<!DOCTYPE html>
<html lang="pt-BR">
    <head><script src="/livereload.js?mindelay=10&amp;v=2&amp;port=1313&amp;path=livereload" data-no-instant defer></script>
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="robots" content="noodp" />
        <title>Terraform: Criando uma infraestrutura no Google Cloud - Marcelo Cavalcante Rocha</title><meta name="Description" content="Uma introdução ao Terraform, da Hashicorp, como robusta e eficiente ferramenta para infraestrutura como código. Criando infraestrutura na nuvem GCP, do Google."><meta property="og:url" content="//blog.marcelocavalcante.net:1313/posts/20181124terraform-criando-uma-infraestrutura-no/">
  <meta property="og:site_name" content="Marcelo Cavalcante Rocha">
  <meta property="og:title" content="Terraform: Criando uma infraestrutura no Google Cloud">
  <meta property="og:description" content="Uma introdução ao Terraform, da Hashicorp, como robusta e eficiente ferramenta para infraestrutura como código. Criando infraestrutura na nuvem GCP, do Google.">
  <meta property="og:locale" content="pt_BR">
  <meta property="og:type" content="article">
    <meta property="article:section" content="posts">
    <meta property="article:published_time" content="2018-11-24T21:04:44-05:00">
    <meta property="article:modified_time" content="2018-11-24T21:04:44-05:00">
    <meta property="article:tag" content="Devops">
    <meta property="article:tag" content="Terraform">
    <meta property="article:tag" content="Cloud">
    <meta property="article:tag" content="GCP">
    <meta property="article:tag" content="Docker">
    <meta property="article:tag" content="Kubernetes">
    <meta property="og:image" content="//blog.marcelocavalcante.net:1313/posts/20181124terraform-criando-uma-infraestrutura-no/featured-image.jpeg">

  <meta name="twitter:card" content="summary_large_image">
  <meta name="twitter:image" content="//blog.marcelocavalcante.net:1313/posts/20181124terraform-criando-uma-infraestrutura-no/featured-image.jpeg">
  <meta name="twitter:title" content="Terraform: Criando uma infraestrutura no Google Cloud">
  <meta name="twitter:description" content="Uma introdução ao Terraform, da Hashicorp, como robusta e eficiente ferramenta para infraestrutura como código. Criando infraestrutura na nuvem GCP, do Google.">
<meta name="application-name" content="Marcelo Cavalcante">
<meta name="apple-mobile-web-app-title" content="Marcelo Cavalcante">
<meta name="referrer" content="no-referrer" /><meta name="theme-color" content="#ffffff"><meta name="msapplication-TileColor" content="#da532c"><link rel="shortcut icon" type="image/x-icon" href="/favicon.ico" />
        <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
        <link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png"><link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png"><link rel="mask-icon" href="/safari-pinned-tab.svg" color="#5bbad5"><link rel="manifest" href="/site.webmanifest"><link rel="canonical" href="//blog.marcelocavalcante.net:1313/posts/20181124terraform-criando-uma-infraestrutura-no/" /><link rel="prev" href="//blog.marcelocavalcante.net:1313/posts/terraform-variaveis-e-outputs/" /><link rel="next" href="//blog.marcelocavalcante.net:1313/posts/de-volta-com-novo-visual/" /><link rel="stylesheet" href="/css/style.min.css"><link rel="preload" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.7.2/css/all.min.css" as="style" onload="this.onload=null;this.rel='stylesheet'">
        <noscript><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.7.2/css/all.min.css"></noscript><link rel="preload" href="https://cdn.jsdelivr.net/npm/animate.css@4.1.1/animate.min.css" as="style" onload="this.onload=null;this.rel='stylesheet'">
        <noscript><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/animate.css@4.1.1/animate.min.css"></noscript><script type="application/ld+json">
    {
        "@context": "http://schema.org",
        "@type": "BlogPosting",
        "headline": "Terraform: Criando uma infraestrutura no Google Cloud",
        "inLanguage": "pt-BR",
        "mainEntityOfPage": {
            "@type": "WebPage",
            "@id": "\/\/blog.marcelocavalcante.net:1313\/posts\/20181124terraform-criando-uma-infraestrutura-no\/"
        },"image": [{
                            "@type": "ImageObject",
                            "url": "\/\/blog.marcelocavalcante.net:1313\/posts\/20181124terraform-criando-uma-infraestrutura-no\/featured-image.jpeg",
                            "width":  1400 ,
                            "height":  933 
                        }],"genre": "posts","keywords": "Devops, Terraform, Cloud, GCP, Docker, Kubernetes","wordcount":  4965 ,
        "url": "\/\/blog.marcelocavalcante.net:1313\/posts\/20181124terraform-criando-uma-infraestrutura-no\/","datePublished": "2018-11-24T21:04:44-05:00","dateModified": "2018-11-24T21:04:44-05:00","publisher": {
            "@type": "Organization",
            "name": ""},"author": {
                "@type": "Person",
                "name": "Marcelo Cavalcante"
            },"description": "Uma introdução ao Terraform, da Hashicorp, como robusta e eficiente ferramenta para infraestrutura como código. Criando infraestrutura na nuvem GCP, do Google."
    }
    </script></head>
    <body data-header-desktop="fixed" data-header-mobile="auto"><script>
          const query = window.matchMedia('(prefers-color-scheme: dark)');
          function applyTheme() {
            let theme = window.localStorage?.getItem('theme') || 'auto';
            let isDark = theme === 'dark' || (theme === 'auto' && query.matches);
            document.body.setAttribute('theme', isDark? 'dark' : 'light');
            document.body.setAttribute('cfg-theme', theme);
          }

          applyTheme();
          query.addEventListener('change', applyTheme);
        </script>

        <div id="mask"></div><div class="wrapper"><header class="desktop" id="header-desktop">
    <div class="header-wrapper">
        <div class="header-title">
            <a href="/" title="Marcelo Cavalcante Rocha"><img
        class="lazyload logo"
        src="/svg/loading.min.svg"
        data-src="https://marcelocavalcante.net/ftp/logonew.png"
        data-srcset="https://marcelocavalcante.net/ftp/logonew.png, https://marcelocavalcante.net/ftp/logonew.png 1.5x, https://marcelocavalcante.net/ftp/logonew.png 2x"
        data-sizes="auto"
        alt="https://marcelocavalcante.net/ftp/logonew.png"
        title="https://marcelocavalcante.net/ftp/logonew.png" />A sabedoria se constrói no silêncio paciente de todos os dias.</a>
        </div>
        <div class="menu">
            <div class="menu-inner"><a class="menu-item" href="/posts/"> Posts </a><a class="menu-item" href="/tags/"> Tags </a><a class="menu-item" href="/categories/"> Categorias </a><a class="menu-item" href="/sobre/"> Quem Sou </a><span class="menu-item delimiter"></span><span class="menu-item search" id="search-desktop">
                        <input type="text" placeholder="Pesquisar títulos ou conteúdos ..." id="search-input-desktop">
                        <a href="javascript:void(0);" class="search-button search-toggle" id="search-toggle-desktop" title="Pesquisa">
                            <i class="fas fa-search fa-fw" aria-hidden="true"></i>
                        </a>
                        <a href="javascript:void(0);" class="search-button search-clear" id="search-clear-desktop" title="Limpar">
                            <i class="fas fa-times-circle fa-fw" aria-hidden="true"></i>
                        </a>
                        <span class="search-button search-loading" id="search-loading-desktop">
                            <i class="fas fa-spinner fa-fw fa-spin" aria-hidden="true"></i>
                        </span>
                    </span><a href="javascript:void(0);" class="menu-item theme-switch" title="Trocar tema">
                    <i class="fas fa-adjust fa-fw" aria-hidden="true"></i>
                </a></div>
        </div>
    </div>
</header><header class="mobile" id="header-mobile">
    <div class="header-container">
        <div class="header-wrapper">
            <div class="header-title">
                <a href="/" title="Marcelo Cavalcante Rocha"><img
        class="lazyload logo"
        src="/svg/loading.min.svg"
        data-src="https://marcelocavalcante.net/ftp/logonew.png"
        data-srcset="https://marcelocavalcante.net/ftp/logonew.png, https://marcelocavalcante.net/ftp/logonew.png 1.5x, https://marcelocavalcante.net/ftp/logonew.png 2x"
        data-sizes="auto"
        alt="https://marcelocavalcante.net/ftp/logonew.png"
        title="https://marcelocavalcante.net/ftp/logonew.png" />A sabedoria se constrói no silêncio paciente de todos os dias.</a>
            </div>
            <div class="menu-toggle" id="menu-toggle-mobile">
                <span></span><span></span><span></span>
            </div>
        </div>
        <div class="menu" id="menu-mobile"><div class="search-wrapper">
                    <div class="search mobile" id="search-mobile">
                        <input type="text" placeholder="Pesquisar títulos ou conteúdos ..." id="search-input-mobile">
                        <a href="javascript:void(0);" class="search-button search-toggle" id="search-toggle-mobile" title="Pesquisa">
                            <i class="fas fa-search fa-fw" aria-hidden="true"></i>
                        </a>
                        <a href="javascript:void(0);" class="search-button search-clear" id="search-clear-mobile" title="Limpar">
                            <i class="fas fa-times-circle fa-fw" aria-hidden="true"></i>
                        </a>
                        <span class="search-button search-loading" id="search-loading-mobile">
                            <i class="fas fa-spinner fa-fw fa-spin" aria-hidden="true"></i>
                        </span>
                    </div>
                    <a href="javascript:void(0);" class="search-cancel" id="search-cancel-mobile">
                        Cancelar
                    </a>
                </div><a class="menu-item" href="/posts/" title="">Posts</a><a class="menu-item" href="/tags/" title="">Tags</a><a class="menu-item" href="/categories/" title="">Categorias</a><a class="menu-item" href="/sobre/" title="">Quem Sou</a><a href="javascript:void(0);" class="menu-item theme-switch" title="Trocar tema">
                <i class="fas fa-adjust fa-fw" aria-hidden="true"></i>
            </a></div>
    </div>
</header><div class="search-dropdown desktop">
        <div id="search-dropdown-desktop"></div>
    </div>
    <div class="search-dropdown mobile">
        <div id="search-dropdown-mobile"></div>
    </div><main class="main">
                <div class="container"><div class="toc" id="toc-auto">
            <h2 class="toc-title">Conteúdos</h2>
            <div class="toc-content" id="toc-content-auto"></div>
        </div><article class="page single"><h1 class="single-title animate__animated animate__flipInX">Terraform: Criando uma infraestrutura no Google Cloud</h1><div class="post-meta">
            <div class="post-meta-line"><span class="post-author"><a href="https://blog.marcelocavalcante.net" title="Author" target="_blank" rel="noopener noreffer author" class="author"><i class="fas fa-user-circle fa-fw" aria-hidden="true"></i>Marcelo Cavalcante</a></span></div>
            <div class="post-meta-line"><i class="far fa-calendar-alt fa-fw" aria-hidden="true"></i>&nbsp;<time datetime="2018-11-24">2018-11-24</time>&nbsp;<i class="fas fa-pencil-alt fa-fw" aria-hidden="true"></i>&nbsp;4965 palavras&nbsp;
                <i class="far fa-clock fa-fw" aria-hidden="true"></i>&nbsp;24 minutos&nbsp;</div>
        </div><div class="featured-image"><img
        class="lazyload"
        src="/svg/loading.min.svg"
        data-src="/posts/20181124terraform-criando-uma-infraestrutura-no/featured-image.jpeg"
        data-srcset="/posts/20181124terraform-criando-uma-infraestrutura-no/featured-image.jpeg, /posts/20181124terraform-criando-uma-infraestrutura-no/featured-image.jpeg 1.5x, /posts/20181124terraform-criando-uma-infraestrutura-no/featured-image.jpeg 2x"
        data-sizes="auto"
        alt="/posts/20181124terraform-criando-uma-infraestrutura-no/featured-image.jpeg"
        title="Uma introdução ao Terraform, da Hashicorp, como robusta e eficiente ferramenta para infraestrutura como código. Criando infraestrutura na nuvem GCP, do Google." /></div><div class="details toc" id="toc-static"  data-kept="">
                <div class="details-summary toc-title">
                    <span>Conteúdos</span>
                    <span><i class="details-icon fas fa-angle-right" aria-hidden="true"></i></span>
                </div>
                <div class="details-content toc-content" id="toc-content-static"><nav id="TableOfContents">
  <ul>
    <li><a href="#introdução">Introdução</a></li>
    <li><a href="#gcp---google-cloud-platform">GCP - Google Cloud Platform</a>
      <ul>
        <li><a href="#cadastro">Cadastro</a></li>
        <li><a href="#criando-uma-conta-de-serviço-ou-service-account">Criando uma conta de serviço ou service account</a></li>
        <li><a href="#google-cloud-sdk">Google Cloud SDK</a></li>
      </ul>
    </li>
    <li><a href="#terraform">Terraform</a></li>
  </ul>
</nav></div>
            </div><div class="content" id="content"><p><strong>Q</strong>uando se fala em infraestrutura como código imagina-se algo mais complexo do que simplesmente um container docker rodando uma aplicação, certo?! O propósito deste post é justamente criar uma infraestrutura um pouco mais complexa e completa no GCP, <em>Google Cloud Platform</em>. Embora o Terraform possua integração com diversos provedores de computação em nuvem, utilizarei o Google Cloud para este post por estar trabalhando mais com GCP atualmente e estar gostando da experiência.</p>
<h2 id="introdução">Introdução</h2>
<p><strong>U</strong>ma vez que não entrarei em tantos detalhes básicos do Terraform neste post, espero que você já possua algum conhecimento básico sobre o mesmo bem como entenda como funcionam seus <em>resources</em>, <em>variables</em>, etc. Do contrário, recomendo <strong>fortemente</strong> que você volte um pouco e leia meus posts anteriores nesta respectiva ordem:</p>
<ul>
<li><a href="/infraestrutura-como-c%C3%B3digo-com-terraform/" rel="">Infraestrutura como Código com Terraform</a></li>
<li><!-- raw HTML omitted -->Introdução ao Terraform<!-- raw HTML omitted --></li>
<li><!-- raw HTML omitted -->Terraform: Variáveis e Outputs<!-- raw HTML omitted --></li>
</ul>
<p><strong>A</strong>ssumindo que você já possui algum conhecimento básico sobre Terraform, chegou a hora de inciarmos o nosso pequeno projeto de infraestrutura como código.</p>
<h2 id="gcp---google-cloud-platform">GCP - Google Cloud Platform</h2>
<p><img
        class="lazyload"
        src="/svg/loading.min.svg"
        data-src="/img/gcloud.png"
        data-srcset="/img/gcloud.png, /img/gcloud.png 1.5x, /img/gcloud.png 2x"
        data-sizes="auto"
        alt="/img/gcloud.png"
        title="Google Cloud Platform" />
<strong>G</strong>oogle Cloud Platform, ou GCP, é uma suíte de computação em nuvem oferecida pelo Google, funcionando na mesma infraestrutura que a empresa utiliza para seus produtos dirigidos aos usuários, dentre eles o buscador Google e o Youtube. Juntamente com um conjunto de ferramentas de gerenciamento modulares, o GCP fornece uma série de serviços incluindo computação, armazenamento de dados, análise de dados, machine learning, containers, etc.</p>
<p><strong>N</strong>ovamente, o motivo pelo qual optei por utilizar GCP para este pequeno projeto foi simplesmente o fato de eu estar trabalhando mais com GCP em meu dia a dia atual, mas nada impede que você utilize AWS ou Microsoft Azure, por exemplo. Embora a sintaxe e o código Terraform deverá ser ajustado para tais plataformas caso decida utilizá-las.</p>
<p><strong>O</strong>utro motivo interessante é o plano gratuito oferecido pelo Google, o que facilita nossos estudos e experimentos. O GCP nos oferece 1 ano de utilização grátis OU $300 dólares em créditos, o que ocorrer primeiro. De uma forma ou de outra, isto será muito mais que o suficiente para a execução deste nosso projeto.</p>
<p><strong>A</strong>lém das duas razões já citadas, a integração e facilidade de criação de uma nova conta no GCP foi levada em conta para esta escolha. O fato de o gmail e demais serviços do Google serem amplamente utilizados, é bem provável que você possua um email do Google (gmail, por exemplo), certo!? Se este é o caso, você já possui uma &ldquo;pré-conta&rdquo; no GCP sem ao menos saber.</p>
<h3 id="cadastro">Cadastro</h3>
<p><strong>S</strong>e você possui uma conta do Google, autentique-se com a mesma. Caso não possua uma, você poderá criar uma através do Gmail, por exemplo, ou criar diretamente na interface do Google Cloud durante o cadastro.</p>
<p>1-   Uma vez logado com sua conta do Google, acesse em seu navegador o seguinte endereço: <!-- raw HTML omitted -->Google Cloud Console<!-- raw HTML omitted --> ;</p>
<p>2-   Caso esteja logado com sua conta do Google, verá sua foto ou imagem de conta no canto superior direito da página conforme na imagem a seguir. Clique em <em>Try free</em> ou Experimente Gratuitamente;
<img
        class="lazyload"
        src="/svg/loading.min.svg"
        data-src="/img/gcloud1.png"
        data-srcset="/img/gcloud1.png, /img/gcloud1.png 1.5x, /img/gcloud1.png 2x"
        data-sizes="auto"
        alt="/img/gcloud1.png"
        title="Google Cloud Platform" />
3-   Você cairá na primeira página do cadastro. Informe seu País, leia e concorde com os termos de uso caso deseje seguir e em seguida clique em Concordar e Continuar;
<img
        class="lazyload"
        src="/svg/loading.min.svg"
        data-src="/img/gcloud2.png"
        data-srcset="/img/gcloud2.png, /img/gcloud2.png 1.5x, /img/gcloud2.png 2x"
        data-sizes="auto"
        alt="/img/gcloud2.png"
        title="Google Cloud Platform" />
4-   Após confirmar e validar todas as informações que eles pedem na etapa 2, clique em Iniciar minha avaliação gratuita;
<img
        class="lazyload"
        src="/svg/loading.min.svg"
        data-src="/img/gcloud3.png"
        data-srcset="/img/gcloud3.png, /img/gcloud3.png 1.5x, /img/gcloud3.png 2x"
        data-sizes="auto"
        alt="/img/gcloud3.png"
        title="Google Cloud Platform" />
<strong>E</strong>m poucos segundos você deverá cair no painel ou <em>dashboard</em> principal do GCP, com um popup de boas vindas com alguma mensagem de boas vindas: &ldquo;Olá, Marcelo, Agradecemos por você se inscrever na avaliação gratuita de 12 meses. Demos US$ 300 de crédito grátis para você gastar. Não se preocupe se o crédito acabar, você só receberá cobranças se tivermos sua permissão.&rdquo;</p>
<p><strong>E</strong>ste é outro fator interessante do GCP. Durante este período de avaliação, você não corre o risco de ser cobrado caso utilize mais do que deveria por descuido. Uma vez que o período de 12 meses, ou o crédito de $300 tenha se esgotado, você será notificado e deverá encerrar sua conta ou confirmar que deseja continuar utilizando os serviços, autorizando assim o Google a lhe efetuar cobranças a partir deste momento.</p>
<p><strong>O</strong> painel principal se parecerá com este:
<img
        class="lazyload"
        src="/svg/loading.min.svg"
        data-src="/img/gcloud4.png"
        data-srcset="/img/gcloud4.png, /img/gcloud4.png 1.5x, /img/gcloud4.png 2x"
        data-sizes="auto"
        alt="/img/gcloud4.png"
        title="Google Cloud Platform" />
<strong>C</strong>onforme a imagem abaixo, através do Menu principal que se encontra na lateral esquerda, clique em <strong>IAM e Admin</strong>, e em seguida em <strong>Gerenciar recursos</strong>.
<img
        class="lazyload"
        src="/svg/loading.min.svg"
        data-src="/img/gcloud5.png"
        data-srcset="/img/gcloud5.png, /img/gcloud5.png 1.5x, /img/gcloud5.png 2x"
        data-sizes="auto"
        alt="/img/gcloud5.png"
        title="Google Cloud Platform" />
<strong>V</strong>ocê receberá uma listagem inicial de seus recursos. Por padrão, quando se cria uma nova conta no GCP, apenas um projeto inicial é criado, chamado My First Project, sem qualquer recurso vinculado ou inserido no mesmo.</p>
<h3 id="criando-uma-conta-de-serviço-ou-service-account">Criando uma conta de serviço ou service account</h3>
<p>Embora seja possível e permitido utilizar-se de uma conta pessoal para este tipo de tarefa, não é o mais indicado. O ideal é deixar serviços utilizarem contas específicas, as chamadas service accounts. Uma vez que utilizaremos o Terraform para criar nossos recursos na nuvem, ele não deixa de funcionar como um serviço, não sendo uma pessoa XYZ de um departamento qualquer de uma empresa.</p>
<p>1-   No menu principal da lateral esquerda, clique em <strong>IAM e Admin</strong>, em seguida em <strong>Contas de serviço</strong>, conforme na imagem abaixo:
<img
        class="lazyload"
        src="/svg/loading.min.svg"
        data-src="/img/gcloud7.png"
        data-srcset="/img/gcloud7.png, /img/gcloud7.png 1.5x, /img/gcloud7.png 2x"
        data-sizes="auto"
        alt="/img/gcloud7.png"
        title="Google Cloud Platform" />
2-   Na tela de Contas de serviço, clique em <strong>Criar conta de serviço</strong>;</p>
<p>3-   Indique o nome <strong>terraform</strong> para esta conta, conforme imagem abaixo, e clique em <strong>CRIAR</strong>;
<img
        class="lazyload"
        src="/svg/loading.min.svg"
        data-src="/img/gcloud8.png"
        data-srcset="/img/gcloud8.png, /img/gcloud8.png 1.5x, /img/gcloud8.png 2x"
        data-sizes="auto"
        alt="/img/gcloud8.png"
        title="Google Cloud Platform" />
4-   No passo 2, daremos um papel para esta conta de serviço. Aqui indicaremos quais permissões ela terá. Para facilitar nosso exercício, utilizaremos <strong>Projeto</strong> &gt; <strong>Proprietário</strong>, significando que nossa conta de serviço terá todas as permissões em nosso projeto, podendo criar ou destruir qualquer tipo de recurso.
<img
        class="lazyload"
        src="/svg/loading.min.svg"
        data-src="/img/gcloud9.png"
        data-srcset="/img/gcloud9.png, /img/gcloud9.png 1.5x, /img/gcloud9.png 2x"
        data-sizes="auto"
        alt="/img/gcloud9.png"
        title="Google Cloud Platform" />
5-   Em seguida, clicaremos em <strong>Continuar</strong> para seguir com a criação de nossa conta de serviço;</p>
<p>6-   Na tela seguinte lhe será dada a opção de dar permissões para algum usuário que possa precisar utilizar-se desta conta de serviço para criar recursos. Você pode inserir neste campo o seu usuário principal do google cloud, o qual será o seu email que foi utilizado para criar esta conta no GCP. Insira-o em <em>Papel de usuários da conta de serviço</em>. Em seguida, clique no botão de <em>Criar Chave</em> que se encontra logo abaixo. Esta será a chave criptografada que utilizaremos para comunicação segura com o GCP;
<img
        class="lazyload"
        src="/svg/loading.min.svg"
        data-src="/img/gcloud10.png"
        data-srcset="/img/gcloud10.png, /img/gcloud10.png 1.5x, /img/gcloud10.png 2x"
        data-sizes="auto"
        alt="/img/gcloud10.png"
        title="Google Cloud Platform" />
7-   Lhe será perguntado em que formato você deseja slavar a chave. Escolha o formato JSON e clique em <strong>CRIAR</strong>;</p>
<p>8-   Escolha com atenção o local onde salvará esta chave, pois você não poderá baixá-la novamente e precisaremos da mesma posteriormente;</p>
<p><strong>OBS:</strong> Para facilitar este exemplo, estarei salvando a chave no mesmo diretório no qual criaremos o código de nosso projeto. Caso você decida fazer o mesmo, e decida hospedar este código em alguma espécie de repositório git, por exemplo, lembre-se de <strong>sempre</strong> incluir esta e outras chaves ou dados sigilosos em seu <em>.gitignore</em>, para que este tipo de arquivo com informações confidenciais não seja enviado para o repositório juntamente com o código. =) (Sim, já vi pessoas hospedando chaves em repositórios git e tendo sérios problemas. Sim, é você mesmo. :p)</p>
<h3 id="google-cloud-sdk">Google Cloud SDK</h3>
<p><strong>U</strong>m dos nossos pré-requisitos será o Google Cloud SDK, que possui um conjunto de ferramentas via linha de comando que nos permitem interagir com o Google Cloud remotamente através de APIs. O Terraform também fará uso desta ferramenta.</p>
<p><strong>P</strong>ara o funcionamento do gcloud SDK precisaremos também possuir o Python instalado, na versão 2.7. Você poderá confirmar a sua versão do python executando <em>python -V</em> em algum console ou terminal.</p>
<p><strong>I</strong>nformações detalhadas sobre como instalar o Gcloud SDK encontram-se com excelentes detalhes nas páginas oficiais do Google, listadas abaixo:</p>
<ul>
<li>
<p>Para Linux (genérico): <!-- raw HTML omitted -->Aqui<!-- raw HTML omitted --></p>
</li>
<li>
<p>Para Linux (Debian e Ubuntu): <!-- raw HTML omitted -->Aqui<!-- raw HTML omitted --></p>
</li>
<li>
<p>Para Linux (Red Hat e CentOS): &lt;a href=&ldquo;<a href="https://cloud.google.com/sdk/docs/quickstart-redhat-centos%22" target="_blank" rel="noopener noreffer ">https://cloud.google.com/sdk/docs/quickstart-redhat-centos"</a> target=_blank&rdquo;&gt;Aqui<!-- raw HTML omitted --></p>
</li>
<li>
<p>Para Mac OS X: <!-- raw HTML omitted -->Aqui<!-- raw HTML omitted --></p>
</li>
<li>
<p>Para Windows: <!-- raw HTML omitted -->Aqui<!-- raw HTML omitted --></p>
</li>
</ul>
<p><strong>É</strong> importante lembrar de reiniciar o seu terminal ou console após a instalação.</p>
<p><strong>P</strong>ara certificar-se de que a instalação foi realizada com sucesso, execute:</p>
<div class="code-block code-line-numbers open" style="counter-reset: code-block 0">
    <div class="code-header language-yaml">
        <span class="code-title"><i class="arrow fas fa-angle-right fa-fw" aria-hidden="true"></i></span>
        <span class="ellipses"><i class="fas fa-ellipsis-h fa-fw" aria-hidden="true"></i></span>
        <span class="copy" title="Copiar para a área de transferência"><i class="far fa-copy fa-fw" aria-hidden="true"></i></span>
    </div><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-yaml" data-lang="yaml"><span class="line"><span class="cl"><span class="l">$ gcloud --version</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="l">Google Cloud SDK 225.0.0</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="l">bq 2.0.37</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="l">core 2018.11.09</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="l">gsutil 4.34</span></span></span></code></pre></div></div>
<p><strong>S</strong>e você recebeu informações referentes à versão do Google Cloud SDK, significa que a instalação foi bem sucedida. O próximo passo é autenticar-se com sua conta do google através do SDK. Execute <em>gcloud init</em>. O seu navegador deverá abrir automaticamente lhe pedindo a autenticação de sua conta do Google após você confirmar com um <em>Y</em> a solicitação no console ou terminal.</p>
<div class="code-block code-line-numbers open" style="counter-reset: code-block 0">
    <div class="code-header language-yaml">
        <span class="code-title"><i class="arrow fas fa-angle-right fa-fw" aria-hidden="true"></i></span>
        <span class="ellipses"><i class="fas fa-ellipsis-h fa-fw" aria-hidden="true"></i></span>
        <span class="copy" title="Copiar para a área de transferência"><i class="far fa-copy fa-fw" aria-hidden="true"></i></span>
    </div><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-yaml" data-lang="yaml"><span class="line"><span class="cl"><span class="l">$ gcloud init</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="l">Welcome! This command will take you through the configuration of gcloud.</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">Your current configuration has been set to</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="l">default]</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">You can skip diagnostics next time by using the following flag</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="l">gcloud init --skip-diagnostics</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="l">Network diagnostic detects and fixes local network connection issues.</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="l">Checking network connection...done.</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="l">Reachability Check passed.</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="l">Network diagnostic passed (1/1 checks passed).</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="l">You must log in to continue. Would you like to log in (Y/n)?</span></span></span></code></pre></div></div>
<p><strong>C</strong>aso ao inserir um <em>Y</em>, o seu navegador não lhe solicite a autenticação do Google, copie e cole a longa URL que lhe será apresentada.</p>
<p><strong>A</strong> solicitação de autenticação será similar à esta:
<img
        class="lazyload"
        src="/svg/loading.min.svg"
        data-src="/img/gcloud6.png"
        data-srcset="/img/gcloud6.png, /img/gcloud6.png 1.5x, /img/gcloud6.png 2x"
        data-sizes="auto"
        alt="/img/gcloud6.png"
        title="Google Cloud Platform" />
<strong>A</strong>o finalizar sua autenticação no navegador, você receberá mais uma pergunta em seu terminal ou console. O SDK lhe indicará o seu projeto e lhe perguntará se você quer utilizá-lo ou criar um novo. Vamos escolher a opção <em>1</em>, para utilizar o projeto que foi criado automaticamente e em seguida confirmar com um Enter:</p>
<div class="code-block code-line-numbers open" style="counter-reset: code-block 0">
    <div class="code-header language-yaml">
        <span class="code-title"><i class="arrow fas fa-angle-right fa-fw" aria-hidden="true"></i></span>
        <span class="ellipses"><i class="fas fa-ellipsis-h fa-fw" aria-hidden="true"></i></span>
        <span class="copy" title="Copiar para a área de transferência"><i class="far fa-copy fa-fw" aria-hidden="true"></i></span>
    </div><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-yaml" data-lang="yaml"><span class="line"><span class="cl"><span class="nt">Your browser has been opened to visit</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="l">https://accounts.google.com/o/oauth2/auth?reblablabalblablaba=http%3A%2F%2Flocalhost%3A8085%2F&amp;prompt=select_account&amp;response_typereblablabalblablabauid.apps.googleusercontent.com&amp;scope=https%3A%2F%2Fwww.googleapis.com%reblablabalblablabaemreblablabalblablabaw.gooreblablabalblablaba%2Fauth%2Fclreblablabalblablaba%2Fwwwreblablabalblablabacomreblablabalblablabaappenreblablabalblablabattpsreblablabalblablabaww.reblablabalblablabaleapis.com%2Fauthreblablabalblablabattps%3A%2F%2Fwww.googleapis.com%2Fauthreblablabalblablaba&amp;access_type=offline</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">You are logged in as</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="l">marcelo@marceloemail.net].</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">Pick cloud project to use</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"> </span><span class="p">[</span><span class="m">1</span><span class="p">]</span><span class="w"> </span><span class="l">possible-sun-meuid</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"> </span><span class="p">[</span><span class="m">2</span><span class="p">]</span><span class="w"> </span><span class="l">Create a new project</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="l">Please enter numeric choice or text value (must exactly match list</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="l">item):</span></span></span></code></pre></div></div>
<p><strong>O</strong> SDK finalizará o setup e lhe informará que o projeto está pronto para ser utilizado.</p>
<h2 id="terraform">Terraform</h2>
<p><img
        class="lazyload"
        src="/svg/loading.min.svg"
        data-src="/img/terraform_badge.png"
        data-srcset="/img/terraform_badge.png, /img/terraform_badge.png 1.5x, /img/terraform_badge.png 2x"
        data-sizes="auto"
        alt="/img/terraform_badge.png"
        title="Terraform" />
<strong>V</strong>amos ao que interessa agora. Antes de iniciarmos nosso código, crie um diretório chamado <em>terraform-gcp</em>, ou algo de sua preferência. Dentro deste diretório apenas teremos por enquanto o arquivo JSON que baixamos do GCP com as credenciais de nossa conta de serviço.</p>
<p><strong>C</strong>riaremos agora nosso primeiro arquivo terraform.</p>
<p><strong>C</strong>omecemos criando nosso arquivo de variáveis, o qual por enquanto conterá apenas 2 variáveis para começarmos nosso código. Crie o arquivo <em>variables.tf</em> com o seguinte conteúdo:</p>
<div class="code-block code-line-numbers open" style="counter-reset: code-block 0">
    <div class="code-header language-py">
        <span class="code-title"><i class="arrow fas fa-angle-right fa-fw" aria-hidden="true"></i></span>
        <span class="ellipses"><i class="fas fa-ellipsis-h fa-fw" aria-hidden="true"></i></span>
        <span class="copy" title="Copiar para a área de transferência"><i class="far fa-copy fa-fw" aria-hidden="true"></i></span>
    </div><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-py" data-lang="py"><span class="line"><span class="cl"><span class="n">variable</span> <span class="s2">&#34;project_id&#34;</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="nb">type</span>    <span class="o">=</span> <span class="s2">&#34;string&#34;</span>
</span></span><span class="line"><span class="cl">  <span class="n">default</span> <span class="o">=</span> <span class="s2">&#34;possible-sun-83482736&#34;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">variable</span> <span class="s2">&#34;regiao&#34;</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="nb">type</span> <span class="o">=</span> <span class="s2">&#34;string&#34;</span>
</span></span><span class="line"><span class="cl">  <span class="n">default</span> <span class="o">=</span> <span class="s2">&#34;northamerica-northeast1&#34;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span></span></span></code></pre></div></div>
<p><strong>OBS:</strong> Lembre-se de alterar o valor default da variável <em>project_id</em>. Eu inseri aqui o id do projeto que foi criado para mim pelo GCP automaticamente. O id do seu projeto deverá ser o mesmo fornecido a você pelo GCP.</p>
<p><strong>O</strong>utra coisa importante é lembrar que estou assumindo que você já possui algum conhecimento básico sobre como o Terraform funciona, ou que leu meus posts anteriores sobre o assunto, de forma que não estarei aqui entrando em tantos detalhes explicativos sobre cada arquivo, conforme fiz nos anteriores.</p>
<p><strong>E</strong>m nosso arquivo <em>variables.tf</em>, por enquanto, criamos apenas duas variáveis: <em>project_id</em> e <em>regiao</em>. Para quem já utilizou algum serviço de computação em nuvem, seja GCP, AWS, Azure, etc., isto pode soar familiar. Sempre que se deseja criar recursos na nuvem, devemos optar por alguma região disponível no provedor de escolha. Estou optando por utilizar <em>northamerica-northeast1</em> pelo fato de eu morar em Toronto, e esta ser a região mais próxima, mas sinta-se livre para optar por qualquer região disponível no GCP conforme <!-- raw HTML omitted -->lista fornecida aqui<!-- raw HTML omitted -->.</p>
<p><strong>E</strong>m seguida criaremos nosso arquivo <em>main.tf</em> que, inicialmente, possuirá apenas o seguinte:</p>
<div class="code-block code-line-numbers open" style="counter-reset: code-block 0">
    <div class="code-header language-py">
        <span class="code-title"><i class="arrow fas fa-angle-right fa-fw" aria-hidden="true"></i></span>
        <span class="ellipses"><i class="fas fa-ellipsis-h fa-fw" aria-hidden="true"></i></span>
        <span class="copy" title="Copiar para a área de transferência"><i class="far fa-copy fa-fw" aria-hidden="true"></i></span>
    </div><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-py" data-lang="py"><span class="line"><span class="cl"><span class="c1"># Configura o projeto GCP</span>
</span></span><span class="line"><span class="cl"><span class="n">provider</span> <span class="s2">&#34;google&#34;</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="n">credentials</span> <span class="o">=</span> <span class="s2">&#34;${file(&#34;</span><span class="n">possible</span><span class="o">-</span><span class="n">sun</span><span class="o">-</span><span class="mi">83482736</span><span class="o">-</span><span class="n">sabh45jhb2345ghv</span><span class="o">.</span><span class="n">json</span><span class="s2">&#34;)}&#34;</span>
</span></span><span class="line"><span class="cl">  <span class="n">project</span>     <span class="o">=</span> <span class="s2">&#34;$</span><span class="si">{var.project_id}</span><span class="s2">&#34;</span>
</span></span><span class="line"><span class="cl">  <span class="n">region</span>      <span class="o">=</span> <span class="s2">&#34;$</span><span class="si">{var.regiao}</span><span class="s2">&#34;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span></span></span></code></pre></div></div>
<p><strong>A</strong>qui estamos apenas informando ao Terraform que utilizaremos o <em>google</em> como provedor ou <em>provider</em>. Para nos conectarmos com o <em>provider</em> precisamos passar nossas credenciais e para tal estamos apontando o arquivo ou <em>file</em> que baixamos do GCP com as informações de nossa conta de serviço. Aqui estou passando apenas o nome do arquivo, pois o mesmo se encontra no mesmo diretório onde se encontra meu código.</p>
<p><strong>A</strong>lém da credencial, estamos também informando qual o nome do projeto que utilizaremos no GCP bem como a região na qual estaremos trabalhando. Ambos os valores estão sendo trazidos do arquivo <em>variables.tf</em>. Aqui apenas invocamos as variáveis. (Novamente: Se esta invocação das variáveis lhe parece confusa, significa que não leu o post anterior, onde expliquei o básico sobre uso de variáveis no Terraform. Volte uma casa!)</p>
<p><strong>C</strong>om ambos os arquivos criados, podemos iniciar a execução de nosso projeto. Neste momento, nosso código não fará nada além de permitir que o Terraform consiga se conectar ao GCP e validar que nossa conta e projeto de fato existem. Executemos <em>terraform init</em> para ver se está tudo certo:</p>
<div class="code-block code-line-numbers open" style="counter-reset: code-block 0">
    <div class="code-header language-yaml">
        <span class="code-title"><i class="arrow fas fa-angle-right fa-fw" aria-hidden="true"></i></span>
        <span class="ellipses"><i class="fas fa-ellipsis-h fa-fw" aria-hidden="true"></i></span>
        <span class="copy" title="Copiar para a área de transferência"><i class="far fa-copy fa-fw" aria-hidden="true"></i></span>
    </div><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-yaml" data-lang="yaml"><span class="line"><span class="cl"><span class="l">$ terraform init</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="l">Initializing provider plugins...</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span>- <span class="l">Checking for available provider plugins on https://releases.hashicorp.com...</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span>- <span class="l">Downloading plugin for provider &#34;google&#34; (1.19.1)...</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="l">The following providers do not have any version constraints in configuration,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="l">so the latest version was installed.</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="l">To prevent automatic upgrades to new major versions that may contain breaking</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="l">changes, it is recommended to add version = &#34;...&#34; constraints to the</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="l">corresponding provider blocks in configuration, with the constraint strings</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="l">suggested below.</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">* provider.google</span><span class="p">:</span><span class="w"> </span><span class="l">version = &#34;~&gt; 1.19&#34;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="l">Terraform has been successfully initialized!</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="l">You may now begin working with Terraform. Try running &#34;terraform plan&#34; to see</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="l">any changes that are required for your infrastructure. All Terraform commands</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="l">should now work.</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="l">If you ever set or change modules or backend configuration for Terraform,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="l">rerun this command to reinitialize your working directory. If you forget, other</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="l">commands will detect it and remind you to do so if necessary.</span></span></span></code></pre></div></div>
<p><strong>A</strong>o que parece, o nosso <em>state</em> do Terraform foi iniciado com sucesso e tudo parece correto. Vamos tentar criar nosso plano de execução agora com <em>terraform plan</em>:</p>
<div class="code-block code-line-numbers open" style="counter-reset: code-block 0">
    <div class="code-header language-yaml">
        <span class="code-title"><i class="arrow fas fa-angle-right fa-fw" aria-hidden="true"></i></span>
        <span class="ellipses"><i class="fas fa-ellipsis-h fa-fw" aria-hidden="true"></i></span>
        <span class="copy" title="Copiar para a área de transferência"><i class="far fa-copy fa-fw" aria-hidden="true"></i></span>
    </div><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-yaml" data-lang="yaml"><span class="line"><span class="cl"><span class="l">$ terraform plan</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="l">Refreshing Terraform state in-memory prior to plan...</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="l">The refreshed state will be used to calculate this plan, but will not be</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="l">persisted to local or remote state storage.</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nn">---</span>---------------------------------------------------------------------<span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="kc">No</span><span class="w"> </span><span class="l">changes. Infrastructure is up-to-date.</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="l">This means that Terraform did not detect any differences between your</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="l">configuration and real physical resources that exist. As a result, no</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="l">actions need to be performed.</span></span></span></code></pre></div></div>
<p><strong>T</strong>udo parece correto e, assim como dito anteriormente, o Terraform também nos informa que tudo está atualizado e que nenhuma ação precisa ser realizada, afinal não indicamos nada a ser criado, nenhum recurso. Apenas indicamos que utilizaremos um determinado projeto em uma determinada região, e tal projeto já existe no GCP.</p>
<p><strong>V</strong>amos então iniciar a criação de nossa infraestrutura básica. Iniciemos criando uma VM simples.</p>
<p><strong>Q</strong>uando falamos em VMs na nuvem, existem alguns atributos importantes que devemos levar em conta antes de criar a mesma:</p>
<ul>
<li>Nome: Nossa VM precisa ter um nome;</li>
<li>Tipo de máquina: Quando se decide comprar um novo servidor para sua empresa, você terá diversas máquinas disponíveis a venda, algumas com mais memória, outras com menos, CPU, Disco, etc. Da mesma forma funcionam VMs em um ambiente de nuvem como o GCP. Precisamos determinar o tipo de VM que queremos;</li>
<li>Zona: Todo provedor na nuvem ou <em>cloud</em> possui diversas zonas ou regiões disponíveis espalhadas pelo globo, portanto devemos sempre informar onde queremos rodar nossos recursos;</li>
<li>Imagem: Assim como fazemos com um servidor físico, sempre devemos escolher uma imagem ou Sistema Operacional para ser instalado em nossa VM;</li>
</ul>
<p><strong>U</strong>ma vez que tenhamos iuma listagem básica de algumas variáveis importantes para nossa VM, vamos inserí-las em nosso arquivo <em>variables.tf</em>:</p>
<div class="code-block code-line-numbers open" style="counter-reset: code-block 0">
    <div class="code-header language-py">
        <span class="code-title"><i class="arrow fas fa-angle-right fa-fw" aria-hidden="true"></i></span>
        <span class="ellipses"><i class="fas fa-ellipsis-h fa-fw" aria-hidden="true"></i></span>
        <span class="copy" title="Copiar para a área de transferência"><i class="far fa-copy fa-fw" aria-hidden="true"></i></span>
    </div><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-py" data-lang="py"><span class="line"><span class="cl"><span class="n">variable</span> <span class="s2">&#34;project_id&#34;</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="nb">type</span>    <span class="o">=</span> <span class="s2">&#34;string&#34;</span>
</span></span><span class="line"><span class="cl">  <span class="n">default</span> <span class="o">=</span> <span class="s2">&#34;possible-sun-83482736&#34;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">variable</span> <span class="s2">&#34;regiao&#34;</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="nb">type</span> <span class="o">=</span> <span class="s2">&#34;string&#34;</span>
</span></span><span class="line"><span class="cl">  <span class="n">default</span> <span class="o">=</span> <span class="s2">&#34;northamerica-northeast1&#34;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">variable</span> <span class="s2">&#34;nome&#34;</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="nb">type</span> <span class="o">=</span> <span class="s2">&#34;string&#34;</span>
</span></span><span class="line"><span class="cl">  <span class="n">default</span> <span class="o">=</span> <span class="s2">&#34;vm-webserver&#34;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">variable</span> <span class="s2">&#34;tipo_maquina&#34;</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="nb">type</span> <span class="o">=</span> <span class="s2">&#34;string&#34;</span>
</span></span><span class="line"><span class="cl">  <span class="n">default</span> <span class="o">=</span> <span class="s2">&#34;f1-micro&#34;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">variable</span> <span class="s2">&#34;zona&#34;</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="nb">type</span> <span class="o">=</span> <span class="s2">&#34;string&#34;</span>
</span></span><span class="line"><span class="cl">  <span class="n">default</span> <span class="o">=</span> <span class="s2">&#34;northamerica-northeast1-a&#34;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">variable</span> <span class="s2">&#34;imagem&#34;</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="nb">type</span> <span class="o">=</span> <span class="s2">&#34;string&#34;</span>
</span></span><span class="line"><span class="cl">  <span class="n">default</span> <span class="o">=</span> <span class="s2">&#34;debian-cloud/debian-9&#34;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span></span></span></code></pre></div></div>
<p><strong>A</strong>qui criamos 4 novas variáveis. Daremos um nome (vm-webserver) para nossa VM, um tipo de máquina (f1-micro), uma zona (em meu caso utilizarei northamerica-northamerica1-a por ser a mais próxima de mim, mas sinta-se livre para utilizar a que melhor lhe servir) e uma imagem (debian-cloud/debian-9, a qual faz parte da enorme lista de imagens disponíveis no Google).</p>
<p>Agora que temos nossas variáveis definidas, vamos editar o arquivo <em>main.tf</em> para criar nossos recursos para a VM:</p>
<div class="code-block code-line-numbers open" style="counter-reset: code-block 0">
    <div class="code-header language-py">
        <span class="code-title"><i class="arrow fas fa-angle-right fa-fw" aria-hidden="true"></i></span>
        <span class="ellipses"><i class="fas fa-ellipsis-h fa-fw" aria-hidden="true"></i></span>
        <span class="copy" title="Copiar para a área de transferência"><i class="far fa-copy fa-fw" aria-hidden="true"></i></span>
    </div><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-py" data-lang="py"><span class="line"><span class="cl"><span class="c1"># Configura o projeto GCP</span>
</span></span><span class="line"><span class="cl"><span class="n">provider</span> <span class="s2">&#34;google&#34;</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="n">credentials</span> <span class="o">=</span> <span class="s2">&#34;${file(&#34;</span><span class="n">possible</span><span class="o">-</span><span class="n">sun</span><span class="o">-</span><span class="mi">83482736</span><span class="o">-</span><span class="n">sabh45jhb2345ghv</span><span class="o">.</span><span class="n">json</span><span class="s2">&#34;)}&#34;</span>
</span></span><span class="line"><span class="cl">  <span class="n">project</span>     <span class="o">=</span> <span class="s2">&#34;$</span><span class="si">{var.project_id}</span><span class="s2">&#34;</span>
</span></span><span class="line"><span class="cl">  <span class="n">region</span>      <span class="o">=</span> <span class="s2">&#34;$</span><span class="si">{var.regiao}</span><span class="s2">&#34;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># Cria a VM com o Google Compute Engine</span>
</span></span><span class="line"><span class="cl"><span class="n">resource</span> <span class="s2">&#34;google_compute_instance&#34;</span> <span class="s2">&#34;webserver&#34;</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="n">name</span>          <span class="o">=</span> <span class="s2">&#34;$</span><span class="si">{var.nome}</span><span class="s2">&#34;</span>
</span></span><span class="line"><span class="cl">  <span class="n">machine_type</span>  <span class="o">=</span> <span class="s2">&#34;$</span><span class="si">{var.tipo_maquina}</span><span class="s2">&#34;</span>
</span></span><span class="line"><span class="cl">  <span class="n">zone</span>          <span class="o">=</span> <span class="s2">&#34;$</span><span class="si">{var.zona}</span><span class="s2">&#34;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="n">boot_disk</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="n">initialize_params</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">      <span class="n">image</span> <span class="o">=</span> <span class="s2">&#34;$</span><span class="si">{var.imagem}</span><span class="s2">&#34;</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">  <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="c1"># Instala o servidor web Apache</span>
</span></span><span class="line"><span class="cl">  <span class="n">metadata_startup_script</span> <span class="o">=</span> <span class="s2">&#34;sudo apt-get update; sudo apt-get install apache2 -y; echo Testando &gt; /var/www/html/index.html&#34;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="c1"># Habilita rede para a VM bem como um IP público</span>
</span></span><span class="line"><span class="cl">  <span class="n">network_interface</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="n">network</span> <span class="o">=</span> <span class="s2">&#34;default&#34;</span>
</span></span><span class="line"><span class="cl">    <span class="n">access_config</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">  <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span></span></span></code></pre></div></div>
<p><strong>A</strong>qui inserimos um <em>resource</em> de tipo <em>google_compute_instance</em> para criar nossa VM e nele passamos os detalhes de nossa VM, tais como nome, tipo de máquina, zona e rede.</p>
<p><strong>E</strong>stamos também utilizando a propriedade <em>metadata_startup_script</em>, na qual o Terraform nos permite utilizar o recurso de script de inicialização do Google Cloud. Este parâmetro nos permite executar um script logo que a VM é criada, portanto podemos automatizar qualquer setup inicial de nossa VM através deste recurso. Neste exemplo estaremos apenas atualizando os repositórios de nosso Debian e instalando um servidor web Apache para nosso teste.</p>
<p><strong>A</strong>gora que temos nossos arquivos <em>variables.tf</em> e <em>main.tf</em> atualizados, vamos executar novamente <em>terraform plan</em> para ver o que aconteceria com nossa infraestrutura:</p>
<div class="code-block code-line-numbers" style="counter-reset: code-block 0">
    <div class="code-header language-yaml">
        <span class="code-title"><i class="arrow fas fa-angle-right fa-fw" aria-hidden="true"></i></span>
        <span class="ellipses"><i class="fas fa-ellipsis-h fa-fw" aria-hidden="true"></i></span>
        <span class="copy" title="Copiar para a área de transferência"><i class="far fa-copy fa-fw" aria-hidden="true"></i></span>
    </div><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-yaml" data-lang="yaml"><span class="line"><span class="cl"><span class="l">$ terraform plan</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="l">Refreshing Terraform state in-memory prior to plan...</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="l">The refreshed state will be used to calculate this plan, but will not be</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="l">persisted to local or remote state storage.</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nn">---</span>---------------------------------------------------------------------<span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="l">An execution plan has been generated and is shown below.</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">Resource actions are indicated with the following symbols</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"> </span><span class="l">+ create</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">Terraform will perform the following actions</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"> </span><span class="l">+ google_compute_instance.webserver</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">     </span><span class="nt">id</span><span class="p">:</span><span class="w">                                                  </span><span class="l">&lt;computed&gt;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">     </span><span class="nt">boot_disk.#</span><span class="p">:</span><span class="w">                                         </span><span class="s2">&#34;1&#34;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">     </span><span class="nt">boot_disk.0.auto_delete</span><span class="p">:</span><span class="w">                             </span><span class="s2">&#34;true&#34;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">     </span><span class="nt">boot_disk.0.device_name</span><span class="p">:</span><span class="w">                             </span><span class="l">&lt;computed&gt;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">     </span><span class="nt">boot_disk.0.disk_encryption_key_sha256</span><span class="p">:</span><span class="w">              </span><span class="l">&lt;computed&gt;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">     </span><span class="nt">boot_disk.0.initialize_params.#</span><span class="p">:</span><span class="w">                     </span><span class="s2">&#34;1&#34;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">     </span><span class="nt">boot_disk.0.initialize_params.0.image</span><span class="p">:</span><span class="w">               </span><span class="s2">&#34;debian-cloud/debian-9&#34;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">     </span><span class="nt">boot_disk.0.initialize_params.0.size</span><span class="p">:</span><span class="w">                </span><span class="l">&lt;computed&gt;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">     </span><span class="nt">boot_disk.0.initialize_params.0.type</span><span class="p">:</span><span class="w">                </span><span class="l">&lt;computed&gt;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">     </span><span class="nt">can_ip_forward</span><span class="p">:</span><span class="w">                                      </span><span class="s2">&#34;false&#34;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">     </span><span class="nt">cpu_platform</span><span class="p">:</span><span class="w">                                        </span><span class="l">&lt;computed&gt;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">     </span><span class="nt">create_timeout</span><span class="p">:</span><span class="w">                                      </span><span class="s2">&#34;4&#34;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">     </span><span class="nt">deletion_protection</span><span class="p">:</span><span class="w">                                 </span><span class="s2">&#34;false&#34;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">     </span><span class="nt">guest_accelerator.#</span><span class="p">:</span><span class="w">                                 </span><span class="l">&lt;computed&gt;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">     </span><span class="nt">instance_id</span><span class="p">:</span><span class="w">                                         </span><span class="l">&lt;computed&gt;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">     </span><span class="nt">label_fingerprint</span><span class="p">:</span><span class="w">                                   </span><span class="l">&lt;computed&gt;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">     </span><span class="nt">machine_type</span><span class="p">:</span><span class="w">                                        </span><span class="s2">&#34;f1-micro&#34;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">     </span><span class="nt">metadata_fingerprint</span><span class="p">:</span><span class="w">                                </span><span class="l">&lt;computed&gt;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">     </span><span class="nt">metadata_startup_script</span><span class="p">:</span><span class="w">                             </span><span class="s2">&#34;sudo apt-get update; sudo apt-get install apache2 -y; echo Testando &gt; /var/www/html/index.html&#34;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">     </span><span class="nt">name</span><span class="p">:</span><span class="w">                                                </span><span class="s2">&#34;vm-webserver&#34;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">     </span><span class="nt">network_interface.#</span><span class="p">:</span><span class="w">                                 </span><span class="s2">&#34;1&#34;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">     </span><span class="nt">network_interface.0.access_config.#</span><span class="p">:</span><span class="w">                 </span><span class="s2">&#34;1&#34;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">     </span><span class="nt">network_interface.0.access_config.0.assigned_nat_ip</span><span class="p">:</span><span class="w"> </span><span class="l">&lt;computed&gt;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">     </span><span class="nt">network_interface.0.access_config.0.nat_ip</span><span class="p">:</span><span class="w">          </span><span class="l">&lt;computed&gt;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">     </span><span class="nt">network_interface.0.access_config.0.network_tier</span><span class="p">:</span><span class="w">    </span><span class="l">&lt;computed&gt;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">     </span><span class="nt">network_interface.0.address</span><span class="p">:</span><span class="w">                         </span><span class="l">&lt;computed&gt;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">     </span><span class="nt">network_interface.0.name</span><span class="p">:</span><span class="w">                            </span><span class="l">&lt;computed&gt;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">     </span><span class="nt">network_interface.0.network</span><span class="p">:</span><span class="w">                         </span><span class="s2">&#34;default&#34;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">     </span><span class="nt">network_interface.0.network_ip</span><span class="p">:</span><span class="w">                      </span><span class="l">&lt;computed&gt;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">     </span><span class="nt">network_interface.0.subnetwork_project</span><span class="p">:</span><span class="w">              </span><span class="l">&lt;computed&gt;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">     </span><span class="nt">project</span><span class="p">:</span><span class="w">                                             </span><span class="l">&lt;computed&gt;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">     </span><span class="nt">scheduling.#</span><span class="p">:</span><span class="w">                                        </span><span class="l">&lt;computed&gt;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">     </span><span class="nt">self_link</span><span class="p">:</span><span class="w">                                           </span><span class="l">&lt;computed&gt;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">     </span><span class="nt">tags_fingerprint</span><span class="p">:</span><span class="w">                                    </span><span class="l">&lt;computed&gt;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">     </span><span class="nt">zone</span><span class="p">:</span><span class="w">                                                </span><span class="s2">&#34;northamerica-northeast1-a&#34;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">Plan</span><span class="p">:</span><span class="w"> </span><span class="m">1</span><span class="w"> </span><span class="l">to add, 0 to change, 0 to destroy.</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nn">---</span>---------------------------------------------------------------------<span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">Note</span><span class="p">:</span><span class="w"> </span><span class="l">You didn&#39;t specify an &#34;-out&#34; parameter to save this plan, so Terraform</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="l">can&#39;t guarantee that exactly these actions will be performed if</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="s2">&#34;terraform apply&#34;</span><span class="w"> </span><span class="l">is subsequently run.</span></span></span></code></pre></div></div>
<p><strong>A</strong>parentemente tudo está conforme o esperado. O Terraform criará um recurso para nossa VM.</p>
<p><strong>A</strong>ntes de aplicarmos nosso plano de fato, volte à sua <em>Dashboard</em> do GCP e, no menu principal do canto esquerdo navegue até o painel de Instâncias (VMs):
<img
        class="lazyload"
        src="/svg/loading.min.svg"
        data-src="/img/gcloud11.png"
        data-srcset="/img/gcloud11.png, /img/gcloud11.png 1.5x, /img/gcloud11.png 2x"
        data-sizes="auto"
        alt="/img/gcloud11.png"
        title="Google Cloud Platform" />
<strong>C</strong>aso seja a sua primeira vez acessando esta seção, você deverá receber a informação de que o Google esta carregando a API de <em>Compute Engine</em> para seu uso. Este processo costuma levar cerca de 1 ou 2 minutos, mas apenas acontece na primeira vez que você acessa este painel. Para otimizar sua nuvem o Google não carrega todas as APIs por padrão, habilitando-as aos poucos conforme você as utiliza, bem como lhe permitindo habilitar apenas as que você deseja ou desabilitar as que não precisa.</p>
<p><strong>V</strong>ocê provavelmente não terá nenhuma VM ou instância criada, portanto nada será listado para você além de uma tela informando que ali ficarão suas VMs, bem como um botão de <strong>Criar</strong> VMs, através do qual você poderia criar suas VMs e passar todas as suas definições pela interface. Mas o nosso objetivo é automatizar tudo isso e codificar nossa infraestrutura, certo?! Portanto, ignoremos isto por enquanto. O nosso objetivo nesta interface era apenas ver que não temos nossa vm webserver criada (ainda).</p>
<p><strong>D</strong>e volta ao nosso console ou terminal, executemos <em>terraform apply</em>:</p>
<div class="code-block code-line-numbers" style="counter-reset: code-block 0">
    <div class="code-header language-yaml">
        <span class="code-title"><i class="arrow fas fa-angle-right fa-fw" aria-hidden="true"></i></span>
        <span class="ellipses"><i class="fas fa-ellipsis-h fa-fw" aria-hidden="true"></i></span>
        <span class="copy" title="Copiar para a área de transferência"><i class="far fa-copy fa-fw" aria-hidden="true"></i></span>
    </div><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-yaml" data-lang="yaml"><span class="line"><span class="cl"><span class="l">$ terraform apply</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="l">An execution plan has been generated and is shown below.</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">Resource actions are indicated with the following symbols</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="l">+ create</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">Terraform will perform the following actions</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="l">+ google_compute_instance.webserver</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">id</span><span class="p">:</span><span class="w">                                                  </span><span class="l">&lt;computed&gt;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">boot_disk.#</span><span class="p">:</span><span class="w">                                         </span><span class="s2">&#34;1&#34;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">boot_disk.0.auto_delete</span><span class="p">:</span><span class="w">                             </span><span class="s2">&#34;true&#34;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">boot_disk.0.device_name</span><span class="p">:</span><span class="w">                             </span><span class="l">&lt;computed&gt;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">boot_disk.0.disk_encryption_key_sha256</span><span class="p">:</span><span class="w">              </span><span class="l">&lt;computed&gt;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">boot_disk.0.initialize_params.#</span><span class="p">:</span><span class="w">                     </span><span class="s2">&#34;1&#34;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">boot_disk.0.initialize_params.0.image</span><span class="p">:</span><span class="w">               </span><span class="s2">&#34;debian-cloud/debian-9&#34;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">boot_disk.0.initialize_params.0.size</span><span class="p">:</span><span class="w">                </span><span class="l">&lt;computed&gt;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">boot_disk.0.initialize_params.0.type</span><span class="p">:</span><span class="w">                </span><span class="l">&lt;computed&gt;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">can_ip_forward</span><span class="p">:</span><span class="w">                                      </span><span class="s2">&#34;false&#34;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">cpu_platform</span><span class="p">:</span><span class="w">                                        </span><span class="l">&lt;computed&gt;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">create_timeout</span><span class="p">:</span><span class="w">                                      </span><span class="s2">&#34;4&#34;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">deletion_protection</span><span class="p">:</span><span class="w">                                 </span><span class="s2">&#34;false&#34;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">guest_accelerator.#</span><span class="p">:</span><span class="w">                                 </span><span class="l">&lt;computed&gt;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">instance_id</span><span class="p">:</span><span class="w">                                         </span><span class="l">&lt;computed&gt;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">label_fingerprint</span><span class="p">:</span><span class="w">                                   </span><span class="l">&lt;computed&gt;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">machine_type</span><span class="p">:</span><span class="w">                                        </span><span class="s2">&#34;f1-micro&#34;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">metadata_fingerprint</span><span class="p">:</span><span class="w">                                </span><span class="l">&lt;computed&gt;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">metadata_startup_script</span><span class="p">:</span><span class="w">                             </span><span class="s2">&#34;sudo apt-get update; sudo apt-get install apache2 -y; echo Testando &gt; /var/www/html/index.html&#34;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">name</span><span class="p">:</span><span class="w">                                                </span><span class="s2">&#34;vm-webserver&#34;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">network_interface.#</span><span class="p">:</span><span class="w">                                 </span><span class="s2">&#34;1&#34;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">network_interface.0.access_config.#</span><span class="p">:</span><span class="w">                 </span><span class="s2">&#34;1&#34;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">network_interface.0.access_config.0.assigned_nat_ip</span><span class="p">:</span><span class="w"> </span><span class="l">&lt;computed&gt;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">network_interface.0.access_config.0.nat_ip</span><span class="p">:</span><span class="w">          </span><span class="l">&lt;computed&gt;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">network_interface.0.access_config.0.network_tier</span><span class="p">:</span><span class="w">    </span><span class="l">&lt;computed&gt;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">network_interface.0.address</span><span class="p">:</span><span class="w">                         </span><span class="l">&lt;computed&gt;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">network_interface.0.name</span><span class="p">:</span><span class="w">                            </span><span class="l">&lt;computed&gt;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">network_interface.0.network</span><span class="p">:</span><span class="w">                         </span><span class="s2">&#34;default&#34;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">network_interface.0.network_ip</span><span class="p">:</span><span class="w">                      </span><span class="l">&lt;computed&gt;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">network_interface.0.subnetwork_project</span><span class="p">:</span><span class="w">              </span><span class="l">&lt;computed&gt;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">project</span><span class="p">:</span><span class="w">                                             </span><span class="l">&lt;computed&gt;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">scheduling.#</span><span class="p">:</span><span class="w">                                        </span><span class="l">&lt;computed&gt;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">self_link</span><span class="p">:</span><span class="w">                                           </span><span class="l">&lt;computed&gt;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">tags_fingerprint</span><span class="p">:</span><span class="w">                                    </span><span class="l">&lt;computed&gt;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">zone</span><span class="p">:</span><span class="w">                                                </span><span class="s2">&#34;northamerica-northeast1-a&#34;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">Plan</span><span class="p">:</span><span class="w"> </span><span class="m">1</span><span class="w"> </span><span class="l">to add, 0 to change, 0 to destroy.</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="l">Do you want to perform these actions?</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="l">Terraform will perform the actions described above.</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="l">Only &#39;yes&#39; will be accepted to approve.</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="l">Enter a value:</span></span></span></code></pre></div></div>
<p><strong>T</strong>udo parece correto, inclusive podemos ver nosso script de metadata que deverá ser executado durante a criação da VM para instalar nosso servidor WEB Apache. Confirme com um <em>yes</em>:</p>
<div class="code-block code-line-numbers open" style="counter-reset: code-block 0">
    <div class="code-header language-yaml">
        <span class="code-title"><i class="arrow fas fa-angle-right fa-fw" aria-hidden="true"></i></span>
        <span class="ellipses"><i class="fas fa-ellipsis-h fa-fw" aria-hidden="true"></i></span>
        <span class="copy" title="Copiar para a área de transferência"><i class="far fa-copy fa-fw" aria-hidden="true"></i></span>
    </div><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-yaml" data-lang="yaml"><span class="line"><span class="cl"><span class="nt">Enter a value</span><span class="p">:</span><span class="w"> </span><span class="kc">yes</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">google_compute_instance.webserver</span><span class="p">:</span><span class="w"> </span><span class="l">Creating...</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">boot_disk.#</span><span class="p">:</span><span class="w">                                         </span><span class="s2">&#34;&#34;</span><span class="w"> </span><span class="l">=&gt; &#34;1&#34;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">boot_disk.0.auto_delete</span><span class="p">:</span><span class="w">                             </span><span class="s2">&#34;&#34;</span><span class="w"> </span><span class="l">=&gt; &#34;true&#34;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">boot_disk.0.device_name</span><span class="p">:</span><span class="w">                             </span><span class="s2">&#34;&#34;</span><span class="w"> </span><span class="l">=&gt; &#34;&lt;computed&gt;&#34;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">boot_disk.0.disk_encryption_key_sha256</span><span class="p">:</span><span class="w">              </span><span class="s2">&#34;&#34;</span><span class="w"> </span><span class="l">=&gt; &#34;&lt;computed&gt;&#34;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">boot_disk.0.initialize_params.#</span><span class="p">:</span><span class="w">                     </span><span class="s2">&#34;&#34;</span><span class="w"> </span><span class="l">=&gt; &#34;1&#34;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">boot_disk.0.initialize_params.0.image</span><span class="p">:</span><span class="w">               </span><span class="s2">&#34;&#34;</span><span class="w"> </span><span class="l">=&gt; &#34;debian-cloud/debian-9&#34;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">boot_disk.0.initialize_params.0.size</span><span class="p">:</span><span class="w">                </span><span class="s2">&#34;&#34;</span><span class="w"> </span><span class="l">=&gt; &#34;&lt;computed&gt;&#34;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">boot_disk.0.initialize_params.0.type</span><span class="p">:</span><span class="w">                </span><span class="s2">&#34;&#34;</span><span class="w"> </span><span class="l">=&gt; &#34;&lt;computed&gt;&#34;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">can_ip_forward</span><span class="p">:</span><span class="w">                                      </span><span class="s2">&#34;&#34;</span><span class="w"> </span><span class="l">=&gt; &#34;false&#34;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">cpu_platform</span><span class="p">:</span><span class="w">                                        </span><span class="s2">&#34;&#34;</span><span class="w"> </span><span class="l">=&gt; &#34;&lt;computed&gt;&#34;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">create_timeout</span><span class="p">:</span><span class="w">                                      </span><span class="s2">&#34;&#34;</span><span class="w"> </span><span class="l">=&gt; &#34;4&#34;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">deletion_protection</span><span class="p">:</span><span class="w">                                 </span><span class="s2">&#34;&#34;</span><span class="w"> </span><span class="l">=&gt; &#34;false&#34;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">guest_accelerator.#</span><span class="p">:</span><span class="w">                                 </span><span class="s2">&#34;&#34;</span><span class="w"> </span><span class="l">=&gt; &#34;&lt;computed&gt;&#34;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">instance_id</span><span class="p">:</span><span class="w">                                         </span><span class="s2">&#34;&#34;</span><span class="w"> </span><span class="l">=&gt; &#34;&lt;computed&gt;&#34;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">label_fingerprint</span><span class="p">:</span><span class="w">                                   </span><span class="s2">&#34;&#34;</span><span class="w"> </span><span class="l">=&gt; &#34;&lt;computed&gt;&#34;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">machine_type</span><span class="p">:</span><span class="w">                                        </span><span class="s2">&#34;&#34;</span><span class="w"> </span><span class="l">=&gt; &#34;f1-micro&#34;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">metadata_fingerprint</span><span class="p">:</span><span class="w">                                </span><span class="s2">&#34;&#34;</span><span class="w"> </span><span class="l">=&gt; &#34;&lt;computed&gt;&#34;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">metadata_startup_script</span><span class="p">:</span><span class="w">                             </span><span class="s2">&#34;&#34;</span><span class="w"> </span><span class="l">=&gt; &#34;sudo apt-get update; sudo apt-get install apache2 -y; echo Testando &gt; /var/www/html/index.html&#34;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">name</span><span class="p">:</span><span class="w">                                                </span><span class="s2">&#34;&#34;</span><span class="w"> </span><span class="l">=&gt; &#34;vm-webserver&#34;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">network_interface.#</span><span class="p">:</span><span class="w">                                 </span><span class="s2">&#34;&#34;</span><span class="w"> </span><span class="l">=&gt; &#34;1&#34;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">network_interface.0.access_config.#</span><span class="p">:</span><span class="w">                 </span><span class="s2">&#34;&#34;</span><span class="w"> </span><span class="l">=&gt; &#34;1&#34;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">network_interface.0.access_config.0.assigned_nat_ip</span><span class="p">:</span><span class="w"> </span><span class="s2">&#34;&#34;</span><span class="w"> </span><span class="l">=&gt; &#34;&lt;computed&gt;&#34;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">network_interface.0.access_config.0.nat_ip</span><span class="p">:</span><span class="w">          </span><span class="s2">&#34;&#34;</span><span class="w"> </span><span class="l">=&gt; &#34;&lt;computed&gt;&#34;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">network_interface.0.access_config.0.network_tier</span><span class="p">:</span><span class="w">    </span><span class="s2">&#34;&#34;</span><span class="w"> </span><span class="l">=&gt; &#34;&lt;computed&gt;&#34;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">network_interface.0.address</span><span class="p">:</span><span class="w">                         </span><span class="s2">&#34;&#34;</span><span class="w"> </span><span class="l">=&gt; &#34;&lt;computed&gt;&#34;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">network_interface.0.name</span><span class="p">:</span><span class="w">                            </span><span class="s2">&#34;&#34;</span><span class="w"> </span><span class="l">=&gt; &#34;&lt;computed&gt;&#34;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">network_interface.0.network</span><span class="p">:</span><span class="w">                         </span><span class="s2">&#34;&#34;</span><span class="w"> </span><span class="l">=&gt; &#34;default&#34;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">network_interface.0.network_ip</span><span class="p">:</span><span class="w">                      </span><span class="s2">&#34;&#34;</span><span class="w"> </span><span class="l">=&gt; &#34;&lt;computed&gt;&#34;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">network_interface.0.subnetwork_project</span><span class="p">:</span><span class="w">              </span><span class="s2">&#34;&#34;</span><span class="w"> </span><span class="l">=&gt; &#34;&lt;computed&gt;&#34;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">project</span><span class="p">:</span><span class="w">                                             </span><span class="s2">&#34;&#34;</span><span class="w"> </span><span class="l">=&gt; &#34;&lt;computed&gt;&#34;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">scheduling.#</span><span class="p">:</span><span class="w">                                        </span><span class="s2">&#34;&#34;</span><span class="w"> </span><span class="l">=&gt; &#34;&lt;computed&gt;&#34;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">self_link</span><span class="p">:</span><span class="w">                                           </span><span class="s2">&#34;&#34;</span><span class="w"> </span><span class="l">=&gt; &#34;&lt;computed&gt;&#34;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">tags_fingerprint</span><span class="p">:</span><span class="w">                                    </span><span class="s2">&#34;&#34;</span><span class="w"> </span><span class="l">=&gt; &#34;&lt;computed&gt;&#34;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">zone</span><span class="p">:</span><span class="w">                                                </span><span class="s2">&#34;&#34;</span><span class="w"> </span><span class="l">=&gt; &#34;northamerica-northeast1-a&#34;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">google_compute_instance.webserver</span><span class="p">:</span><span class="w"> </span><span class="l">Still creating... (10s elapsed)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">google_compute_instance.webserver: Creation complete after 14s (ID</span><span class="p">:</span><span class="w"> </span><span class="l">vm-webserver)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">Apply complete! Resources</span><span class="p">:</span><span class="w"> </span><span class="m">1</span><span class="w"> </span><span class="l">added, 0 changed, 0 destroyed.</span></span></span></code></pre></div></div>
<p><strong>N</strong>osso código parece ter sido executado com sucesso e o Terraform ao final nos confirma que um <em>resource</em> foi adicionado (o qual esperamos ser nossa VM).</p>
<p>Se atualizarmos nossa página de instâncias no GCP, devemos agora ver nossa <em>vm-webserver</em> criada e rodando:
<img
        class="lazyload"
        src="/svg/loading.min.svg"
        data-src="/img/gcloud12.png"
        data-srcset="/img/gcloud12.png, /img/gcloud12.png 1.5x, /img/gcloud12.png 2x"
        data-sizes="auto"
        alt="/img/gcloud12.png"
        title="Google Cloud Platform" />
<strong>A</strong>gora que temos a certeza de que nosso código funciona para a criação de nossa VM, precisamos também fazer com que a mesma seja acessível, afinal a principal função de qualquer servidor web é justamente ser acessível para apresentar alguma aplicação ou site. Para isto precisamos habilitar o firewall de nossa VM ou instância. Além disso, precisamos saber qual o endereço IP desta instância. Embora seja possível e simples conseguir este endereço IP através da interface do GCP ao clicarmos em cima de nossa VM, podemos também automatizar isto e receber este valor diretamente através do Terraform. (Lembre-se: O principal objetivo por trás da ideia de infraestrutura como código é automatizar ao máximo, evitando o uso de interfaces ou  dashboards (odeio cliques) :p).</p>
<p><strong>V</strong>amos começar criando um arquivo <em>outputs.tf</em> que será utilizado para nos informar o IP da VM criada pelo Terraform:</p>
<div class="code-block code-line-numbers open" style="counter-reset: code-block 0">
    <div class="code-header language-py">
        <span class="code-title"><i class="arrow fas fa-angle-right fa-fw" aria-hidden="true"></i></span>
        <span class="ellipses"><i class="fas fa-ellipsis-h fa-fw" aria-hidden="true"></i></span>
        <span class="copy" title="Copiar para a área de transferência"><i class="far fa-copy fa-fw" aria-hidden="true"></i></span>
    </div><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-py" data-lang="py"><span class="line"><span class="cl"><span class="c1"># Retorna o IP da VM criada</span>
</span></span><span class="line"><span class="cl"><span class="n">output</span> <span class="s2">&#34;ip&#34;</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="n">value</span> <span class="o">=</span> <span class="s2">&#34;$</span><span class="si">{google_compute_instance.webserver.network_interface.0.access_config.0.nat_ip}</span><span class="s2">&#34;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span></span></span></code></pre></div></div>
<p><strong>N</strong>ão, eu não estou inventando comandos ou trazendo algo do além. Se você é curioso e atencioso deve ter percebido que aqui estamos apenas puxando informações que o GCP criou através do Terraform. Se você voltar e reparar em seu comando <em>terraform apply</em>, perceberá que um dos atributos listados/criados em sua VM foi justamente o <em>network_interface.0.access_config.0.nat_ip</em>:</p>
<div class="code-block code-line-numbers open" style="counter-reset: code-block 0">
    <div class="code-header language-yaml">
        <span class="code-title"><i class="arrow fas fa-angle-right fa-fw" aria-hidden="true"></i></span>
        <span class="ellipses"><i class="fas fa-ellipsis-h fa-fw" aria-hidden="true"></i></span>
        <span class="copy" title="Copiar para a área de transferência"><i class="far fa-copy fa-fw" aria-hidden="true"></i></span>
    </div><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-yaml" data-lang="yaml"><span class="line"><span class="cl"><span class="nn">...</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">network_interface.0.access_config.0.assigned_nat_ip</span><span class="p">:</span><span class="w"> </span><span class="s2">&#34;&#34;</span><span class="w"> </span><span class="l">=&gt; &#34;&lt;computed&gt;&#34;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">--&gt; network_interface.0.access_config.0.nat_ip</span><span class="p">:</span><span class="w">          </span><span class="s2">&#34;&#34;</span><span class="w"> </span><span class="l">=&gt; &#34;&lt;computed&gt;&#34;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">network_interface.0.access_config.0.network_tier</span><span class="p">:</span><span class="w">    </span><span class="s2">&#34;&#34;</span><span class="w"> </span><span class="l">=&gt; &#34;&lt;computed&gt;&#34;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">network_interface.0.address</span><span class="p">:</span><span class="w">                         </span><span class="s2">&#34;&#34;</span><span class="w"> </span><span class="l">=&gt; &#34;&lt;computed&gt;&#34;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nn">...</span></span></span></code></pre></div></div>
<p><strong>P</strong>ara validarmos que isto de fato funcionará, vamos executar novamente <em>terraform apply</em>:</p>
<div class="code-block code-line-numbers open" style="counter-reset: code-block 0">
    <div class="code-header language-yaml">
        <span class="code-title"><i class="arrow fas fa-angle-right fa-fw" aria-hidden="true"></i></span>
        <span class="ellipses"><i class="fas fa-ellipsis-h fa-fw" aria-hidden="true"></i></span>
        <span class="copy" title="Copiar para a área de transferência"><i class="far fa-copy fa-fw" aria-hidden="true"></i></span>
    </div><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-yaml" data-lang="yaml"><span class="line"><span class="cl"><span class="l">$ terraform apply</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">google_compute_instance.webserver: Refreshing state... (ID</span><span class="p">:</span><span class="w"> </span><span class="l">vm-webserver)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">Apply complete! Resources</span><span class="p">:</span><span class="w"> </span><span class="m">0</span><span class="w"> </span><span class="l">added, 0 changed, 0 destroyed.</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">Outputs</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="l">ip = 35.203.117.191</span></span></span></code></pre></div></div>
<p><strong>C</strong>onforme o esperado, nenhum <em>resource</em> precisou ser criado, pois não alteramos nada em nosso código indicando a necessidade de alguma mudança. A única coisa que aocnteceu de diferente foi que desta vez recebemos o IP de nossa instância ou VM.</p>
<p><strong>O</strong>utra forma de recebermos este valor a qualquer momento é executando <em>terraform output ip</em>:</p>
<div class="code-block code-line-numbers open" style="counter-reset: code-block 0">
    <div class="code-header language-yaml">
        <span class="code-title"><i class="arrow fas fa-angle-right fa-fw" aria-hidden="true"></i></span>
        <span class="ellipses"><i class="fas fa-ellipsis-h fa-fw" aria-hidden="true"></i></span>
        <span class="copy" title="Copiar para a área de transferência"><i class="far fa-copy fa-fw" aria-hidden="true"></i></span>
    </div><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-yaml" data-lang="yaml"><span class="line"><span class="cl"><span class="l">$ terraform output ip</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="m">35.203.117.191</span></span></span></code></pre></div></div>
<p><strong>Ó</strong>timo, já temos nossa instância e sabemos que podemos receber o endereço IP externo dela facilmente para acesso. Só nos resta agora abrir as portas de firewall necessárias para que possamos acessar nossa aplicação. Vamos abrir a porta 80 para nossa VM.</p>
<p><strong>V</strong>amos criar as seguintes variáveis em nosso arquivo <em>variables.tf</em>:</p>
<ul>
<li>nome_fw: precisamos dar um nome para nosso firewall;</li>
<li>portas: precisamos criar uma lista de portas que serão abertas neste firewall.</li>
</ul>
<div class="code-block code-line-numbers open" style="counter-reset: code-block 0">
    <div class="code-header language-py">
        <span class="code-title"><i class="arrow fas fa-angle-right fa-fw" aria-hidden="true"></i></span>
        <span class="ellipses"><i class="fas fa-ellipsis-h fa-fw" aria-hidden="true"></i></span>
        <span class="copy" title="Copiar para a área de transferência"><i class="far fa-copy fa-fw" aria-hidden="true"></i></span>
    </div><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-py" data-lang="py"><span class="line"><span class="cl"><span class="n">variable</span> <span class="s2">&#34;project_id&#34;</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="nb">type</span>    <span class="o">=</span> <span class="s2">&#34;string&#34;</span>
</span></span><span class="line"><span class="cl">  <span class="n">default</span> <span class="o">=</span> <span class="s2">&#34;possible-sun-83482736&#34;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">variable</span> <span class="s2">&#34;regiao&#34;</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="nb">type</span> <span class="o">=</span> <span class="s2">&#34;string&#34;</span>
</span></span><span class="line"><span class="cl">  <span class="n">default</span> <span class="o">=</span> <span class="s2">&#34;northamerica-northeast1&#34;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">variable</span> <span class="s2">&#34;nome&#34;</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="nb">type</span> <span class="o">=</span> <span class="s2">&#34;string&#34;</span>
</span></span><span class="line"><span class="cl">  <span class="n">default</span> <span class="o">=</span> <span class="s2">&#34;vm-webserver&#34;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">variable</span> <span class="s2">&#34;tipo_maquina&#34;</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="nb">type</span> <span class="o">=</span> <span class="s2">&#34;string&#34;</span>
</span></span><span class="line"><span class="cl">  <span class="n">default</span> <span class="o">=</span> <span class="s2">&#34;f1-micro&#34;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">variable</span> <span class="s2">&#34;zona&#34;</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="nb">type</span> <span class="o">=</span> <span class="s2">&#34;string&#34;</span>
</span></span><span class="line"><span class="cl">  <span class="n">default</span> <span class="o">=</span> <span class="s2">&#34;northamerica-northeast1-a&#34;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">variable</span> <span class="s2">&#34;imagem&#34;</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="nb">type</span> <span class="o">=</span> <span class="s2">&#34;string&#34;</span>
</span></span><span class="line"><span class="cl">  <span class="n">default</span> <span class="o">=</span> <span class="s2">&#34;debian-cloud/debian-9&#34;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">variable</span> <span class="s2">&#34;nome_fw&#34;</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="nb">type</span> <span class="o">=</span> <span class="s2">&#34;string&#34;</span>
</span></span><span class="line"><span class="cl">  <span class="n">default</span> <span class="o">=</span> <span class="s2">&#34;webserver-firewall&#34;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">variable</span> <span class="s2">&#34;portas&#34;</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="nb">type</span> <span class="o">=</span> <span class="s2">&#34;list&#34;</span>
</span></span><span class="line"><span class="cl">  <span class="n">default</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&#34;80&#34;</span><span class="p">]</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span></span></span></code></pre></div></div>
<p><strong>A</strong> única novidade aqui foi o tipo <em>list</em> que utilizamos para a variável <em>portas</em>. Uma vez que podemos querer abrir múltiplas portas, utilizaremos o tipo <em>list</em>, o qual nos permite ter vários valores, ou uma lista de valores, para esta variável.</p>
<p><strong>A</strong>gora vamos criar o <em>resource</em> para nosso firewall no arquivo <em>main.tf</em>:</p>
<div class="code-block code-line-numbers open" style="counter-reset: code-block 0">
    <div class="code-header language-py">
        <span class="code-title"><i class="arrow fas fa-angle-right fa-fw" aria-hidden="true"></i></span>
        <span class="ellipses"><i class="fas fa-ellipsis-h fa-fw" aria-hidden="true"></i></span>
        <span class="copy" title="Copiar para a área de transferência"><i class="far fa-copy fa-fw" aria-hidden="true"></i></span>
    </div><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-py" data-lang="py"><span class="line"><span class="cl"><span class="c1"># Configura o projeto GCP</span>
</span></span><span class="line"><span class="cl"><span class="n">provider</span> <span class="s2">&#34;google&#34;</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="n">credentials</span> <span class="o">=</span> <span class="s2">&#34;${file(&#34;</span><span class="n">possible</span><span class="o">-</span><span class="n">sun</span><span class="o">-</span><span class="mi">83482736</span><span class="o">-</span><span class="n">sabh45jhb2345ghv</span><span class="o">.</span><span class="n">json</span><span class="s2">&#34;)}&#34;</span>
</span></span><span class="line"><span class="cl">  <span class="n">project</span>     <span class="o">=</span> <span class="s2">&#34;$</span><span class="si">{var.project_id}</span><span class="s2">&#34;</span>
</span></span><span class="line"><span class="cl">  <span class="n">region</span>      <span class="o">=</span> <span class="s2">&#34;$</span><span class="si">{var.regiao}</span><span class="s2">&#34;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># Cria a VM com o Google Compute Engine</span>
</span></span><span class="line"><span class="cl"><span class="n">resource</span> <span class="s2">&#34;google_compute_instance&#34;</span> <span class="s2">&#34;webserver&#34;</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="n">name</span>          <span class="o">=</span> <span class="s2">&#34;$</span><span class="si">{var.nome}</span><span class="s2">&#34;</span>
</span></span><span class="line"><span class="cl">  <span class="n">machine_type</span>  <span class="o">=</span> <span class="s2">&#34;$</span><span class="si">{var.tipo_maquina}</span><span class="s2">&#34;</span>
</span></span><span class="line"><span class="cl">  <span class="n">zone</span>          <span class="o">=</span> <span class="s2">&#34;$</span><span class="si">{var.zona}</span><span class="s2">&#34;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="n">boot_disk</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="n">initialize_params</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">      <span class="n">image</span> <span class="o">=</span> <span class="s2">&#34;$</span><span class="si">{var.imagem}</span><span class="s2">&#34;</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">  <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="c1"># Instala o servidor web Apache</span>
</span></span><span class="line"><span class="cl">  <span class="n">metadata_startup_script</span> <span class="o">=</span> <span class="s2">&#34;sudo apt-get update; sudo apt-get install apache2 -y; echo Testando &gt; /var/www/html/index.html&#34;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="c1"># Habilita rede para a VM bem como um IP público</span>
</span></span><span class="line"><span class="cl">  <span class="n">network_interface</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="n">network</span> <span class="o">=</span> <span class="s2">&#34;default&#34;</span>
</span></span><span class="line"><span class="cl">    <span class="n">access_config</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">  <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># Cria o Firewall para a VM</span>
</span></span><span class="line"><span class="cl"><span class="n">resource</span> <span class="s2">&#34;google_compute_firewall&#34;</span> <span class="s2">&#34;webfirewall&#34;</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="n">name</span>        <span class="o">=</span> <span class="s2">&#34;$</span><span class="si">{var.nome_fw}</span><span class="s2">&#34;</span>
</span></span><span class="line"><span class="cl">  <span class="n">network</span>     <span class="o">=</span> <span class="s2">&#34;default&#34;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="n">allow</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="n">protocol</span>  <span class="o">=</span> <span class="s2">&#34;tcp&#34;</span>
</span></span><span class="line"><span class="cl">    <span class="n">ports</span>     <span class="o">=</span> <span class="s2">&#34;$</span><span class="si">{var.portas}</span><span class="s2">&#34;</span>
</span></span><span class="line"><span class="cl">  <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span></span></span></code></pre></div></div>
<p><strong>I</strong>ncluímos apenas um novo <em>resource</em> para a criação de nosso firewall abrindo as portas que definimos em nosso arquivo <em>variables.tf</em> com o protocolo <em>tcp</em>. Execute novamente <em>terraform plan</em> para ver o que mudaria:</p>
<div class="code-block code-line-numbers open" style="counter-reset: code-block 0">
    <div class="code-header language-yaml">
        <span class="code-title"><i class="arrow fas fa-angle-right fa-fw" aria-hidden="true"></i></span>
        <span class="ellipses"><i class="fas fa-ellipsis-h fa-fw" aria-hidden="true"></i></span>
        <span class="copy" title="Copiar para a área de transferência"><i class="far fa-copy fa-fw" aria-hidden="true"></i></span>
    </div><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-yaml" data-lang="yaml"><span class="line"><span class="cl"><span class="l">$ terraform plan</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="l">Refreshing Terraform state in-memory prior to plan...</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="l">The refreshed state will be used to calculate this plan, but will not be</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="l">persisted to local or remote state storage.</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">google_compute_instance.webserver: Refreshing state... (ID</span><span class="p">:</span><span class="w"> </span><span class="l">vm-webserver)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nn">---</span>---------------------------------------------------------------------<span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="l">An execution plan has been generated and is shown below.</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">Resource actions are indicated with the following symbols</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="l">+ create</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">Terraform will perform the following actions</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="l">+ google_compute_firewall.webfirewall</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">id</span><span class="p">:</span><span class="w">                       </span><span class="l">&lt;computed&gt;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">allow.#</span><span class="p">:</span><span class="w">                  </span><span class="s2">&#34;1&#34;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">allow.272637744.ports.#</span><span class="p">:</span><span class="w">  </span><span class="s2">&#34;1&#34;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">allow.272637744.ports.0</span><span class="p">:</span><span class="w">  </span><span class="s2">&#34;80&#34;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">allow.272637744.protocol</span><span class="p">:</span><span class="w"> </span><span class="s2">&#34;tcp&#34;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">creation_timestamp</span><span class="p">:</span><span class="w">       </span><span class="l">&lt;computed&gt;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">destination_ranges.#</span><span class="p">:</span><span class="w">     </span><span class="l">&lt;computed&gt;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">direction</span><span class="p">:</span><span class="w">                </span><span class="l">&lt;computed&gt;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">name</span><span class="p">:</span><span class="w">                     </span><span class="s2">&#34;webserver-firewall&#34;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">network</span><span class="p">:</span><span class="w">                  </span><span class="s2">&#34;default&#34;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">priority</span><span class="p">:</span><span class="w">                 </span><span class="s2">&#34;1000&#34;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">project</span><span class="p">:</span><span class="w">                  </span><span class="l">&lt;computed&gt;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">self_link</span><span class="p">:</span><span class="w">                </span><span class="l">&lt;computed&gt;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">source_ranges.#</span><span class="p">:</span><span class="w">          </span><span class="l">&lt;computed&gt;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">Plan</span><span class="p">:</span><span class="w"> </span><span class="m">1</span><span class="w"> </span><span class="l">to add, 0 to change, 0 to destroy.</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nn">---</span>---------------------------------------------------------------------<span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">Note</span><span class="p">:</span><span class="w"> </span><span class="l">You didn&#39;t specify an &#34;-out&#34; parameter to save this plan, so Terraform</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="l">can&#39;t guarantee that exactly these actions will be performed if</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="s2">&#34;terraform apply&#34;</span><span class="w"> </span><span class="l">is subsequently run.</span></span></span></code></pre></div></div>
<p><strong>T</strong>udo parece correto. Como a VM já existe e nada foi modificado no código da mesma, o Terraform apenas criará um  novo <em>resource</em> para nosso firewall com os valores que definimos. Execute seu plano com <em>terraform apply</em> e confirme com <em>yes</em>:</p>
<div class="code-block code-line-numbers" style="counter-reset: code-block 0">
    <div class="code-header language-yaml">
        <span class="code-title"><i class="arrow fas fa-angle-right fa-fw" aria-hidden="true"></i></span>
        <span class="ellipses"><i class="fas fa-ellipsis-h fa-fw" aria-hidden="true"></i></span>
        <span class="copy" title="Copiar para a área de transferência"><i class="far fa-copy fa-fw" aria-hidden="true"></i></span>
    </div><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-yaml" data-lang="yaml"><span class="line"><span class="cl"><span class="l">$ terraform apply</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">google_compute_instance.webserver: Refreshing state... (ID</span><span class="p">:</span><span class="w"> </span><span class="l">vm-webserver)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="l">An execution plan has been generated and is shown below.</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">Resource actions are indicated with the following symbols</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="l">+ create</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">Terraform will perform the following actions</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="l">+ google_compute_firewall.webfirewall</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">id</span><span class="p">:</span><span class="w">                       </span><span class="l">&lt;computed&gt;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">allow.#</span><span class="p">:</span><span class="w">                  </span><span class="s2">&#34;1&#34;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">allow.272637744.ports.#</span><span class="p">:</span><span class="w">  </span><span class="s2">&#34;1&#34;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">allow.272637744.ports.0</span><span class="p">:</span><span class="w">  </span><span class="s2">&#34;80&#34;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">allow.272637744.protocol</span><span class="p">:</span><span class="w"> </span><span class="s2">&#34;tcp&#34;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">creation_timestamp</span><span class="p">:</span><span class="w">       </span><span class="l">&lt;computed&gt;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">destination_ranges.#</span><span class="p">:</span><span class="w">     </span><span class="l">&lt;computed&gt;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">direction</span><span class="p">:</span><span class="w">                </span><span class="l">&lt;computed&gt;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">name</span><span class="p">:</span><span class="w">                     </span><span class="s2">&#34;webserver-firewall&#34;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">network</span><span class="p">:</span><span class="w">                  </span><span class="s2">&#34;default&#34;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">priority</span><span class="p">:</span><span class="w">                 </span><span class="s2">&#34;1000&#34;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">project</span><span class="p">:</span><span class="w">                  </span><span class="l">&lt;computed&gt;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">self_link</span><span class="p">:</span><span class="w">                </span><span class="l">&lt;computed&gt;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">source_ranges.#</span><span class="p">:</span><span class="w">          </span><span class="l">&lt;computed&gt;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">Plan</span><span class="p">:</span><span class="w"> </span><span class="m">1</span><span class="w"> </span><span class="l">to add, 0 to change, 0 to destroy.</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="l">Do you want to perform these actions?</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="l">Terraform will perform the actions described above.</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="l">Only &#39;yes&#39; will be accepted to approve.</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">Enter a value</span><span class="p">:</span><span class="w"> </span><span class="kc">yes</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">google_compute_firewall.webfirewall</span><span class="p">:</span><span class="w"> </span><span class="l">Creating...</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">allow.#</span><span class="p">:</span><span class="w">                  </span><span class="s2">&#34;&#34;</span><span class="w"> </span><span class="l">=&gt; &#34;1&#34;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">allow.272637744.ports.#</span><span class="p">:</span><span class="w">  </span><span class="s2">&#34;&#34;</span><span class="w"> </span><span class="l">=&gt; &#34;1&#34;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">allow.272637744.ports.0</span><span class="p">:</span><span class="w">  </span><span class="s2">&#34;&#34;</span><span class="w"> </span><span class="l">=&gt; &#34;80&#34;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">allow.272637744.protocol</span><span class="p">:</span><span class="w"> </span><span class="s2">&#34;&#34;</span><span class="w"> </span><span class="l">=&gt; &#34;tcp&#34;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">creation_timestamp</span><span class="p">:</span><span class="w">       </span><span class="s2">&#34;&#34;</span><span class="w"> </span><span class="l">=&gt; &#34;&lt;computed&gt;&#34;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">destination_ranges.#</span><span class="p">:</span><span class="w">     </span><span class="s2">&#34;&#34;</span><span class="w"> </span><span class="l">=&gt; &#34;&lt;computed&gt;&#34;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">direction</span><span class="p">:</span><span class="w">                </span><span class="s2">&#34;&#34;</span><span class="w"> </span><span class="l">=&gt; &#34;&lt;computed&gt;&#34;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w">                     </span><span class="s2">&#34;&#34;</span><span class="w"> </span><span class="l">=&gt; &#34;webserver-firewall&#34;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">network</span><span class="p">:</span><span class="w">                  </span><span class="s2">&#34;&#34;</span><span class="w"> </span><span class="l">=&gt; &#34;default&#34;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">priority</span><span class="p">:</span><span class="w">                 </span><span class="s2">&#34;&#34;</span><span class="w"> </span><span class="l">=&gt; &#34;1000&#34;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">project</span><span class="p">:</span><span class="w">                  </span><span class="s2">&#34;&#34;</span><span class="w"> </span><span class="l">=&gt; &#34;&lt;computed&gt;&#34;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">self_link</span><span class="p">:</span><span class="w">                </span><span class="s2">&#34;&#34;</span><span class="w"> </span><span class="l">=&gt; &#34;&lt;computed&gt;&#34;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">source_ranges.#</span><span class="p">:</span><span class="w">          </span><span class="s2">&#34;&#34;</span><span class="w"> </span><span class="l">=&gt; &#34;&lt;computed&gt;&#34;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">google_compute_firewall.webfirewall</span><span class="p">:</span><span class="w"> </span><span class="l">Still creating... (10s elapsed)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">google_compute_firewall.webfirewall: Creation complete after 14s (ID</span><span class="p">:</span><span class="w"> </span><span class="l">webserver-firewall)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">Apply complete! Resources</span><span class="p">:</span><span class="w"> </span><span class="m">1</span><span class="w"> </span><span class="l">added, 0 changed, 0 destroyed.</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">Outputs</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="l">ip = 35.203.117.191</span></span></span></code></pre></div></div>
<p><strong>T</strong>udo parece ter funcionado. Um novo resource de <em>firewall</em> foi criado e, conforme visto anteriormente, também recebemos o nosso IP como output.</p>
<p><strong>C</strong>onfirme que tudo funcionou como o esperado copiando este IP e colando-o em seu navegador:
<img
        class="lazyload"
        src="/svg/loading.min.svg"
        data-src="/img/gcloud13.png"
        data-srcset="/img/gcloud13.png, /img/gcloud13.png 1.5x, /img/gcloud13.png 2x"
        data-sizes="auto"
        alt="/img/gcloud13.png"
        title="Google Cloud Platform" />
<strong>S</strong>e você recebeu uma página em branco com a palavra <em>Testando</em>, significa que tudo ocorreu conforme o esperado.</p>
<p><strong>A</strong>té agora nossa infraestrutura possui:</p>
<ul>
<li>1 VM como servidor Web básico rodando Apache e uma página de teste;</li>
<li>1 rede default;</li>
<li>1 firewall básico aplicado à nossa VM abrindo a porta 80.</li>
</ul>
<p><strong>E</strong>mbora esta seja uma infraestrutura extremamente simples, o Terraform lhe permite criar infraestruturas muito mais complexas e robustas.</p>
<p><strong>N</strong>o próximo post incrementaremos este código para incluírmos a criação de um cluster Kubernetes em nossa <em>cloud</em>.</p>
<p><strong>P</strong>or hora, para não consumir muito de nossos créditos no GCP, vamos destruir nossa infraestrutura com <em>terraform destroy</em>. É tão simples e rápido criar tudo novamente agora que temos o código pronto, certo?! Então destruir tudo não nos causará problemas.</p>
<div class="code-block code-line-numbers open" style="counter-reset: code-block 0">
    <div class="code-header language-yaml">
        <span class="code-title"><i class="arrow fas fa-angle-right fa-fw" aria-hidden="true"></i></span>
        <span class="ellipses"><i class="fas fa-ellipsis-h fa-fw" aria-hidden="true"></i></span>
        <span class="copy" title="Copiar para a área de transferência"><i class="far fa-copy fa-fw" aria-hidden="true"></i></span>
    </div><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-yaml" data-lang="yaml"><span class="line"><span class="cl"><span class="l">$ terraform destroy</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">google_compute_firewall.webfirewall: Refreshing state... (ID</span><span class="p">:</span><span class="w"> </span><span class="l">webserver-firewall)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">google_compute_instance.webserver: Refreshing state... (ID</span><span class="p">:</span><span class="w"> </span><span class="l">vm-webserver)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="l">An execution plan has been generated and is shown below.</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">Resource actions are indicated with the following symbols</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span>- <span class="l">destroy</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">Terraform will perform the following actions</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span>- <span class="l">google_compute_firewall.webfirewall</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span>- <span class="l">google_compute_instance.webserver</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">Plan</span><span class="p">:</span><span class="w"> </span><span class="m">0</span><span class="w"> </span><span class="l">to add, 0 to change, 2 to destroy.</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="l">Do you really want to destroy all resources?</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="l">Terraform will destroy all your managed infrastructure, as shown above.</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="l">There is no undo. Only &#39;yes&#39; will be accepted to confirm.</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">Enter a value</span><span class="p">:</span><span class="w"> </span><span class="kc">yes</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">google_compute_firewall.webfirewall: Destroying... (ID</span><span class="p">:</span><span class="w"> </span><span class="l">webserver-firewall)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">google_compute_instance.webserver: Destroying... (ID</span><span class="p">:</span><span class="w"> </span><span class="l">vm-webserver)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">google_compute_firewall.webfirewall: Still destroying... (ID</span><span class="p">:</span><span class="w"> </span><span class="l">webserver-firewall, 10s elapsed)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">google_compute_instance.webserver: Still destroying... (ID</span><span class="p">:</span><span class="w"> </span><span class="l">vm-webserver, 10s elapsed)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">google_compute_firewall.webfirewall</span><span class="p">:</span><span class="w"> </span><span class="l">Destruction complete after 12s</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">google_compute_instance.webserver</span><span class="p">:</span><span class="w"> </span><span class="l">Destruction complete after 14s</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">Destroy complete! Resources</span><span class="p">:</span><span class="w"> </span><span class="m">2</span><span class="w"> </span><span class="l">destroyed.</span></span></span></code></pre></div></div>
<p><strong>T</strong>udo certo, sua infra foi completamente removida e seus créditos não mais serão utilizados agora.</p>
<p><strong>H</strong>appy hacking!</p></div><div class="post-footer" id="post-footer">
    <div class="post-info">
        <div class="post-info-line">
            <div class="post-info-mod">
                <span>Atualizado em 2018-11-24</span>
            </div></div>
        <div class="post-info-line">
            <div class="post-info-md"></div>
            <div class="post-info-share">
                <span><a href="javascript:void(0);" title="Compartilhe em X" data-sharer="x" data-url="//blog.marcelocavalcante.net:1313/posts/20181124terraform-criando-uma-infraestrutura-no/" data-title="Terraform: Criando uma infraestrutura no Google Cloud" data-via="Marcelo_Kalib" data-hashtags="Devops,Terraform,Cloud,GCP,Docker,Kubernetes"><i class="fab fa-x-twitter fa-fw" aria-hidden="true"></i></a><a href="javascript:void(0);" title="Compartilhe em Threads" data-sharer="threads" data-url="//blog.marcelocavalcante.net:1313/posts/20181124terraform-criando-uma-infraestrutura-no/" data-title="Terraform: Criando uma infraestrutura no Google Cloud"><i class="fab fa-threads fa-fw" aria-hidden="true"></i></a><a href="javascript:void(0);" title="Compartilhe em Facebook" data-sharer="facebook" data-url="//blog.marcelocavalcante.net:1313/posts/20181124terraform-criando-uma-infraestrutura-no/" data-hashtag="Devops"><i class="fab fa-facebook-square fa-fw" aria-hidden="true"></i></a><a href="javascript:void(0);" title="Compartilhe em Hacker News" data-sharer="hackernews" data-url="//blog.marcelocavalcante.net:1313/posts/20181124terraform-criando-uma-infraestrutura-no/" data-title="Terraform: Criando uma infraestrutura no Google Cloud"><i class="fab fa-hacker-news fa-fw" aria-hidden="true"></i></a><a href="javascript:void(0);" title="Compartilhe em Line" data-sharer="line" data-url="//blog.marcelocavalcante.net:1313/posts/20181124terraform-criando-uma-infraestrutura-no/" data-title="Terraform: Criando uma infraestrutura no Google Cloud"><i data-svg-src="https://cdn.jsdelivr.net/npm/simple-icons@15.14.0/icons/line.svg" aria-hidden="true"></i></a><a href="javascript:void(0);" title="Compartilhe em 微博" data-sharer="weibo" data-url="//blog.marcelocavalcante.net:1313/posts/20181124terraform-criando-uma-infraestrutura-no/" data-title="Terraform: Criando uma infraestrutura no Google Cloud"><i class="fab fa-weibo fa-fw" aria-hidden="true"></i></a><a href="javascript:void(0);" title="Compartilhe em Diaspora" data-sharer="diaspora" data-url="//blog.marcelocavalcante.net:1313/posts/20181124terraform-criando-uma-infraestrutura-no/" data-title="Terraform: Criando uma infraestrutura no Google Cloud" data-description="Uma introdução ao Terraform, da Hashicorp, como robusta e eficiente ferramenta para infraestrutura como código. Criando infraestrutura na nuvem GCP, do Google."><i class="fab fa-diaspora fa-fw" aria-hidden="true"></i></a><a href="https://t.me/share/url?url=%2f%2fblog.marcelocavalcante.net%3a1313%2fposts%2f20181124terraform-criando-uma-infraestrutura-no%2f&amp;text=Terraform%3a%20Criando%20uma%20infraestrutura%20no%20Google%20Cloud" target="_blank" title="Compartilhe em Telegram"><i class="fab fa-telegram fa-fw" aria-hidden="true"></i></a></span>
            </div>
        </div>
    </div>

    <div class="post-info-more">
        <section class="post-tags"><i class="fas fa-tags fa-fw" aria-hidden="true"></i>&nbsp;<a href="/tags/devops/">Devops</a>,&nbsp;<a href="/tags/terraform/">Terraform</a>,&nbsp;<a href="/tags/cloud/">Cloud</a>,&nbsp;<a href="/tags/gcp/">GCP</a>,&nbsp;<a href="/tags/docker/">Docker</a>,&nbsp;<a href="/tags/kubernetes/">Kubernetes</a></section>
        <section>
            <span><a href="javascript:void(0);" onclick="window.history.back();">Voltar</a></span>&nbsp;|&nbsp;<span><a href="/">Home</a></span>
        </section>
    </div>

    <div class="post-nav"><a href="/posts/terraform-variaveis-e-outputs/" class="prev" rel="prev" title="Terraform: Variáveis e Outputs"><i class="fas fa-angle-left fa-fw" aria-hidden="true"></i>Terraform: Variáveis e Outputs</a>
            <a href="/posts/de-volta-com-novo-visual/" class="next" rel="next" title="De Volta à Ativa e Com Novo Visual">De Volta à Ativa e Com Novo Visual<i class="fas fa-angle-right fa-fw" aria-hidden="true"></i></a></div>
</div>
<div id="comments"><div id="disqus_thread" class="comment"></div><noscript>
                Please enable JavaScript to view the comments powered by <a href="https://disqus.com/?ref_noscript">Disqus</a>.
            </noscript></div></article></div>
            </main><footer class="footer">
        <div class="footer-container"><div class="footer-line">Possibilitado por <a href="https://gohugo.io/" target="_blank" rel="noopener noreffer" title="Hugo 0.145.0">Hugo</a> | Tema - <a href="https://github.com/dillonzq/LoveIt" target="_blank" rel="noopener noreffer" title="LoveIt 0.3.1-DEV"><i class="far fa-kiss-wink-heart fa-fw" aria-hidden="true"></i> LoveIt</a>
                </div><div class="footer-line" itemscope itemtype="http://schema.org/CreativeWork"><i class="far fa-copyright fa-fw" aria-hidden="true"></i><span itemprop="copyrightYear">2008 - 2025</span><span class="author" itemprop="copyrightHolder">&nbsp;<a href="https://blog.marcelocavalcante.net" target="_blank">Marcelo Cavalcante</a></span></div>
        </div>
    </footer></div>

        <div id="fixed-buttons"><a href="#" id="back-to-top" class="fixed-button" title="Voltar ao topo">
                <i class="fas fa-arrow-up fa-fw" aria-hidden="true"></i>
            </a>
        </div>

        <div id="fixed-buttons-hidden"><a href="#" id="view-comments" class="fixed-button" title="Ver comentários">
                <i class="fas fa-comment fa-fw" aria-hidden="true"></i>
            </a>
        </div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/lightgallery@2.5.0/css/lightgallery-bundle.min.css"><script src="https://marcelokalib.disqus.com/embed.js" defer></script><script src="https://cdn.jsdelivr.net/npm/autocomplete.js@0.38.1/dist/autocomplete.min.js"></script><script src="https://cdn.jsdelivr.net/npm/lunr@2.3.9/lunr.min.js"></script><script src="/lib/lunr/lunr.stemmer.support.min.js"></script><script src="/lib/lunr/lunr.pt.min.js"></script><script src="https://cdn.jsdelivr.net/npm/lazysizes@5.3.2/lazysizes.min.js"></script><script src="https://cdn.jsdelivr.net/npm/lightgallery@2.5.0/lightgallery.min.js"></script><script src="https://cdn.jsdelivr.net/npm/lightgallery@2.5.0/plugins/thumbnail/lg-thumbnail.min.js"></script><script src="https://cdn.jsdelivr.net/npm/lightgallery@2.5.0/plugins/zoom/lg-zoom.min.js"></script><script src="https://cdn.jsdelivr.net/npm/clipboard@2.0.11/dist/clipboard.min.js"></script><script src="https://cdn.jsdelivr.net/npm/sharer.js@0.5.2/sharer.min.js"></script><script>window.config={"comment":{},"lightgallery":true,"search":{"highlightTag":"em","lunrLanguageCode":"pt","maxResultLength":10,"noResultsFound":"Nenhum resultado encontrado","snippetLength":30}};</script><script src="/js/theme.min.js"></script></body>
</html>
