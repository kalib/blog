<!DOCTYPE html>
<html lang="pt-BR">
    <head><script src="/livereload.js?mindelay=10&amp;v=2&amp;port=1313&amp;path=livereload" data-no-instant defer></script>
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="robots" content="noodp" />
        <title>Automatizando a Criacao De Imagens Com Packer - Marcelo Cavalcante Rocha</title><meta name="Description" content="Packer é uma ferramenta Open Source, criada e mantida pela HashiCorp, para a criação de imagens de máquinas idênticas para múltiplas plataformas a partir de uma única fonte ou código de configuração. O Packer é leve, roda em praticamente todos os principais Sistemas Operacionais e possui alta performance, permitindo a criação de imagens para múltiplas plataformas em paralelo."><meta property="og:url" content="//blog.marcelocavalcante.net:1313/posts/automatizando-a-criacao-de-imagens/">
  <meta property="og:site_name" content="Marcelo Cavalcante Rocha">
  <meta property="og:title" content="Automatizando a Criacao De Imagens Com Packer">
  <meta property="og:description" content="Packer é uma ferramenta Open Source, criada e mantida pela HashiCorp, para a criação de imagens de máquinas idênticas para múltiplas plataformas a partir de uma única fonte ou código de configuração. O Packer é leve, roda em praticamente todos os principais Sistemas Operacionais e possui alta performance, permitindo a criação de imagens para múltiplas plataformas em paralelo.">
  <meta property="og:locale" content="pt_BR">
  <meta property="og:type" content="article">
    <meta property="article:section" content="posts">
    <meta property="article:published_time" content="2018-07-30T13:32:42-05:00">
    <meta property="article:modified_time" content="2018-07-30T13:32:42-05:00">
    <meta property="article:tag" content="Devops">
    <meta property="article:tag" content="Packer">
    <meta property="article:tag" content="Docker">
    <meta property="article:tag" content="Cloud">
    <meta property="og:image" content="//blog.marcelocavalcante.net:1313/posts/automatizando-a-criacao-de-imagens/featured-image.png">

  <meta name="twitter:card" content="summary_large_image">
  <meta name="twitter:image" content="//blog.marcelocavalcante.net:1313/posts/automatizando-a-criacao-de-imagens/featured-image.png">
  <meta name="twitter:title" content="Automatizando a Criacao De Imagens Com Packer">
  <meta name="twitter:description" content="Packer é uma ferramenta Open Source, criada e mantida pela HashiCorp, para a criação de imagens de máquinas idênticas para múltiplas plataformas a partir de uma única fonte ou código de configuração. O Packer é leve, roda em praticamente todos os principais Sistemas Operacionais e possui alta performance, permitindo a criação de imagens para múltiplas plataformas em paralelo.">
<meta name="application-name" content="Marcelo Cavalcante">
<meta name="apple-mobile-web-app-title" content="Marcelo Cavalcante">
<meta name="referrer" content="no-referrer" /><meta name="theme-color" content="#ffffff"><meta name="msapplication-TileColor" content="#da532c"><link rel="shortcut icon" type="image/x-icon" href="/favicon.ico" />
        <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
        <link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png"><link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png"><link rel="mask-icon" href="/safari-pinned-tab.svg" color="#5bbad5"><link rel="manifest" href="/site.webmanifest"><link rel="canonical" href="//blog.marcelocavalcante.net:1313/posts/automatizando-a-criacao-de-imagens/" /><link rel="prev" href="//blog.marcelocavalcante.net:1313/posts/10-anos/" /><link rel="next" href="//blog.marcelocavalcante.net:1313/posts/criando-uma-imagem-aws-ec2/" /><link rel="stylesheet" href="/css/style.min.css"><link rel="preload" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.7.2/css/all.min.css" as="style" onload="this.onload=null;this.rel='stylesheet'">
        <noscript><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.7.2/css/all.min.css"></noscript><link rel="preload" href="https://cdn.jsdelivr.net/npm/animate.css@4.1.1/animate.min.css" as="style" onload="this.onload=null;this.rel='stylesheet'">
        <noscript><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/animate.css@4.1.1/animate.min.css"></noscript><script type="application/ld+json">
    {
        "@context": "http://schema.org",
        "@type": "BlogPosting",
        "headline": "Automatizando a Criacao De Imagens Com Packer",
        "inLanguage": "pt-BR",
        "mainEntityOfPage": {
            "@type": "WebPage",
            "@id": "\/\/blog.marcelocavalcante.net:1313\/posts\/automatizando-a-criacao-de-imagens\/"
        },"image": [{
                            "@type": "ImageObject",
                            "url": "\/\/blog.marcelocavalcante.net:1313\/posts\/automatizando-a-criacao-de-imagens\/featured-image.png",
                            "width":  500 ,
                            "height":  333 
                        }],"genre": "posts","keywords": "Devops, Packer, Docker, Cloud","wordcount":  2387 ,
        "url": "\/\/blog.marcelocavalcante.net:1313\/posts\/automatizando-a-criacao-de-imagens\/","datePublished": "2018-07-30T13:32:42-05:00","dateModified": "2018-07-30T13:32:42-05:00","publisher": {
            "@type": "Organization",
            "name": ""},"author": {
                "@type": "Person",
                "name": "Marcelo Cavalcante"
            },"description": "Packer é uma ferramenta Open Source, criada e mantida pela HashiCorp, para a criação de imagens de máquinas idênticas para múltiplas plataformas a partir de uma única fonte ou código de configuração. O Packer é leve, roda em praticamente todos os principais Sistemas Operacionais e possui alta performance, permitindo a criação de imagens para múltiplas plataformas em paralelo."
    }
    </script><script src="https://cdnjs.cloudflare.com/ajax/libs/lunr.js/2.3.9/lunr.min.js"></script>
    </head>
    <body data-header-desktop="fixed" data-header-mobile="auto"><script>
          const query = window.matchMedia('(prefers-color-scheme: dark)');
          function applyTheme() {
            let theme = window.localStorage?.getItem('theme') || 'auto';
            let isDark = theme === 'dark' || (theme === 'auto' && query.matches);
            document.body.setAttribute('theme', isDark? 'dark' : 'light');
            document.body.setAttribute('cfg-theme', theme);
          }

          applyTheme();
          query.addEventListener('change', applyTheme);
        </script>

        <div id="mask"></div><div class="wrapper"><header class="desktop" id="header-desktop">
    <div class="header-wrapper">
        <div class="header-title">
            <a href="/" title="Marcelo Cavalcante Rocha"><img
        class="lazyload logo"
        src="/svg/loading.min.svg"
        data-src="https://marcelocavalcante.net/ftp/logonew.png"
        data-srcset="https://marcelocavalcante.net/ftp/logonew.png, https://marcelocavalcante.net/ftp/logonew.png 1.5x, https://marcelocavalcante.net/ftp/logonew.png 2x"
        data-sizes="auto"
        alt="https://marcelocavalcante.net/ftp/logonew.png"
        title="https://marcelocavalcante.net/ftp/logonew.png" /></a>
        </div>
        <div class="menu">
            <div class="menu-inner"><a class="menu-item" href="/posts/"> Posts </a><a class="menu-item" href="/tags/"> Tags </a><a class="menu-item" href="/categories/"> Categorias </a><a class="menu-item" href="/sobre/"> Quem Sou </a><span class="menu-item delimiter"></span><span class="menu-item search" id="search-desktop">
                        <input type="text" placeholder="Pesquisar títulos ou conteúdos ..." id="search-input-desktop">
                        <a href="javascript:void(0);" class="search-button search-toggle" id="search-toggle-desktop" title="Pesquisa">
                            <i class="fas fa-search fa-fw" aria-hidden="true"></i>
                        </a>
                        <a href="javascript:void(0);" class="search-button search-clear" id="search-clear-desktop" title="Limpar">
                            <i class="fas fa-times-circle fa-fw" aria-hidden="true"></i>
                        </a>
                        <span class="search-button search-loading" id="search-loading-desktop">
                            <i class="fas fa-spinner fa-fw fa-spin" aria-hidden="true"></i>
                        </span>
                    </span><a href="javascript:void(0);" class="menu-item theme-switch" title="Trocar tema">
                    <i class="fas fa-adjust fa-fw" aria-hidden="true"></i>
                </a></div>
        </div>
    </div>
</header><header class="mobile" id="header-mobile">
    <div class="header-container">
        <div class="header-wrapper">
            <div class="header-title">
                <a href="/" title="Marcelo Cavalcante Rocha"><img
        class="lazyload logo"
        src="/svg/loading.min.svg"
        data-src="https://marcelocavalcante.net/ftp/logonew.png"
        data-srcset="https://marcelocavalcante.net/ftp/logonew.png, https://marcelocavalcante.net/ftp/logonew.png 1.5x, https://marcelocavalcante.net/ftp/logonew.png 2x"
        data-sizes="auto"
        alt="https://marcelocavalcante.net/ftp/logonew.png"
        title="https://marcelocavalcante.net/ftp/logonew.png" /></a>
            </div>
            <div class="menu-toggle" id="menu-toggle-mobile">
                <span></span><span></span><span></span>
            </div>
        </div>
        <div class="menu" id="menu-mobile"><div class="search-wrapper">
                    <div class="search mobile" id="search-mobile">
                        <input type="text" placeholder="Pesquisar títulos ou conteúdos ..." id="search-input-mobile">
                        <a href="javascript:void(0);" class="search-button search-toggle" id="search-toggle-mobile" title="Pesquisa">
                            <i class="fas fa-search fa-fw" aria-hidden="true"></i>
                        </a>
                        <a href="javascript:void(0);" class="search-button search-clear" id="search-clear-mobile" title="Limpar">
                            <i class="fas fa-times-circle fa-fw" aria-hidden="true"></i>
                        </a>
                        <span class="search-button search-loading" id="search-loading-mobile">
                            <i class="fas fa-spinner fa-fw fa-spin" aria-hidden="true"></i>
                        </span>
                    </div>
                    <a href="javascript:void(0);" class="search-cancel" id="search-cancel-mobile">
                        Cancelar
                    </a>
                </div><a class="menu-item" href="/posts/" title="">Posts</a><a class="menu-item" href="/tags/" title="">Tags</a><a class="menu-item" href="/categories/" title="">Categorias</a><a class="menu-item" href="/sobre/" title="">Quem Sou</a><a href="javascript:void(0);" class="menu-item theme-switch" title="Trocar tema">
                <i class="fas fa-adjust fa-fw" aria-hidden="true"></i>
            </a></div>
    </div>
</header><div class="search-dropdown desktop">
        <div id="search-dropdown-desktop"></div>
    </div>
    <div class="search-dropdown mobile">
        <div id="search-dropdown-mobile"></div>
    </div><main class="main">
                <div class="container"><div class="toc" id="toc-auto">
            <h2 class="toc-title">Conteúdos</h2>
            <div class="toc-content" id="toc-content-auto"></div>
        </div><article class="page single"><h1 class="single-title animate__animated animate__flipInX">Automatizando a Criacao De Imagens Com Packer</h1><div class="post-meta">
            <div class="post-meta-line"><span class="post-author"><a href="https://blog.marcelocavalcante.net" title="Author" target="_blank" rel="noopener noreffer author" class="author"><i class="fas fa-user-circle fa-fw" aria-hidden="true"></i>Marcelo Cavalcante</a></span>&nbsp;<span class="post-category">incluido em <a href="/categories/tutoriais/"><i class="far fa-folder fa-fw" aria-hidden="true"></i>Tutoriais</a></span></div>
            <div class="post-meta-line"><i class="far fa-calendar-alt fa-fw" aria-hidden="true"></i>&nbsp;<time datetime="2018-07-30">2018-07-30</time>&nbsp;<i class="fas fa-pencil-alt fa-fw" aria-hidden="true"></i>&nbsp;2387 palavras&nbsp;
                <i class="far fa-clock fa-fw" aria-hidden="true"></i>&nbsp;12 minutos&nbsp;</div>
        </div><div class="featured-image"><img
        class="lazyload"
        src="/svg/loading.min.svg"
        data-src="/posts/automatizando-a-criacao-de-imagens/featured-image.png"
        data-srcset="/posts/automatizando-a-criacao-de-imagens/featured-image.png, /posts/automatizando-a-criacao-de-imagens/featured-image.png 1.5x, /posts/automatizando-a-criacao-de-imagens/featured-image.png 2x"
        data-sizes="auto"
        alt="/posts/automatizando-a-criacao-de-imagens/featured-image.png"
        title="Packer é uma ferramenta Open Source, criada e mantida pela HashiCorp, para a criação de imagens de máquinas idênticas para múltiplas plataformas a partir de uma única fonte ou código de configuração. O Packer é leve, roda em praticamente todos os principais Sistemas Operacionais e possui alta performance, permitindo a criação de imagens para múltiplas plataformas em paralelo." /></div><div class="details toc" id="toc-static"  data-kept="">
                <div class="details-summary toc-title">
                    <span>Conteúdos</span>
                    <span><i class="details-icon fas fa-angle-right" aria-hidden="true"></i></span>
                </div>
                <div class="details-content toc-content" id="toc-content-static"><nav id="TableOfContents">
  <ul>
    <li><a href="#o-que-é-packer-e-qual-sua-importância">O que é Packer e qual sua importância</a></li>
    <li><a href="#instalação">Instalação</a></li>
    <li><a href="#criando-imagens-com-o-packer">Criando Imagens com o Packer</a></li>
  </ul>
</nav></div>
            </div><div class="content" id="content"><p>Já utilizou Packer para automatizar e facilitar sua criação de recursos e imagens de máquinas? Caso não, está na hora de você conhecer e experimentar esta excelente ferramenta.</p>
<h2 id="o-que-é-packer-e-qual-sua-importância">O que é Packer e qual sua importância</h2>
<p><strong>P</strong>acker é uma ferramenta Open Source, criada e mantida pela <a href="https://www.hashicorp.com" target="_blank" rel="noopener noreffer ">HashiCorp</a>, para a criação de imagens de máquinas idênticas para múltiplas plataformas a partir de uma única fonte ou código de configuração. O <a href="https://www.packer.io/" target="_blank" rel="noopener noreffer ">Packer</a> é leve, roda em praticamente todos os principais Sistemas Operacionais e possui alta performance, permitindo a criação de imagens para múltiplas plataformas em paralelo.</p>
<p><strong>U</strong>ma imagem de máquina, nada mais é que um arquivo estático que contém um sistema operacional pré-configurado, com determinados softwares instalados e que pode ser utilizada para criar novas máquinas ou servidores de forma mais rápida, evitando o trabalho repetitivo de instalar o sistema operacional e configurar aplicações padrões.</p>
<p><strong>E</strong>xistem diversos formatos diferentes de imagens que podem ser criadas através do Packer, como por exemplo Amazon EC2, VirtualBox, VMware, Google Cloud Platform, Microsoft Azure, Docker, QEMU, CloudStack, DigitalOcean, etc.</p>
<p><strong>O</strong> Packer suporta e é compatível com diversas ferramentas de provisionamento e automação, como shell script, Ansible, Puppet, Chef, etc., fazendo com que a criação de imagens seja ainda mais simples, dinâmica e robusta.</p>
<p><strong>A</strong> ideia de criar imagens não é nova, visto que Sysadmins já o fazem há muitos anos, porém esta sempre foi uma tarefa tediosa, demorada e muito pouco produtiva. Basicamente a ideia de se construir uma imagem partia de, antes de mais nada, realizar de fato uma instalação completa de um Sistema Operacional e em seguida utilizar algum aplicativo para &ldquo;salvar&rdquo; aquele estado em uma imagem, que poderia ser posteriormente aplicada em outras máquinas. Isto por si só já facilitava muito a vida de Sysadmins em geral, visto que eles apenas realizavam a instalação completa do SO uma vez. Caso, além do SO, fossem necessárias outras aplicações, o processo seria basicamente o mesmo, instalando-se uma vez o SO completo e em seguida instalando todas as aplicações desejadas para a imagem.</p>
<p><strong>A</strong>té então a criação da imagem parecia ser um sucesso, no entanto isto era algo improdutivo por ser absolutamente estático e imutável. Sempre que fosse necessário fazer uma mudança na imagem, atualizar versão de sistema operacional, aplicar patches, atualizar demais aplicações ou mudar configurações, novamente o processo deveria se repetir do início. Não é necessário sequer mencionar que não era nada simples gerenciar e versionar isto.</p>
<p><strong>E</strong>is que surge o Packer para deixar a criação de imagens menos entediante, flexível e mais gerenciável.</p>
<h2 id="instalação">Instalação</h2>
<p><strong>A</strong> instalação não é complexa e pode ser feita através do binário disponível na página de downloads do Packer: <a href="https://www.packer.io/downloads.html" target="_blank" rel="noopener noreffer ">Download Packer</a><!-- raw HTML omitted --></p>
<p><strong>Ubuntu</strong> - Caso não queira instalar através do binário fornecido no link acima, pode instalar via:</p>
<div class="code-block code-line-numbers open" style="counter-reset: code-block 0">
    <div class="code-header language-bash">
        <span class="code-title"><i class="arrow fas fa-angle-right fa-fw" aria-hidden="true"></i></span>
        <span class="ellipses"><i class="fas fa-ellipsis-h fa-fw" aria-hidden="true"></i></span>
        <span class="copy" title="Copiar para a área de transferência"><i class="far fa-copy fa-fw" aria-hidden="true"></i></span>
    </div><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">$ sudo apt-get install packer -y</span></span></code></pre></div></div>
<p><strong>Arch linux</strong> - Caso não queira instalar através do binário fornecido no link acima, pode instalar através do pacote disponível no <a href="https://aur.archlinux.org/packages/packer/" target="_blank" rel="noopener noreffer ">AUR</a>.</p>
<p><strong>OS X</strong> - Caso não queira instalar através do binário fornecido no link acima, pode instalar através do homebrew:</p>
<div class="code-block code-line-numbers open" style="counter-reset: code-block 0">
    <div class="code-header language-bash">
        <span class="code-title"><i class="arrow fas fa-angle-right fa-fw" aria-hidden="true"></i></span>
        <span class="ellipses"><i class="fas fa-ellipsis-h fa-fw" aria-hidden="true"></i></span>
        <span class="copy" title="Copiar para a área de transferência"><i class="far fa-copy fa-fw" aria-hidden="true"></i></span>
    </div><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">$ brew install packer</span></span></code></pre></div></div>
<p><strong>I</strong>ndependente de sua forma de instalação, confirme que a instalação foi concluída com sucesso:</p>
<div class="code-block code-line-numbers open" style="counter-reset: code-block 0">
    <div class="code-header language-bash">
        <span class="code-title"><i class="arrow fas fa-angle-right fa-fw" aria-hidden="true"></i></span>
        <span class="ellipses"><i class="fas fa-ellipsis-h fa-fw" aria-hidden="true"></i></span>
        <span class="copy" title="Copiar para a área de transferência"><i class="far fa-copy fa-fw" aria-hidden="true"></i></span>
    </div><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">$ packer
</span></span><span class="line"><span class="cl">Usage: packer <span class="o">[</span>--version<span class="o">]</span> <span class="o">[</span>--help<span class="o">]</span> &lt;command&gt; <span class="o">[</span>&lt;args&gt;<span class="o">]</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">Available commands are:
</span></span><span class="line"><span class="cl">    build       build image<span class="o">(</span>s<span class="o">)</span> from template
</span></span><span class="line"><span class="cl">    fix         fixes templates from old versions of packer
</span></span><span class="line"><span class="cl">    inspect     see components of a template
</span></span><span class="line"><span class="cl">    push        push a template and supporting files to a Packer build service
</span></span><span class="line"><span class="cl">    validate    check that a template is valid
</span></span><span class="line"><span class="cl">    version     Prints the Packer version</span></span></code></pre></div></div>
<p><strong>S</strong>e você recebeu algo similar, significa que você já pode começar a criar suas imagens. Caso tenha recebido um erro informando que o Packer não foi encontrado, significa que o mesmo não foi inserido corretamente na variável de ambiente de seu PATH. Certifique-se de inserir o diretório no qual o Packer foi instalado em seu PATH.</p>
<h2 id="criando-imagens-com-o-packer">Criando Imagens com o Packer</h2>
<p><strong>C</strong>onforme dito anteriormente, o Packer pode criar imagens para diversas extensões e plataformas, portanto o primeiro passo é saber para qual plataforma você deseja criar sua imagem.</p>
<p><strong>P</strong>ara este tutorial introdutório, utilizaremos o Docker como destino para nossa imagem, ou seja, criaremos uma imagem de container que poderá rodar com o Docker.</p>
<p><strong>OBS:</strong> A partir deste ponto estou assumindo que você já possui o Docker instalado em seu sistema. Para confirmar, digite:</p>
<div class="code-block code-line-numbers open" style="counter-reset: code-block 0">
    <div class="code-header language-bash">
        <span class="code-title"><i class="arrow fas fa-angle-right fa-fw" aria-hidden="true"></i></span>
        <span class="ellipses"><i class="fas fa-ellipsis-h fa-fw" aria-hidden="true"></i></span>
        <span class="copy" title="Copiar para a área de transferência"><i class="far fa-copy fa-fw" aria-hidden="true"></i></span>
    </div><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">$ docker --version
</span></span><span class="line"><span class="cl">Docker version 18.06.0-ce, build 0ffa825</span></span></code></pre></div></div>
<p><strong>Vamos ao Packer.</strong></p>
<p><strong>P</strong>rimeiramente mostrarei como não tenho nenhuma imagem Docker neste momento em meu sistema:</p>
<div class="code-block code-line-numbers open" style="counter-reset: code-block 0">
    <div class="code-header language-bash">
        <span class="code-title"><i class="arrow fas fa-angle-right fa-fw" aria-hidden="true"></i></span>
        <span class="ellipses"><i class="fas fa-ellipsis-h fa-fw" aria-hidden="true"></i></span>
        <span class="copy" title="Copiar para a área de transferência"><i class="far fa-copy fa-fw" aria-hidden="true"></i></span>
    </div><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">$ docker ps
</span></span><span class="line"><span class="cl">CONTAINER ID        IMAGE               COMMAND             CREATED             STATUS              PORTS               NAMES</span></span></code></pre></div></div>
<p><strong>1-</strong> Escolha um editor de textos de sua preferência e inicie um arquivo chamado <em>template.json</em>;</p>
<p><strong>2-</strong> Digite o seguinte em seu arquivo <em>template.json</em>.</p>
<div class="code-block code-line-numbers open" style="counter-reset: code-block 0">
    <div class="code-header language-json">
        <span class="code-title"><i class="arrow fas fa-angle-right fa-fw" aria-hidden="true"></i></span>
        <span class="ellipses"><i class="fas fa-ellipsis-h fa-fw" aria-hidden="true"></i></span>
        <span class="copy" title="Copiar para a área de transferência"><i class="far fa-copy fa-fw" aria-hidden="true"></i></span>
    </div><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-json" data-lang="json"><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="nt">&#34;builders&#34;</span><span class="p">:</span> <span class="p">[{</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&#34;type&#34;</span><span class="p">:</span> <span class="s2">&#34;docker&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&#34;image&#34;</span><span class="p">:</span> <span class="s2">&#34;ubuntu&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&#34;commit&#34;</span><span class="p">:</span> <span class="kc">true</span>
</span></span><span class="line"><span class="cl">  <span class="p">}]</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span></span></span></code></pre></div></div>
<p><strong>O</strong> que temos&hellip;</p>
<p><em>builders:</em> Abre o bloco builders (construtores), onde iniciamos as instruções que definirão como a nossa imagem será criada;</p>
<p><em>type:</em> Especifica o tipo de construtor que será utilizado. Neste exemplo escolhemos Docker. Aqui poderíamos utilizar AWS EC2, Google Cloud Instance, etc.</p>
<p><em>image:</em> Parâmetro no qual indicaremos qual imagem será utilizada como origem para a nossa imagem final.</p>
<p><em>commit:</em> Indica que queremos realizar o commit da imagem gerada no final.</p>
<p>*<em>OBS:</em> É importante lembrar que o Packer possui uma infinidade de parâmetros ou propriedades diferentes que podem ser específicos para cada tipo de builder. Lista de parâmetros e opções para o builder <a href="https://www.packer.io/docs/builders/docker.html" target="_blank" rel="noopener noreffer ">Docker</a>.</p>
<p><strong>P</strong>rimeiramente, o indicado é validarmos a sintaxe de nosso código json: <em>($ packer validate template.json)</em></p>
<div class="code-block code-line-numbers open" style="counter-reset: code-block 0">
    <div class="code-header language-bash">
        <span class="code-title"><i class="arrow fas fa-angle-right fa-fw" aria-hidden="true"></i></span>
        <span class="ellipses"><i class="fas fa-ellipsis-h fa-fw" aria-hidden="true"></i></span>
        <span class="copy" title="Copiar para a área de transferência"><i class="far fa-copy fa-fw" aria-hidden="true"></i></span>
    </div><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">$ packer validate template.json
</span></span><span class="line"><span class="cl">Template validated successfully.</span></span></code></pre></div></div>
<p><strong>O</strong> código parece estar correto do ponto de vista do Packer. Caso houvesse algo errado com o código, a mensagem daria alguma pista de onde está o erro. Removerei o último <strong>}</strong> do arquivo template.json para forçar um erro: <em>($ packer validate template.json)</em></p>
<div class="code-block code-line-numbers open" style="counter-reset: code-block 0">
    <div class="code-header language-bash">
        <span class="code-title"><i class="arrow fas fa-angle-right fa-fw" aria-hidden="true"></i></span>
        <span class="ellipses"><i class="fas fa-ellipsis-h fa-fw" aria-hidden="true"></i></span>
        <span class="copy" title="Copiar para a área de transferência"><i class="far fa-copy fa-fw" aria-hidden="true"></i></span>
    </div><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">$ packer validate template.json
</span></span><span class="line"><span class="cl">Failed to parse template: Error parsing JSON: unexpected end of JSON input
</span></span><span class="line"><span class="cl">At line 7, column <span class="m">1</span> <span class="o">(</span>offset 88<span class="o">)</span>:
</span></span><span class="line"><span class="cl">    6:   <span class="o">}]</span>
</span></span><span class="line"><span class="cl">    7:</span></span></code></pre></div></div>
<p><strong>C</strong>om o arquivo de volta à sua versão correta, o próximo passo seria de fato o build, onde criaremos a imgem desejado de acordo com as intruções que demos: <em>($ packer build template.json)</em></p>
<div class="code-block code-line-numbers open" style="counter-reset: code-block 0">
    <div class="code-header language-bash">
        <span class="code-title"><i class="arrow fas fa-angle-right fa-fw" aria-hidden="true"></i></span>
        <span class="ellipses"><i class="fas fa-ellipsis-h fa-fw" aria-hidden="true"></i></span>
        <span class="copy" title="Copiar para a área de transferência"><i class="far fa-copy fa-fw" aria-hidden="true"></i></span>
    </div><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">$ packer build template.json
</span></span><span class="line"><span class="cl">docker output will be in this color.
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="o">==</span>&gt; docker: Creating a temporary directory <span class="k">for</span> sharing data...
</span></span><span class="line"><span class="cl"><span class="o">==</span>&gt; docker: Pulling Docker image: ubuntu
</span></span><span class="line"><span class="cl">    docker: Using default tag: latest
</span></span><span class="line"><span class="cl">    docker: latest: Pulling from library/ubuntu
</span></span><span class="line"><span class="cl">    docker: c64513b74145: Pulling fs layer
</span></span><span class="line"><span class="cl">    docker: 01b8b12bad90: Pulling fs layer
</span></span><span class="line"><span class="cl">    docker: c5d85cf7a05f: Pulling fs layer
</span></span><span class="line"><span class="cl">    docker: b6b268720157: Pulling fs layer
</span></span><span class="line"><span class="cl">    docker: e12192999ff1: Pulling fs layer
</span></span><span class="line"><span class="cl">    docker: b6b268720157: Waiting
</span></span><span class="line"><span class="cl">    docker: e12192999ff1: Waiting
</span></span><span class="line"><span class="cl">    docker: c5d85cf7a05f: Verifying Checksum
</span></span><span class="line"><span class="cl">    docker: c5d85cf7a05f: Download <span class="nb">complete</span>
</span></span><span class="line"><span class="cl">    docker: 01b8b12bad90: Verifying Checksum
</span></span><span class="line"><span class="cl">    docker: 01b8b12bad90: Download <span class="nb">complete</span>
</span></span><span class="line"><span class="cl">    docker: e12192999ff1: Verifying Checksum
</span></span><span class="line"><span class="cl">    docker: e12192999ff1: Download <span class="nb">complete</span>
</span></span><span class="line"><span class="cl">    docker: b6b268720157: Verifying Checksum
</span></span><span class="line"><span class="cl">    docker: b6b268720157: Download <span class="nb">complete</span>
</span></span><span class="line"><span class="cl">    docker: c64513b74145: Verifying Checksum
</span></span><span class="line"><span class="cl">    docker: c64513b74145: Download <span class="nb">complete</span>
</span></span><span class="line"><span class="cl">    docker: c64513b74145: Pull <span class="nb">complete</span>
</span></span><span class="line"><span class="cl">    docker: 01b8b12bad90: Pull <span class="nb">complete</span>
</span></span><span class="line"><span class="cl">    docker: c5d85cf7a05f: Pull <span class="nb">complete</span>
</span></span><span class="line"><span class="cl">    docker: b6b268720157: Pull <span class="nb">complete</span>
</span></span><span class="line"><span class="cl">    docker: e12192999ff1: Pull <span class="nb">complete</span>
</span></span><span class="line"><span class="cl">    docker: Digest: sha256:3f119dc0737f57f704ebecac8a6d8477b0f6ca1ca0332c7ee1395ed2c6a82be7
</span></span><span class="line"><span class="cl">    docker: Status: Downloaded newer image <span class="k">for</span> ubuntu:latest
</span></span><span class="line"><span class="cl"><span class="o">==</span>&gt; docker: Starting docker container...
</span></span><span class="line"><span class="cl">    docker: Run command: docker run -v /Users/kalib/.packer.d/tmp/packer-docker835877235:/packer-files -d -i -t ubuntu /bin/bash
</span></span><span class="line"><span class="cl">    docker: Container ID: <span class="nv">50211726119aa045b0bc5eb9da8c9af243bc179fef0aad3cd94156d0f2a7a45a</span>
</span></span><span class="line"><span class="cl"><span class="o">==</span>&gt; docker: Committing the container
</span></span><span class="line"><span class="cl">    docker: Image ID: sha256:3a6a21aab4706e2b512f0c1fcbe8265e2527d4794f7c6fbdc5e4faf907d10622
</span></span><span class="line"><span class="cl"><span class="o">==</span>&gt; docker: Killing the container: 50211726119aa045b0bc5eb9da8c9af243bc179fef0aad3cd94156d0f2a7a45a
</span></span><span class="line"><span class="cl">Build <span class="s1">&#39;docker&#39;</span> finished.
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="o">==</span>&gt; Builds finished. The artifacts of successful builds are:
</span></span><span class="line"><span class="cl">--&gt; docker: Imported Docker image: sha256:3a6a21aab4706e2b512f0c1fcbe8265e2527d4794f7c6fbdc5e4faf907d10622</span></span></code></pre></div></div>
<p><strong>N</strong>a saída do comando, ou output, podemos ver todos os passos e instruções que foram realizadas na criação de nossa imagem. Neste exemplo, o Docker baixou a última imagem ubuntu dos repositórios do Docker e em seguida gerou nossa imagem.</p>
<p><strong>P</strong>ara confirmar, podemos utilizar novamente o <em>docker images</em>:</p>
<div class="code-block code-line-numbers open" style="counter-reset: code-block 0">
    <div class="code-header language-bash">
        <span class="code-title"><i class="arrow fas fa-angle-right fa-fw" aria-hidden="true"></i></span>
        <span class="ellipses"><i class="fas fa-ellipsis-h fa-fw" aria-hidden="true"></i></span>
        <span class="copy" title="Copiar para a área de transferência"><i class="far fa-copy fa-fw" aria-hidden="true"></i></span>
    </div><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">docker images
</span></span><span class="line"><span class="cl">REPOSITORY          TAG                 IMAGE ID            CREATED             SIZE
</span></span><span class="line"><span class="cl">&lt;none&gt;              &lt;none&gt;              3a6a21aab470        <span class="m">5</span> minutes ago       83.5MB
</span></span><span class="line"><span class="cl">ubuntu              latest              735f80812f90        <span class="m">6</span> days ago          83.5MB</span></span></code></pre></div></div>
<p><strong>C</strong>omo esperado, agora temos duas imagens: a do ubuntu padrão, que foi baixada para servir de base para a nossa, bem como a nossa, até então sem nome.</p>
<p><strong>D</strong>e certa forma nada foi feito até então. Nós apenas geramos uma imagem idêntica à que já existia do ubuntu, sem qualquer mudança. Vamos então dar algum sentido à nossa imagem em seguida. Além disso, podemos perceber que nossa imagem não tinha sequer nome, ficando listada como <em><!-- raw HTML omitted --></em>. Corrigiremos isso também.</p>
<p><strong>O</strong> Packer considera o Docker apenas como uma plataforma para gerar/rodar containers e, como tal, para gerar uma imagem o Packer descarta a necessidade da utilização de um Dockerfile, como de costume para quem já criou containers com Docker. Através de blocos de código <em>changes</em> e <em>provisioners</em>, o Packer nos permite passar praticamente todas as informações de metadata que fariam parte de um Dockerfile.</p>
<p><strong>P</strong>ara demonstrar, criaremos uma imagem de um ubuntu rodando <em>nginx</em>, porém utilizaremos a imagem padrão do ubuntu que já baixamos anteriormente.</p>
<p><strong>O</strong> código do template.json agora deverá ser o seguinte:</p>
<div class="code-block code-line-numbers open" style="counter-reset: code-block 0">
    <div class="code-header language-json">
        <span class="code-title"><i class="arrow fas fa-angle-right fa-fw" aria-hidden="true"></i></span>
        <span class="ellipses"><i class="fas fa-ellipsis-h fa-fw" aria-hidden="true"></i></span>
        <span class="copy" title="Copiar para a área de transferência"><i class="far fa-copy fa-fw" aria-hidden="true"></i></span>
    </div><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-json" data-lang="json"><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="nt">&#34;builders&#34;</span><span class="p">:</span> <span class="p">[{</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&#34;type&#34;</span><span class="p">:</span> <span class="s2">&#34;docker&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&#34;image&#34;</span><span class="p">:</span> <span class="s2">&#34;ubuntu&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&#34;commit&#34;</span><span class="p">:</span> <span class="kc">true</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&#34;changes&#34;</span><span class="p">:</span> <span class="p">[</span>
</span></span><span class="line"><span class="cl">      <span class="s2">&#34;CMD [\&#34;nginx\&#34;, \&#34;-g\&#34;, \&#34;daemon off;\&#34;]&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">      <span class="s2">&#34;EXPOSE 80&#34;</span>
</span></span><span class="line"><span class="cl">   <span class="p">]</span>
</span></span><span class="line"><span class="cl">  <span class="p">}],</span>
</span></span><span class="line"><span class="cl">  <span class="nt">&#34;provisioners&#34;</span><span class="p">:</span> <span class="p">[</span>
</span></span><span class="line"><span class="cl">    <span class="p">{</span>
</span></span><span class="line"><span class="cl">      <span class="nt">&#34;type&#34;</span> <span class="p">:</span> <span class="s2">&#34;shell&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">      <span class="nt">&#34;inline&#34;</span> <span class="p">:</span> <span class="p">[</span><span class="s2">&#34;apt-get update &amp;&amp; apt-get install -y nginx&#34;</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">  <span class="p">],</span>
</span></span><span class="line"><span class="cl">  <span class="nt">&#34;post-processors&#34;</span><span class="p">:</span> <span class="p">[</span>
</span></span><span class="line"><span class="cl">      <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="nt">&#34;type&#34;</span><span class="p">:</span> <span class="s2">&#34;docker-tag&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">        <span class="nt">&#34;repository&#34;</span><span class="p">:</span> <span class="s2">&#34;kalib/ubuntunginx&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">        <span class="nt">&#34;tag&#34;</span><span class="p">:</span> <span class="s2">&#34;0.1&#34;</span>
</span></span><span class="line"><span class="cl">      <span class="p">}</span>
</span></span><span class="line"><span class="cl">  <span class="p">]</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span></span></span></code></pre></div></div>
<p><strong>V</strong>ejamos o que foi incluído:</p>
<p><em>changes:</em> Parâmetro que nos permite alterar a meta-data de nossa imagem docker.</p>
<p><em>CMD [&quot;nginx&quot;, &quot;-g&quot;, &quot;daemon off;&quot;]:</em> Comando para iniciar o nginx no container, assim como faríamos utilizando Dockerfile.</p>
<p><em>EXPOSE 80:</em> Da mesma forma, apenas informando que a porta 80 no container deverá estar disponível, assim como faríamos em um Dockerfile.</p>
<p><em>provisioners:</em> É onde indicamos que ferramentas utilizaremos para provisionar as alterações/configurações em nossa imagem. Podemos ter um ou mais provisioners ao mesmo tempo. Neste exemplo estaremos utilizando um simples comando bash, portanto nosso provisioner será <em>bash</em>, mas poderia ser chef, ansible, puppet, ou mesmo um script bash mais complexo, mas como o objetivo para este post é uma abordagem simples e introdutória, manteremos o provisioner mais simples possível.</p>
<p><em>type:</em> especificamos que o tipo de provisioner será <em>bash</em>.</p>
<p><em>inline:</em> Inserimos o comando bash que desejamos que seja executado para personalizar nossa imagem. Neste caso, <em>apt-get update &amp;&amp; apt-get install -y nginx</em> irá atualizar a base de dados dos repositórios e em seguida instalar o nginx.</p>
<p><em>post-processors:</em> Como o nome já diz, são instruções ou processors que acontecem ao final do build.</p>
<p><em>type:</em> Indica o tipo de post-processor que utilizaremos. No exemplo, utilizaremos <em>docker-tag</em>, para que possamos dar uma tag/nome para nossa imagem. (Lembrando que como uma boa prática, ao criar uma imagem Docker, sempre inserimos o padrão <em>repositório/imagem</em>)</p>
<p><em>repository:</em> É onde indicamos o repositório e o nome da imagem que criaremos.</p>
<p><em>tag:</em> Onde podemos definir a tag que ajudar a manter o controle de versão de nossa imagem.</p>
<p><strong>N</strong>ovamente, vamos validar nosso código:</p>
<div class="code-block code-line-numbers open" style="counter-reset: code-block 0">
    <div class="code-header language-bash">
        <span class="code-title"><i class="arrow fas fa-angle-right fa-fw" aria-hidden="true"></i></span>
        <span class="ellipses"><i class="fas fa-ellipsis-h fa-fw" aria-hidden="true"></i></span>
        <span class="copy" title="Copiar para a área de transferência"><i class="far fa-copy fa-fw" aria-hidden="true"></i></span>
    </div><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">$ packer validate template.json
</span></span><span class="line"><span class="cl">Template validated successfully.</span></span></code></pre></div></div>
<p><strong>D</strong>esta vez o output será muito extenso, portanto colarei apenas alguns trechos aqui para demonstrar o resultado:</p>
<div class="code-block code-line-numbers" style="counter-reset: code-block 0">
    <div class="code-header language-bash">
        <span class="code-title"><i class="arrow fas fa-angle-right fa-fw" aria-hidden="true"></i></span>
        <span class="ellipses"><i class="fas fa-ellipsis-h fa-fw" aria-hidden="true"></i></span>
        <span class="copy" title="Copiar para a área de transferência"><i class="far fa-copy fa-fw" aria-hidden="true"></i></span>
    </div><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">$ packer build template.json
</span></span><span class="line"><span class="cl">docker output will be in this color.
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="o">==</span>&gt; docker: Creating a temporary directory <span class="k">for</span> sharing data...
</span></span><span class="line"><span class="cl"><span class="o">==</span>&gt; docker: Pulling Docker image: ubuntu
</span></span><span class="line"><span class="cl">    docker: Using default tag: latest
</span></span><span class="line"><span class="cl">    docker: latest: Pulling from library/ubuntu
</span></span><span class="line"><span class="cl">    docker: Digest: sha256:3f119dc0737f57f704ebecac8a6d8477b0f6ca1ca0332c7ee1395ed2c6a82be7
</span></span><span class="line"><span class="cl">    docker: Status: Image is up to date <span class="k">for</span> ubuntu:latest
</span></span><span class="line"><span class="cl"><span class="o">==</span>&gt; docker: Starting docker container...
</span></span><span class="line"><span class="cl">    docker: Run command: docker run -v /Users/kalib/.packer.d/tmp/packer-docker737353515:/packer-files -d -i -t ubuntu /bin/bash
</span></span><span class="line"><span class="cl">    docker: Container ID: <span class="nv">097a85a796e0e928fbc82cd6618bd60e286b46dfadad20e823027fc2f93d25db</span>
</span></span><span class="line"><span class="cl"><span class="o">==</span>&gt; docker: Provisioning with shell script: /var/folders/nn/njz4sd054fv_tvq30vh0zygh0000gp/T/packer-shell161880041
</span></span><span class="line"><span class="cl">    docker: Get:1 https://archive.ubuntu.com/ubuntu bionic InRelease <span class="o">[</span><span class="m">242</span> kB<span class="o">]</span>
</span></span><span class="line"><span class="cl">    docker: Get:2 https://security.ubuntu.com/ubuntu bionic-security InRelease <span class="o">[</span>83.2 kB<span class="o">]</span>
</span></span><span class="line"><span class="cl">    ...
</span></span><span class="line"><span class="cl">    ...
</span></span><span class="line"><span class="cl">    docker: Reading state information...
</span></span><span class="line"><span class="cl">docker: The following additional packages will be installed:
</span></span><span class="line"><span class="cl">docker:   fontconfig-config fonts-dejavu-core geoip-database libbsd0 libexpat1
</span></span><span class="line"><span class="cl">docker:   libfontconfig1 libfreetype6 libgd3 libgeoip1 libicu60 libjbig0
</span></span><span class="line"><span class="cl">docker:   libjpeg-turbo8 libjpeg8 libnginx-mod-http-geoip
</span></span><span class="line"><span class="cl">docker:   libnginx-mod-http-image-filter libnginx-mod-http-xslt-filter
</span></span><span class="line"><span class="cl">docker:   libnginx-mod-mail libnginx-mod-stream libpng16-16 libssl1.1 libtiff5
</span></span><span class="line"><span class="cl">docker:   libwebp6 libx11-6 libx11-data libxau6 libxcb1 libxdmcp6 libxml2 libxpm4
</span></span><span class="line"><span class="cl">docker:   libxslt1.1 multiarch-support nginx-common nginx-core ucf
</span></span><span class="line"><span class="cl">docker: Suggested packages:
</span></span><span class="line"><span class="cl">docker:   libgd-tools geoip-bin fcgiwrap nginx-doc ssl-cert
</span></span><span class="line"><span class="cl">docker: The following NEW packages will be installed:
</span></span><span class="line"><span class="cl">docker:   fontconfig-config fonts-dejavu-core geoip-database libbsd0 libexpat1
</span></span><span class="line"><span class="cl">docker:   libfontconfig1 libfreetype6 libgd3 libgeoip1 libicu60 libjbig0
</span></span><span class="line"><span class="cl">docker:   libjpeg-turbo8 libjpeg8 libnginx-mod-http-geoip
</span></span><span class="line"><span class="cl">docker:   libnginx-mod-http-image-filter libnginx-mod-http-xslt-filter
</span></span><span class="line"><span class="cl">docker:   libnginx-mod-mail libnginx-mod-stream libpng16-16 libssl1.1 libtiff5
</span></span><span class="line"><span class="cl">docker:   libwebp6 libx11-6 libx11-data libxau6 libxcb1 libxdmcp6 libxml2 libxpm4
</span></span><span class="line"><span class="cl">docker:   libxslt1.1 multiarch-support nginx nginx-common nginx-core ucf
</span></span><span class="line"><span class="cl">docker: <span class="m">0</span> upgraded, <span class="m">35</span> newly installed, <span class="m">0</span> to remove and <span class="m">0</span> not upgraded.
</span></span><span class="line"><span class="cl">docker: Need to get 16.1 MB of archives.
</span></span><span class="line"><span class="cl">docker: After this operation, 58.8 MB of additional disk space will be used.
</span></span><span class="line"><span class="cl">docker: Get:1 https://archive.ubuntu.com/ubuntu bionic/main amd64 multiarch-support amd64 2.27-3ubuntu1 <span class="o">[</span><span class="m">6916</span> B<span class="o">]</span>
</span></span><span class="line"><span class="cl">docker: Get:2 https://archive.ubuntu.com/ubuntu bionic/main amd64 libxau6 amd64 1:1.0.8-1 <span class="o">[</span><span class="m">8376</span> B<span class="o">]</span>
</span></span><span class="line"><span class="cl">docker: Get:3 https://archive.ubuntu.com/ubuntu bionic-updates/main amd64 libjpeg-turbo8 amd64 1.5.2
</span></span><span class="line"><span class="cl">...
</span></span><span class="line"><span class="cl">...
</span></span><span class="line"><span class="cl">docker: Setting up nginx <span class="o">(</span>1.14.0-0ubuntu1<span class="o">)</span> ...
</span></span><span class="line"><span class="cl">    docker: Processing triggers <span class="k">for</span> libc-bin <span class="o">(</span>2.27-3ubuntu1<span class="o">)</span> ...
</span></span><span class="line"><span class="cl"><span class="o">==</span>&gt; docker: Committing the container
</span></span><span class="line"><span class="cl">    docker: Image ID: sha256:0cbafebeaf17d8b8e8eccad87e706845993b78265a99e3e0f1ef8bd0bd724aa7
</span></span><span class="line"><span class="cl"><span class="o">==</span>&gt; docker: Killing the container: <span class="nv">097a85a796e0e928fbc82cd6618bd60e286b46dfadad20e823027fc2f93d25db</span>
</span></span><span class="line"><span class="cl"><span class="o">==</span>&gt; docker: Running post-processor: docker-tag
</span></span><span class="line"><span class="cl">    docker <span class="o">(</span>docker-tag<span class="o">)</span>: Tagging image: sha256:0cbafebeaf17d8b8e8eccad87e706845993b78265a99e3e0f1ef8bd0bd724aa7
</span></span><span class="line"><span class="cl">    docker <span class="o">(</span>docker-tag<span class="o">)</span>: Repository: kalib/ubuntunginx:0.1
</span></span><span class="line"><span class="cl">Build <span class="s1">&#39;docker&#39;</span> finished.
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="o">==</span>&gt; Builds finished. The artifacts of successful builds are:
</span></span><span class="line"><span class="cl">--&gt; docker: Imported Docker image: sha256:0cbafebeaf17d8b8e8eccad87e706845993b78265a99e3e0f1ef8bd0bd724aa7
</span></span><span class="line"><span class="cl">--&gt; docker: Imported Docker image: kalib/ubuntunginx:0.1</span></span></code></pre></div></div>
<p><strong>C</strong>omo podemos ver, todos os passos foram executados, incluindo a atualização da lista de pacotes dos repositórios, a instalação do nginx e a criação da imagem com o repositório, nome e tag de versão que indicamos.</p>
<p><strong>V</strong>ejamos nossa imagem na lista de imagens disponíveis no Docker:</p>
<div class="code-block code-line-numbers open" style="counter-reset: code-block 0">
    <div class="code-header language-bash">
        <span class="code-title"><i class="arrow fas fa-angle-right fa-fw" aria-hidden="true"></i></span>
        <span class="ellipses"><i class="fas fa-ellipsis-h fa-fw" aria-hidden="true"></i></span>
        <span class="copy" title="Copiar para a área de transferência"><i class="far fa-copy fa-fw" aria-hidden="true"></i></span>
    </div><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">$ docker images
</span></span><span class="line"><span class="cl">REPOSITORY          TAG                 IMAGE ID            CREATED             SIZE
</span></span><span class="line"><span class="cl">kalib/ubuntunginx   0.1                 0cbafebeaf17        <span class="m">5</span> minutes ago       182MB
</span></span><span class="line"><span class="cl">&lt;none&gt;              &lt;none&gt;              4d86b1edf015        <span class="m">43</span> minutes ago      83.5MB
</span></span><span class="line"><span class="cl">ubuntu              latest              735f80812f90        <span class="m">6</span> days ago          83.5MB</span></span></code></pre></div></div>
<p><strong>S</strong>ucesso, aparentemente nossa imagem foi criada conforme o esperado. Hora de testar e ver se tudo realmente funcionou.</p>
<p><strong>OBS:</strong> Como dito no início do post, o objetivo deste post não é ensinar Docker, portanto estou assumindo que você já possui alguma familiaridade com esta ferramenta.</p>
<p><strong>V</strong>amos iniciar um container a partir desta nossa imagem em background, mapeando a porta 80 do container na porta 80 de nosso host, para facilitar o teste:</p>
<div class="code-block code-line-numbers open" style="counter-reset: code-block 0">
    <div class="code-header language-bash">
        <span class="code-title"><i class="arrow fas fa-angle-right fa-fw" aria-hidden="true"></i></span>
        <span class="ellipses"><i class="fas fa-ellipsis-h fa-fw" aria-hidden="true"></i></span>
        <span class="copy" title="Copiar para a área de transferência"><i class="far fa-copy fa-fw" aria-hidden="true"></i></span>
    </div><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">$ docker run -d -p 80:80 kalib/ubuntunginx:0.1
</span></span><span class="line"><span class="cl">53de48d3e7708a7ac16dbb5ba6ed71b8672201729264e51945ee3412a02e0deb</span></span></code></pre></div></div>
<p><strong>N</strong>enhuma mensagem de erro, portanto ao que tudo indica nosso container está rodando corretamente. Vamos confirmar isto com <em>docker ps</em>:</p>
<div class="code-block code-line-numbers open" style="counter-reset: code-block 0">
    <div class="code-header language-bash">
        <span class="code-title"><i class="arrow fas fa-angle-right fa-fw" aria-hidden="true"></i></span>
        <span class="ellipses"><i class="fas fa-ellipsis-h fa-fw" aria-hidden="true"></i></span>
        <span class="copy" title="Copiar para a área de transferência"><i class="far fa-copy fa-fw" aria-hidden="true"></i></span>
    </div><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">$ docker ps
</span></span><span class="line"><span class="cl">CONTAINER ID        IMAGE                   COMMAND                  CREATED             STATUS              PORTS                NAMES
</span></span><span class="line"><span class="cl">53de48d3e770        kalib/ubuntunginx:0.1   <span class="s2">&#34;nginx -g &#39;daemon of…&#34;</span>   <span class="m">5</span> seconds ago       Up <span class="m">4</span> seconds        0.0.0.0:80-&gt;80/tcp   clever_keldysh</span></span></code></pre></div></div>
<p><strong>T</strong>udo certo aqui também. Podemos ver nosso container rodando, o processo do nginx aparentemente rodando, bem como a porta 80 mapeada como esperado. Vamos abrir o browser em nosso host e acessar <em>localhost:80</em>&hellip;</p>
<p><img
        class="lazyload"
        src="/svg/loading.min.svg"
        data-src="/posts/automatizando-a-criacao-de-imagens/packer_nginx.png"
        data-srcset="/posts/automatizando-a-criacao-de-imagens/packer_nginx.png, /posts/automatizando-a-criacao-de-imagens/packer_nginx.png 1.5x, /posts/automatizando-a-criacao-de-imagens/packer_nginx.png 2x"
        data-sizes="auto"
        alt="/posts/automatizando-a-criacao-de-imagens/packer_nginx.png"
        title="Packer" width="630" height="300" /></p>
<p><strong>P</strong>ronto, validamos a nossa imagem criando um container e confirmando que o nginx está de fato rodando como deveria.</p>
<p><strong>E</strong>m futuros posts, pretendo dar exemplos mais aprofundados, utilizando combinações com outros provisioners, como Puppet, Ansible e Shell Scripts, bem como outros builders, como por exemplo o AWS.</p></div><div class="post-footer" id="post-footer">
    <div class="post-info">
        <div class="post-info-line">
            <div class="post-info-mod">
                <span>Atualizado em 2018-07-30</span>
            </div></div>
        <div class="post-info-line">
            <div class="post-info-md"></div>
            <div class="post-info-share">
                <span><a href="javascript:void(0);" title="Compartilhe em X" data-sharer="x" data-url="//blog.marcelocavalcante.net:1313/posts/automatizando-a-criacao-de-imagens/" data-title="Automatizando a Criacao De Imagens Com Packer" data-via="Marcelo_Kalib" data-hashtags="Devops,Packer,Docker,Cloud"><i class="fab fa-x-twitter fa-fw" aria-hidden="true"></i></a><a href="javascript:void(0);" title="Compartilhe em Threads" data-sharer="threads" data-url="//blog.marcelocavalcante.net:1313/posts/automatizando-a-criacao-de-imagens/" data-title="Automatizando a Criacao De Imagens Com Packer"><i class="fab fa-threads fa-fw" aria-hidden="true"></i></a><a href="javascript:void(0);" title="Compartilhe em Facebook" data-sharer="facebook" data-url="//blog.marcelocavalcante.net:1313/posts/automatizando-a-criacao-de-imagens/" data-hashtag="Devops"><i class="fab fa-facebook-square fa-fw" aria-hidden="true"></i></a><a href="javascript:void(0);" title="Compartilhe em Linkedin" data-sharer="linkedin" data-url="//blog.marcelocavalcante.net:1313/posts/automatizando-a-criacao-de-imagens/"><i class="fab fa-linkedin fa-fw" aria-hidden="true"></i></a><a href="javascript:void(0);" title="Compartilhe em Hacker News" data-sharer="hackernews" data-url="//blog.marcelocavalcante.net:1313/posts/automatizando-a-criacao-de-imagens/" data-title="Automatizando a Criacao De Imagens Com Packer"><i class="fab fa-hacker-news fa-fw" aria-hidden="true"></i></a><a href="javascript:void(0);" title="Compartilhe em Line" data-sharer="line" data-url="//blog.marcelocavalcante.net:1313/posts/automatizando-a-criacao-de-imagens/" data-title="Automatizando a Criacao De Imagens Com Packer"><i data-svg-src="https://cdn.jsdelivr.net/npm/simple-icons@15.14.0/icons/line.svg" aria-hidden="true"></i></a><a href="javascript:void(0);" title="Compartilhe em 微博" data-sharer="weibo" data-url="//blog.marcelocavalcante.net:1313/posts/automatizando-a-criacao-de-imagens/" data-title="Automatizando a Criacao De Imagens Com Packer"><i class="fab fa-weibo fa-fw" aria-hidden="true"></i></a><a href="javascript:void(0);" title="Compartilhe em Diaspora" data-sharer="diaspora" data-url="//blog.marcelocavalcante.net:1313/posts/automatizando-a-criacao-de-imagens/" data-title="Automatizando a Criacao De Imagens Com Packer" data-description="Packer é uma ferramenta Open Source, criada e mantida pela HashiCorp, para a criação de imagens de máquinas idênticas para múltiplas plataformas a partir de uma única fonte ou código de configuração. O Packer é leve, roda em praticamente todos os principais Sistemas Operacionais e possui alta performance, permitindo a criação de imagens para múltiplas plataformas em paralelo."><i class="fab fa-diaspora fa-fw" aria-hidden="true"></i></a><a href="https://t.me/share/url?url=%2f%2fblog.marcelocavalcante.net%3a1313%2fposts%2fautomatizando-a-criacao-de-imagens%2f&amp;text=Automatizando%20a%20Criacao%20De%20Imagens%20Com%20Packer" target="_blank" title="Compartilhe em Telegram"><i class="fab fa-telegram fa-fw" aria-hidden="true"></i></a></span>
            </div>
        </div>
    </div>

    <div class="post-info-more">
        <section class="post-tags"><i class="fas fa-tags fa-fw" aria-hidden="true"></i>&nbsp;<a href="/tags/devops/">Devops</a>,&nbsp;<a href="/tags/packer/">Packer</a>,&nbsp;<a href="/tags/docker/">Docker</a>,&nbsp;<a href="/tags/cloud/">Cloud</a></section>
        <section>
            <span><a href="javascript:void(0);" onclick="window.history.back();">Voltar</a></span>&nbsp;|&nbsp;<span><a href="/">Home</a></span>
        </section>
    </div>

    <div class="post-nav"><a href="/posts/10-anos/" class="prev" rel="prev" title="10 Anos de Blog!"><i class="fas fa-angle-left fa-fw" aria-hidden="true"></i>10 Anos de Blog!</a>
            <a href="/posts/criando-uma-imagem-aws-ec2/" class="next" rel="next" title="Criando Uma Imagem Aws Ec2 Com Packer E Puppet">Criando Uma Imagem Aws Ec2 Com Packer E Puppet<i class="fas fa-angle-right fa-fw" aria-hidden="true"></i></a></div>
</div>
<div id="comments"><div id="disqus_thread" class="comment"></div><noscript>
                Please enable JavaScript to view the comments powered by <a href="https://disqus.com/?ref_noscript">Disqus</a>.
            </noscript></div></article></div>
            </main><footer class="footer">
        <div class="footer-container"><div class="footer-line">Possibilitado por <a href="https://gohugo.io/" target="_blank" rel="noopener noreffer" title="Hugo 0.145.0">Hugo</a> | Tema - <a href="https://github.com/dillonzq/LoveIt" target="_blank" rel="noopener noreffer" title="LoveIt 0.3.1-DEV"><i class="far fa-kiss-wink-heart fa-fw" aria-hidden="true"></i> LoveIt</a>
                </div><div class="footer-line" itemscope itemtype="http://schema.org/CreativeWork"><i class="far fa-copyright fa-fw" aria-hidden="true"></i><span itemprop="copyrightYear">2008 - 2025</span><span class="author" itemprop="copyrightHolder">&nbsp;<a href="https://blog.marcelocavalcante.net" target="_blank">Marcelo Cavalcante</a></span></div>
        </div>
    </footer></div>

        <div id="fixed-buttons"><a href="#" id="back-to-top" class="fixed-button" title="Voltar ao topo">
                <i class="fas fa-arrow-up fa-fw" aria-hidden="true"></i>
            </a>
        </div>

        <div id="fixed-buttons-hidden"><a href="#" id="view-comments" class="fixed-button" title="Ver comentários">
                <i class="fas fa-comment fa-fw" aria-hidden="true"></i>
            </a>
        </div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/lightgallery@2.5.0/css/lightgallery-bundle.min.css"><script src="https://marcelocavalcante.disqus.com/embed.js" defer></script><script src="https://cdn.jsdelivr.net/npm/autocomplete.js@0.38.1/dist/autocomplete.min.js"></script><script src="https://cdn.jsdelivr.net/npm/lunr@2.3.9/lunr.min.js"></script><script src="/lib/lunr/lunr.stemmer.support.min.js"></script><script src="/lib/lunr/lunr.pt.min.js"></script><script src="https://cdn.jsdelivr.net/npm/lazysizes@5.3.2/lazysizes.min.js"></script><script src="https://cdn.jsdelivr.net/npm/lightgallery@2.5.0/lightgallery.min.js"></script><script src="https://cdn.jsdelivr.net/npm/lightgallery@2.5.0/plugins/thumbnail/lg-thumbnail.min.js"></script><script src="https://cdn.jsdelivr.net/npm/lightgallery@2.5.0/plugins/zoom/lg-zoom.min.js"></script><script src="https://cdn.jsdelivr.net/npm/clipboard@2.0.11/dist/clipboard.min.js"></script><script src="https://cdn.jsdelivr.net/npm/sharer.js@0.5.2/sharer.min.js"></script><script>window.config={"comment":{},"lightgallery":true,"search":{"highlightTag":"em","lunrIndexURL":"/index.json","lunrLanguageCode":"pt","maxResultLength":10,"noResultsFound":"Nenhum resultado encontrado","snippetLength":30,"type":"lunr"}};</script><script src="/js/theme.min.js"></script></body>
</html>

<script>
    document.addEventListener('DOMContentLoaded', function() {
        var searchIndex;

        fetch('/lunr.json')
            .then(response => response.json())
            .then(data => {
                searchIndex = lunr(function () {
                    this.field('title');
                    this.field('content');
                    this.field('tags');
                    this.ref('uri');

                    data.forEach(doc => {
                        this.add(doc);
                    });
                });
            });

        function performSearch(query) {
            if (searchIndex) {
                var results = searchIndex.search(query);
                displayResults(results);
            }
        }

        function displayResults(results) {
            var resultsContainer = document.getElementById('search-results');
            resultsContainer.innerHTML = '';
            results.forEach(result => {
                var item = document.createElement('div');
                item.innerHTML = `<a href="${result.ref}">${result.ref}</a>`;
                resultsContainer.appendChild(item);
            });
        }

        var searchInputDesktop = document.getElementById('search-input-desktop');
        if (searchInputDesktop) {
            searchInputDesktop.addEventListener('input', function() {
                performSearch(searchInputDesktop.value);
            });
        }

        var searchInputMobile = document.getElementById('search-input-mobile');
        if (searchInputMobile) {
            searchInputMobile.addEventListener('input', function() {
                performSearch(searchInputMobile.value);
            });
        }
    });
</script>
