<!DOCTYPE html>
<html lang="pt-BR">
    <head><script src="/livereload.js?mindelay=10&amp;v=2&amp;port=1313&amp;path=livereload" data-no-instant defer></script>
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="robots" content="noodp" />
        <title>Conhecendo O Kubernetes - Clusters De Containers - Marcelo Cavalcante Rocha</title><meta name="Description" content="Sistema Open Source desenvolvido pelo Google para o gerenciamento de cluster de containers tendo como características auto-scaling de serviços e containers, auto-monitoração de containers, permite o deploy de containers e serviços, load balancer, orquestração de containers, e orquestração de volumes de armazenamento."><meta property="og:url" content="//blog.marcelocavalcante.net:1313/posts/conhecendo-o-kubernetes-clusters-de/">
  <meta property="og:site_name" content="Marcelo Cavalcante Rocha">
  <meta property="og:title" content="Conhecendo O Kubernetes - Clusters De Containers">
  <meta property="og:description" content="Sistema Open Source desenvolvido pelo Google para o gerenciamento de cluster de containers tendo como características auto-scaling de serviços e containers, auto-monitoração de containers, permite o deploy de containers e serviços, load balancer, orquestração de containers, e orquestração de volumes de armazenamento.">
  <meta property="og:locale" content="pt_BR">
  <meta property="og:type" content="article">
    <meta property="article:section" content="posts">
    <meta property="article:published_time" content="2017-06-24T16:27:16-05:00">
    <meta property="article:modified_time" content="2017-06-24T16:27:16-05:00">
    <meta property="article:tag" content="Devops">
    <meta property="article:tag" content="Docker">
    <meta property="article:tag" content="Kubernetes">
    <meta property="og:image" content="//blog.marcelocavalcante.net:1313/posts/conhecendo-o-kubernetes-clusters-de/featured-image.png">

  <meta name="twitter:card" content="summary_large_image">
  <meta name="twitter:image" content="//blog.marcelocavalcante.net:1313/posts/conhecendo-o-kubernetes-clusters-de/featured-image.png">
  <meta name="twitter:title" content="Conhecendo O Kubernetes - Clusters De Containers">
  <meta name="twitter:description" content="Sistema Open Source desenvolvido pelo Google para o gerenciamento de cluster de containers tendo como características auto-scaling de serviços e containers, auto-monitoração de containers, permite o deploy de containers e serviços, load balancer, orquestração de containers, e orquestração de volumes de armazenamento.">
<meta name="application-name" content="Marcelo Cavalcante">
<meta name="apple-mobile-web-app-title" content="Marcelo Cavalcante">
<meta name="referrer" content="no-referrer" /><meta name="theme-color" content="#ffffff"><meta name="msapplication-TileColor" content="#da532c"><link rel="shortcut icon" type="image/x-icon" href="/favicon.ico" />
        <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
        <link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png"><link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png"><link rel="mask-icon" href="/safari-pinned-tab.svg" color="#5bbad5"><link rel="manifest" href="/site.webmanifest"><link rel="canonical" href="//blog.marcelocavalcante.net:1313/posts/conhecendo-o-kubernetes-clusters-de/" /><link rel="prev" href="//blog.marcelocavalcante.net:1313/posts/recebendo-alarmes-do-aws-diretamente/" /><link rel="next" href="//blog.marcelocavalcante.net:1313/posts/chef-aautomacao-e-gerenciamento-de/" /><link rel="stylesheet" href="/css/style.min.css"><link rel="preload" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.7.2/css/all.min.css" as="style" onload="this.onload=null;this.rel='stylesheet'">
        <noscript><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.7.2/css/all.min.css"></noscript><link rel="preload" href="https://cdn.jsdelivr.net/npm/animate.css@4.1.1/animate.min.css" as="style" onload="this.onload=null;this.rel='stylesheet'">
        <noscript><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/animate.css@4.1.1/animate.min.css"></noscript><script type="application/ld+json">
    {
        "@context": "http://schema.org",
        "@type": "BlogPosting",
        "headline": "Conhecendo O Kubernetes - Clusters De Containers",
        "inLanguage": "pt-BR",
        "mainEntityOfPage": {
            "@type": "WebPage",
            "@id": "\/\/blog.marcelocavalcante.net:1313\/posts\/conhecendo-o-kubernetes-clusters-de\/"
        },"image": [{
                            "@type": "ImageObject",
                            "url": "\/\/blog.marcelocavalcante.net:1313\/posts\/conhecendo-o-kubernetes-clusters-de\/featured-image.png",
                            "width":  500 ,
                            "height":  333 
                        }],"genre": "posts","keywords": "Devops, Docker, Kubernetes","wordcount":  3552 ,
        "url": "\/\/blog.marcelocavalcante.net:1313\/posts\/conhecendo-o-kubernetes-clusters-de\/","datePublished": "2017-06-24T16:27:16-05:00","dateModified": "2017-06-24T16:27:16-05:00","publisher": {
            "@type": "Organization",
            "name": ""},"author": {
                "@type": "Person",
                "name": "Marcelo Cavalcante"
            },"description": "Sistema Open Source desenvolvido pelo Google para o gerenciamento de cluster de containers tendo como características auto-scaling de serviços e containers, auto-monitoração de containers, permite o deploy de containers e serviços, load balancer, orquestração de containers, e orquestração de volumes de armazenamento."
    }
    </script></head>
    <body data-header-desktop="fixed" data-header-mobile="auto"><script>
          const query = window.matchMedia('(prefers-color-scheme: dark)');
          function applyTheme() {
            let theme = window.localStorage?.getItem('theme') || 'auto';
            let isDark = theme === 'dark' || (theme === 'auto' && query.matches);
            document.body.setAttribute('theme', isDark? 'dark' : 'light');
            document.body.setAttribute('cfg-theme', theme);
          }

          applyTheme();
          query.addEventListener('change', applyTheme);
        </script>

        <div id="mask"></div><div class="wrapper"><header class="desktop" id="header-desktop">
    <div class="header-wrapper">
        <div class="header-title">
            <a href="/" title="Marcelo Cavalcante Rocha"><img
        class="lazyload logo"
        src="/svg/loading.min.svg"
        data-src="https://marcelocavalcante.net/ftp/logonew.png"
        data-srcset="https://marcelocavalcante.net/ftp/logonew.png, https://marcelocavalcante.net/ftp/logonew.png 1.5x, https://marcelocavalcante.net/ftp/logonew.png 2x"
        data-sizes="auto"
        alt="https://marcelocavalcante.net/ftp/logonew.png"
        title="https://marcelocavalcante.net/ftp/logonew.png" /></a>
        </div>
        <div class="menu">
            <div class="menu-inner"><a class="menu-item" href="/posts/"> Posts </a><a class="menu-item" href="/tags/"> Tags </a><a class="menu-item" href="/categories/"> Categorias </a><a class="menu-item" href="/sobre/"> Quem Sou </a><span class="menu-item delimiter"></span><span class="menu-item search" id="search-desktop">
                        <input type="text" placeholder="Pesquisar títulos ou conteúdos ..." id="search-input-desktop">
                        <a href="javascript:void(0);" class="search-button search-toggle" id="search-toggle-desktop" title="Pesquisa">
                            <i class="fas fa-search fa-fw" aria-hidden="true"></i>
                        </a>
                        <a href="javascript:void(0);" class="search-button search-clear" id="search-clear-desktop" title="Limpar">
                            <i class="fas fa-times-circle fa-fw" aria-hidden="true"></i>
                        </a>
                        <span class="search-button search-loading" id="search-loading-desktop">
                            <i class="fas fa-spinner fa-fw fa-spin" aria-hidden="true"></i>
                        </span>
                    </span><a href="javascript:void(0);" class="menu-item theme-switch" title="Trocar tema">
                    <i class="fas fa-adjust fa-fw" aria-hidden="true"></i>
                </a></div>
        </div>
    </div>
</header><header class="mobile" id="header-mobile">
    <div class="header-container">
        <div class="header-wrapper">
            <div class="header-title">
                <a href="/" title="Marcelo Cavalcante Rocha"><img
        class="lazyload logo"
        src="/svg/loading.min.svg"
        data-src="https://marcelocavalcante.net/ftp/logonew.png"
        data-srcset="https://marcelocavalcante.net/ftp/logonew.png, https://marcelocavalcante.net/ftp/logonew.png 1.5x, https://marcelocavalcante.net/ftp/logonew.png 2x"
        data-sizes="auto"
        alt="https://marcelocavalcante.net/ftp/logonew.png"
        title="https://marcelocavalcante.net/ftp/logonew.png" /></a>
            </div>
            <div class="menu-toggle" id="menu-toggle-mobile">
                <span></span><span></span><span></span>
            </div>
        </div>
        <div class="menu" id="menu-mobile"><div class="search-wrapper">
                    <div class="search mobile" id="search-mobile">
                        <input type="text" placeholder="Pesquisar títulos ou conteúdos ..." id="search-input-mobile">
                        <a href="javascript:void(0);" class="search-button search-toggle" id="search-toggle-mobile" title="Pesquisa">
                            <i class="fas fa-search fa-fw" aria-hidden="true"></i>
                        </a>
                        <a href="javascript:void(0);" class="search-button search-clear" id="search-clear-mobile" title="Limpar">
                            <i class="fas fa-times-circle fa-fw" aria-hidden="true"></i>
                        </a>
                        <span class="search-button search-loading" id="search-loading-mobile">
                            <i class="fas fa-spinner fa-fw fa-spin" aria-hidden="true"></i>
                        </span>
                    </div>
                    <a href="javascript:void(0);" class="search-cancel" id="search-cancel-mobile">
                        Cancelar
                    </a>
                </div><a class="menu-item" href="/posts/" title="">Posts</a><a class="menu-item" href="/tags/" title="">Tags</a><a class="menu-item" href="/categories/" title="">Categorias</a><a class="menu-item" href="/sobre/" title="">Quem Sou</a><a href="javascript:void(0);" class="menu-item theme-switch" title="Trocar tema">
                <i class="fas fa-adjust fa-fw" aria-hidden="true"></i>
            </a></div>
    </div>
</header><div class="search-dropdown desktop">
        <div id="search-dropdown-desktop"></div>
    </div>
    <div class="search-dropdown mobile">
        <div id="search-dropdown-mobile"></div>
    </div><main class="main">
                <div class="container"><div class="toc" id="toc-auto">
            <h2 class="toc-title">Conteúdos</h2>
            <div class="toc-content" id="toc-content-auto"></div>
        </div><article class="page single"><h1 class="single-title animate__animated animate__flipInX">Conhecendo O Kubernetes - Clusters De Containers</h1><div class="post-meta">
            <div class="post-meta-line"><span class="post-author"><a href="https://blog.marcelocavalcante.net" title="Author" target="_blank" rel="noopener noreffer author" class="author"><i class="fas fa-user-circle fa-fw" aria-hidden="true"></i>Marcelo Cavalcante</a></span>&nbsp;<span class="post-category">incluido em <a href="/categories/tutoriais/"><i class="far fa-folder fa-fw" aria-hidden="true"></i>Tutoriais</a></span></div>
            <div class="post-meta-line"><i class="far fa-calendar-alt fa-fw" aria-hidden="true"></i>&nbsp;<time datetime="2017-06-24">2017-06-24</time>&nbsp;<i class="fas fa-pencil-alt fa-fw" aria-hidden="true"></i>&nbsp;3552 palavras&nbsp;
                <i class="far fa-clock fa-fw" aria-hidden="true"></i>&nbsp;17 minutos&nbsp;</div>
        </div><div class="featured-image"><img
        class="lazyload"
        src="/svg/loading.min.svg"
        data-src="/posts/conhecendo-o-kubernetes-clusters-de/featured-image.png"
        data-srcset="/posts/conhecendo-o-kubernetes-clusters-de/featured-image.png, /posts/conhecendo-o-kubernetes-clusters-de/featured-image.png 1.5x, /posts/conhecendo-o-kubernetes-clusters-de/featured-image.png 2x"
        data-sizes="auto"
        alt="/posts/conhecendo-o-kubernetes-clusters-de/featured-image.png"
        title="Sistema Open Source desenvolvido pelo Google para o gerenciamento de cluster de containers tendo como características auto-scaling de serviços e containers, auto-monitoração de containers, permite o deploy de containers e serviços, load balancer, orquestração de containers, e orquestração de volumes de armazenamento." /></div><div class="details toc" id="toc-static"  data-kept="">
                <div class="details-summary toc-title">
                    <span>Conteúdos</span>
                    <span><i class="details-icon fas fa-angle-right" aria-hidden="true"></i></span>
                </div>
                <div class="details-content toc-content" id="toc-content-static"><nav id="TableOfContents">
  <ul>
    <li><a href="#o-que-é-kubernetes">O que é Kubernetes</a></li>
    <li><a href="#arquitetura-do-kubernetes">Arquitetura do Kubernetes</a></li>
    <li><a href="#instalação">Instalação</a></li>
    <li><a href="#configuração">Configuração</a></li>
    <li><a href="#testando-o-cluster-com-o-kubernetes">Testando o Cluster com o Kubernetes</a></li>
    <li><a href="#criando-pods">Criando pods</a></li>
  </ul>
</nav></div>
            </div><div class="content" id="content"><p>Sistema Open Source desenvolvido pelo Google para o gerenciamento de cluster de containers tendo como características auto-scaling de serviços e containers, auto-monitoração de containers, permite o deploy de containers e serviços, load balancer, orquestração de containers, e orquestração de volumes de armazenamento.</p>
<h2 id="o-que-é-kubernetes">O que é Kubernetes</h2>
<p><strong>K</strong>ubernetes é uma solução Open Source desenvolvida pelo Google, originalmente chamada de K8s, como uma ferramenta para gerenciar clusters de containers (ou containeres, como prefira). Em 2005, quando a ferramenta foi desenvolvida, originalmente para uso interno, o Google doou o código à recém fundada <a href="https://www.cncf.io/" target="_blank" rel="noopener noreffer ">Cloud Native Computing Foundation</a>, em parceria com a <a href="https://www.linuxfoundation.org/" target="_blank" rel="noopener noreffer ">The Linux Foundation</a>.</p>
<p><strong>O</strong> motivo do leme em sua logomarca é devido à origem grega da palavra, que vem de Kuvernetes, que representa a pessoa que pilota o navio, timoneiro.</p>
<p><strong>C</strong>omo objetivo primário o Kubernetes provê uma plataforma de automação para deployments, escalonamento e operações de containers de aplicações em um cluster de hosts ou nodes.</p>
<p><strong>A</strong>ntes de seguir com a explicação, instalação e configuração do Kubernetes, estou supondo que você já possui algum conhecimento básico sobre o que sejam containers e tenha alguma familiaridade com o <a href="https://www.docker.com" target="_blank" rel="noopener noreffer ">Docker</a>. Caso não possua um entendimento básico sobre containers e Docker, sugiro que leia algo antes de seguir com este artigo. Possuo um post introdutório sobre containers com um exemplo básico e prático sobre como criar containers com Docker, bem como iniciar uma simples aplicação web - <a href="/posts/docker-uma-alternativa-elegante-para/" rel="">aqui</a>.</p>
<p><strong>O</strong> Kubernetes é formado por uma série de componentes ou blocos que, quando utilizados coletivamente, fornecem um método de deployment, manutenção e escalonamento de clusters de aplicações baseadas em containers. Estes componentes, ou primitives como o Kubernetes os chama, foram desenvolvidos com o intuito de serem independentes, de forma que quase não se faz necessário ter conhecimento entre si para que possam funcionar e trabalhar juntos, visto que todos se comunicam e interligam através de uma API, sejam componentes internos do Kubernetes ou mesmo extensões e containers.</p>
<p><strong>E</strong>mbora tenha sido inicialmente desenvolvido para o deployment e utilização de <strong>bilhões de containers</strong> internamente no Google, desde que seu código passou a ser distribuído abertamente com a licença <a href="https://commons.apache.org/proper/commons-daemon/license.html" target="_blank" rel="noopener noreffer ">Apache Commons</a> o Kubernetes tem sido adotado formalmente por praticamente todos os grandes provedores de serviços em nuvem.</p>
<h2 id="arquitetura-do-kubernetes">Arquitetura do Kubernetes</h2>
<p><img
        class="lazyload"
        src="/svg/loading.min.svg"
        data-src="/posts/conhecendo-o-kubernetes-clusters-de/kubernetes_architecture.png"
        data-srcset="/posts/conhecendo-o-kubernetes-clusters-de/kubernetes_architecture.png, /posts/conhecendo-o-kubernetes-clusters-de/kubernetes_architecture.png 1.5x, /posts/conhecendo-o-kubernetes-clusters-de/kubernetes_architecture.png 2x"
        data-sizes="auto"
        alt="/posts/conhecendo-o-kubernetes-clusters-de/kubernetes_architecture.png"
        title="Kubernetes Architecture" width="762" height="530" /></p>
<p><strong>D</strong>entre os principais componentes do Kubernetes, vamos destacar os seguintes:</p>
<ul>
<li>
<p><strong>Master ou Master Controller</strong> - Host que será o gerenciador principal do Kubernetes, responsável por gerenciar os Minions ou Nodes do Cluster;</p>
</li>
<li>
<p><strong>Nodes ou Minions</strong> - Embora normalmente a nomenclatura em diversos serviços de tecnolocia seja Node, o Kubernetes prefere chamar de Minions os hosts que fazem parte de um Cluster gerenciado pelo próprio Kubernetes. Este minion pode ser um servidor físico ou virtual, necessitando possuir um serviço de gerenciamento de containers, como o Docker, por exemplo;</p>
</li>
<li>
<p><strong>ETCD</strong> - Embora este seja um serviço independente, estou listando-o aqui pois este será fundamental em seu ciclo de desenvolvimento com o Kubernetes. Cada Minion deverá rodar o <a href="https://coreos.com/etcd/docs/latest/" target="_blank" rel="noopener noreffer ">ETCD</a> (serviço de comunicação e gerenciamento de configurações no formato par de Chave/Valor). O ETCD é utilizado para troca e armazenamento de informações sobre os containers, pods, minions, etc.</p>
</li>
<li>
<p><strong>Pods</strong> - São grupos de containers (um ou mais) rodando em um único minion do cluster. Cada Pod receberá um endereço IP único no Cluster como forma de possibilitar a utilização de portas sem a necessidade de se preocupar com conflitos;</p>
</li>
<li>
<p><strong>Labels</strong> - São informações de identificação na configuração e gerenciamento dos objetos (como Pods ou Minions) formados de pares &ldquo;chave:valor&rdquo;;</p>
</li>
<li>
<p><strong>Controllers</strong> - Além do Master Controller, dependendo do tamanho de sua infraestrutura e quantidade de Pods e Minions, você pode optar por ter mais de um Controller para dividir a carga e tarefas de gerenciamento. Os Controllers gerenciam um grupo de pods e, dependendo do estado de configuração desejada, podem acionar outros Controllers para lidar com as replicações e escalonamento. Os Controllers também são responsáveis pela substituiçao de Pods, caso um entre em estado de falha.</p>
</li>
</ul>
<h2 id="instalação">Instalação</h2>
<p><strong>V</strong>amos ao que interessa&hellip;</p>
<p><strong>N</strong>ovamente estou supondo que você já possui alguma familiaridade com Containers, Docker e, por consequência, com GNU/Linux.</p>
<p><strong>E</strong>estarei utilizando 4 servidores virtuais rodando CentOS 7 nos exemplos a seguir, mas fica a seu critério decidir quantos utilizar.</p>
<p><em>Certamente você optar por utilizar outra distribuição, seja Debian, Ubuntu, etc.. Uma vez que optei pelo CentOS 7, estarei utilizando comandos voltados para esta distro, mas sinta-se livre para adaptar seus comandos, como substituir o &ldquo;yum&rdquo; pelo &ldquo;apt-get&rdquo;, &ldquo;pacman&rdquo;, etc..</em></p>
<p><strong>E</strong>m minha configuração chamarei os servidores da seguinte forma:</p>
<ul>
<li>centos-master</li>
<li>centos-minion1</li>
<li>centos-minion2</li>
<li>centos-minion3</li>
</ul>
<p><strong>A</strong> primeira coisa que se deve fazer sempre que se pensa em trabalhar com clusters, independente de ser um cluster de containers ou não, é ter a certeza de que os servidores terão uma correta sincronização de relógios entre si. A forma mais simples e eficiente no nosso contexto é com a utilização do NTP, portanto comece instalando o NTP nos 4 servidores, bem como habilitando o serviço e iniciando-o:</p>
<div class="code-block code-line-numbers open" style="counter-reset: code-block 0">
    <div class="code-header language-bash">
        <span class="code-title"><i class="arrow fas fa-angle-right fa-fw" aria-hidden="true"></i></span>
        <span class="ellipses"><i class="fas fa-ellipsis-h fa-fw" aria-hidden="true"></i></span>
        <span class="copy" title="Copiar para a área de transferência"><i class="far fa-copy fa-fw" aria-hidden="true"></i></span>
    </div><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl"><span class="c1"># yum install -y ntp</span></span></span></code></pre></div></div>
<div class="code-block code-line-numbers open" style="counter-reset: code-block 0">
    <div class="code-header language-bash">
        <span class="code-title"><i class="arrow fas fa-angle-right fa-fw" aria-hidden="true"></i></span>
        <span class="ellipses"><i class="fas fa-ellipsis-h fa-fw" aria-hidden="true"></i></span>
        <span class="copy" title="Copiar para a área de transferência"><i class="far fa-copy fa-fw" aria-hidden="true"></i></span>
    </div><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl"><span class="c1"># systemctl enable ntpd &amp;&amp; systemctl start ntpd</span></span></span></code></pre></div></div>
<p><strong>C</strong>aso queira certificar-se de que o serviço está realmente rodando:</p>
<div class="code-block code-line-numbers open" style="counter-reset: code-block 0">
    <div class="code-header language-bash">
        <span class="code-title"><i class="arrow fas fa-angle-right fa-fw" aria-hidden="true"></i></span>
        <span class="ellipses"><i class="fas fa-ellipsis-h fa-fw" aria-hidden="true"></i></span>
        <span class="copy" title="Copiar para a área de transferência"><i class="far fa-copy fa-fw" aria-hidden="true"></i></span>
    </div><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl"><span class="c1"># systemctl status ntpd</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">● ntpd.service - Network Time Service
</span></span><span class="line"><span class="cl">   Loaded: loaded <span class="o">(</span>/usr/lib/systemd/system/ntpd.service<span class="p">;</span> enabled<span class="p">;</span> vendor preset: disabled<span class="o">)</span>
</span></span><span class="line"><span class="cl">   Active: active <span class="o">(</span>running<span class="o">)</span> since Sat 2017-06-24 17:46:02 UTC<span class="p">;</span> 3s ago
</span></span><span class="line"><span class="cl">  Process: <span class="m">1586</span> <span class="nv">ExecStart</span><span class="o">=</span>/usr/sbin/ntpd -u ntp:ntp <span class="nv">$OPTIONS</span> <span class="o">(</span><span class="nv">code</span><span class="o">=</span>exited, <span class="nv">status</span><span class="o">=</span>0/SUCCESS<span class="o">)</span>
</span></span><span class="line"><span class="cl"> Main PID: <span class="m">1587</span> <span class="o">(</span>ntpd<span class="o">)</span>
</span></span><span class="line"><span class="cl">   Memory: 2.1M
</span></span><span class="line"><span class="cl">   CGroup: /system.slice/ntpd.service
</span></span><span class="line"><span class="cl">           └─1587 /usr/sbin/ntpd -u ntp:ntp -g</span></span></code></pre></div></div>
<p><strong>P</strong>inga?</p>
<p><strong>É</strong> importante nos certificarmos de que os servidores conseguem se comunicar e de que conseguem resolver nomes corretamente.</p>
<p><strong>N</strong>este exemplo, conforme informado mais acima, estamos utilizando 4 servidores com os seguintes nomes: <em>centos-master</em>, <em>centos-minion1</em>, <em>centos-minion2</em> e <em>centos-minion3</em>, portanto vamos editar o arquivo <strong>/etc/hosts</strong> de cada um deles para que possam se comunicar pelos nomes que desejamos:</p>
<p><strong>Insira as seguintes linhas no arquivo /etc/hosts dos 4 servidores:</strong></p>
<p><em>Lembre-se de substituir os IPs pelos IPs dos servidores em seu ambiente</em></p>
<div class="code-block code-line-numbers open" style="counter-reset: code-block 0">
    <div class="code-header language-bash">
        <span class="code-title"><i class="arrow fas fa-angle-right fa-fw" aria-hidden="true"></i></span>
        <span class="ellipses"><i class="fas fa-ellipsis-h fa-fw" aria-hidden="true"></i></span>
        <span class="copy" title="Copiar para a área de transferência"><i class="far fa-copy fa-fw" aria-hidden="true"></i></span>
    </div><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl"><span class="c1"># Ip local do servidor master</span>
</span></span><span class="line"><span class="cl">172.31.22.126   centos-master
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># Ip local do minion1</span>
</span></span><span class="line"><span class="cl">172.31.120.16   centos-minion1
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># Ip local do minion2</span>
</span></span><span class="line"><span class="cl">172.31.25.6     centos-minion2
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># Ip local do minion3</span>
</span></span><span class="line"><span class="cl">172.31.123.22   centos-minion3</span></span></code></pre></div></div>
<p>Feito isto, tente pingar do master para os 3 minions utilizando os nomes especificados no /etc/hosts:</p>
<div class="code-block code-line-numbers open" style="counter-reset: code-block 0">
    <div class="code-header language-bash">
        <span class="code-title"><i class="arrow fas fa-angle-right fa-fw" aria-hidden="true"></i></span>
        <span class="ellipses"><i class="fas fa-ellipsis-h fa-fw" aria-hidden="true"></i></span>
        <span class="copy" title="Copiar para a área de transferência"><i class="far fa-copy fa-fw" aria-hidden="true"></i></span>
    </div><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl"><span class="o">[</span>root@kalib1 ~<span class="o">]</span><span class="c1"># ping centos-minion1</span>
</span></span><span class="line"><span class="cl">PING centos-minion1 <span class="o">(</span>172.31.120.16<span class="o">)</span> 56<span class="o">(</span>84<span class="o">)</span> bytes of data.
</span></span><span class="line"><span class="cl"><span class="m">64</span> bytes from centos-minion1 <span class="o">(</span>172.31.120.16<span class="o">)</span>: <span class="nv">icmp_seq</span><span class="o">=</span><span class="m">1</span> <span class="nv">ttl</span><span class="o">=</span><span class="m">64</span> <span class="nv">time</span><span class="o">=</span>1.06 ms
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="o">[</span>root@kalib1 ~<span class="o">]</span><span class="c1"># ping centos-minion2</span>
</span></span><span class="line"><span class="cl">PING centos-minion2 <span class="o">(</span>172.31.25.6<span class="o">)</span> 56<span class="o">(</span>84<span class="o">)</span> bytes of data.
</span></span><span class="line"><span class="cl"><span class="m">64</span> bytes from centos-minion2 <span class="o">(</span>172.31.25.6<span class="o">)</span>: <span class="nv">icmp_seq</span><span class="o">=</span><span class="m">1</span> <span class="nv">ttl</span><span class="o">=</span><span class="m">64</span> <span class="nv">time</span><span class="o">=</span>0.588 ms
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="o">[</span>root@kalib1 ~<span class="o">]</span><span class="c1"># ping centos-minion3</span>
</span></span><span class="line"><span class="cl">PING centos-minion3 <span class="o">(</span>172.31.123.22<span class="o">)</span> 56<span class="o">(</span>84<span class="o">)</span> bytes of data.
</span></span><span class="line"><span class="cl"><span class="m">64</span> bytes from centos-minion3 <span class="o">(</span>172.31.123.22<span class="o">)</span>: <span class="nv">icmp_seq</span><span class="o">=</span><span class="m">1</span> <span class="nv">ttl</span><span class="o">=</span><span class="m">64</span> <span class="nv">time</span><span class="o">=</span>1.24 ms</span></span></code></pre></div></div>
<p><strong>V</strong>ocê pode realizar o mesmo teste a partir dos minions, pingando entre si e também para o centos-master.</p>
<p><strong>U</strong>ma vez que tenhamos certeza de que todos os hosts se comunicam, é hora de instalar mais alguns pacotes necessários.</p>
<p><strong>P</strong>rimeiramente, vamos configurar o repositório do Docker para o CentOS 7:</p>
<ul>
<li>Configurações de repositório retiradas dos repositórios CBS do Centos: <a href="https://cbs.centos.org/repos/virt7-docker-common-release/" target="_blank" rel="noopener noreffer ">https://cbs.centos.org/repos/virt7-docker-common-release/</a></li>
</ul>
<p><strong>V</strong>amos criar o seguinte arquivo de repositório:</p>
<div class="code-block code-line-numbers open" style="counter-reset: code-block 0">
    <div class="code-header language-bash">
        <span class="code-title"><i class="arrow fas fa-angle-right fa-fw" aria-hidden="true"></i></span>
        <span class="ellipses"><i class="fas fa-ellipsis-h fa-fw" aria-hidden="true"></i></span>
        <span class="copy" title="Copiar para a área de transferência"><i class="far fa-copy fa-fw" aria-hidden="true"></i></span>
    </div><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl"><span class="c1"># vim /etc/yum.repos.d/virt7-docker-common-release.repos</span></span></span></code></pre></div></div>
<p><strong>O</strong> conteúdo deste arquivo será o seguinte:</p>
<div class="code-block code-line-numbers open" style="counter-reset: code-block 0">
    <div class="code-header language-bash">
        <span class="code-title"><i class="arrow fas fa-angle-right fa-fw" aria-hidden="true"></i></span>
        <span class="ellipses"><i class="fas fa-ellipsis-h fa-fw" aria-hidden="true"></i></span>
        <span class="copy" title="Copiar para a área de transferência"><i class="far fa-copy fa-fw" aria-hidden="true"></i></span>
    </div><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl"><span class="o">[</span>virt7-docker-common-release<span class="o">]</span>
</span></span><span class="line"><span class="cl"><span class="nv">name</span><span class="o">=</span>virt7-docker-common-release
</span></span><span class="line"><span class="cl"><span class="nv">baseurl</span><span class="o">=</span>https://cbs.centos.org/repos/virt7-docker-common-release/x86_64/os/
</span></span><span class="line"><span class="cl"><span class="nv">gpgcheck</span><span class="o">=</span><span class="m">0</span></span></span></code></pre></div></div>
<p><em>Este arquivo deverá ser criado nos 4 servidores.</em></p>
<p><strong>E</strong>m seguida, vamos atualizar a nossa base de repositórios e pacotes, também <strong>nos 4 servidores</strong>, bem como habilitar o novo repositório para instalar os pacotes docker e kubernetes:</p>
<div class="code-block code-line-numbers open" style="counter-reset: code-block 0">
    <div class="code-header language-bash">
        <span class="code-title"><i class="arrow fas fa-angle-right fa-fw" aria-hidden="true"></i></span>
        <span class="ellipses"><i class="fas fa-ellipsis-h fa-fw" aria-hidden="true"></i></span>
        <span class="copy" title="Copiar para a área de transferência"><i class="far fa-copy fa-fw" aria-hidden="true"></i></span>
    </div><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl"><span class="c1"># yum update</span></span></span></code></pre></div></div>
<div class="code-block code-line-numbers open" style="counter-reset: code-block 0">
    <div class="code-header language-bash">
        <span class="code-title"><i class="arrow fas fa-angle-right fa-fw" aria-hidden="true"></i></span>
        <span class="ellipses"><i class="fas fa-ellipsis-h fa-fw" aria-hidden="true"></i></span>
        <span class="copy" title="Copiar para a área de transferência"><i class="far fa-copy fa-fw" aria-hidden="true"></i></span>
    </div><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl"><span class="c1"># yum install -y --enablerepo=virt7-docker-common-release docker kubernetes</span></span></span></code></pre></div></div>
<p><strong>C</strong>omo dito na introdução, também precisaremos do etcd para o armazenamento e troca de configurações, portanto vamos instalá-lo também nos 4 hosts:</p>
<div class="code-block code-line-numbers open" style="counter-reset: code-block 0">
    <div class="code-header language-bash">
        <span class="code-title"><i class="arrow fas fa-angle-right fa-fw" aria-hidden="true"></i></span>
        <span class="ellipses"><i class="fas fa-ellipsis-h fa-fw" aria-hidden="true"></i></span>
        <span class="copy" title="Copiar para a área de transferência"><i class="far fa-copy fa-fw" aria-hidden="true"></i></span>
    </div><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl"><span class="c1"># yum instal -y etcd</span></span></span></code></pre></div></div>
<h2 id="configuração">Configuração</h2>
<p><strong>V</strong>amos começar com a configuração básica dos serviços envolvidos. Primeiramente, vamos abrir o arquivo de configuração do kubernetes e fazer algumas alterações:</p>
<p><em>/etc/kubernetes/config</em></p>
<p><strong>N</strong>o arquivo config altere as seguintes linhas:</p>
<p><em>Edite o valor do parâmetro KUBE_MASTER, de forma que nosso master possa ser encontrado pelo nome que definimos no hosts file. O valor original é &ldquo;&ndash;master=https://127.0.0.1:8080&rdquo;, portanto mudaremos para o seguinte:</em></p>
<div class="code-block code-line-numbers open" style="counter-reset: code-block 0">
    <div class="code-header language-bash">
        <span class="code-title"><i class="arrow fas fa-angle-right fa-fw" aria-hidden="true"></i></span>
        <span class="ellipses"><i class="fas fa-ellipsis-h fa-fw" aria-hidden="true"></i></span>
        <span class="copy" title="Copiar para a área de transferência"><i class="far fa-copy fa-fw" aria-hidden="true"></i></span>
    </div><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl"><span class="nv">KUBE_MASTER</span><span class="o">=</span><span class="s2">&#34;--master=https://centos-master:8080&#34;</span></span></span></code></pre></div></div>
<p><strong>A</strong>inda neste arquivo de configuração, vamos inserir a configuração do serviço ETCD, portanto inclua a seguinte linha ao final do arquivo:</p>
<div class="code-block code-line-numbers open" style="counter-reset: code-block 0">
    <div class="code-header language-bash">
        <span class="code-title"><i class="arrow fas fa-angle-right fa-fw" aria-hidden="true"></i></span>
        <span class="ellipses"><i class="fas fa-ellipsis-h fa-fw" aria-hidden="true"></i></span>
        <span class="copy" title="Copiar para a área de transferência"><i class="far fa-copy fa-fw" aria-hidden="true"></i></span>
    </div><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl"><span class="nv">KUBE_ETCD_SERVERS</span><span class="o">=</span><span class="s2">&#34;--etcd-servers=https://centos-master:2379&#34;</span></span></span></code></pre></div></div>
<p><strong>S</strong>eu arquivo de configuração deverá estar similar a este:</p>
<div class="code-block code-line-numbers open" style="counter-reset: code-block 0">
    <div class="code-header language-bash">
        <span class="code-title"><i class="arrow fas fa-angle-right fa-fw" aria-hidden="true"></i></span>
        <span class="ellipses"><i class="fas fa-ellipsis-h fa-fw" aria-hidden="true"></i></span>
        <span class="copy" title="Copiar para a área de transferência"><i class="far fa-copy fa-fw" aria-hidden="true"></i></span>
    </div><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl"><span class="c1">###</span>
</span></span><span class="line"><span class="cl"><span class="c1"># kubernetes system config</span>
</span></span><span class="line"><span class="cl"><span class="c1">#</span>
</span></span><span class="line"><span class="cl"><span class="c1"># The following values are used to configure various aspects of all</span>
</span></span><span class="line"><span class="cl"><span class="c1"># kubernetes services, including</span>
</span></span><span class="line"><span class="cl"><span class="c1">#</span>
</span></span><span class="line"><span class="cl"><span class="c1">#   kube-apiserver.service</span>
</span></span><span class="line"><span class="cl"><span class="c1">#   kube-controller-manager.service</span>
</span></span><span class="line"><span class="cl"><span class="c1">#   kube-scheduler.service</span>
</span></span><span class="line"><span class="cl"><span class="c1">#   kubelet.service</span>
</span></span><span class="line"><span class="cl"><span class="c1">#   kube-proxy.service</span>
</span></span><span class="line"><span class="cl"><span class="c1"># logging to stderr means we get it in the systemd journal</span>
</span></span><span class="line"><span class="cl"><span class="nv">KUBE_LOGTOSTDERR</span><span class="o">=</span><span class="s2">&#34;--logtostderr=true&#34;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># journal message level, 0 is debug</span>
</span></span><span class="line"><span class="cl"><span class="nv">KUBE_LOG_LEVEL</span><span class="o">=</span><span class="s2">&#34;--v=0&#34;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># Should this cluster be allowed to run privileged docker containers</span>
</span></span><span class="line"><span class="cl"><span class="nv">KUBE_ALLOW_PRIV</span><span class="o">=</span><span class="s2">&#34;--allow-privileged=false&#34;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># How the controller-manager, scheduler, and proxy find the apiserver</span>
</span></span><span class="line"><span class="cl"><span class="nv">KUBE_MASTER</span><span class="o">=</span><span class="s2">&#34;--master=https://centos-master:8080&#34;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nv">KUBE_ETCD_SERVERS</span><span class="o">=</span><span class="s2">&#34;--etcd-servers=https://centos-master:2379&#34;</span></span></span></code></pre></div></div>
<p><strong>R</strong>epita esta mesma configuração nos 4 hosts. Todos eles devem utilizar exatamente os mesmos valores utilizados aqui, apontando KUBE_MASTER e KUBE_ETCD_SERVERS para centos-master, visto que este será o responsável por gerenciar todos os nossos minions.</p>
<p><strong>U</strong>ma vez que o arquivo de configuração do kubernetes esteja pronto nos 4 hosts, vamos configurar o serviço de API do kubernetes:</p>
<p><em>/etc/kubernetes/apiserver</em></p>
<p><strong>Esta configuração abaixo será apenas para o Master.</strong></p>
<p><em>Edite o valor do parâmetro KUBE_API_ADDRESS, que originalmente é &ldquo;&ndash;insecure-bind-address=127.0.0.1&rdquo;, de forma que possamos novamente receber comunicação dos demais hosts.</em></p>
<div class="code-block code-line-numbers open" style="counter-reset: code-block 0">
    <div class="code-header language-bash">
        <span class="code-title"><i class="arrow fas fa-angle-right fa-fw" aria-hidden="true"></i></span>
        <span class="ellipses"><i class="fas fa-ellipsis-h fa-fw" aria-hidden="true"></i></span>
        <span class="copy" title="Copiar para a área de transferência"><i class="far fa-copy fa-fw" aria-hidden="true"></i></span>
    </div><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl"><span class="nv">KUBE_API_ADDRESS</span><span class="o">=</span><span class="s2">&#34;--address=0.0.0.0&#34;</span></span></span></code></pre></div></div>
<p><em>Descomente as linhas KUBE_API_PORT e KUBELET_PORT, para que possamos estabelecer as portas de comunicação com a API:</em></p>
<div class="code-block code-line-numbers open" style="counter-reset: code-block 0">
    <div class="code-header language-bash">
        <span class="code-title"><i class="arrow fas fa-angle-right fa-fw" aria-hidden="true"></i></span>
        <span class="ellipses"><i class="fas fa-ellipsis-h fa-fw" aria-hidden="true"></i></span>
        <span class="copy" title="Copiar para a área de transferência"><i class="far fa-copy fa-fw" aria-hidden="true"></i></span>
    </div><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl"><span class="c1"># The port on the local server to listen on.</span>
</span></span><span class="line"><span class="cl"><span class="nv">KUBE_API_PORT</span><span class="o">=</span><span class="s2">&#34;--port=8080&#34;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># Port minions listen on</span>
</span></span><span class="line"><span class="cl"><span class="nv">KUBELET_PORT</span><span class="o">=</span><span class="s2">&#34;--kubelet-port=10250&#34;</span></span></span></code></pre></div></div>
<p><em>Em nosso exemplo não utilizaremos o parâmetro KUBE_ADMISSION_CONTROL, o qual nos permite ter mais controles e restrições sobre quais nodes ou minios podem entrar em nosso ambiente, portanto vamos apenas comentar esta linha por enquanto:</em></p>
<div class="code-block code-line-numbers open" style="counter-reset: code-block 0">
    <div class="code-header language-bash">
        <span class="code-title"><i class="arrow fas fa-angle-right fa-fw" aria-hidden="true"></i></span>
        <span class="ellipses"><i class="fas fa-ellipsis-h fa-fw" aria-hidden="true"></i></span>
        <span class="copy" title="Copiar para a área de transferência"><i class="far fa-copy fa-fw" aria-hidden="true"></i></span>
    </div><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl"><span class="c1"># default admission control policies</span>
</span></span><span class="line"><span class="cl"><span class="c1"># KUBE_ADMISSION_CONTROL=&#34;--admission-control=NamespaceLifecycle,NamespaceExists,LimitRanger,SecurityContextDeny,ServiceAccount,ResourceQuota&#34;</span></span></span></code></pre></div></div>
<p><em>Nosso arquivo /etc/kubernetes/apiserver deverá estar assim:</em></p>
<div class="code-block code-line-numbers open" style="counter-reset: code-block 0">
    <div class="code-header language-bash">
        <span class="code-title"><i class="arrow fas fa-angle-right fa-fw" aria-hidden="true"></i></span>
        <span class="ellipses"><i class="fas fa-ellipsis-h fa-fw" aria-hidden="true"></i></span>
        <span class="copy" title="Copiar para a área de transferência"><i class="far fa-copy fa-fw" aria-hidden="true"></i></span>
    </div><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl"><span class="c1">##</span>
</span></span><span class="line"><span class="cl"><span class="c1"># kubernetes system config</span>
</span></span><span class="line"><span class="cl"><span class="c1">#</span>
</span></span><span class="line"><span class="cl"><span class="c1"># The following values are used to configure the kube-apiserver</span>
</span></span><span class="line"><span class="cl"><span class="c1">#</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># The address on the local server to listen to.</span>
</span></span><span class="line"><span class="cl"><span class="nv">KUBE_API_ADDRESS</span><span class="o">=</span><span class="s2">&#34;--address=0.0.0.0&#34;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># The port on the local server to listen on.</span>
</span></span><span class="line"><span class="cl"><span class="nv">KUBE_API_PORT</span><span class="o">=</span><span class="s2">&#34;--port=8080&#34;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># Port minions listen on</span>
</span></span><span class="line"><span class="cl"><span class="nv">KUBELET_PORT</span><span class="o">=</span><span class="s2">&#34;--kubelet-port=10250&#34;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># Comma separated list of nodes in the etcd cluster</span>
</span></span><span class="line"><span class="cl"><span class="nv">KUBE_ETCD_SERVERS</span><span class="o">=</span><span class="s2">&#34;--etcd-servers=https://127.0.0.1:2379&#34;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># Address range to use for services</span>
</span></span><span class="line"><span class="cl"><span class="nv">KUBE_SERVICE_ADDRESSES</span><span class="o">=</span><span class="s2">&#34;--service-cluster-ip-range=10.254.0.0/16&#34;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># default admission control policies</span>
</span></span><span class="line"><span class="cl"><span class="c1"># KUBE_ADMISSION_CONTROL=&#34;--admission-control=NamespaceLifecycle,NamespaceExists,LimitRanger,SecurityContextDeny,ServiceAccount,ResourceQuota&#34;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># Add your own!</span>
</span></span><span class="line"><span class="cl"><span class="nv">KUBE_API_ARGS</span><span class="o">=</span><span class="s2">&#34;&#34;</span></span></span></code></pre></div></div>
<p><strong>S</strong>alve e feche o arquivo. Novamente, esta configuração deve ser feita apenas para o Master.</p>
<p><strong>A</strong>gora vamos configurar o serviço ETCD:</p>
<p><em>/etc/etcd/etcd.conf</em></p>
<p><strong>Esta configuração abaixo será apenas para o Master.</strong></p>
<p><em>Edite os valores dos parâmetros ETCD_LISTEN_CLIENT_URLS e ETCD_ADVERTISE_CLIENT_URLS, que originalmente apontam para localhost. Como desejamos que nosso etcd escute requisições dos demais hosts, altere para o seguinte:</em></p>
<div class="code-block code-line-numbers open" style="counter-reset: code-block 0">
    <div class="code-header language-bash">
        <span class="code-title"><i class="arrow fas fa-angle-right fa-fw" aria-hidden="true"></i></span>
        <span class="ellipses"><i class="fas fa-ellipsis-h fa-fw" aria-hidden="true"></i></span>
        <span class="copy" title="Copiar para a área de transferência"><i class="far fa-copy fa-fw" aria-hidden="true"></i></span>
    </div><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl"><span class="nv">ETCD_LISTEN_CLIENT_URLS</span><span class="o">=</span><span class="s2">&#34;https://0.0.0.0:2379&#34;</span>
</span></span><span class="line"><span class="cl">...
</span></span><span class="line"><span class="cl">...
</span></span><span class="line"><span class="cl"><span class="nv">ETCD_ADVERTISE_CLIENT_URLS</span><span class="o">=</span><span class="s2">&#34;https://0.0.0.0:2379&#34;</span></span></span></code></pre></div></div>
<p><strong>N</strong>ovamente, não é necessário alterar a configuração do etcd nos demais hosts, apenas no Master.</p>
<p><strong>U</strong>ma vez que as configurações iniciais foram feitas, vamos habilitar e iniciar os serviços necessários <strong>no Master</strong>, sendo eles:</p>
<ul>
<li>etcd</li>
<li>kube-apiserver</li>
<li>kube-controller-manager</li>
<li>kube-scheduler</li>
</ul>
<div class="code-block code-line-numbers open" style="counter-reset: code-block 0">
    <div class="code-header language-bash">
        <span class="code-title"><i class="arrow fas fa-angle-right fa-fw" aria-hidden="true"></i></span>
        <span class="ellipses"><i class="fas fa-ellipsis-h fa-fw" aria-hidden="true"></i></span>
        <span class="copy" title="Copiar para a área de transferência"><i class="far fa-copy fa-fw" aria-hidden="true"></i></span>
    </div><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl"><span class="c1"># systemctl enable etcd kube-apiserver kube-controller-manager kube-scheduler</span></span></span></code></pre></div></div>
<div class="code-block code-line-numbers open" style="counter-reset: code-block 0">
    <div class="code-header language-bash">
        <span class="code-title"><i class="arrow fas fa-angle-right fa-fw" aria-hidden="true"></i></span>
        <span class="ellipses"><i class="fas fa-ellipsis-h fa-fw" aria-hidden="true"></i></span>
        <span class="copy" title="Copiar para a área de transferência"><i class="far fa-copy fa-fw" aria-hidden="true"></i></span>
    </div><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl"><span class="c1"># systemctl start etcd kube-apiserver kube-controller-manager kube-scheduler</span></span></span></code></pre></div></div>
<p><strong>O</strong>s 4 serviços devem estar rodando. Para termos certeza, vamos checar o status dos mesmos:</p>
<div class="code-block code-line-numbers open" style="counter-reset: code-block 0">
    <div class="code-header language-bash">
        <span class="code-title"><i class="arrow fas fa-angle-right fa-fw" aria-hidden="true"></i></span>
        <span class="ellipses"><i class="fas fa-ellipsis-h fa-fw" aria-hidden="true"></i></span>
        <span class="copy" title="Copiar para a área de transferência"><i class="far fa-copy fa-fw" aria-hidden="true"></i></span>
    </div><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl"><span class="c1"># systemctl status etcd kube-apiserver kube-controller-manager kube-scheduler | grep &#34;(running)&#34;</span>
</span></span><span class="line"><span class="cl">   Active: active <span class="o">(</span>running<span class="o">)</span> since Sat 2017-06-24 21:45:37 UTC<span class="p">;</span> 1min ago
</span></span><span class="line"><span class="cl">   Active: active <span class="o">(</span>running<span class="o">)</span> since Sat 2017-06-24 21:46:13 UTC<span class="p">;</span> 1min ago
</span></span><span class="line"><span class="cl">   Active: active <span class="o">(</span>running<span class="o">)</span> since Sat 2017-06-24 21:44:25 UTC<span class="p">;</span> 1min ago
</span></span><span class="line"><span class="cl">   Active: active <span class="o">(</span>running<span class="o">)</span> since Sat 2017-06-24 21:44:25 UTC<span class="p">;</span> 1min ago</span></span></code></pre></div></div>
<p><strong>N</strong>ovamente, estes serviços serão iniciados no Master, e não nos nodes/minions, visto que estes utilizarão outros serviços.</p>
<p><strong>A</strong>gora vamos configurar o seguinte arquivo nos nodes/minions:</p>
<p><em>/etc/kubernetes/kubelet</em></p>
<p><strong>Este arquivo apenas deverá ser editado nos nodes/minions, não no Master.</strong></p>
<p><em>Vamos alterar o valor do parâmetro KUBELET_ADDRESS para que aceite comunicação não apenas do localhost:</em></p>
<div class="code-block code-line-numbers open" style="counter-reset: code-block 0">
    <div class="code-header language-bash">
        <span class="code-title"><i class="arrow fas fa-angle-right fa-fw" aria-hidden="true"></i></span>
        <span class="ellipses"><i class="fas fa-ellipsis-h fa-fw" aria-hidden="true"></i></span>
        <span class="copy" title="Copiar para a área de transferência"><i class="far fa-copy fa-fw" aria-hidden="true"></i></span>
    </div><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl"><span class="nv">KUBELET_ADDRESS</span><span class="o">=</span><span class="s2">&#34;--address=0.0.0.0&#34;</span></span></span></code></pre></div></div>
<p><em>Descomentaremos também a linha KUBELET_PORT, para que possamos ter uma porta definida para a comunicação do kubelet:</em></p>
<div class="code-block code-line-numbers open" style="counter-reset: code-block 0">
    <div class="code-header language-bash">
        <span class="code-title"><i class="arrow fas fa-angle-right fa-fw" aria-hidden="true"></i></span>
        <span class="ellipses"><i class="fas fa-ellipsis-h fa-fw" aria-hidden="true"></i></span>
        <span class="copy" title="Copiar para a área de transferência"><i class="far fa-copy fa-fw" aria-hidden="true"></i></span>
    </div><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl"><span class="c1"># The port for the info server to serve on</span>
</span></span><span class="line"><span class="cl"><span class="nv">KUBELET_PORT</span><span class="o">=</span><span class="s2">&#34;--port=10250&#34;</span></span></span></code></pre></div></div>
<p><em>Vamos alterar o valor do parâmetro KUBELET_HOSTNAME para o nome que definimos <strong>para cada um dos minions</strong>, portanto em cada um deles este será um valor diferente. Supondo que este seja o minion1, utilizaremos:</em></p>
<div class="code-block code-line-numbers open" style="counter-reset: code-block 0">
    <div class="code-header language-bash">
        <span class="code-title"><i class="arrow fas fa-angle-right fa-fw" aria-hidden="true"></i></span>
        <span class="ellipses"><i class="fas fa-ellipsis-h fa-fw" aria-hidden="true"></i></span>
        <span class="copy" title="Copiar para a área de transferência"><i class="far fa-copy fa-fw" aria-hidden="true"></i></span>
    </div><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl"><span class="nv">KUBELET_HOSTNAME</span><span class="o">=</span><span class="s2">&#34;--hostname-override=centos-minion1&#34;</span></span></span></code></pre></div></div>
<p><em>Vamos também alterar o valor para KUBELET_API_SERVER, apontando para o nosso Master:</em></p>
<div class="code-block code-line-numbers open" style="counter-reset: code-block 0">
    <div class="code-header language-bash">
        <span class="code-title"><i class="arrow fas fa-angle-right fa-fw" aria-hidden="true"></i></span>
        <span class="ellipses"><i class="fas fa-ellipsis-h fa-fw" aria-hidden="true"></i></span>
        <span class="copy" title="Copiar para a área de transferência"><i class="far fa-copy fa-fw" aria-hidden="true"></i></span>
    </div><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl"><span class="nv">KUBELET_API_SERVER</span><span class="o">=</span><span class="s2">&#34;--api-servers=https://centos-master:8080&#34;</span></span></span></code></pre></div></div>
<p><em>Vamos comentar a linha KUBELET_POD_INFRA_CONTAINER, visto que não utilizaremos uma infraestrutura de containers externa, pois estaremos utilizando nossos próprios PODs e containers:</em></p>
<div class="code-block code-line-numbers open" style="counter-reset: code-block 0">
    <div class="code-header language-bash">
        <span class="code-title"><i class="arrow fas fa-angle-right fa-fw" aria-hidden="true"></i></span>
        <span class="ellipses"><i class="fas fa-ellipsis-h fa-fw" aria-hidden="true"></i></span>
        <span class="copy" title="Copiar para a área de transferência"><i class="far fa-copy fa-fw" aria-hidden="true"></i></span>
    </div><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl"><span class="c1"># pod infrastructure container</span>
</span></span><span class="line"><span class="cl"><span class="c1">#KUBELET_POD_INFRA_CONTAINER=&#34;--pod-infra-container-image=registry.access.redhat.com/rhel7/pod-infrastructure:latest&#34;</span></span></span></code></pre></div></div>
<p><em>Nosso arquivo deverá estar assim: (Lembrando que o parâmetro KUBELET_HOSTNAME deverá ser diferente para cada um dos 3 minions, respectivamente: centos-minion1, centos-minion2 e centos-minion3)</em></p>
<div class="code-block code-line-numbers open" style="counter-reset: code-block 0">
    <div class="code-header language-bash">
        <span class="code-title"><i class="arrow fas fa-angle-right fa-fw" aria-hidden="true"></i></span>
        <span class="ellipses"><i class="fas fa-ellipsis-h fa-fw" aria-hidden="true"></i></span>
        <span class="copy" title="Copiar para a área de transferência"><i class="far fa-copy fa-fw" aria-hidden="true"></i></span>
    </div><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl"><span class="c1">###</span>
</span></span><span class="line"><span class="cl"><span class="c1"># kubernetes kubelet (minion) config</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># The address for the info server to serve on (set to 0.0.0.0 or &#34;&#34; for all interfaces)</span>
</span></span><span class="line"><span class="cl"><span class="nv">KUBELET_ADDRESS</span><span class="o">=</span><span class="s2">&#34;--address=0.0.0.0&#34;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># The port for the info server to serve on</span>
</span></span><span class="line"><span class="cl"><span class="nv">KUBELET_PORT</span><span class="o">=</span><span class="s2">&#34;--port=10250&#34;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># You may leave this blank to use the actual hostname</span>
</span></span><span class="line"><span class="cl"><span class="nv">KUBELET_HOSTNAME</span><span class="o">=</span><span class="s2">&#34;--hostname-override=centos-minion1&#34;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># location of the api-server</span>
</span></span><span class="line"><span class="cl"><span class="nv">KUBELET_API_SERVER</span><span class="o">=</span><span class="s2">&#34;--api-servers=https://centos-master:8080&#34;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># pod infrastructure container</span>
</span></span><span class="line"><span class="cl"><span class="c1">#KUBELET_POD_INFRA_CONTAINER=&#34;--pod-infra-container-image=registry.access.redhat.com/rhel7/pod-infrastructure:latest&#34;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># Add your own!</span>
</span></span><span class="line"><span class="cl"><span class="nv">KUBELET_ARGS</span><span class="o">=</span><span class="s2">&#34;&#34;</span></span></span></code></pre></div></div>
<p><strong>U</strong>ma vez que estas configurações também estão feitas nos 3 minions, vamos habilitar e iniciar os serviços necessários nos minions:</p>
<ul>
<li>kube-proxy</li>
<li>kube-kubelet</li>
<li>docker</li>
</ul>
<div class="code-block code-line-numbers open" style="counter-reset: code-block 0">
    <div class="code-header language-bash">
        <span class="code-title"><i class="arrow fas fa-angle-right fa-fw" aria-hidden="true"></i></span>
        <span class="ellipses"><i class="fas fa-ellipsis-h fa-fw" aria-hidden="true"></i></span>
        <span class="copy" title="Copiar para a área de transferência"><i class="far fa-copy fa-fw" aria-hidden="true"></i></span>
    </div><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl"><span class="c1"># systemctl enable kube-proxy kubelet docker</span></span></span></code></pre></div></div>
<div class="code-block code-line-numbers open" style="counter-reset: code-block 0">
    <div class="code-header language-bash">
        <span class="code-title"><i class="arrow fas fa-angle-right fa-fw" aria-hidden="true"></i></span>
        <span class="ellipses"><i class="fas fa-ellipsis-h fa-fw" aria-hidden="true"></i></span>
        <span class="copy" title="Copiar para a área de transferência"><i class="far fa-copy fa-fw" aria-hidden="true"></i></span>
    </div><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl"><span class="c1"># systemctl start kube-proxy kubelet docker</span></span></span></code></pre></div></div>
<p><strong>N</strong>ovamente, vamos ter certeza de que os 3 serviços estão rodando:</p>
<div class="code-block code-line-numbers open" style="counter-reset: code-block 0">
    <div class="code-header language-bash">
        <span class="code-title"><i class="arrow fas fa-angle-right fa-fw" aria-hidden="true"></i></span>
        <span class="ellipses"><i class="fas fa-ellipsis-h fa-fw" aria-hidden="true"></i></span>
        <span class="copy" title="Copiar para a área de transferência"><i class="far fa-copy fa-fw" aria-hidden="true"></i></span>
    </div><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl"><span class="c1"># systemctl status kube-proxy kubelet docker | grep &#34;(running)&#34;</span>
</span></span><span class="line"><span class="cl">   Active: active <span class="o">(</span>running<span class="o">)</span> since Sat 2017-06-24 21:44:23 UTC<span class="p">;</span> 1h 16min ago
</span></span><span class="line"><span class="cl">   Active: active <span class="o">(</span>running<span class="o">)</span> since Sat 2017-06-24 21:44:27 UTC<span class="p">;</span> 1h 16min ago
</span></span><span class="line"><span class="cl">   Active: active <span class="o">(</span>running<span class="o">)</span> since Sat 2017-06-24 21:44:27 UTC<span class="p">;</span> 1h 16min ago</span></span></code></pre></div></div>
<p><strong>N</strong>ovamente, estes 3 serviços devem ser habilitados e iniciados nos 3 minions.</p>
<p><strong>N</strong>este momento já temos nosso cluster rodando, com um master e 3 minions. :D</p>
<h2 id="testando-o-cluster-com-o-kubernetes">Testando o Cluster com o Kubernetes</h2>
<p><strong>A</strong>gora que temos a configuração básica de nosso Master Controller e de 3 minions, vamos testar nosso cluster.</p>
<p><strong>U</strong>tilizaremos o utilitário kubectl (KubeControl) disponível com o kubernetes. Caso tenha interesse em ver os parâmetros e funções do mesmo&hellip; <em>$ man kubectl</em></p>
<p><strong>V</strong>amos verificar a lista dos nodes ou minions que temos neste momento registrados em nosso Cluster. Vamos digitar alguns comandos em nosso Master Controller (centos-master):</p>
<div class="code-block code-line-numbers open" style="counter-reset: code-block 0">
    <div class="code-header language-bash">
        <span class="code-title"><i class="arrow fas fa-angle-right fa-fw" aria-hidden="true"></i></span>
        <span class="ellipses"><i class="fas fa-ellipsis-h fa-fw" aria-hidden="true"></i></span>
        <span class="copy" title="Copiar para a área de transferência"><i class="far fa-copy fa-fw" aria-hidden="true"></i></span>
    </div><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl"><span class="o">[</span>root@kalib1 ~<span class="o">]</span><span class="c1"># kubectl get nodes</span>
</span></span><span class="line"><span class="cl">NAME             STATUS    AGE
</span></span><span class="line"><span class="cl">centos-minion1   Ready     17m
</span></span><span class="line"><span class="cl">centos-minion2   Ready     15m
</span></span><span class="line"><span class="cl">centos-minion3   Ready     10m</span></span></code></pre></div></div>
<p><strong>O</strong>s três nodes criados e configurados anteriormente já são reconhecidos pelo nosso Kubernetes através do Master Controller. Além de registrados, estão com o status Ready, o que indica que estão prontos para funcionar e executar o que precisarmos.</p>
<p><em>Caso deseje conhecer mais parâmetros que a função <strong>get</strong> do kubectl possui, podemos invocar o manual desta função: $ man kubectl-get</em></p>
<p><strong>A</strong>lém do status, podemos conseguir diversas outras informações dos nodes através do <em>kubectl</em>: <em>(Ex: kubectl describe nodes)</em> Isto lhe daria informações sobre todos os nodes. Vamos experimentar com um node em específico.</p>
<div class="code-block code-line-numbers" style="counter-reset: code-block 0">
    <div class="code-header language-bash">
        <span class="code-title"><i class="arrow fas fa-angle-right fa-fw" aria-hidden="true"></i></span>
        <span class="ellipses"><i class="fas fa-ellipsis-h fa-fw" aria-hidden="true"></i></span>
        <span class="copy" title="Copiar para a área de transferência"><i class="far fa-copy fa-fw" aria-hidden="true"></i></span>
    </div><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl"><span class="o">[</span>root@kalib1 ~<span class="o">]</span><span class="c1"># kubectl describe node centos-minion1</span>
</span></span><span class="line"><span class="cl">Name:                   centos-minion1
</span></span><span class="line"><span class="cl">Role:
</span></span><span class="line"><span class="cl">Labels:                 beta.kubernetes.io/arch<span class="o">=</span>amd64
</span></span><span class="line"><span class="cl">                        beta.kubernetes.io/os<span class="o">=</span>linux
</span></span><span class="line"><span class="cl">                        kubernetes.io/hostname<span class="o">=</span>centos-minion1
</span></span><span class="line"><span class="cl">Taints:                 &lt;none&gt;
</span></span><span class="line"><span class="cl">CreationTimestamp:      Tue, <span class="m">20</span> Jun <span class="m">2017</span> 19:27:31 +0000
</span></span><span class="line"><span class="cl">Phase:
</span></span><span class="line"><span class="cl">Conditions:
</span></span><span class="line"><span class="cl">  Type                  Status  LastHeartbeatTime                       LastTransitionTime                      Reason     Message
</span></span><span class="line"><span class="cl">  ----                  ------  -----------------                       ------------------                      ------     -------
</span></span><span class="line"><span class="cl">  OutOfDisk             False   Sun, <span class="m">25</span> Jun <span class="m">2017</span> 01:39:38 +0000         Fri, <span class="m">23</span> Jun <span class="m">2017</span> 17:31:44 +0000         KubeletHasSufficientDisk    kubelet has sufficient disk space available
</span></span><span class="line"><span class="cl">  MemoryPressure        False   Sun, <span class="m">25</span> Jun <span class="m">2017</span> 01:39:38 +0000         Tue, <span class="m">20</span> Jun <span class="m">2017</span> 19:27:31 +0000         KubeletHasSufficientMemory  kubelet has sufficient memory available
</span></span><span class="line"><span class="cl">  DiskPressure          False   Sun, <span class="m">25</span> Jun <span class="m">2017</span> 01:39:38 +0000         Tue, <span class="m">20</span> Jun <span class="m">2017</span> 19:27:31 +0000         KubeletHasNoDiskPressure    kubelet has no disk pressure
</span></span><span class="line"><span class="cl">  Ready                 True    Sun, <span class="m">25</span> Jun <span class="m">2017</span> 01:39:38 +0000         Fri, <span class="m">23</span> Jun <span class="m">2017</span> 17:31:54 +0000         KubeletReady                        kubelet is posting ready status
</span></span><span class="line"><span class="cl">Addresses:              172.31.120.16,172.31.120.16,centos-minion1
</span></span><span class="line"><span class="cl">Capacity:
</span></span><span class="line"><span class="cl"> alpha.kubernetes.io/nvidia-gpu:        <span class="m">0</span>
</span></span><span class="line"><span class="cl"> cpu:                                   <span class="m">1</span>
</span></span><span class="line"><span class="cl"> memory:                                1015348Ki
</span></span><span class="line"><span class="cl"> pods:                                  <span class="m">110</span>
</span></span><span class="line"><span class="cl">Allocatable:
</span></span><span class="line"><span class="cl"> alpha.kubernetes.io/nvidia-gpu:        <span class="m">0</span>
</span></span><span class="line"><span class="cl"> cpu:                                   <span class="m">1</span>
</span></span><span class="line"><span class="cl"> memory:                                1015348Ki
</span></span><span class="line"><span class="cl"> pods:                                  <span class="m">110</span>
</span></span><span class="line"><span class="cl">System Info:
</span></span><span class="line"><span class="cl"> Machine ID:                    f9afeb75a5a382dce8269887a67fbf58
</span></span><span class="line"><span class="cl"> System UUID:                   EC2C8A0E-91D6-F54E-5A49-534A6A903FDA
</span></span><span class="line"><span class="cl"> Boot ID:                       20961efd-c946-481a-97cb-7788209551ae
</span></span><span class="line"><span class="cl"> Kernel Version:                3.10.0-327.28.2.el7.x86_64
</span></span><span class="line"><span class="cl"> OS Image:                      CentOS Linux <span class="m">7</span> <span class="o">(</span>Core<span class="o">)</span>
</span></span><span class="line"><span class="cl"> Operating System:              linux
</span></span><span class="line"><span class="cl"> Architecture:                  amd64
</span></span><span class="line"><span class="cl"> Container Runtime Version:     docker://1.12.6
</span></span><span class="line"><span class="cl"> Kubelet Version:               v1.5.2
</span></span><span class="line"><span class="cl"> Kube-Proxy Version:            v1.5.2
</span></span><span class="line"><span class="cl">ExternalID:                     centos-minion1
</span></span><span class="line"><span class="cl">Non-terminated Pods:            <span class="o">(</span><span class="m">0</span> in total<span class="o">)</span>
</span></span><span class="line"><span class="cl">  Namespace                     Name            CPU Requests    CPU Limits      Memory Requests Memory Limits
</span></span><span class="line"><span class="cl">  ---------                     ----            ------------    ----------      --------------- -------------
</span></span><span class="line"><span class="cl">Allocated resources:
</span></span><span class="line"><span class="cl">  <span class="o">(</span>Total limits may be over <span class="m">100</span> percent, i.e., overcommitted.
</span></span><span class="line"><span class="cl">  CPU Requests  CPU Limits      Memory Requests Memory Limits
</span></span><span class="line"><span class="cl">  ------------  ----------      --------------- -------------
</span></span><span class="line"><span class="cl">  <span class="m">0</span> <span class="o">(</span>0%<span class="o">)</span>        <span class="m">0</span> <span class="o">(</span>0%<span class="o">)</span>          <span class="m">0</span> <span class="o">(</span>0%<span class="o">)</span>          <span class="m">0</span> <span class="o">(</span>0%<span class="o">)</span>
</span></span><span class="line"><span class="cl">Events:
</span></span><span class="line"><span class="cl">  FirstSeen     LastSeen        Count   From                            SubObjectPath   Type            Reason             Message
</span></span><span class="line"><span class="cl">  ---------     --------        -----   ----                            -------------   --------        ------             -------
</span></span><span class="line"><span class="cl">  15m           15m             <span class="m">1</span>       <span class="o">{</span>kubelet centos-minion1<span class="o">}</span>                        Normal          Starting           Starting kubelet.
</span></span><span class="line"><span class="cl">  15m           15m             <span class="m">1</span>       <span class="o">{</span>kubelet centos-minion1<span class="o">}</span>                        Warning         ImageGCFailed      unable to find data <span class="k">for</span> container /
</span></span><span class="line"><span class="cl">  15m           15m             <span class="m">2</span>       <span class="o">{</span>kubelet centos-minion1<span class="o">}</span>                        Normal          NodeHasSufficientDisk       Node centos-minion1 status is now: NodeHasSufficientDisk
</span></span><span class="line"><span class="cl">  15m           15m             <span class="m">2</span>       <span class="o">{</span>kubelet centos-minion1<span class="o">}</span>                        Normal          NodeHasSufficientMemory     Node centos-minion1 status is now: NodeHasSufficientMemory
</span></span><span class="line"><span class="cl">  15m           15m             <span class="m">2</span>       <span class="o">{</span>kubelet centos-minion1<span class="o">}</span>                        Normal          NodeHasNoDiskPressure       Node centos-minion1 status is now: NodeHasNoDiskPressure
</span></span><span class="line"><span class="cl">  15m           15m             <span class="m">1</span>       <span class="o">{</span>kubelet centos-minion1<span class="o">}</span>                        Warning         Rebooted           Node centos-minion1 has been rebooted, boot id: 20961efd-c946-481a-97cb-7788209551ae</span></span></code></pre></div></div>
<p><strong>O</strong>bviamente recebemos um retorno com muitas informações em formato Json, o que nem sempre é como esperamos. Existem formas de filtrar os resultados e conseguir informações mais precisas, como o bom e velho grep:</p>
<div class="code-block code-line-numbers open" style="counter-reset: code-block 0">
    <div class="code-header language-bash">
        <span class="code-title"><i class="arrow fas fa-angle-right fa-fw" aria-hidden="true"></i></span>
        <span class="ellipses"><i class="fas fa-ellipsis-h fa-fw" aria-hidden="true"></i></span>
        <span class="copy" title="Copiar para a área de transferência"><i class="far fa-copy fa-fw" aria-hidden="true"></i></span>
    </div><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl"><span class="o">[</span>root@kalib1 ~<span class="o">]</span><span class="c1"># kubectl describe node centos-minion1 | grep Addresses</span>
</span></span><span class="line"><span class="cl">Addresses:              172.31.120.16,172.31.120.16,centos-minion1</span></span></code></pre></div></div>
<p><strong>V</strong>ocê também pode utilizar expressões regulares e a sintaxe do próprio Kubernetes para consultas mais complexas, como por exemplo, formatar a minha saída Json de forma a pegar apenas a listagem de status dos meus nodes que estão com Ready = True:</p>
<div class="code-block code-line-numbers open" style="counter-reset: code-block 0">
    <div class="code-header language-bash">
        <span class="code-title"><i class="arrow fas fa-angle-right fa-fw" aria-hidden="true"></i></span>
        <span class="ellipses"><i class="fas fa-ellipsis-h fa-fw" aria-hidden="true"></i></span>
        <span class="copy" title="Copiar para a área de transferência"><i class="far fa-copy fa-fw" aria-hidden="true"></i></span>
    </div><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl"><span class="o">[</span>root@kalib1 ~<span class="o">]</span><span class="c1"># kubectl get nodes -o jsonpath=&#39;{range .items[*]}{@.metadata.name}:{range @.status.conditions[*]}{@.type}={@.status};{end}{end}&#39;| tr &#39;;&#39; &#34;\n&#34; | grep &#34;Ready=True&#34;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nv">Ready</span><span class="o">=</span>True
</span></span><span class="line"><span class="cl"><span class="nv">Ready</span><span class="o">=</span>True
</span></span><span class="line"><span class="cl"><span class="nv">Ready</span><span class="o">=</span>True</span></span></code></pre></div></div>
<p><strong>A</strong> sua criatividade é o limite. ;]</p>
<p><strong>N</strong>ão temos nenhum pod configurado, mas também poderíamos utilizar <em>kubectl get</em> para conseguir a listagem de nossos pods:</p>
<div class="code-block code-line-numbers open" style="counter-reset: code-block 0">
    <div class="code-header language-bash">
        <span class="code-title"><i class="arrow fas fa-angle-right fa-fw" aria-hidden="true"></i></span>
        <span class="ellipses"><i class="fas fa-ellipsis-h fa-fw" aria-hidden="true"></i></span>
        <span class="copy" title="Copiar para a área de transferência"><i class="far fa-copy fa-fw" aria-hidden="true"></i></span>
    </div><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl"><span class="o">[</span>root@kalib1 ~<span class="o">]</span><span class="c1"># kubectl get pods</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">No resources found.</span></span></code></pre></div></div>
<h2 id="criando-pods">Criando pods</h2>
<p><strong>A</strong>ssim como com o Docker, Ansible e algumas outras ferramentas, utilizaremos a linguagem <a href="ttps://pt.wikipedia.org/wiki/YAML" target="_blank" rel="noopener noreffer ">YAML</a> para criar nossos arquivos de configuração.</p>
<p><strong>C</strong>riaremos um diretório chamado <em>Builds</em> em nosso Master Controller apenas para melhor organizar nossos arquivos de configuração e ficar mais fácil encontrá-los no futuro:</p>
<div class="code-block code-line-numbers open" style="counter-reset: code-block 0">
    <div class="code-header language-bash">
        <span class="code-title"><i class="arrow fas fa-angle-right fa-fw" aria-hidden="true"></i></span>
        <span class="ellipses"><i class="fas fa-ellipsis-h fa-fw" aria-hidden="true"></i></span>
        <span class="copy" title="Copiar para a área de transferência"><i class="far fa-copy fa-fw" aria-hidden="true"></i></span>
    </div><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl"><span class="c1"># mkdir Builds</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># cd Builds</span></span></span></code></pre></div></div>
<p><strong>P</strong>ara criarmos Pods, o que fazemos na verdade é criar arquivos de configuração que vão dizer ao Kubernetes qual o estado em que desejamos nossa infraestrutura. O papel do Kubernetes é ler esta configuração e assegurar que o estado de nossa infraestrutura reflita o estado desejado.</p>
<p><strong>P</strong>ara facilitar, vamos utilizar exemplos encontrados na própria documentação do Kubernetes. Comecemos com a criação de um Pod para um servidor web Nginx.</p>
<p><strong>V</strong>amos criar um arquivo chamado nginx.yaml dentro do diretório Builds que criamos anteriormente:</p>
<div class="code-block code-line-numbers open" style="counter-reset: code-block 0">
    <div class="code-header language-bash">
        <span class="code-title"><i class="arrow fas fa-angle-right fa-fw" aria-hidden="true"></i></span>
        <span class="ellipses"><i class="fas fa-ellipsis-h fa-fw" aria-hidden="true"></i></span>
        <span class="copy" title="Copiar para a área de transferência"><i class="far fa-copy fa-fw" aria-hidden="true"></i></span>
    </div><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl"><span class="c1"># vim nginx.yaml</span></span></span></code></pre></div></div>
<p><strong>N</strong>o arquivo indicaremos alguns atributos ou variáveis, bem como seus respectivos valores:</p>
<ul>
<li>apiVersion - Indica a versão da API do kubernetes utilizada</li>
<li>kind - o tipo de recurso que desejamos</li>
<li>metadata - dados referentes ao recurso desejado</li>
<li>spec - especificações sobre o que este recurso irá conter</li>
</ul>
<p><strong>V</strong>amos criar um Pod contendo um único container rodando a versão 1.7.9 do nginx bem como disponibilizando a porta 80 para receber conexões. Este deverá ser o conteúdo do arquivo <em>nginx.yaml</em>:</p>
<div class="code-block code-line-numbers open" style="counter-reset: code-block 0">
    <div class="code-header language-yaml">
        <span class="code-title"><i class="arrow fas fa-angle-right fa-fw" aria-hidden="true"></i></span>
        <span class="ellipses"><i class="fas fa-ellipsis-h fa-fw" aria-hidden="true"></i></span>
        <span class="copy" title="Copiar para a área de transferência"><i class="far fa-copy fa-fw" aria-hidden="true"></i></span>
    </div><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-yaml" data-lang="yaml"><span class="line"><span class="cl"><span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l">v1</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l">Pod</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">metadata</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">nginx</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">spec</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">containers</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span>- <span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">nginx</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l">nginx:1.7.9</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">ports</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span>- <span class="nt">containerPort</span><span class="p">:</span><span class="w"> </span><span class="m">80</span></span></span></code></pre></div></div>
<p><strong>A</strong>ntes de executarmos, vamos nos certificar novamente de duas coisas:</p>
<ul>
<li>Que realmente não temos nenhum Pod criado e ativo;</li>
<li>Que não temos nenhum container rodando em nossos nodes.</li>
</ul>
<p><em>No centos-master:</em></p>
<div class="code-block code-line-numbers open" style="counter-reset: code-block 0">
    <div class="code-header language-bash">
        <span class="code-title"><i class="arrow fas fa-angle-right fa-fw" aria-hidden="true"></i></span>
        <span class="ellipses"><i class="fas fa-ellipsis-h fa-fw" aria-hidden="true"></i></span>
        <span class="copy" title="Copiar para a área de transferência"><i class="far fa-copy fa-fw" aria-hidden="true"></i></span>
    </div><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl"><span class="o">[</span>root@kalib1 Builds<span class="o">]</span><span class="c1"># kubectl get pods</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">No resources found.</span></span></code></pre></div></div>
<p><em>No centos-minion1: (Execute o mesmo comando nos demais nodes (centos-minion2 e centos-minion3))</em></p>
<div class="code-block code-line-numbers open" style="counter-reset: code-block 0">
    <div class="code-header language-bash">
        <span class="code-title"><i class="arrow fas fa-angle-right fa-fw" aria-hidden="true"></i></span>
        <span class="ellipses"><i class="fas fa-ellipsis-h fa-fw" aria-hidden="true"></i></span>
        <span class="copy" title="Copiar para a área de transferência"><i class="far fa-copy fa-fw" aria-hidden="true"></i></span>
    </div><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl"><span class="o">[</span>root@kalib2 ~<span class="o">]</span><span class="c1"># docker ps</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">CONTAINER ID        IMAGE               COMMAND             CREATED             STATUS              PORTS               NAMES</span></span></code></pre></div></div>
<p><em>Novamente: Se você não faz ideia do que acabei de digitar, (docker ps) volte e leia um pouco sobre <a href="/posts/docker-uma-alternativa-elegante-para/" rel="">Docker</a> antes de seguir com este artigo.</em></p>
<p><strong>C</strong>omo podemos ver, não temos nenhum Pod, bem como nenhum container rodando em nossos nodes.</p>
<p><strong>V</strong>amos utilizar <em>kubectl create</em> para criar o Pod utilizando o arquivo que criamos <em>nginx.yaml</em>: <em>Executaremos este comando no Master Controller - centos-master</em></p>
<div class="code-block code-line-numbers open" style="counter-reset: code-block 0">
    <div class="code-header language-bash">
        <span class="code-title"><i class="arrow fas fa-angle-right fa-fw" aria-hidden="true"></i></span>
        <span class="ellipses"><i class="fas fa-ellipsis-h fa-fw" aria-hidden="true"></i></span>
        <span class="copy" title="Copiar para a área de transferência"><i class="far fa-copy fa-fw" aria-hidden="true"></i></span>
    </div><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl"><span class="o">[</span>root@kalib1 Builds<span class="o">]</span><span class="c1"># kubectl create -f nginx.yaml</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">pod <span class="s2">&#34;nginx&#34;</span> created</span></span></code></pre></div></div>
<p><strong>O</strong> Kubernetes está dizendo que nosso Pod &ldquo;nginx&rdquo; foi criado. Vamos verificar:</p>
<div class="code-block code-line-numbers open" style="counter-reset: code-block 0">
    <div class="code-header language-bash">
        <span class="code-title"><i class="arrow fas fa-angle-right fa-fw" aria-hidden="true"></i></span>
        <span class="ellipses"><i class="fas fa-ellipsis-h fa-fw" aria-hidden="true"></i></span>
        <span class="copy" title="Copiar para a área de transferência"><i class="far fa-copy fa-fw" aria-hidden="true"></i></span>
    </div><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl"><span class="o">[</span>root@kalib1 Builds<span class="o">]</span><span class="c1"># kubectl get pods</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">NAME      READY     STATUS    RESTARTS   AGE
</span></span><span class="line"><span class="cl">nginx     1/1       Running   <span class="m">0</span>          1m</span></span></code></pre></div></div>
<p><strong>O</strong> pod está criado e rodando. Agora, execute novamente <em>docker ps</em> nos 3 nodes para identificar em qual deles o container foi criado. Sim, como não especificamos nada, o Kubernetes vai verificar os recursos disponíveis no momento e vai lançar onde ele achar mais adequado.</p>
<div class="code-block code-line-numbers open" style="counter-reset: code-block 0">
    <div class="code-header language-bash">
        <span class="code-title"><i class="arrow fas fa-angle-right fa-fw" aria-hidden="true"></i></span>
        <span class="ellipses"><i class="fas fa-ellipsis-h fa-fw" aria-hidden="true"></i></span>
        <span class="copy" title="Copiar para a área de transferência"><i class="far fa-copy fa-fw" aria-hidden="true"></i></span>
    </div><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl"><span class="o">[</span>root@kalib4 ~<span class="o">]</span><span class="c1"># docker ps</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">CONTAINER ID        IMAGE                                      COMMAND                  CREATED             STATUS              PORTS               NAMES
</span></span><span class="line"><span class="cl">6de8e22e1536        nginx:1.7.9                                <span class="s2">&#34;nginx -g &#39;daemon off&#34;</span>   <span class="m">2</span> minutes ago       Up <span class="m">2</span> minutes                            k8s_nginx.b0df00ef_nginx_default_d4debd3a-594c-11e7-b587-06827a5b32d4_583881e0
</span></span><span class="line"><span class="cl">ae49b36ae11b        gcr.io/google_containers/pause-amd64:3.0   <span class="s2">&#34;/pause&#34;</span>                 <span class="m">2</span> minutes ago       Up <span class="m">2</span> minutes                            k8s_POD.b2390301_nginx_default_d4debd3a-594c-11e7-b587-06827a5b32d4_fb5c834f</span></span></code></pre></div></div>
<p><strong>S</strong>im, existem dois containers rodando. Um deles é o nosso &ldquo;nginx&rdquo;, enquanto que o outro é um container padrão do google chamado &ldquo;/pause&rdquo;, o qual será responsável pela manutenção de alguns recursos de nosso cluster.</p>
<p><strong>P</strong>odemos novamente pedir a descrição deste pod que acabamos de criar:</p>
<div class="code-block code-line-numbers open" style="counter-reset: code-block 0">
    <div class="code-header language-bash">
        <span class="code-title"><i class="arrow fas fa-angle-right fa-fw" aria-hidden="true"></i></span>
        <span class="ellipses"><i class="fas fa-ellipsis-h fa-fw" aria-hidden="true"></i></span>
        <span class="copy" title="Copiar para a área de transferência"><i class="far fa-copy fa-fw" aria-hidden="true"></i></span>
    </div><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl"><span class="o">[</span>root@kalib1 Builds<span class="o">]</span><span class="c1"># kubectl describe pod nginx</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">Name:           nginx
</span></span><span class="line"><span class="cl">Namespace:      default
</span></span><span class="line"><span class="cl">Node:           centos-minion3/172.31.123.22
</span></span><span class="line"><span class="cl">Start Time:     Sun, <span class="m">25</span> Jun <span class="m">2017</span> 02:20:18 +0000
</span></span><span class="line"><span class="cl">Labels:         &lt;none&gt;
</span></span><span class="line"><span class="cl">Status:         Running
</span></span><span class="line"><span class="cl">IP:             172.17.0.2
</span></span><span class="line"><span class="cl">Controllers:    &lt;none&gt;
</span></span><span class="line"><span class="cl">Containers:
</span></span><span class="line"><span class="cl">  nginx:
</span></span><span class="line"><span class="cl">    Container ID:               docker://6de8e22e153618271bb6e8095c68070126541331c8acfc3f5d1a654f4b978454
</span></span><span class="line"><span class="cl">    Image:                      nginx:1.7.9
</span></span><span class="line"><span class="cl">    Image ID:                   docker-pullable://docker.io/nginx@sha256:e3456c851a152494c3e4ff5fcc26f240206abac0c9d794affb40e0714846c451
</span></span><span class="line"><span class="cl">    Port:                       80/TCP
</span></span><span class="line"><span class="cl">    State:                      Running
</span></span><span class="line"><span class="cl">      Started:                  Sun, <span class="m">25</span> Jun <span class="m">2017</span> 02:20:27 +0000
</span></span><span class="line"><span class="cl">    Ready:                      True
</span></span><span class="line"><span class="cl">    Restart Count:              <span class="m">0</span>
</span></span><span class="line"><span class="cl">    Volume Mounts:              &lt;none&gt;
</span></span><span class="line"><span class="cl">    Environment Variables:      &lt;none&gt;
</span></span><span class="line"><span class="cl">Conditions:
</span></span><span class="line"><span class="cl">  Type          Status
</span></span><span class="line"><span class="cl">  Initialized   True
</span></span><span class="line"><span class="cl">  Ready         True
</span></span><span class="line"><span class="cl">  PodScheduled  True
</span></span><span class="line"><span class="cl">No volumes.
</span></span><span class="line"><span class="cl">QoS Class:      BestEffort
</span></span><span class="line"><span class="cl">Tolerations:    &lt;none&gt;
</span></span><span class="line"><span class="cl">Events:
</span></span><span class="line"><span class="cl">  FirstSeen     LastSeen        Count   From                            SubObjectPath           Type            Reason     Message
</span></span><span class="line"><span class="cl">  ---------     --------        -----   ----                            -------------           --------        ------     -------
</span></span><span class="line"><span class="cl">  6m            6m              <span class="m">1</span>       <span class="o">{</span>default-scheduler <span class="o">}</span>                                    Normal          Scheduled  Successfully assigned nginx to centos-minion3
</span></span><span class="line"><span class="cl">  6m            6m              <span class="m">1</span>       <span class="o">{</span>kubelet centos-minion3<span class="o">}</span>        spec.containers<span class="o">{</span>nginx<span class="o">}</span>  Normal          Pulling    pulling image <span class="s2">&#34;nginx:1.7.9&#34;</span>
</span></span><span class="line"><span class="cl">  6m            6m              <span class="m">2</span>       <span class="o">{</span>kubelet centos-minion3<span class="o">}</span>                                Warning         MissingClusterDNS   kubelet does not have ClusterDNS IP configured and cannot create Pod using <span class="s2">&#34;ClusterFirst&#34;</span> policy. Falling back to DNSDefault policy.
</span></span><span class="line"><span class="cl">  6m            6m              <span class="m">1</span>       <span class="o">{</span>kubelet centos-minion3<span class="o">}</span>        spec.containers<span class="o">{</span>nginx<span class="o">}</span>  Normal          Pulled     Successfully pulled image <span class="s2">&#34;nginx:1.7.9&#34;</span>
</span></span><span class="line"><span class="cl">  6m            6m              <span class="m">1</span>       <span class="o">{</span>kubelet centos-minion3<span class="o">}</span>        spec.containers<span class="o">{</span>nginx<span class="o">}</span>  Normal          Created    Created container with docker id 6de8e22e1536<span class="p">;</span> Security:<span class="o">[</span><span class="nv">seccomp</span><span class="o">=</span>unconfined<span class="o">]</span>
</span></span><span class="line"><span class="cl">  6m            6m              <span class="m">1</span>       <span class="o">{</span>kubelet centos-minion3<span class="o">}</span>        spec.containers<span class="o">{</span>nginx<span class="o">}</span>  Normal          Started    Started container with docker id 6de8e22e1536</span></span></code></pre></div></div>
<p><strong>O</strong>bviamente que isto é apenas a configuração mais básica que se possa imaginar, sem storage, mapeamentos de portas, redirecionamentos, rotas, etc. A ideia é apenas uma apresentação inicial..o que é o Kubernetes.</p>
<p><strong>H</strong>appy Hacking</p></div><div class="post-footer" id="post-footer">
    <div class="post-info">
        <div class="post-info-line">
            <div class="post-info-mod">
                <span>Atualizado em 2017-06-24</span>
            </div></div>
        <div class="post-info-line">
            <div class="post-info-md"></div>
            <div class="post-info-share">
                <span><a href="javascript:void(0);" title="Compartilhe em X" data-sharer="x" data-url="//blog.marcelocavalcante.net:1313/posts/conhecendo-o-kubernetes-clusters-de/" data-title="Conhecendo O Kubernetes - Clusters De Containers" data-via="Marcelo_Kalib" data-hashtags="Devops,Docker,Kubernetes"><i class="fab fa-x-twitter fa-fw" aria-hidden="true"></i></a><a href="javascript:void(0);" title="Compartilhe em Threads" data-sharer="threads" data-url="//blog.marcelocavalcante.net:1313/posts/conhecendo-o-kubernetes-clusters-de/" data-title="Conhecendo O Kubernetes - Clusters De Containers"><i class="fab fa-threads fa-fw" aria-hidden="true"></i></a><a href="javascript:void(0);" title="Compartilhe em Facebook" data-sharer="facebook" data-url="//blog.marcelocavalcante.net:1313/posts/conhecendo-o-kubernetes-clusters-de/" data-hashtag="Devops"><i class="fab fa-facebook-square fa-fw" aria-hidden="true"></i></a><a href="javascript:void(0);" title="Compartilhe em Linkedin" data-sharer="linkedin" data-url="//blog.marcelocavalcante.net:1313/posts/conhecendo-o-kubernetes-clusters-de/"><i class="fab fa-linkedin fa-fw" aria-hidden="true"></i></a><a href="javascript:void(0);" title="Compartilhe em Hacker News" data-sharer="hackernews" data-url="//blog.marcelocavalcante.net:1313/posts/conhecendo-o-kubernetes-clusters-de/" data-title="Conhecendo O Kubernetes - Clusters De Containers"><i class="fab fa-hacker-news fa-fw" aria-hidden="true"></i></a><a href="javascript:void(0);" title="Compartilhe em Line" data-sharer="line" data-url="//blog.marcelocavalcante.net:1313/posts/conhecendo-o-kubernetes-clusters-de/" data-title="Conhecendo O Kubernetes - Clusters De Containers"><i data-svg-src="https://cdn.jsdelivr.net/npm/simple-icons@15.14.0/icons/line.svg" aria-hidden="true"></i></a><a href="javascript:void(0);" title="Compartilhe em 微博" data-sharer="weibo" data-url="//blog.marcelocavalcante.net:1313/posts/conhecendo-o-kubernetes-clusters-de/" data-title="Conhecendo O Kubernetes - Clusters De Containers"><i class="fab fa-weibo fa-fw" aria-hidden="true"></i></a><a href="javascript:void(0);" title="Compartilhe em Diaspora" data-sharer="diaspora" data-url="//blog.marcelocavalcante.net:1313/posts/conhecendo-o-kubernetes-clusters-de/" data-title="Conhecendo O Kubernetes - Clusters De Containers" data-description="Sistema Open Source desenvolvido pelo Google para o gerenciamento de cluster de containers tendo como características auto-scaling de serviços e containers, auto-monitoração de containers, permite o deploy de containers e serviços, load balancer, orquestração de containers, e orquestração de volumes de armazenamento."><i class="fab fa-diaspora fa-fw" aria-hidden="true"></i></a><a href="https://t.me/share/url?url=%2f%2fblog.marcelocavalcante.net%3a1313%2fposts%2fconhecendo-o-kubernetes-clusters-de%2f&amp;text=Conhecendo%20O%20Kubernetes%20-%20Clusters%20De%20Containers" target="_blank" title="Compartilhe em Telegram"><i class="fab fa-telegram fa-fw" aria-hidden="true"></i></a></span>
            </div>
        </div>
    </div>

    <div class="post-info-more">
        <section class="post-tags"><i class="fas fa-tags fa-fw" aria-hidden="true"></i>&nbsp;<a href="/tags/devops/">Devops</a>,&nbsp;<a href="/tags/docker/">Docker</a>,&nbsp;<a href="/tags/kubernetes/">Kubernetes</a></section>
        <section>
            <span><a href="javascript:void(0);" onclick="window.history.back();">Voltar</a></span>&nbsp;|&nbsp;<span><a href="/">Home</a></span>
        </section>
    </div>

    <div class="post-nav"><a href="/posts/recebendo-alarmes-do-aws-diretamente/" class="prev" rel="prev" title="Recebendo Alarmes Do Aws Diretamente No Slack"><i class="fas fa-angle-left fa-fw" aria-hidden="true"></i>Recebendo Alarmes Do Aws Diretamente No Slack</a>
            <a href="/posts/chef-aautomacao-e-gerenciamento-de/" class="next" rel="next" title="Chef: Automação E Gerenciamento De Configuração">Chef: Automação E Gerenciamento De Configuração<i class="fas fa-angle-right fa-fw" aria-hidden="true"></i></a></div>
</div>
<div id="comments"><div id="disqus_thread" class="comment"></div><noscript>
                Please enable JavaScript to view the comments powered by <a href="https://disqus.com/?ref_noscript">Disqus</a>.
            </noscript></div></article></div>
            </main><footer class="footer">
        <div class="footer-container"><div class="footer-line">Possibilitado por <a href="https://gohugo.io/" target="_blank" rel="noopener noreffer" title="Hugo 0.145.0">Hugo</a> | Tema - <a href="https://github.com/dillonzq/LoveIt" target="_blank" rel="noopener noreffer" title="LoveIt 0.3.1-DEV"><i class="far fa-kiss-wink-heart fa-fw" aria-hidden="true"></i> LoveIt</a>
                </div><div class="footer-line" itemscope itemtype="http://schema.org/CreativeWork"><i class="far fa-copyright fa-fw" aria-hidden="true"></i><span itemprop="copyrightYear">2008 - 2025</span><span class="author" itemprop="copyrightHolder">&nbsp;<a href="https://blog.marcelocavalcante.net" target="_blank">Marcelo Cavalcante</a></span></div>
        </div>
    </footer></div>

        <div id="fixed-buttons"><a href="#" id="back-to-top" class="fixed-button" title="Voltar ao topo">
                <i class="fas fa-arrow-up fa-fw" aria-hidden="true"></i>
            </a>
        </div>

        <div id="fixed-buttons-hidden"><a href="#" id="view-comments" class="fixed-button" title="Ver comentários">
                <i class="fas fa-comment fa-fw" aria-hidden="true"></i>
            </a>
        </div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/lightgallery@2.5.0/css/lightgallery-bundle.min.css"><script src="https://marcelokalib.disqus.com/embed.js" defer></script><script src="https://cdn.jsdelivr.net/npm/autocomplete.js@0.38.1/dist/autocomplete.min.js"></script><script src="https://cdn.jsdelivr.net/npm/algoliasearch@5.20.2/dist/lite/builds/browser.umd.min.js"></script><script src="https://cdn.jsdelivr.net/npm/lazysizes@5.3.2/lazysizes.min.js"></script><script src="https://cdn.jsdelivr.net/npm/lightgallery@2.5.0/lightgallery.min.js"></script><script src="https://cdn.jsdelivr.net/npm/lightgallery@2.5.0/plugins/thumbnail/lg-thumbnail.min.js"></script><script src="https://cdn.jsdelivr.net/npm/lightgallery@2.5.0/plugins/zoom/lg-zoom.min.js"></script><script src="https://cdn.jsdelivr.net/npm/clipboard@2.0.11/dist/clipboard.min.js"></script><script src="https://cdn.jsdelivr.net/npm/sharer.js@0.5.2/sharer.min.js"></script><script>window.config={"comment":{},"lightgallery":true,"search":{"algoliaAppID":"","algoliaIndex":"","algoliaSearchKey":"","highlightTag":"em","maxResultLength":10,"noResultsFound":"Nenhum resultado encontrado","snippetLength":30,"type":"algolia"}};</script><script src="/js/theme.min.js"></script></body>
</html>
