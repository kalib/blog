<!DOCTYPE html>
<html lang="pt-BR">
    <head><script src="/livereload.js?mindelay=10&amp;v=2&amp;port=1313&amp;path=livereload" data-no-instant defer></script>
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="robots" content="noodp" />
        <title>Criando Um Cluster Kubernetes Local Com O Kind - Marcelo Cavalcante Rocha</title><meta name="Description" content="Rodar um cluster kubernetes local muitas vezes facilita e acelera o desenvolvimento de aplicações, testes ou mesmo criação de pipelines de CI/CD. Dentre as várias opções disponívels para tal, abordarei o Kind, que roda clusters kubernetes locais utilizando-se do Docker."><meta property="og:url" content="//blog.marcelocavalcante.net:1313/posts/criando-um-cluster-kubernetes-local/">
  <meta property="og:site_name" content="Marcelo Cavalcante Rocha">
  <meta property="og:title" content="Criando Um Cluster Kubernetes Local Com O Kind">
  <meta property="og:description" content="Rodar um cluster kubernetes local muitas vezes facilita e acelera o desenvolvimento de aplicações, testes ou mesmo criação de pipelines de CI/CD. Dentre as várias opções disponívels para tal, abordarei o Kind, que roda clusters kubernetes locais utilizando-se do Docker.">
  <meta property="og:locale" content="pt_BR">
  <meta property="og:type" content="article">
    <meta property="article:section" content="posts">
    <meta property="article:published_time" content="2021-01-03T13:29:27-05:00">
    <meta property="article:modified_time" content="2021-01-03T13:29:27-05:00">
    <meta property="article:tag" content="Devops">
    <meta property="article:tag" content="Containers">
    <meta property="article:tag" content="Kubernetes">
    <meta property="article:tag" content="Docker">
    <meta property="article:tag" content="Kind">
    <meta property="og:image" content="//blog.marcelocavalcante.net:1313/posts/criando-um-cluster-kubernetes-local/featured-image.png">

  <meta name="twitter:card" content="summary_large_image">
  <meta name="twitter:image" content="//blog.marcelocavalcante.net:1313/posts/criando-um-cluster-kubernetes-local/featured-image.png">
  <meta name="twitter:title" content="Criando Um Cluster Kubernetes Local Com O Kind">
  <meta name="twitter:description" content="Rodar um cluster kubernetes local muitas vezes facilita e acelera o desenvolvimento de aplicações, testes ou mesmo criação de pipelines de CI/CD. Dentre as várias opções disponívels para tal, abordarei o Kind, que roda clusters kubernetes locais utilizando-se do Docker.">
<meta name="application-name" content="Marcelo Cavalcante">
<meta name="apple-mobile-web-app-title" content="Marcelo Cavalcante">
<meta name="referrer" content="no-referrer" /><meta name="theme-color" content="#ffffff"><meta name="msapplication-TileColor" content="#da532c"><link rel="shortcut icon" type="image/x-icon" href="/favicon.ico" />
        <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
        <link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png"><link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png"><link rel="mask-icon" href="/safari-pinned-tab.svg" color="#5bbad5"><link rel="manifest" href="/site.webmanifest"><link rel="canonical" href="//blog.marcelocavalcante.net:1313/posts/criando-um-cluster-kubernetes-local/" /><link rel="prev" href="//blog.marcelocavalcante.net:1313/posts/kubernetes-imperativo-vs-declarativo/" /><link rel="next" href="//blog.marcelocavalcante.net:1313/posts/lens-uma-ide-para-o/" /><link rel="stylesheet" href="/css/style.min.css"><link rel="preload" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.7.2/css/all.min.css" as="style" onload="this.onload=null;this.rel='stylesheet'">
        <noscript><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.7.2/css/all.min.css"></noscript><link rel="preload" href="https://cdn.jsdelivr.net/npm/animate.css@4.1.1/animate.min.css" as="style" onload="this.onload=null;this.rel='stylesheet'">
        <noscript><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/animate.css@4.1.1/animate.min.css"></noscript><script type="application/ld+json">
    {
        "@context": "http://schema.org",
        "@type": "BlogPosting",
        "headline": "Criando Um Cluster Kubernetes Local Com O Kind",
        "inLanguage": "pt-BR",
        "mainEntityOfPage": {
            "@type": "WebPage",
            "@id": "\/\/blog.marcelocavalcante.net:1313\/posts\/criando-um-cluster-kubernetes-local\/"
        },"image": [{
                            "@type": "ImageObject",
                            "url": "\/\/blog.marcelocavalcante.net:1313\/posts\/criando-um-cluster-kubernetes-local\/featured-image.png",
                            "width":  990 ,
                            "height":  495 
                        }],"genre": "posts","keywords": "Devops, Containers, Kubernetes, Docker, Kind","wordcount":  2129 ,
        "url": "\/\/blog.marcelocavalcante.net:1313\/posts\/criando-um-cluster-kubernetes-local\/","datePublished": "2021-01-03T13:29:27-05:00","dateModified": "2021-01-03T13:29:27-05:00","publisher": {
            "@type": "Organization",
            "name": ""},"author": {
                "@type": "Person",
                "name": "Marcelo Cavalcante"
            },"description": "Rodar um cluster kubernetes local muitas vezes facilita e acelera o desenvolvimento de aplicações, testes ou mesmo criação de pipelines de CI/CD. Dentre as várias opções disponívels para tal, abordarei o Kind, que roda clusters kubernetes locais utilizando-se do Docker."
    }
    </script><script src="https://cdnjs.cloudflare.com/ajax/libs/lunr.js/2.3.9/lunr.min.js"></script>
    </head>
    <body data-header-desktop="fixed" data-header-mobile="auto"><script>
          const query = window.matchMedia('(prefers-color-scheme: dark)');
          function applyTheme() {
            let theme = window.localStorage?.getItem('theme') || 'auto';
            let isDark = theme === 'dark' || (theme === 'auto' && query.matches);
            document.body.setAttribute('theme', isDark? 'dark' : 'light');
            document.body.setAttribute('cfg-theme', theme);
          }

          applyTheme();
          query.addEventListener('change', applyTheme);
        </script>

        <div id="mask"></div><div class="wrapper"><header class="desktop" id="header-desktop">
    <div class="header-wrapper">
        <div class="header-title">
            <a href="/" title="Marcelo Cavalcante Rocha"><img
        class="lazyload logo"
        src="/svg/loading.min.svg"
        data-src="https://marcelocavalcante.net/ftp/logonew.png"
        data-srcset="https://marcelocavalcante.net/ftp/logonew.png, https://marcelocavalcante.net/ftp/logonew.png 1.5x, https://marcelocavalcante.net/ftp/logonew.png 2x"
        data-sizes="auto"
        alt="https://marcelocavalcante.net/ftp/logonew.png"
        title="https://marcelocavalcante.net/ftp/logonew.png" /></a>
        </div>
        <div class="menu">
            <div class="menu-inner"><a class="menu-item" href="/posts/"> Posts </a><a class="menu-item" href="/tags/"> Tags </a><a class="menu-item" href="/categories/"> Categorias </a><a class="menu-item" href="/sobre/"> Quem Sou </a><span class="menu-item delimiter"></span><span class="menu-item search" id="search-desktop">
                        <input type="text" placeholder="Pesquisar títulos ou conteúdos ..." id="search-input-desktop">
                        <a href="javascript:void(0);" class="search-button search-toggle" id="search-toggle-desktop" title="Pesquisa">
                            <i class="fas fa-search fa-fw" aria-hidden="true"></i>
                        </a>
                        <a href="javascript:void(0);" class="search-button search-clear" id="search-clear-desktop" title="Limpar">
                            <i class="fas fa-times-circle fa-fw" aria-hidden="true"></i>
                        </a>
                        <span class="search-button search-loading" id="search-loading-desktop">
                            <i class="fas fa-spinner fa-fw fa-spin" aria-hidden="true"></i>
                        </span>
                    </span><a href="javascript:void(0);" class="menu-item theme-switch" title="Trocar tema">
                    <i class="fas fa-adjust fa-fw" aria-hidden="true"></i>
                </a></div>
        </div>
    </div>
</header><header class="mobile" id="header-mobile">
    <div class="header-container">
        <div class="header-wrapper">
            <div class="header-title">
                <a href="/" title="Marcelo Cavalcante Rocha"><img
        class="lazyload logo"
        src="/svg/loading.min.svg"
        data-src="https://marcelocavalcante.net/ftp/logonew.png"
        data-srcset="https://marcelocavalcante.net/ftp/logonew.png, https://marcelocavalcante.net/ftp/logonew.png 1.5x, https://marcelocavalcante.net/ftp/logonew.png 2x"
        data-sizes="auto"
        alt="https://marcelocavalcante.net/ftp/logonew.png"
        title="https://marcelocavalcante.net/ftp/logonew.png" /></a>
            </div>
            <div class="menu-toggle" id="menu-toggle-mobile">
                <span></span><span></span><span></span>
            </div>
        </div>
        <div class="menu" id="menu-mobile"><div class="search-wrapper">
                    <div class="search mobile" id="search-mobile">
                        <input type="text" placeholder="Pesquisar títulos ou conteúdos ..." id="search-input-mobile">
                        <a href="javascript:void(0);" class="search-button search-toggle" id="search-toggle-mobile" title="Pesquisa">
                            <i class="fas fa-search fa-fw" aria-hidden="true"></i>
                        </a>
                        <a href="javascript:void(0);" class="search-button search-clear" id="search-clear-mobile" title="Limpar">
                            <i class="fas fa-times-circle fa-fw" aria-hidden="true"></i>
                        </a>
                        <span class="search-button search-loading" id="search-loading-mobile">
                            <i class="fas fa-spinner fa-fw fa-spin" aria-hidden="true"></i>
                        </span>
                    </div>
                    <a href="javascript:void(0);" class="search-cancel" id="search-cancel-mobile">
                        Cancelar
                    </a>
                </div><a class="menu-item" href="/posts/" title="">Posts</a><a class="menu-item" href="/tags/" title="">Tags</a><a class="menu-item" href="/categories/" title="">Categorias</a><a class="menu-item" href="/sobre/" title="">Quem Sou</a><a href="javascript:void(0);" class="menu-item theme-switch" title="Trocar tema">
                <i class="fas fa-adjust fa-fw" aria-hidden="true"></i>
            </a></div>
    </div>
</header><div class="search-dropdown desktop">
        <div id="search-dropdown-desktop"></div>
    </div>
    <div class="search-dropdown mobile">
        <div id="search-dropdown-mobile"></div>
    </div><main class="main">
                <div class="container"><div class="toc" id="toc-auto">
            <h2 class="toc-title">Conteúdos</h2>
            <div class="toc-content" id="toc-content-auto"></div>
        </div><article class="page single"><h1 class="single-title animate__animated animate__flipInX">Criando Um Cluster Kubernetes Local Com O Kind</h1><div class="post-meta">
            <div class="post-meta-line"><span class="post-author"><a href="https://blog.marcelocavalcante.net" title="Author" target="_blank" rel="noopener noreffer author" class="author"><i class="fas fa-user-circle fa-fw" aria-hidden="true"></i>Marcelo Cavalcante</a></span>&nbsp;<span class="post-category">incluido em <a href="/categories/tutoriais/"><i class="far fa-folder fa-fw" aria-hidden="true"></i>Tutoriais</a></span></div>
            <div class="post-meta-line"><i class="far fa-calendar-alt fa-fw" aria-hidden="true"></i>&nbsp;<time datetime="2021-01-03">2021-01-03</time>&nbsp;<i class="fas fa-pencil-alt fa-fw" aria-hidden="true"></i>&nbsp;2129 palavras&nbsp;
                <i class="far fa-clock fa-fw" aria-hidden="true"></i>&nbsp;10 minutos&nbsp;</div>
        </div><div class="featured-image"><img
        class="lazyload"
        src="/svg/loading.min.svg"
        data-src="/posts/criando-um-cluster-kubernetes-local/featured-image.png"
        data-srcset="/posts/criando-um-cluster-kubernetes-local/featured-image.png, /posts/criando-um-cluster-kubernetes-local/featured-image.png 1.5x, /posts/criando-um-cluster-kubernetes-local/featured-image.png 2x"
        data-sizes="auto"
        alt="/posts/criando-um-cluster-kubernetes-local/featured-image.png"
        title="Rodar um cluster kubernetes local muitas vezes facilita e acelera o desenvolvimento de aplicações, testes ou mesmo criação de pipelines de CI/CD. Dentre as várias opções disponívels para tal, abordarei o Kind, que roda clusters kubernetes locais utilizando-se do Docker." /></div><div class="details toc" id="toc-static"  data-kept="">
                <div class="details-summary toc-title">
                    <span>Conteúdos</span>
                    <span><i class="details-icon fas fa-angle-right" aria-hidden="true"></i></span>
                </div>
                <div class="details-content toc-content" id="toc-content-static"><nav id="TableOfContents">
  <ul>
    <li><a href="#o-que-é-o-kind---seja-gentil">O que é o Kind - Seja gentil</a></li>
    <li><a href="#instalação">Instalação</a>
      <ul>
        <li><a href="#os-x">OS X</a></li>
        <li><a href="#linux">Linux</a></li>
        <li><a href="#windows">Windows</a></li>
      </ul>
    </li>
    <li><a href="#como-utilizar">Como utilizar</a></li>
  </ul>
</nav></div>
            </div><div class="content" id="content"><p>Rodar um cluster kubernetes local muitas vezes facilita e acelera o desenvolvimento de aplicações, testes ou mesmo criação de pipelines de CI/CD. Dentre as várias opções disponívels para tal, abordarei o Kind, que roda clusters kubernetes locais utilizando-se do Docker.</p>
<h2 id="o-que-é-o-kind---seja-gentil">O que é o Kind - Seja gentil</h2>
<p><strong>D</strong>esenvolver uma aplicação para rodar em um cluster Kubernetes, embora não seja uma tarefa tão difícil, requer muitos testes e deployments, como em qualquer outro tipo de desenvolvimento mas o desafio se torna um pouco maior e caro quando falamos de Kubernetes.</p>
<p><strong>N</strong>em sempre podemos ter uma série de máquinas disponíveis para criarmos um ou mais clusters para testes de forma simples e rápida, certo?! É claro, hoje temos diversos provedores na nuvem (cloud) que podem nos permitir criar um novo cluster Kubernetes em alguns minutos, mas nem sempre esta opção é viável, pois caso você mantenha o cluster rodando por algumas horas o custo começa a pesar.</p>
<p><strong>A</strong>lém disso, dificilmente você irá precisar de apenas algumas horas, certo?! Sua aplicação vai receber atualizações, melhorias, correções de bugs, etc. Tudo isto requer mais desenvolvimento, mais testes, mais deployments, o que significa novamente clusters disponíveis para tais tarefas. Uma forma de reduzir os custos na nuvem para este tipo de rotina é você criar e destruir seus clusters cada vez que for parar de desenvolver/testar. Mas se você faz isso diariamente ou algumas vezes por semana, este trabalho se torna complicado e demandará muito de seu tempo, além de ainda assim lhe custar alguns dólares por cada hora que mantém seu cluster funcionando.</p>
<p><strong>D</strong>iversas alternativas foram criadas com foco nesta necessidade, visando justamente uma forma eficiente, prática e barata para que possamos rodar clusters Kubernetes localmente sem a necessidade de termos múltiplas máquinas, múltiplas VMs ou mesmo clusters na nuvem, como por exemplo no Google Cloud ou AWS.</p>
<p><strong>D</strong>entre estas alternativas, algumas das mais comuns são o Docker em si, que agora trás uma versão simplificada do Kubernetes com apenas um node (master), o kubeadm, minikube, kind, etc.</p>
<p><strong>N</strong>este post falaremos um pouco mais sobre o <a href="https://kind.sigs.k8s.io/" target="_blank" rel="noopener noreffer ">Kind</a>. Kind, que na verdade é uma palavra em inglês que significa gentil, também é uma abreviação para <em>Kubernetes in Docker</em> (Kubernetes em Docker).</p>
<p><strong>D</strong>e acordo com sua página oficial, o Kind é uma ferramenta que lhe permite rodar clusters Kubernetes utilizando-se de Docker containers como nodes. Isso mesmo, cada node do seu cluster, será na verdade um container Docker em sua máquina, o que resultará na verdade em um cluster de containers rodando dentro de outros containers. Parece engraçado e estranho, rodar containers dentro de outros containers, mas lembre-se, o objetivo aqui não é um cluster de produção, e sim uma forma simples e eficiente para testes, desenvolvimento, CI, etc.</p>
<p><strong>D</strong>e fato, o Kind é uma ferramenta tão eficiente neste sentido que é utilizada oficialmente no desenvolvimento do Kubernetes em si, como plataforma de testes.</p>
<p><strong>N</strong>ão seria fantástico poder subir ou deletar um novo cluster em segundos? Todos sabemos o quão rápido é criar um novo container no Docker, certo?! Muito mais rápido que criar uma nova máquina virtual. Da mesma forma, se cada node de nosso cluster será um container, podemos apenas esperar que a criação de um novo cluster seja também rápida.</p>
<p><strong>O</strong> kind utiliza o Containerd como seu Container Runtime ao invés do Dockershim. Apenas estou citando isto devido a todo o barulho criado com a notícia de o Kubernetes estar abandonando o uso do Docker como seu container runtime. Ou seja, o kind não será afetado em nada com isto.</p>
<p><strong>D</strong>iferentemente do Kubernetes que vem em sua instalação Docker, o Kind lhe permitirá facilmente criar múltiplos clusters, com imagens diferentes para os nodes bem como com múltiplos nodes, o que tornará seus testes ainda mais realistas.</p>
<h2 id="instalação">Instalação</h2>
<p><strong>A</strong>qui assumirei que você já possui o <strong>Docker</strong> instalado e funcionando, afinal o Kind criará seus nodes com containers Docker.</p>
<p><strong>A</strong>lém do Docker, assumo que você já possua alguma familiaridade com o Kubernetes e que já possua o <strong>kubectl</strong> instalado.</p>
<h3 id="os-x">OS X</h3>
<p><strong>N</strong>o mac podemos utilizar o gerenciador de pacotes homebrew que cuidará de todas as dependências e configurações de ambiente:</p>
<div class="code-block code-line-numbers open" style="counter-reset: code-block 0">
    <div class="code-header language-bash">
        <span class="code-title"><i class="arrow fas fa-angle-right fa-fw" aria-hidden="true"></i></span>
        <span class="ellipses"><i class="fas fa-ellipsis-h fa-fw" aria-hidden="true"></i></span>
        <span class="copy" title="Copiar para a área de transferência"><i class="far fa-copy fa-fw" aria-hidden="true"></i></span>
    </div><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">$ brew install kind</span></span></code></pre></div></div>
<h3 id="linux">Linux</h3>
<p><strong>P</strong>ara diferentes distribuições Linux o pacote poderá ter um nome diferente em seus repositórios ou mesmo não estar presente nos repositórios, portanto utilizaremos o binário oficial para a instalação aqui:</p>
<div class="code-block code-line-numbers open" style="counter-reset: code-block 0">
    <div class="code-header language-bash">
        <span class="code-title"><i class="arrow fas fa-angle-right fa-fw" aria-hidden="true"></i></span>
        <span class="ellipses"><i class="fas fa-ellipsis-h fa-fw" aria-hidden="true"></i></span>
        <span class="copy" title="Copiar para a área de transferência"><i class="far fa-copy fa-fw" aria-hidden="true"></i></span>
    </div><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">$ curl -Lo ./kind https://kind.sigs.k8s.io/dl/v0.9.0/kind-linux-amd64
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">$ chmod +x ./kind
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">$ mv ./kind /algum-diretório-no-seu-PATH/kind</span></span></code></pre></div></div>
<h3 id="windows">Windows</h3>
<p><strong>C</strong>aso você possua o choco ou chocolatey como gerenciador de pacotes, pode instalar o kind apenas utilizando o seguinte comando:</p>
<div class="code-block code-line-numbers open" style="counter-reset: code-block 0">
    <div class="code-header language-bash">
        <span class="code-title"><i class="arrow fas fa-angle-right fa-fw" aria-hidden="true"></i></span>
        <span class="ellipses"><i class="fas fa-ellipsis-h fa-fw" aria-hidden="true"></i></span>
        <span class="copy" title="Copiar para a área de transferência"><i class="far fa-copy fa-fw" aria-hidden="true"></i></span>
    </div><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">$ choco install kind</span></span></code></pre></div></div>
<p><strong>C</strong>aso não possua este gerenciador de pacotes, pode fazer o download manualmente através do seguinte link: <a href="https://kind.sigs.k8s.io/dl/v0.9.0/kind-windows-amd64" target="_blank" rel="noopener noreffer ">https://kind.sigs.k8s.io/dl/v0.9.0/kind-windows-amd64</a></p>
<p><strong>S</strong>alve o arquivo e lembre-se de <strong>renomeá-lo</strong> para kind.exe. É importante que ele seja salvo em um diretório que faça parte de seu Path, do contrário você precisará incluir o diretório no seu PATH em suas variáveis de ambiente.</p>
<h2 id="como-utilizar">Como utilizar</h2>
<p><strong>A</strong>ntes de mais nada, vejamos se temos algum container rodando em nosso Docker. (Embora isto não seja necessário, queremos ver o que realmente será criado pelo Kind). Para isto utilizaremos o comando <em>docker ps</em> que listará os containers rodando no momento:</p>
<div class="code-block code-line-numbers open" style="counter-reset: code-block 0">
    <div class="code-header language-bash">
        <span class="code-title"><i class="arrow fas fa-angle-right fa-fw" aria-hidden="true"></i></span>
        <span class="ellipses"><i class="fas fa-ellipsis-h fa-fw" aria-hidden="true"></i></span>
        <span class="copy" title="Copiar para a área de transferência"><i class="far fa-copy fa-fw" aria-hidden="true"></i></span>
    </div><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">$ docker ps
</span></span><span class="line"><span class="cl">CONTAINER ID   IMAGE     COMMAND   CREATED   STATUS    PORTS     NAMES</span></span></code></pre></div></div>
<p><strong>Ó</strong>timo, nenhum container foi listado. Não temos nada rodando em nosso Docker.</p>
<p><strong>P</strong>ara criarmos um novo cluster Kubernetes precisamos apenas utilizar o comando <em>kind create cluster &ndash;name <!-- raw HTML omitted --></em>: (Aqui criarei um cluster chamado teste)</p>
<div class="code-block code-line-numbers open" style="counter-reset: code-block 0">
    <div class="code-header language-bash">
        <span class="code-title"><i class="arrow fas fa-angle-right fa-fw" aria-hidden="true"></i></span>
        <span class="ellipses"><i class="fas fa-ellipsis-h fa-fw" aria-hidden="true"></i></span>
        <span class="copy" title="Copiar para a área de transferência"><i class="far fa-copy fa-fw" aria-hidden="true"></i></span>
    </div><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">$ kind create cluster --name teste
</span></span><span class="line"><span class="cl">Creating cluster <span class="s2">&#34;teste&#34;</span> ...
</span></span><span class="line"><span class="cl"> ✓ Ensuring node image <span class="o">(</span>kindest/node:v1.19.1<span class="o">)</span> 🖼
</span></span><span class="line"><span class="cl"> ✓ Preparing nodes 📦
</span></span><span class="line"><span class="cl"> ✓ Writing configuration 📜
</span></span><span class="line"><span class="cl"> ✓ Starting control-plane 🕹️
</span></span><span class="line"><span class="cl"> ✓ Installing CNI 🔌
</span></span><span class="line"><span class="cl"> ✓ Installing StorageClass 💾
</span></span><span class="line"><span class="cl">Set kubectl context to <span class="s2">&#34;kind-teste&#34;</span>
</span></span><span class="line"><span class="cl">You can now use your cluster with:
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">kubectl cluster-info --context kind-teste
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">Have a nice day! 👋</span></span></code></pre></div></div>
<p><strong>O</strong> kind nos informou que tudo ocorreu bem e que nosso cluster foi criado com sucesso. Além disso, ele nos informou que o nome do contexto criado foi <em>kind-teste</em>.</p>
<p><strong>R</strong>epare que ele aparentemente criou apenas o Master node (control-plane), conforme podemos ver na linha <em>✓ Preparing nodes 📦</em>. (Apenas uma caixa).</p>
<p><strong>V</strong>amos novmaente rodar <em>docker ps</em> para ver o que foi criado:</p>
<div class="code-block code-line-numbers open" style="counter-reset: code-block 0">
    <div class="code-header language-bash">
        <span class="code-title"><i class="arrow fas fa-angle-right fa-fw" aria-hidden="true"></i></span>
        <span class="ellipses"><i class="fas fa-ellipsis-h fa-fw" aria-hidden="true"></i></span>
        <span class="copy" title="Copiar para a área de transferência"><i class="far fa-copy fa-fw" aria-hidden="true"></i></span>
    </div><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">$ docker ps
</span></span><span class="line"><span class="cl">CONTAINER ID   IMAGE                  COMMAND                  CREATED         STATUS         PORTS                       NAMES
</span></span><span class="line"><span class="cl">0c468b4d1574   kindest/node:v1.19.1   <span class="s2">&#34;/usr/local/bin/entr…&#34;</span>   <span class="m">3</span> minutes ago   Up <span class="m">3</span> minutes   127.0.0.1:65165-&gt;6443/tcp   teste-control-plane</span></span></code></pre></div></div>
<p><strong>P</strong>odemos ver que de fato apenas um container foi criado, e que se trata de nosso master node ou control-plane.</p>
<p><strong>C</strong>omo podemos ver se nosso cluster está funcional?</p>
<p><strong>S</strong>e você está utilizando o Docker para Desktop que possui Kubernetes nativo e, caso o mesmo esteja com o Kubernetes inicializado, o seu novo cluster provavelmente estará visível na lista de contextos disponíveis em seu docker:</p>
<p><img
        class="lazyload"
        src="/svg/loading.min.svg"
        data-src="/posts/criando-um-cluster-kubernetes-local/kind-1.png"
        data-srcset="/posts/criando-um-cluster-kubernetes-local/kind-1.png, /posts/criando-um-cluster-kubernetes-local/kind-1.png 1.5x, /posts/criando-um-cluster-kubernetes-local/kind-1.png 2x"
        data-sizes="auto"
        alt="/posts/criando-um-cluster-kubernetes-local/kind-1.png"
        title="Docker" width="703" height="403" /></p>
<p><strong>A</strong>o selecionar este contexto <em>kind-teste</em> poderemos a seguir utilizar o kubectl para gerenciar nosso cluster.</p>
<p><strong>O</strong>pcionalmente, você também pode exportar o contexto manualmente com o comando <em>export KUBECONFIG=&quot;$(kind get kubeconfig-path &ndash;name=&ldquo;teste&rdquo;)&quot;</em>.</p>
<p><strong>C</strong>om o cluster criado, podemos listar os clusters existentes no kind com o comando <em>kind get clusters</em>:</p>
<div class="code-block code-line-numbers open" style="counter-reset: code-block 0">
    <div class="code-header language-bash">
        <span class="code-title"><i class="arrow fas fa-angle-right fa-fw" aria-hidden="true"></i></span>
        <span class="ellipses"><i class="fas fa-ellipsis-h fa-fw" aria-hidden="true"></i></span>
        <span class="copy" title="Copiar para a área de transferência"><i class="far fa-copy fa-fw" aria-hidden="true"></i></span>
    </div><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">$ kind get clusters
</span></span><span class="line"><span class="cl">teste</span></span></code></pre></div></div>
<p><strong>E</strong> também podemos pegar informações importante sobre o nosso cluster com o comando <em>kubectl cluster-info &ndash;context kind-teste</em>:</p>
<div class="code-block code-line-numbers open" style="counter-reset: code-block 0">
    <div class="code-header language-bash">
        <span class="code-title"><i class="arrow fas fa-angle-right fa-fw" aria-hidden="true"></i></span>
        <span class="ellipses"><i class="fas fa-ellipsis-h fa-fw" aria-hidden="true"></i></span>
        <span class="copy" title="Copiar para a área de transferência"><i class="far fa-copy fa-fw" aria-hidden="true"></i></span>
    </div><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">$ kubectl cluster-info --context kind-teste
</span></span><span class="line"><span class="cl">Kubernetes master is running at https://127.0.0.1:51908
</span></span><span class="line"><span class="cl">KubeDNS is running at https://127.0.0.1:51908/api/v1/namespaces/kube-system/services/kube-dns:dns/proxy
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">To further debug and diagnose cluster problems, use <span class="s1">&#39;kubectl cluster-info dump&#39;</span>.</span></span></code></pre></div></div>
<p><strong>P</strong>odemos listar nossos nodes com <em>kubectl get nodes</em> e listar todos os pods (inclusive os padrões do sistema kubernetes) com <em>kubectl get pods &ndash;all-namespaces</em>:</p>
<div class="code-block code-line-numbers open" style="counter-reset: code-block 0">
    <div class="code-header language-bash">
        <span class="code-title"><i class="arrow fas fa-angle-right fa-fw" aria-hidden="true"></i></span>
        <span class="ellipses"><i class="fas fa-ellipsis-h fa-fw" aria-hidden="true"></i></span>
        <span class="copy" title="Copiar para a área de transferência"><i class="far fa-copy fa-fw" aria-hidden="true"></i></span>
    </div><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">$ kubectl get nodes
</span></span><span class="line"><span class="cl">NAME                  STATUS   ROLES    AGE   VERSION
</span></span><span class="line"><span class="cl">teste-control-plane   Ready    master   12m   v1.19.1
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">$ kubectl get pods --all-namespaces
</span></span><span class="line"><span class="cl">NAMESPACE            NAME                                          READY   STATUS    RESTARTS   AGE
</span></span><span class="line"><span class="cl">kube-system          coredns-f9fd979d6-254xj                       1/1     Running   <span class="m">0</span>          11m
</span></span><span class="line"><span class="cl">kube-system          coredns-f9fd979d6-s6jlc                       1/1     Running   <span class="m">0</span>          11m
</span></span><span class="line"><span class="cl">kube-system          etcd-teste-control-plane                      1/1     Running   <span class="m">0</span>          12m
</span></span><span class="line"><span class="cl">kube-system          kindnet-6qnl5                                 1/1     Running   <span class="m">0</span>          11m
</span></span><span class="line"><span class="cl">kube-system          kube-apiserver-teste-control-plane            1/1     Running   <span class="m">0</span>          12m
</span></span><span class="line"><span class="cl">kube-system          kube-controller-manager-teste-control-plane   1/1     Running   <span class="m">0</span>          12m
</span></span><span class="line"><span class="cl">kube-system          kube-proxy-fbhnf                              1/1     Running   <span class="m">0</span>          11m
</span></span><span class="line"><span class="cl">kube-system          kube-scheduler-teste-control-plane            1/1     Running   <span class="m">0</span>          12m
</span></span><span class="line"><span class="cl">local-path-storage   local-path-provisioner-78776bfc44-dfcc8       1/1     Running   <span class="m">0</span>          11m</span></span></code></pre></div></div>
<p><strong>C</strong>omo podemos ver, temos todos os pods padrões do Kubernetes, mas nenhum que nós mesmos tenhamos criado.</p>
<p><strong>P</strong>ara deletar o cluster podemos utilizar o comando <em>kind delete cluster &ndash;name teste</em>*:</p>
<div class="code-block code-line-numbers open" style="counter-reset: code-block 0">
    <div class="code-header language-bash">
        <span class="code-title"><i class="arrow fas fa-angle-right fa-fw" aria-hidden="true"></i></span>
        <span class="ellipses"><i class="fas fa-ellipsis-h fa-fw" aria-hidden="true"></i></span>
        <span class="copy" title="Copiar para a área de transferência"><i class="far fa-copy fa-fw" aria-hidden="true"></i></span>
    </div><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">$ kind delete cluster --name teste
</span></span><span class="line"><span class="cl">Deleting cluster <span class="s2">&#34;teste&#34;</span> ...</span></span></code></pre></div></div>
<p><strong>S</strong>imples assim o seu cluster foi deletado.</p>
<p><strong>O</strong> kind permite diversas configurações e cenários, como por exemplo a utilização de arquivos de configuração para as definições do seu cluster.</p>
<p><strong>N</strong>o exemplo a seguir criaremos um arquivo chamado <em>cluster-teste.yml</em> com o seguinte conteúdo:</p>
<div class="code-block code-line-numbers open" style="counter-reset: code-block 0">
    <div class="code-header language-yaml">
        <span class="code-title"><i class="arrow fas fa-angle-right fa-fw" aria-hidden="true"></i></span>
        <span class="ellipses"><i class="fas fa-ellipsis-h fa-fw" aria-hidden="true"></i></span>
        <span class="copy" title="Copiar para a área de transferência"><i class="far fa-copy fa-fw" aria-hidden="true"></i></span>
    </div><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-yaml" data-lang="yaml"><span class="line"><span class="cl"><span class="c"># Configuração para um cluster com 3 nodes (1 master e 2 worker nodes)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l">Cluster</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l">kind.x-k8s.io/v1alpha4</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">nodes</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span>- <span class="nt">role</span><span class="p">:</span><span class="w"> </span><span class="l">control-plane</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span>- <span class="nt">role</span><span class="p">:</span><span class="w"> </span><span class="l">worker</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span>- <span class="nt">role</span><span class="p">:</span><span class="w"> </span><span class="l">worker</span></span></span></code></pre></div></div>
<p><strong>E</strong>m seguida podemos iniciar o nosso cluster com o comando <em>kind create cluster &ndash;name teste &ndash;config cluster-teste.yml</em>:</p>
<div class="code-block code-line-numbers open" style="counter-reset: code-block 0">
    <div class="code-header language-bash">
        <span class="code-title"><i class="arrow fas fa-angle-right fa-fw" aria-hidden="true"></i></span>
        <span class="ellipses"><i class="fas fa-ellipsis-h fa-fw" aria-hidden="true"></i></span>
        <span class="copy" title="Copiar para a área de transferência"><i class="far fa-copy fa-fw" aria-hidden="true"></i></span>
    </div><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">$ kind create cluster --name teste --config cluster-teste.yml
</span></span><span class="line"><span class="cl">Creating cluster <span class="s2">&#34;teste&#34;</span> ...
</span></span><span class="line"><span class="cl"> ✓ Ensuring node image <span class="o">(</span>kindest/node:v1.19.1<span class="o">)</span> 🖼
</span></span><span class="line"><span class="cl"> ✓ Preparing nodes 📦 📦 📦
</span></span><span class="line"><span class="cl"> ✓ Writing configuration 📜
</span></span><span class="line"><span class="cl"> ✓ Starting control-plane 🕹️
</span></span><span class="line"><span class="cl"> ✓ Installing CNI 🔌
</span></span><span class="line"><span class="cl"> ✓ Installing StorageClass 💾
</span></span><span class="line"><span class="cl"> ✓ Joining worker nodes 🚜
</span></span><span class="line"><span class="cl">Set kubectl context to <span class="s2">&#34;kind-teste&#34;</span>
</span></span><span class="line"><span class="cl">You can now use your cluster with:
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">kubectl cluster-info --context kind-teste
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">Have a nice day! 👋</span></span></code></pre></div></div>
<p><strong>R</strong>epare que desta vez a saída do comando nos indicou a criação de 3 nodes. Podemos ver que ele nos apresentou 3 caixas na linha: ✓ Preparing nodes 📦 📦 📦</p>
<p><strong>S</strong>e executarmos o comando <em>docker ps</em> poderemos ver que agora 3 containers foram criados, um para cada node:</p>
<div class="code-block code-line-numbers open" style="counter-reset: code-block 0">
    <div class="code-header language-bash">
        <span class="code-title"><i class="arrow fas fa-angle-right fa-fw" aria-hidden="true"></i></span>
        <span class="ellipses"><i class="fas fa-ellipsis-h fa-fw" aria-hidden="true"></i></span>
        <span class="copy" title="Copiar para a área de transferência"><i class="far fa-copy fa-fw" aria-hidden="true"></i></span>
    </div><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">$ docker ps
</span></span><span class="line"><span class="cl">CONTAINER ID   IMAGE                  COMMAND                  CREATED         STATUS         PORTS                       NAMES
</span></span><span class="line"><span class="cl">41f91c9a0e30   kindest/node:v1.19.1   <span class="s2">&#34;/usr/local/bin/entr…&#34;</span>   <span class="m">2</span> minutes ago   Up <span class="m">2</span> minutes   127.0.0.1:49543-&gt;6443/tcp   teste-control-plane
</span></span><span class="line"><span class="cl">5830cff7f4e8   kindest/node:v1.19.1   <span class="s2">&#34;/usr/local/bin/entr…&#34;</span>   <span class="m">2</span> minutes ago   Up <span class="m">2</span> minutes                               teste-worker
</span></span><span class="line"><span class="cl">094a5c181c00   kindest/node:v1.19.1   <span class="s2">&#34;/usr/local/bin/entr…&#34;</span>   <span class="m">2</span> minutes ago   Up <span class="m">2</span> minutes                               teste-worker2</span></span></code></pre></div></div>
<p><strong>D</strong>a mesma forma podemos ver nossos nodes no cluster:</p>
<div class="code-block code-line-numbers open" style="counter-reset: code-block 0">
    <div class="code-header language-bash">
        <span class="code-title"><i class="arrow fas fa-angle-right fa-fw" aria-hidden="true"></i></span>
        <span class="ellipses"><i class="fas fa-ellipsis-h fa-fw" aria-hidden="true"></i></span>
        <span class="copy" title="Copiar para a área de transferência"><i class="far fa-copy fa-fw" aria-hidden="true"></i></span>
    </div><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">$ kubectl get nodes
</span></span><span class="line"><span class="cl">NAME                  STATUS   ROLES    AGE     VERSION
</span></span><span class="line"><span class="cl">prod1-control-plane   Ready    master   3m29s   v1.19.1
</span></span><span class="line"><span class="cl">prod1-worker          Ready    &lt;none&gt;   2m58s   v1.19.1
</span></span><span class="line"><span class="cl">prod1-worker2         Ready    &lt;none&gt;   2m58s   v1.19.1</span></span></code></pre></div></div>
<p><strong>O</strong> Kind lhe possibilitará uma série de configurações como mapeamento de portas, proxy, ou mesmo versões específicas do Kubernetes, o que é muito útil para fazer testes em sua aplicação antes de realizar uma atualização real do Kubernetes em seu cluster de produção. Todas as configurações podem ser encontradas em detalhes na documentação do projeto.</p>
<p><strong>P</strong>ara fazermos um teste simples e termos certeza de que nosso cluster está de fato funcional e que poderia receber deployments de aplicações vamos rodar um servidor web em nosso cluster local.</p>
<p><strong>C</strong>om o nosso cluster já funcionando com 1 master (control-plane) e 2 workers, vamos criar um deployment e um service para o nosso nginx web server.</p>
<p><strong>P</strong>rimeiramente criaremos um arquivo chamado <em>nginx-deployment.yml</em> com o seguinte conteúdo:</p>
<div class="code-block code-line-numbers open" style="counter-reset: code-block 0">
    <div class="code-header language-yaml">
        <span class="code-title"><i class="arrow fas fa-angle-right fa-fw" aria-hidden="true"></i></span>
        <span class="ellipses"><i class="fas fa-ellipsis-h fa-fw" aria-hidden="true"></i></span>
        <span class="copy" title="Copiar para a área de transferência"><i class="far fa-copy fa-fw" aria-hidden="true"></i></span>
    </div><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-yaml" data-lang="yaml"><span class="line"><span class="cl"><span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l">apps/v1</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l">Deployment</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">metadata</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">nginx-deployment</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">spec</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">selector</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">matchLabels</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">app</span><span class="p">:</span><span class="w"> </span><span class="l">nginx</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">replicas</span><span class="p">:</span><span class="w"> </span><span class="m">2</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">template</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">metadata</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">labels</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="nt">app</span><span class="p">:</span><span class="w"> </span><span class="l">nginx</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">spec</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">containers</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span>- <span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">nginx</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l">nginx:1.16.1</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="nt">ports</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span>- <span class="nt">containerPort</span><span class="p">:</span><span class="w"> </span><span class="m">80</span></span></span></code></pre></div></div>
<p><strong>E</strong>m seguida criaremos o arquivo <em>nginx-service.yml</em>:</p>
<div class="code-block code-line-numbers open" style="counter-reset: code-block 0">
    <div class="code-header language-yaml">
        <span class="code-title"><i class="arrow fas fa-angle-right fa-fw" aria-hidden="true"></i></span>
        <span class="ellipses"><i class="fas fa-ellipsis-h fa-fw" aria-hidden="true"></i></span>
        <span class="copy" title="Copiar para a área de transferência"><i class="far fa-copy fa-fw" aria-hidden="true"></i></span>
    </div><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-yaml" data-lang="yaml"><span class="line"><span class="cl"><span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l">v1</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l">Service</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">metadata</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">nginx-svc</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">labels</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">app</span><span class="p">:</span><span class="w"> </span><span class="l">nginx</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">spec</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="l">NodePort</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">ports</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span>- <span class="nt">port</span><span class="p">:</span><span class="w"> </span><span class="m">80</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">nodePort</span><span class="p">:</span><span class="w"> </span><span class="m">30225</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">selector</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">app</span><span class="p">:</span><span class="w"> </span><span class="l">nginx</span></span></span></code></pre></div></div>
<p>(Não entraremos em detalhes sobre o conteúdo destes arquivos pois o foco do post é o Kind e assumo que você já possui certa familiaridade com o Kubernetes)</p>
<p><strong>C</strong>om nossos dois arquivos criados vamos aplicá-los ao nosso cluster, criando assim um deployment do nginx com duas réplicas e um serviço que irá expôr o nosso deployment:</p>
<div class="code-block code-line-numbers open" style="counter-reset: code-block 0">
    <div class="code-header language-bash">
        <span class="code-title"><i class="arrow fas fa-angle-right fa-fw" aria-hidden="true"></i></span>
        <span class="ellipses"><i class="fas fa-ellipsis-h fa-fw" aria-hidden="true"></i></span>
        <span class="copy" title="Copiar para a área de transferência"><i class="far fa-copy fa-fw" aria-hidden="true"></i></span>
    </div><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">$ kubectl create -f nginx-deployment.yml
</span></span><span class="line"><span class="cl">deployment.apps/nginx-deployment created
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">$ kubectl create -f nginx-service.yml
</span></span><span class="line"><span class="cl">service/nginx-svc created</span></span></code></pre></div></div>
<p><strong>P</strong>odemos confirmar a criação de nosso deployment e de nosso service com os comandos <em>kubectl get deployments</em> e <em>kubectl get services</em>, ou mesmo checar tudo de uma vez com <em>kubectl get all</em>:</p>
<div class="code-block code-line-numbers open" style="counter-reset: code-block 0">
    <div class="code-header language-bash">
        <span class="code-title"><i class="arrow fas fa-angle-right fa-fw" aria-hidden="true"></i></span>
        <span class="ellipses"><i class="fas fa-ellipsis-h fa-fw" aria-hidden="true"></i></span>
        <span class="copy" title="Copiar para a área de transferência"><i class="far fa-copy fa-fw" aria-hidden="true"></i></span>
    </div><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">$ kubectl get all
</span></span><span class="line"><span class="cl">NAME                                    READY   STATUS    RESTARTS   AGE
</span></span><span class="line"><span class="cl">pod/nginx-deployment-559d658b74-5klfx   1/1     Running   <span class="m">0</span>          18m
</span></span><span class="line"><span class="cl">pod/nginx-deployment-559d658b74-zclb2   1/1     Running   <span class="m">0</span>          18m
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">NAME                 TYPE        CLUSTER-IP    EXTERNAL-IP   PORT<span class="o">(</span>S<span class="o">)</span>        AGE
</span></span><span class="line"><span class="cl">service/kubernetes   ClusterIP   10.96.0.1     &lt;none&gt;        443/TCP        22m
</span></span><span class="line"><span class="cl">service/nginx-svc    NodePort    10.96.88.59   &lt;none&gt;        80:30225/TCP   17m
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">NAME                               READY   UP-TO-DATE   AVAILABLE   AGE
</span></span><span class="line"><span class="cl">deployment.apps/nginx-deployment   2/2     <span class="m">2</span>            <span class="m">2</span>           18m
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">NAME                                          DESIRED   CURRENT   READY   AGE
</span></span><span class="line"><span class="cl">replicaset.apps/nginx-deployment-559d658b74   <span class="m">2</span>         <span class="m">2</span>         <span class="m">2</span>       18m</span></span></code></pre></div></div>
<p><strong>A</strong>li podemos ver também que dois pods foram criados rodando o nginx. Isto se dá por termos dito em nosso deployment que queremos 2 replicas do nosso webserver.</p>
<p><strong>P</strong>ara que possamos de fato testar nosso webserver nos resta agora apenas fazer um redirecionamento de portas para que possamos testar localmente. Como nosso serviço está escutando na porta 80, vamos mapear isso na porta 8000 de nossa máquina local (assumindo que nada em sua máquina está utilizando esta porta): <em>kubectl port-forward service/nginx-svc 8000:80</em></p>
<div class="code-block code-line-numbers open" style="counter-reset: code-block 0">
    <div class="code-header language-bash">
        <span class="code-title"><i class="arrow fas fa-angle-right fa-fw" aria-hidden="true"></i></span>
        <span class="ellipses"><i class="fas fa-ellipsis-h fa-fw" aria-hidden="true"></i></span>
        <span class="copy" title="Copiar para a área de transferência"><i class="far fa-copy fa-fw" aria-hidden="true"></i></span>
    </div><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">$ kubectl port-forward service/nginx-svc 8000:80
</span></span><span class="line"><span class="cl">Forwarding from 127.0.0.1:8000 -&gt; <span class="m">80</span>
</span></span><span class="line"><span class="cl">Forwarding from <span class="o">[</span>::1<span class="o">]</span>:8000 -&gt; <span class="m">80</span>
</span></span><span class="line"><span class="cl">Handling connection <span class="k">for</span> <span class="m">8000</span>
</span></span><span class="line"><span class="cl">Handling connection <span class="k">for</span> <span class="m">8000</span></span></span></code></pre></div></div>
<p><strong>A</strong>gora podemos abrir nosso browser e acessar nosso endereço local, na porta 8000: 127.0.0.1:8000</p>
<p><img
        class="lazyload"
        src="/svg/loading.min.svg"
        data-src="/posts/criando-um-cluster-kubernetes-local/kind-2.png"
        data-srcset="/posts/criando-um-cluster-kubernetes-local/kind-2.png, /posts/criando-um-cluster-kubernetes-local/kind-2.png 1.5x, /posts/criando-um-cluster-kubernetes-local/kind-2.png 2x"
        data-sizes="auto"
        alt="/posts/criando-um-cluster-kubernetes-local/kind-2.png"
        title="Docker" width="900" height="350" /></p>
<p><strong>D</strong>a mesma forma que fizemos para inserir worker nodes, podemos inserir também múltiplos Master ou control-planes, para um cluster de alta disponibilidade. As possibilidades com o kind são inúmeras e vale muito a pena ler a documentação do projeto e brincar um pouco com ele.</p></div><div class="post-footer" id="post-footer">
    <div class="post-info">
        <div class="post-info-line">
            <div class="post-info-mod">
                <span>Atualizado em 2021-01-03</span>
            </div></div>
        <div class="post-info-line">
            <div class="post-info-md"></div>
            <div class="post-info-share">
                <span><a href="javascript:void(0);" title="Compartilhe em X" data-sharer="x" data-url="//blog.marcelocavalcante.net:1313/posts/criando-um-cluster-kubernetes-local/" data-title="Criando Um Cluster Kubernetes Local Com O Kind" data-via="Marcelo_Kalib" data-hashtags="Devops,Containers,Kubernetes,Docker,Kind"><i class="fab fa-x-twitter fa-fw" aria-hidden="true"></i></a><a href="javascript:void(0);" title="Compartilhe em Threads" data-sharer="threads" data-url="//blog.marcelocavalcante.net:1313/posts/criando-um-cluster-kubernetes-local/" data-title="Criando Um Cluster Kubernetes Local Com O Kind"><i class="fab fa-threads fa-fw" aria-hidden="true"></i></a><a href="javascript:void(0);" title="Compartilhe em Facebook" data-sharer="facebook" data-url="//blog.marcelocavalcante.net:1313/posts/criando-um-cluster-kubernetes-local/" data-hashtag="Devops"><i class="fab fa-facebook-square fa-fw" aria-hidden="true"></i></a><a href="javascript:void(0);" title="Compartilhe em Linkedin" data-sharer="linkedin" data-url="//blog.marcelocavalcante.net:1313/posts/criando-um-cluster-kubernetes-local/"><i class="fab fa-linkedin fa-fw" aria-hidden="true"></i></a><a href="javascript:void(0);" title="Compartilhe em Hacker News" data-sharer="hackernews" data-url="//blog.marcelocavalcante.net:1313/posts/criando-um-cluster-kubernetes-local/" data-title="Criando Um Cluster Kubernetes Local Com O Kind"><i class="fab fa-hacker-news fa-fw" aria-hidden="true"></i></a><a href="javascript:void(0);" title="Compartilhe em Line" data-sharer="line" data-url="//blog.marcelocavalcante.net:1313/posts/criando-um-cluster-kubernetes-local/" data-title="Criando Um Cluster Kubernetes Local Com O Kind"><i data-svg-src="https://cdn.jsdelivr.net/npm/simple-icons@15.14.0/icons/line.svg" aria-hidden="true"></i></a><a href="javascript:void(0);" title="Compartilhe em 微博" data-sharer="weibo" data-url="//blog.marcelocavalcante.net:1313/posts/criando-um-cluster-kubernetes-local/" data-title="Criando Um Cluster Kubernetes Local Com O Kind"><i class="fab fa-weibo fa-fw" aria-hidden="true"></i></a><a href="javascript:void(0);" title="Compartilhe em Diaspora" data-sharer="diaspora" data-url="//blog.marcelocavalcante.net:1313/posts/criando-um-cluster-kubernetes-local/" data-title="Criando Um Cluster Kubernetes Local Com O Kind" data-description="Rodar um cluster kubernetes local muitas vezes facilita e acelera o desenvolvimento de aplicações, testes ou mesmo criação de pipelines de CI/CD. Dentre as várias opções disponívels para tal, abordarei o Kind, que roda clusters kubernetes locais utilizando-se do Docker."><i class="fab fa-diaspora fa-fw" aria-hidden="true"></i></a><a href="https://t.me/share/url?url=%2f%2fblog.marcelocavalcante.net%3a1313%2fposts%2fcriando-um-cluster-kubernetes-local%2f&amp;text=Criando%20Um%20Cluster%20Kubernetes%20Local%20Com%20O%20Kind" target="_blank" title="Compartilhe em Telegram"><i class="fab fa-telegram fa-fw" aria-hidden="true"></i></a></span>
            </div>
        </div>
    </div>

    <div class="post-info-more">
        <section class="post-tags"><i class="fas fa-tags fa-fw" aria-hidden="true"></i>&nbsp;<a href="/tags/devops/">Devops</a>,&nbsp;<a href="/tags/containers/">Containers</a>,&nbsp;<a href="/tags/kubernetes/">Kubernetes</a>,&nbsp;<a href="/tags/docker/">Docker</a>,&nbsp;<a href="/tags/kind/">Kind</a></section>
        <section>
            <span><a href="javascript:void(0);" onclick="window.history.back();">Voltar</a></span>&nbsp;|&nbsp;<span><a href="/">Home</a></span>
        </section>
    </div>

    <div class="post-nav"><a href="/posts/kubernetes-imperativo-vs-declarativo/" class="prev" rel="prev" title="Kubernetes: Imperativo vs Declarativo"><i class="fas fa-angle-left fa-fw" aria-hidden="true"></i>Kubernetes: Imperativo vs Declarativo</a>
            <a href="/posts/lens-uma-ide-para-o/" class="next" rel="next" title="Lens - Uma IDE para o Kubernetes">Lens - Uma IDE para o Kubernetes<i class="fas fa-angle-right fa-fw" aria-hidden="true"></i></a></div>
</div>
<div id="comments"><div id="disqus_thread" class="comment"></div><noscript>
                Please enable JavaScript to view the comments powered by <a href="https://disqus.com/?ref_noscript">Disqus</a>.
            </noscript></div></article></div>
            </main><footer class="footer">
        <div class="footer-container"><div class="footer-line">Possibilitado por <a href="https://gohugo.io/" target="_blank" rel="noopener noreffer" title="Hugo 0.145.0">Hugo</a> | Tema - <a href="https://github.com/dillonzq/LoveIt" target="_blank" rel="noopener noreffer" title="LoveIt 0.3.1-DEV"><i class="far fa-kiss-wink-heart fa-fw" aria-hidden="true"></i> LoveIt</a>
                </div><div class="footer-line" itemscope itemtype="http://schema.org/CreativeWork"><i class="far fa-copyright fa-fw" aria-hidden="true"></i><span itemprop="copyrightYear">2008 - 2025</span><span class="author" itemprop="copyrightHolder">&nbsp;<a href="https://blog.marcelocavalcante.net" target="_blank">Marcelo Cavalcante</a></span></div>
        </div>
    </footer></div>

        <div id="fixed-buttons"><a href="#" id="back-to-top" class="fixed-button" title="Voltar ao topo">
                <i class="fas fa-arrow-up fa-fw" aria-hidden="true"></i>
            </a>
        </div>

        <div id="fixed-buttons-hidden"><a href="#" id="view-comments" class="fixed-button" title="Ver comentários">
                <i class="fas fa-comment fa-fw" aria-hidden="true"></i>
            </a>
        </div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/lightgallery@2.5.0/css/lightgallery-bundle.min.css"><script src="https://marcelokalib.disqus.com/embed.js" defer></script><script src="https://cdn.jsdelivr.net/npm/autocomplete.js@0.38.1/dist/autocomplete.min.js"></script><script src="https://cdn.jsdelivr.net/npm/lunr@2.3.9/lunr.min.js"></script><script src="/lib/lunr/lunr.stemmer.support.min.js"></script><script src="/lib/lunr/lunr.pt.min.js"></script><script src="https://cdn.jsdelivr.net/npm/lazysizes@5.3.2/lazysizes.min.js"></script><script src="https://cdn.jsdelivr.net/npm/lightgallery@2.5.0/lightgallery.min.js"></script><script src="https://cdn.jsdelivr.net/npm/lightgallery@2.5.0/plugins/thumbnail/lg-thumbnail.min.js"></script><script src="https://cdn.jsdelivr.net/npm/lightgallery@2.5.0/plugins/zoom/lg-zoom.min.js"></script><script src="https://cdn.jsdelivr.net/npm/clipboard@2.0.11/dist/clipboard.min.js"></script><script src="https://cdn.jsdelivr.net/npm/sharer.js@0.5.2/sharer.min.js"></script><script>window.config={"comment":{},"lightgallery":true,"search":{"highlightTag":"em","lunrIndexURL":"/index.json","lunrLanguageCode":"pt","maxResultLength":10,"noResultsFound":"Nenhum resultado encontrado","snippetLength":30,"type":"lunr"}};</script><script src="/js/theme.min.js"></script></body>
</html>

<script>
    document.addEventListener('DOMContentLoaded', function() {
        var searchIndex;

        fetch('/lunr.json')
            .then(response => response.json())
            .then(data => {
                searchIndex = lunr(function () {
                    this.field('title');
                    this.field('content');
                    this.field('tags');
                    this.ref('uri');

                    data.forEach(doc => {
                        this.add(doc);
                    });
                });
            });

        function performSearch(query) {
            if (searchIndex) {
                var results = searchIndex.search(query);
                displayResults(results);
            }
        }

        function displayResults(results) {
            var resultsContainer = document.getElementById('search-results');
            resultsContainer.innerHTML = '';
            results.forEach(result => {
                var item = document.createElement('div');
                item.innerHTML = `<a href="${result.ref}">${result.ref}</a>`;
                resultsContainer.appendChild(item);
            });
        }

        var searchInputDesktop = document.getElementById('search-input-desktop');
        if (searchInputDesktop) {
            searchInputDesktop.addEventListener('input', function() {
                performSearch(searchInputDesktop.value);
            });
        }

        var searchInputMobile = document.getElementById('search-input-mobile');
        if (searchInputMobile) {
            searchInputMobile.addEventListener('input', function() {
                performSearch(searchInputMobile.value);
            });
        }
    });
</script>
