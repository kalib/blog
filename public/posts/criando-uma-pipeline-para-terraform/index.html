<!DOCTYPE html>
<html lang="pt-BR">
    <head><script src="/livereload.js?mindelay=10&amp;v=2&amp;port=1313&amp;path=livereload" data-no-instant defer></script>
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="robots" content="noodp" />
        <title>Criando Uma Pipeline Para Terraform Com o Gitlab - Marcelo Cavalcante Rocha</title><meta name="Description" content="Integração contínua (CI) e entrega contínua (CD) são termos bastante utilizados em equipes ágeis e de alta performance. São termos fundamentais na cultura e no dia a dia de uma equipe DevOps. Demonstrarei como podemos criar uma eficiente pipeline para Terraform com o Gitlab."><meta property="og:url" content="//blog.marcelocavalcante.net:1313/posts/criando-uma-pipeline-para-terraform/">
  <meta property="og:site_name" content="Marcelo Cavalcante Rocha">
  <meta property="og:title" content="Criando Uma Pipeline Para Terraform Com o Gitlab">
  <meta property="og:description" content="Integração contínua (CI) e entrega contínua (CD) são termos bastante utilizados em equipes ágeis e de alta performance. São termos fundamentais na cultura e no dia a dia de uma equipe DevOps. Demonstrarei como podemos criar uma eficiente pipeline para Terraform com o Gitlab.">
  <meta property="og:locale" content="pt_BR">
  <meta property="og:type" content="article">
    <meta property="article:section" content="posts">
    <meta property="article:published_time" content="2020-02-17T12:50:52-04:00">
    <meta property="article:modified_time" content="2020-02-17T12:50:52-04:00">
    <meta property="article:tag" content="Devops">
    <meta property="article:tag" content="Gitlab">
    <meta property="article:tag" content="Terraform">
    <meta property="article:tag" content="Cloud">
    <meta property="article:tag" content="AWS">
    <meta property="article:tag" content="CI">
    <meta property="og:image" content="//blog.marcelocavalcante.net:1313/posts/criando-uma-pipeline-para-terraform/featured-image.png">

  <meta name="twitter:card" content="summary_large_image">
  <meta name="twitter:image" content="//blog.marcelocavalcante.net:1313/posts/criando-uma-pipeline-para-terraform/featured-image.png">
  <meta name="twitter:title" content="Criando Uma Pipeline Para Terraform Com o Gitlab">
  <meta name="twitter:description" content="Integração contínua (CI) e entrega contínua (CD) são termos bastante utilizados em equipes ágeis e de alta performance. São termos fundamentais na cultura e no dia a dia de uma equipe DevOps. Demonstrarei como podemos criar uma eficiente pipeline para Terraform com o Gitlab.">
<meta name="application-name" content="Marcelo Cavalcante">
<meta name="apple-mobile-web-app-title" content="Marcelo Cavalcante">
<meta name="referrer" content="no-referrer" /><meta name="theme-color" content="#ffffff"><meta name="msapplication-TileColor" content="#da532c"><link rel="shortcut icon" type="image/x-icon" href="/favicon.ico" />
        <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
        <link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png"><link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png"><link rel="mask-icon" href="/safari-pinned-tab.svg" color="#5bbad5"><link rel="manifest" href="/site.webmanifest"><link rel="canonical" href="//blog.marcelocavalcante.net:1313/posts/criando-uma-pipeline-para-terraform/" /><link rel="prev" href="//blog.marcelocavalcante.net:1313/posts/terraform-modules-porque-e-como/" /><link rel="next" href="//blog.marcelocavalcante.net:1313/posts/kubernetes-imperativo-vs-declarativo/" /><link rel="stylesheet" href="/css/style.min.css"><link rel="preload" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.7.2/css/all.min.css" as="style" onload="this.onload=null;this.rel='stylesheet'">
        <noscript><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.7.2/css/all.min.css"></noscript><link rel="preload" href="https://cdn.jsdelivr.net/npm/animate.css@4.1.1/animate.min.css" as="style" onload="this.onload=null;this.rel='stylesheet'">
        <noscript><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/animate.css@4.1.1/animate.min.css"></noscript><script type="application/ld+json">
    {
        "@context": "http://schema.org",
        "@type": "BlogPosting",
        "headline": "Criando Uma Pipeline Para Terraform Com o Gitlab",
        "inLanguage": "pt-BR",
        "mainEntityOfPage": {
            "@type": "WebPage",
            "@id": "\/\/blog.marcelocavalcante.net:1313\/posts\/criando-uma-pipeline-para-terraform\/"
        },"image": [{
                            "@type": "ImageObject",
                            "url": "\/\/blog.marcelocavalcante.net:1313\/posts\/criando-uma-pipeline-para-terraform\/featured-image.png",
                            "width":  1400 ,
                            "height":  600 
                        }],"genre": "posts","keywords": "Devops, Gitlab, Terraform, Cloud, AWS, CI, CD, Pipeline","wordcount":  3377 ,
        "url": "\/\/blog.marcelocavalcante.net:1313\/posts\/criando-uma-pipeline-para-terraform\/","datePublished": "2020-02-17T12:50:52-04:00","dateModified": "2020-02-17T12:50:52-04:00","publisher": {
            "@type": "Organization",
            "name": ""},"author": {
                "@type": "Person",
                "name": "Marcelo Cavalcante"
            },"description": "Integração contínua (CI) e entrega contínua (CD) são termos bastante utilizados em equipes ágeis e de alta performance. São termos fundamentais na cultura e no dia a dia de uma equipe DevOps. Demonstrarei como podemos criar uma eficiente pipeline para Terraform com o Gitlab."
    }
    </script><script src="https://cdnjs.cloudflare.com/ajax/libs/lunr.js/2.3.9/lunr.min.js"></script>
    </head>
    <body data-header-desktop="fixed" data-header-mobile="auto"><script>
          const query = window.matchMedia('(prefers-color-scheme: dark)');
          function applyTheme() {
            let theme = window.localStorage?.getItem('theme') || 'auto';
            let isDark = theme === 'dark' || (theme === 'auto' && query.matches);
            document.body.setAttribute('theme', isDark? 'dark' : 'light');
            document.body.setAttribute('cfg-theme', theme);
          }

          applyTheme();
          query.addEventListener('change', applyTheme);
        </script>

        <div id="mask"></div><div class="wrapper"><header class="desktop" id="header-desktop">
    <div class="header-wrapper">
        <div class="header-title">
            <a href="/" title="Marcelo Cavalcante Rocha"><img
        class="lazyload logo"
        src="/svg/loading.min.svg"
        data-src="https://marcelocavalcante.net/ftp/logonew.png"
        data-srcset="https://marcelocavalcante.net/ftp/logonew.png, https://marcelocavalcante.net/ftp/logonew.png 1.5x, https://marcelocavalcante.net/ftp/logonew.png 2x"
        data-sizes="auto"
        alt="https://marcelocavalcante.net/ftp/logonew.png"
        title="https://marcelocavalcante.net/ftp/logonew.png" /></a>
        </div>
        <div class="menu">
            <div class="menu-inner"><a class="menu-item" href="/" title="Return to home page"><i class='fas fa-home'></i> Home </a><a class="menu-item" href="/posts/"> Posts </a><a class="menu-item" href="/tags/"> Tags </a><a class="menu-item" href="/categories/"> Categorias </a><a class="menu-item" href="/sobre/"> Quem Sou </a><span class="menu-item delimiter"></span><span class="menu-item search" id="search-desktop">
                        <input type="text" placeholder="Pesquisar títulos ou conteúdos ..." id="search-input-desktop">
                        <a href="javascript:void(0);" class="search-button search-toggle" id="search-toggle-desktop" title="Pesquisa">
                            <i class="fas fa-search fa-fw" aria-hidden="true"></i>
                        </a>
                        <a href="javascript:void(0);" class="search-button search-clear" id="search-clear-desktop" title="Limpar">
                            <i class="fas fa-times-circle fa-fw" aria-hidden="true"></i>
                        </a>
                        <span class="search-button search-loading" id="search-loading-desktop">
                            <i class="fas fa-spinner fa-fw fa-spin" aria-hidden="true"></i>
                        </span>
                    </span><a href="javascript:void(0);" class="menu-item theme-switch" title="Trocar tema">
                    <i class="fas fa-adjust fa-fw" aria-hidden="true"></i>
                </a></div>
        </div>
    </div>
</header><header class="mobile" id="header-mobile">
    <div class="header-container">
        <div class="header-wrapper">
            <div class="header-title">
                <a href="/" title="Marcelo Cavalcante Rocha"><img
        class="lazyload logo"
        src="/svg/loading.min.svg"
        data-src="https://marcelocavalcante.net/ftp/logonew.png"
        data-srcset="https://marcelocavalcante.net/ftp/logonew.png, https://marcelocavalcante.net/ftp/logonew.png 1.5x, https://marcelocavalcante.net/ftp/logonew.png 2x"
        data-sizes="auto"
        alt="https://marcelocavalcante.net/ftp/logonew.png"
        title="https://marcelocavalcante.net/ftp/logonew.png" /></a>
            </div>
            <div class="menu-toggle" id="menu-toggle-mobile">
                <span></span><span></span><span></span>
            </div>
        </div>
        <div class="menu" id="menu-mobile"><div class="search-wrapper">
                    <div class="search mobile" id="search-mobile">
                        <input type="text" placeholder="Pesquisar títulos ou conteúdos ..." id="search-input-mobile">
                        <a href="javascript:void(0);" class="search-button search-toggle" id="search-toggle-mobile" title="Pesquisa">
                            <i class="fas fa-search fa-fw" aria-hidden="true"></i>
                        </a>
                        <a href="javascript:void(0);" class="search-button search-clear" id="search-clear-mobile" title="Limpar">
                            <i class="fas fa-times-circle fa-fw" aria-hidden="true"></i>
                        </a>
                        <span class="search-button search-loading" id="search-loading-mobile">
                            <i class="fas fa-spinner fa-fw fa-spin" aria-hidden="true"></i>
                        </span>
                    </div>
                    <a href="javascript:void(0);" class="search-cancel" id="search-cancel-mobile">
                        Cancelar
                    </a>
                </div><a class="menu-item" href="/" title="Return to home page"><i class='fas fa-home'></i>Home</a><a class="menu-item" href="/posts/" title="">Posts</a><a class="menu-item" href="/tags/" title="">Tags</a><a class="menu-item" href="/categories/" title="">Categorias</a><a class="menu-item" href="/sobre/" title="">Quem Sou</a><a href="javascript:void(0);" class="menu-item theme-switch" title="Trocar tema">
                <i class="fas fa-adjust fa-fw" aria-hidden="true"></i>
            </a></div>
    </div>
</header><div class="search-dropdown desktop">
        <div id="search-dropdown-desktop"></div>
    </div>
    <div class="search-dropdown mobile">
        <div id="search-dropdown-mobile"></div>
    </div><main class="main">
                <div class="container"><div class="toc" id="toc-auto">
            <h2 class="toc-title">Conteúdos</h2>
            <div class="toc-content" id="toc-content-auto"></div>
        </div><article class="page single"><h1 class="single-title animate__animated animate__flipInX">Criando Uma Pipeline Para Terraform Com o Gitlab</h1><div class="post-meta">
            <div class="post-meta-line"><span class="post-author"><a href="https://blog.marcelocavalcante.net" title="Author" target="_blank" rel="noopener noreffer author" class="author"><i class="fas fa-user-circle fa-fw" aria-hidden="true"></i>Marcelo Cavalcante</a></span>&nbsp;<span class="post-category">incluido em <a href="/categories/tutoriais/"><i class="far fa-folder fa-fw" aria-hidden="true"></i>Tutoriais</a></span></div>
            <div class="post-meta-line"><i class="far fa-calendar-alt fa-fw" aria-hidden="true"></i>&nbsp;<time datetime="2020-02-17">2020-02-17</time>&nbsp;<i class="fas fa-pencil-alt fa-fw" aria-hidden="true"></i>&nbsp;3377 palavras&nbsp;
                <i class="far fa-clock fa-fw" aria-hidden="true"></i>&nbsp;16 minutos&nbsp;</div>
        </div><div class="featured-image"><img
        class="lazyload"
        src="/svg/loading.min.svg"
        data-src="/posts/criando-uma-pipeline-para-terraform/featured-image.png"
        data-srcset="/posts/criando-uma-pipeline-para-terraform/featured-image.png, /posts/criando-uma-pipeline-para-terraform/featured-image.png 1.5x, /posts/criando-uma-pipeline-para-terraform/featured-image.png 2x"
        data-sizes="auto"
        alt="/posts/criando-uma-pipeline-para-terraform/featured-image.png"
        title="Integração contínua (CI) e entrega contínua (CD) são termos bastante utilizados em equipes ágeis e de alta performance. São termos fundamentais na cultura e no dia a dia de uma equipe DevOps. Demonstrarei como podemos criar uma eficiente pipeline para Terraform com o Gitlab." /></div><div class="details toc" id="toc-static"  data-kept="">
                <div class="details-summary toc-title">
                    <span>Conteúdos</span>
                    <span><i class="details-icon fas fa-angle-right" aria-hidden="true"></i></span>
                </div>
                <div class="details-content toc-content" id="toc-content-static"><nav id="TableOfContents">
  <ul>
    <li><a href="#integração-contínua-ci-e-entrega-contínua-cd">Integração Contínua (CI) e Entrega Contínua (CD)</a></li>
    <li><a href="#gitlab">Gitlab</a></li>
    <li><a href="#terraform">Terraform?</a></li>
    <li><a href="#nosso-projeto">Nosso projeto</a>
      <ul>
        <li><a href="#assumindo-que">Assumindo que&hellip;</a></li>
        <li><a href="#criando-um-repositório-para-nosso-código">Criando um repositório para nosso código</a></li>
      </ul>
    </li>
  </ul>
</nav></div>
            </div><div class="content" id="content"><p>Integração contínua (CI) e entrega contínua (CD) são termos bastante utilizados em equipes ágeis e de alta performance. São termos fundamentais na cultura e no dia a dia de uma equipe DevOps. Demonstrarei como podemos criar uma eficiente pipeline para Terraform com o Gitlab.</p>
<h2 id="integração-contínua-ci-e-entrega-contínua-cd">Integração Contínua (CI) e Entrega Contínua (CD)</h2>
<p><strong>M</strong>uito se fala em <strong>Integração Contínua</strong> (<em>Continuous Integration - CI</em>) e <strong>Entrega Contínua</strong> (<em>Continuous Delivery - CD</em>) em equipes ágeis e de alta performance e que seguem uma filosofia ágil ou DevOps.</p>
<p><strong>R</strong>esumidamente, são metodologias que buscam a utilização de processos e ferramentas específicas com o intuito de realizar uma entrega rápida de novas versões de software ou mesmo infraestrutura, porque não?</p>
<p><strong>S</strong>upondo que sua equipe de desenvolvimento de software segue alguns passos em seu ciclo diário de desenvolvimento de código até a entrega final da aplicação ou deployment, você poderia ter um ciclo similar ao seguinte:</p>
<ol>
<li>Submeter o código atualizado para um repositório Git;</li>
<li>Compilação ou build do código;</li>
<li>Rodar alguns testes neste código em um ambiente qualquer para validação das alterações realizadas;</li>
<li>Execução de alguns testes de segurança com uma ferramenta terceira em cima de seu código;</li>
<li>Realizar a entrega ou deployment do código em si.</li>
</ol>
<p><img
        class="lazyload"
        src="/svg/loading.min.svg"
        data-src="/posts/criando-uma-pipeline-para-terraform/cicd.png"
        data-srcset="/posts/criando-uma-pipeline-para-terraform/cicd.png, /posts/criando-uma-pipeline-para-terraform/cicd.png 1.5x, /posts/criando-uma-pipeline-para-terraform/cicd.png 2x"
        data-sizes="auto"
        alt="/posts/criando-uma-pipeline-para-terraform/cicd.png"
        title="CI/CD" width="600" height="286" /></p>
<p><strong>A</strong> ideia de se ter um ciclo de Integração contínua e entrega contínua surge justamente para automatizar e acelerar este processo.</p>
<p><strong>A</strong>s chamadas <strong>pipelines</strong> são justamente uma forma de automatizar estes passos através de uma ou mais ferramentas de forma que um processo antes demorado e executado manualmente por uma ou mais pessoas agora passa a ser executado automaticamente e de forma contínua, preferivelmente diversas vezes ao dia ou conforme a equipe for disponibilizando novas versões do código.</p>
<h2 id="gitlab">Gitlab</h2>
<p><img
        class="lazyload"
        src="/svg/loading.min.svg"
        data-src="gitlab.png"
        data-srcset="gitlab.png, gitlab.png 1.5x, gitlab.png 2x"
        data-sizes="auto"
        alt="gitlab.png"
        title="Gitlab" /></p>
<p><strong>G</strong>itLab é uma ferramenta que busca ser uma espécie de &ldquo;tudo em um&rdquo; quando o assunto são ciclos de desenvolvimento ágeis. Basicamente é uma ferramenta web para o ciclo de vida de projetos DevOps que, embora originalmente fosse bem mais limitada, atuando apenas como uma opcão para repositórios Git, hoje é uma ferramenta robusta e engloba diversas soluções como repositórios, tarefas/tickets, wiki, pipelines CI/CD, etc.</p>
<p><strong>E</strong>mbora tenha sido originalmente desenvolvida em Ruby, alguns de seus componentes foram re-escritos em Go.</p>
<p><strong>P</strong>ermitindo o controle e gerenciamento de todo o seu ciclo de desenvolvimento de forma colaborativa, GitLab é considerado o primeiro Unicórnio da Ucrânia, ou seja, uma startup avaliada em mais de 1 bilhão de dólares.</p>
<p><strong>A</strong>lém de grandes empresas e organizações como Alibaba, Trivago, Ticketmaster, Cloud Native Foundation, AVG, Siemens, Avast, BlackBerry, Broadcom, Capgemini, Citrix, EA Sports, Ericsoon, Expedia, Nasa, Nasdaq, Governo do Canadá, Interpol, Telus, Nutanix, RedHat, SanDisk, Sony, Trend Micro, Uber, Verizon e muitas outras, o GitLab também é muito popular entre projetos de software livre ou mesmo profissionais independentes e estudantes.</p>
<p><strong>S</strong>im, existem diversas outras soluções para criação de pipelines CI/CD, como Jenkins, Circle CI, Bitbucket, etc. Mas, como mencionei mais acima, o GitLab trás muito mais do que apenas a ferramenta de pipelines.</p>
<p><strong>O</strong>utro fator que me faz adorar este projeto é a possibilidade de utilizá-lo gratuitamente sem qualquer necessidade de instalação ou configuração. Ao contrário do Jenkins, eu não preciso instalar uma VM para ser meu servidor Jenkins para as pipelines. GitLab está disponível online e de forma gratuita para pequenos projetos, incluindo a utilização gratuita de <em>workers</em> que são os &ldquo;trabalhadores&rdquo;, digamos assim. São containers criados e destruidos automaticamente durante as execuções de suas pipelines.</p>
<p><strong>S</strong>em mais enrolação&hellip; vamos ao que interessa.</p>
<h2 id="terraform">Terraform?</h2>
<p><strong>O</strong> objetivo deste post não é ensinar Terraform, portanto não adentraremos a fundo nisto.</p>
<p><strong>C</strong>aso você não possua alguma familiaridade com Terraform, sugiro que pause esta leitura e volte um pouco. Recomendo a leitura de meus posts anteriores antes de seguir com este:</p>
<ul>
<li><a href="/posts/infraestrutura-como-codigo-com-terraform/" rel="">Infraestrutura como Código com Terraform</a></li>
<li><a href="/posts/introducao-ao-terraform/" rel="">Introdução ao Terraform</a></li>
<li><a href="/posts/terraform-variaveis-e-outputs/" rel="">Terraform: Variáveis e Outputs</a></li>
<li><a href="/posts/terraform-criando-uma-infraestrutura-no/" rel="">Terraform: Criando uma infraestrutura no Google Cloud</a></li>
<li><a href="/posts/terraform-modules-porque-e-comop1/" rel="">Terraform Modules: Porquê E Como Trabalhar Com Módulos No Terraform - PARTE 1</a></li>
<li><a href="/posts/terraform-modules-porque-e-como/" rel="">Terraform Modules: Porquê E Como Trabalhar Com Módulos No Terraform - PARTE 2</a></li>
</ul>
<h2 id="nosso-projeto">Nosso projeto</h2>
<h3 id="assumindo-que">Assumindo que&hellip;</h3>
<p><strong>P</strong>ara este post estou assumindo que você já atende aos seguintes pré-requisitos:</p>
<ol>
<li>Já possui alguma familiaridade com o Terraform (conforme citei acima);</li>
<li>Já possui o git instalado e também possui alguma familiaridade com o mesmo;</li>
<li>Já possui uma conta AWS caso queira utilizar exatamente este código que utilizarei ou que possua familiaridade suficiente com o Terraform para criar  seu próprio código sem utilizar o AWS como <em>provider</em>;</li>
<li>Além de possuir uma conta AWS, estou assumindo que você já configurou seu ambiente exportando as variáveis de ambiente de sua chave e senha do AWS para que seu Terraform consiga se comunicar com sua conta AWS (Se também não faz ideia de o que é ou como isto é feito, volte um pouco: <a href="/posts/terraform-modules-porque-e-comop1/" rel="">Terraform Modules: Porquê E Como Trabalhar Com Módulos No Terraform - PARTE 1</a>)</li>
</ol>
<h3 id="criando-um-repositório-para-nosso-código">Criando um repositório para nosso código</h3>
<p><strong>O</strong> primeiro passo é criar uma conta gratuita em <a href="https://www.gitlab.com" target="_blank" rel="noopener noreffer ">Gitlab.com</a>.</p>
<p><strong>A</strong>o criar sua conta, um email lhe será enviado para confirmação de endereço. Valide seu email clicando no link que lhe será enviado.</p>
<p><strong>Q</strong>uando logamos pela primeira vez em nossa conta do GitLab, veremos algo similar à seguinte tela.</p>
<p><strong>C</strong>lique em <em>Create a project</em> ou Criar um projeto.</p>
<p><img
        class="lazyload"
        src="/svg/loading.min.svg"
        data-src="/posts/criando-uma-pipeline-para-terraform/gitlab_1.png"
        data-srcset="/posts/criando-uma-pipeline-para-terraform/gitlab_1.png, /posts/criando-uma-pipeline-para-terraform/gitlab_1.png 1.5x, /posts/criando-uma-pipeline-para-terraform/gitlab_1.png 2x"
        data-sizes="auto"
        alt="/posts/criando-uma-pipeline-para-terraform/gitlab_1.png"
        title="Gitlab" width="600" height="413" /></p>
<p><strong>N</strong>a tela seguinte, crie o seu projeto com o nome e descrição que preferir, similar ao exemplo a seguir:</p>
<p><img
        class="lazyload"
        src="/svg/loading.min.svg"
        data-src="/posts/criando-uma-pipeline-para-terraform/gitlab_2.png"
        data-srcset="/posts/criando-uma-pipeline-para-terraform/gitlab_2.png, /posts/criando-uma-pipeline-para-terraform/gitlab_2.png 1.5x, /posts/criando-uma-pipeline-para-terraform/gitlab_2.png 2x"
        data-sizes="auto"
        alt="/posts/criando-uma-pipeline-para-terraform/gitlab_2.png"
        title="Gitlab" width="800" height="550" /></p>
<p><strong>E</strong>mbora você possa escolher entre privado ou público, sugiro que defina seu repositório como privado inicialmente, apenas para evitar algum erro. Se você ainda não possui familiaridade com o Terraform e com o GitLab, não queremos correr o risco de deixar senhas ou dados confidenciais (como chaves do AWS) em seu código publicamente acessível, certo?!</p>
<p><strong>A</strong>o preencher tudo e clicar em <em>Create project</em> ou Criar projeto você será levado para a seguinte tela:</p>
<p><img
        class="lazyload"
        src="/svg/loading.min.svg"
        data-src="/posts/criando-uma-pipeline-para-terraform/gitlab_3.png"
        data-srcset="/posts/criando-uma-pipeline-para-terraform/gitlab_3.png, /posts/criando-uma-pipeline-para-terraform/gitlab_3.png 1.5x, /posts/criando-uma-pipeline-para-terraform/gitlab_3.png 2x"
        data-sizes="auto"
        alt="/posts/criando-uma-pipeline-para-terraform/gitlab_3.png"
        title="Gitlab" width="800" height="648" /></p>
<p><strong>O</strong> alerta que o GitLab nos dá acima é justamente nos informando que ainda não possuímos uma <strong>chave ssh</strong> cadastrada em nossa conta. A chave é utilizada para que possamos interagir com nosso repositório de forma segura, via ssh. Começaremos então resolvendo esta &ldquo;pendência&rdquo;. Você pode fazê-lo de duas formas:</p>
<p>1- Clicando diretamente no alerta, em *<em>add an SSH key</em> (adicionar uma chave ssh);</p>
<p>2.1- Clicando no menu principal de sua conta, no canto superior direito, conforme imagem abaixo;</p>
<p><img
        class="lazyload"
        src="/svg/loading.min.svg"
        data-src="/posts/criando-uma-pipeline-para-terraform/gitlab_4.png"
        data-srcset="/posts/criando-uma-pipeline-para-terraform/gitlab_4.png, /posts/criando-uma-pipeline-para-terraform/gitlab_4.png 1.5x, /posts/criando-uma-pipeline-para-terraform/gitlab_4.png 2x"
        data-sizes="auto"
        alt="/posts/criando-uma-pipeline-para-terraform/gitlab_4.png"
        title="Gitlab" width="350" height="280" /></p>
<p>2.2- No menu lateral esquerdo, clique em <em>SSH Keys</em> (Chaves SSH);</p>
<p><img
        class="lazyload"
        src="/svg/loading.min.svg"
        data-src="/posts/criando-uma-pipeline-para-terraform/gitlab_5.png"
        data-srcset="/posts/criando-uma-pipeline-para-terraform/gitlab_5.png, /posts/criando-uma-pipeline-para-terraform/gitlab_5.png 1.5x, /posts/criando-uma-pipeline-para-terraform/gitlab_5.png 2x"
        data-sizes="auto"
        alt="/posts/criando-uma-pipeline-para-terraform/gitlab_5.png"
        title="Gitlab" width="500" height="456" /></p>
<p><strong>S</strong>eguindo qualquer um dos módulos acima, você cairá na página de chaves ssh. Cole a sua chave ssh e dê um nome ou apelido para ela, conforme exemplo abaixo (Utilize sua chave pública, não a privada):</p>
<p><img
        class="lazyload"
        src="/svg/loading.min.svg"
        data-src="/posts/criando-uma-pipeline-para-terraform/gitlab_6.png"
        data-srcset="/posts/criando-uma-pipeline-para-terraform/gitlab_6.png, /posts/criando-uma-pipeline-para-terraform/gitlab_6.png 1.5x, /posts/criando-uma-pipeline-para-terraform/gitlab_6.png 2x"
        data-sizes="auto"
        alt="/posts/criando-uma-pipeline-para-terraform/gitlab_6.png"
        title="Gitlab" width="670" height="431" /></p>
<p><strong>A</strong>pós preencher, clique em <em>Add key</em> (Adicionar chave).</p>
<p><strong>C</strong>om sua chave devidamente adicionada, podemos testar se está tudo funcionando de forma simples, clonando nosso repositório.</p>
<p><strong>E</strong>m um terminal qualquer, navegue até um diretório de sua preferência e clone o seu repositório: (Estou assumindo que você já possua o git instalado)</p>
<p><strong>C</strong>lique no botão <em>Clone</em> no canto superior direito da página principal de seu projeto e copie o comando <em>SSH</em> que lhe será apresentado. Em seguida utilize este comando para clonar seu repositório:</p>
<p><img
        class="lazyload"
        src="/svg/loading.min.svg"
        data-src="/posts/criando-uma-pipeline-para-terraform/gitlab_7.png"
        data-srcset="/posts/criando-uma-pipeline-para-terraform/gitlab_7.png, /posts/criando-uma-pipeline-para-terraform/gitlab_7.png 1.5x, /posts/criando-uma-pipeline-para-terraform/gitlab_7.png 2x"
        data-sizes="auto"
        alt="/posts/criando-uma-pipeline-para-terraform/gitlab_7.png"
        title="Gitlab" width="800" height="505" /></p>
<p><strong>C</strong>lone com: (Substituindo o endereço pelo que lhe foi informado no Gitlab, conforme imagem acima)</p>
<div class="code-block code-line-numbers open" style="counter-reset: code-block 0">
    <div class="code-header language-bash">
        <span class="code-title"><i class="arrow fas fa-angle-right fa-fw" aria-hidden="true"></i></span>
        <span class="ellipses"><i class="fas fa-ellipsis-h fa-fw" aria-hidden="true"></i></span>
        <span class="copy" title="Copiar para a área de transferência"><i class="far fa-copy fa-fw" aria-hidden="true"></i></span>
    </div><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">$ git clone git@gitlab.com:marcelokalibtest/terraform-gitlab-kalib.git</span></span></code></pre></div></div>
<p><strong>S</strong>e tudo funcionou como o esperado, você deverá agora ter um diretório com o nome do seu repositório e poderá ver que o único arquivo nele até então é o arquivo de documentação padrão <em>README.md</em>.</p>
<p><strong>A</strong>gora que temos nossa conta no Gitlab funcionando com nossa chave SSH e nosso repositório clonado localmente, nosso próximo passo será criar de fato algum código em nosso repositorio local para que possamos em seguida enviá-lo para o Gitlab.</p>
<p><strong>C</strong>onforme dito anteriormente, o foco deste post não é, em hipótese alguma, ensinar Terraform. Para isto citei no início deste post alguns links para posts anteriores.</p>
<p><strong>U</strong>tilizaremos aqui um código extremamente simplista  visto que nosso objetivo aqui é apenas conhecer melhor como podemos utilizar pipelines para nossa infraestrutura. Mas, uma vez que você entenda o conceito e a técnica, o procedimento seria o mesmo, independente de quão complexo seja o código de sua infraestrutura.</p>
<p><strong>E</strong>m seu repositório local, crie o arquivo <em>main.tf</em> com o seguinte conteúdo:</p>
<div class="code-block code-line-numbers open" style="counter-reset: code-block 0">
    <div class="code-header language-bash">
        <span class="code-title"><i class="arrow fas fa-angle-right fa-fw" aria-hidden="true"></i></span>
        <span class="ellipses"><i class="fas fa-ellipsis-h fa-fw" aria-hidden="true"></i></span>
        <span class="copy" title="Copiar para a área de transferência"><i class="far fa-copy fa-fw" aria-hidden="true"></i></span>
    </div><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl"><span class="c1"># Criando uma instância EC2</span>
</span></span><span class="line"><span class="cl">provider <span class="s2">&#34;aws&#34;</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">  <span class="nv">region</span> <span class="o">=</span> <span class="s2">&#34;ca-central-1&#34;</span>
</span></span><span class="line"><span class="cl"><span class="o">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">data <span class="s2">&#34;aws_ami&#34;</span> <span class="s2">&#34;ubuntu&#34;</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">  <span class="nv">most_recent</span> <span class="o">=</span> <span class="nb">true</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  filter <span class="o">{</span>
</span></span><span class="line"><span class="cl">    <span class="nv">name</span>   <span class="o">=</span> <span class="s2">&#34;name&#34;</span>
</span></span><span class="line"><span class="cl">    <span class="nv">values</span> <span class="o">=</span> <span class="o">[</span><span class="s2">&#34;ubuntu/images/hvm-ssd/ubuntu-trusty-14.04-amd64-server-*&#34;</span><span class="o">]</span>
</span></span><span class="line"><span class="cl">  <span class="o">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  filter <span class="o">{</span>
</span></span><span class="line"><span class="cl">    <span class="nv">name</span>   <span class="o">=</span> <span class="s2">&#34;virtualization-type&#34;</span>
</span></span><span class="line"><span class="cl">    <span class="nv">values</span> <span class="o">=</span> <span class="o">[</span><span class="s2">&#34;hvm&#34;</span><span class="o">]</span>
</span></span><span class="line"><span class="cl">  <span class="o">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="nv">owners</span> <span class="o">=</span> <span class="o">[</span><span class="s2">&#34;099720109477&#34;</span><span class="o">]</span> <span class="c1"># Canonical</span>
</span></span><span class="line"><span class="cl"><span class="o">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">resource <span class="s2">&#34;aws_instance&#34;</span> <span class="s2">&#34;web&#34;</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">  <span class="nv">ami</span>           <span class="o">=</span> data.aws_ami.ubuntu.id
</span></span><span class="line"><span class="cl">  <span class="nv">instance_type</span> <span class="o">=</span> <span class="s2">&#34;t2.micro&#34;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="nv">tags</span> <span class="o">=</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">    <span class="nv">Name</span> <span class="o">=</span> <span class="s2">&#34;HelloWorld&#34;</span>
</span></span><span class="line"><span class="cl">  <span class="o">}</span>
</span></span><span class="line"><span class="cl"><span class="o">}</span></span></span></code></pre></div></div>
<p><strong>E</strong>m seguida, criaremos o arquivo <em>.gitignore</em> para que possamos fazer com que nossos arquivos de configuração e estado do Terraform não sejam enviados para o Gitlab. O arquivo deverá conter uma única linha: (Sim, precisamos ter um &ldquo;.&rdquo; no início do nome do arquivo.)</p>
<div class="code-block code-line-numbers open" style="counter-reset: code-block 0">
    <div class="code-header language-bash">
        <span class="code-title"><i class="arrow fas fa-angle-right fa-fw" aria-hidden="true"></i></span>
        <span class="ellipses"><i class="fas fa-ellipsis-h fa-fw" aria-hidden="true"></i></span>
        <span class="copy" title="Copiar para a área de transferência"><i class="far fa-copy fa-fw" aria-hidden="true"></i></span>
    </div><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">.terraform</span></span></code></pre></div></div>
<p><strong>C</strong>om nosso código Terraform concluído, chegou a hora de iniciarmos nossa pipeline.</p>
<p><strong>A</strong>ntes de definirmos o código de nossa pipeline, vamos criar duas variáveis de ambiente em nosso projeto no Gitlab. Na página principal de seu projeto no Gitlab, clique no botão de engrenagem (<em>Settings</em> ou Configurações) no menu da lateral esquerda, em seguida clique em <em>CI / CD</em>, conforme imagem abaixo:</p>
<p><img
        class="lazyload"
        src="/svg/loading.min.svg"
        data-src="/posts/criando-uma-pipeline-para-terraform/gitlab_8.png"
        data-srcset="/posts/criando-uma-pipeline-para-terraform/gitlab_8.png, /posts/criando-uma-pipeline-para-terraform/gitlab_8.png 1.5x, /posts/criando-uma-pipeline-para-terraform/gitlab_8.png 2x"
        data-sizes="auto"
        alt="/posts/criando-uma-pipeline-para-terraform/gitlab_8.png"
        title="Gitlab" width="500" height="581" /></p>
<p><strong>N</strong>a janela de configurações <em>CI  CD</em>, expanda o menu <em>Variables</em> (Variáveis) onde podemos definir nossas variáveis de ambiente. Inclua duas variáveis, sendo elas:</p>
<ul>
<li>AWS_SECRET_ACCESS_KEY</li>
<li>AWS_ACCESS_KEY_ID</li>
</ul>
<p><strong>P</strong>ara cada uma destas variáveis inclua o seu devido valor de acordo com as suas credenciais de acesso ao AWS, conforme exemplo na imagem abaixo. Em seguida, clique em <em>Save variables</em> (Salvar variáveis).</p>
<p><img
        class="lazyload"
        src="/svg/loading.min.svg"
        data-src="/posts/criando-uma-pipeline-para-terraform/gitlab_9.png"
        data-srcset="/posts/criando-uma-pipeline-para-terraform/gitlab_9.png, /posts/criando-uma-pipeline-para-terraform/gitlab_9.png 1.5x, /posts/criando-uma-pipeline-para-terraform/gitlab_9.png 2x"
        data-sizes="auto"
        alt="/posts/criando-uma-pipeline-para-terraform/gitlab_9.png"
        title="Gitlab" width="700" height="318" /></p>
<p><strong>E</strong>stas variáveis serão utilizadas pelos <em>nodes</em>, ou <em>workers</em> criados pelo Gitlab para executar nossa pipeline.</p>
<p><strong>O</strong> que acontecerá na verdade é que sempre que nossa pipeline for iniciada, o Gitlab criará um container, em sua própria infraestrutura/nuvem, e este container irá clonar nosso repositório para executar os passos de nossa pipeline. Este container terá as variáveis de ambiente que definirmos aqui. Assim como em nossa máquina local precisamos ter estas variáveis de ambiente para que possamos nos comunicar com o AWS via Terraform, o container que irá rodar nossa pipeline também precisará.</p>
<p><strong>U</strong>ma vez que tenhamos nossas variáveis definidas, podemos voltar ao nosso código para iniciarmos a criação de nossa pipeline.</p>
<p><strong>P</strong>rimeiramente, criaremos um arquivo chamado <em>.gitlab-ci.yml</em>. Sim, devemos ter um &ldquo;.&rdquo; no início do nome do arquivo. Isto fará com que ele seja tratado como um arquivo oculto. Por padrão, o Gitlab reconhece a existência deste arquivo em seu repositório e o executará como sendo a definição de sua pipeline.</p>
<p><strong>C</strong>omecemos incluindo o seguinte neste arquivo:</p>
<div class="code-block code-line-numbers open" style="counter-reset: code-block 0">
    <div class="code-header language-yaml">
        <span class="code-title"><i class="arrow fas fa-angle-right fa-fw" aria-hidden="true"></i></span>
        <span class="ellipses"><i class="fas fa-ellipsis-h fa-fw" aria-hidden="true"></i></span>
        <span class="copy" title="Copiar para a área de transferência"><i class="far fa-copy fa-fw" aria-hidden="true"></i></span>
    </div><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-yaml" data-lang="yaml"><span class="line"><span class="cl"><span class="nt">image</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">hashicorp/terraform:light</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">entrypoint</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span>- <span class="s1">&#39;/usr/bin/env&#39;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span>- <span class="s1">&#39;PATH=/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin&#39;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span>- <span class="s1">&#39;AWS_SECRET_ACCESS_KEY=${AWS_SECRET_ACCESS_KEY}&#39;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span>- <span class="s1">&#39;AWS_ACCESS_KEY_ID=${AWS_ACCESS_KEY_ID}&#39;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">cache</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">paths</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span>- <span class="l">.terraform</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">before_script</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span>- <span class="l">terraform --version</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span>- <span class="l">terraform init</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">stages</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span>- <span class="l">validar</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">validar</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">stage</span><span class="p">:</span><span class="w"> </span><span class="l">validar</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">script</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span>- <span class="l">terraform validate</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">only</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span>- <span class="l">branches</span></span></span></code></pre></div></div>
<p><strong>O</strong> que temos neste código:</p>
<ol>
<li>image: aqui definimos as propriedade da imagem que será utilizada pelo Gitlab para criar o container que rodará nossa pipeline. Praticamente podemos utilizar qualquer imagem disponível para Docker, mas como apenas precisamos de um container capaz de executar o terraform, utilizaremos a imagem padrão do Terraform, fornecida pela Hashicorp. Além de indicarmos a imagem, indicamos aqui também as variáveis de ambiente que este container deverá possuir, e apontamos o valor das mesmas como sendo ${AWS_SECRET_ACCESS_KEY} e ${AWS_ACCESS_KEY_ID} como forma de indicarmos que o valor das mesmas deverá ser pego do próprio Gitlab, das configurações de nosso projeto, onde definimos nossos valores anteriormente;</li>
<li>cache: a opção <em>cache</em> nos permite fazer cache de arquivos ou informações que possam ser re-utilizados em jobs seguintes de nossas pipelines, portanto utilizaremos aqui apenas o <em>path</em> .terraform como cache de nossa pipeline;</li>
<li>before_script: com o <em>before_script</em> podemos definir algumas tarefas ou passos que devem ser executados antes do início dos passos convencionais de nossa pipeline. Por vezes pode ser útil ter alguns comandos aqui caso sejam utilizados comumente antes de cada passo da pipeline, por exemplo. Aqui queremos apenas validar a versão do terraform utilizada e garantir que o código terraform pode ser inicializado com <em>terraform init</em>;</li>
<li>stages: estes são os estágios ou <em>stages</em> de nossa pipeline. Podemos ter diversos <em>stages</em> em uma mesma pipeline, como veremos em seguida, mas por enquanto nossa pipeline iniciará com apenas um <em>stage</em>, que será o de validar;</li>
<li>validar: aqui estamos iniciando a criação do nosso primeiro <em>stage</em>, validar. Neste bloco indicamos a qual <em>stage</em> este código se refere, bem como o <em>script</em> ou comandos a serem executados neste <em>stage</em>. Além disso, podemos definir restrições para que este <em>stage</em> possa ser executado. Neste exemplo estamos utilizando a restrição <em>only</em> (apenas) para informar que sempre que se tratar de um branch que não seja o master, este <em>stage</em> será executado.</li>
</ol>
<p><strong>J</strong>á podemos testar este pedaço de nossa pipeline. No nosso projeto do Gitlab, clique no ícone de foguete na lateral esquerda e em seguida clique em <em>Pipelines</em>. Você não deverá ver nada nesta página, mas mantenha-a aberta.</p>
<p><img
        class="lazyload"
        src="/svg/loading.min.svg"
        data-src="/posts/criando-uma-pipeline-para-terraform/gitlab_11.png"
        data-srcset="/posts/criando-uma-pipeline-para-terraform/gitlab_11.png, /posts/criando-uma-pipeline-para-terraform/gitlab_11.png 1.5x, /posts/criando-uma-pipeline-para-terraform/gitlab_11.png 2x"
        data-sizes="auto"
        alt="/posts/criando-uma-pipeline-para-terraform/gitlab_11.png"
        title="Gitlab" width="310" height="280" /></p>
<p><strong>D</strong>e volta ao nosso terminal, criaremos um novo branch e faremos um commit e push de nosso código para o Gitlab em um novo branch:</p>
<div class="code-block code-line-numbers open" style="counter-reset: code-block 0">
    <div class="code-header language-bash">
        <span class="code-title"><i class="arrow fas fa-angle-right fa-fw" aria-hidden="true"></i></span>
        <span class="ellipses"><i class="fas fa-ellipsis-h fa-fw" aria-hidden="true"></i></span>
        <span class="copy" title="Copiar para a área de transferência"><i class="far fa-copy fa-fw" aria-hidden="true"></i></span>
    </div><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">$ git checkout -b codigo-inicial
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">$ git add .
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">$ git commit -m <span class="s2">&#34;Commit inicial de nosso código terraform.&#34;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">$ git push origin codigo-inicial</span></span></code></pre></div></div>
<p><strong>A</strong>gora observe novamente a nossa página de pipelines do Gitlab. Perceba que uma pipeline será iniciada automaticamente após fazermos nosso <em>git push</em>:</p>
<p><img
        class="lazyload"
        src="/svg/loading.min.svg"
        data-src="/posts/criando-uma-pipeline-para-terraform/gitlab_10.png"
        data-srcset="/posts/criando-uma-pipeline-para-terraform/gitlab_10.png, /posts/criando-uma-pipeline-para-terraform/gitlab_10.png 1.5x, /posts/criando-uma-pipeline-para-terraform/gitlab_10.png 2x"
        data-sizes="auto"
        alt="/posts/criando-uma-pipeline-para-terraform/gitlab_10.png"
        title="Gitlab" width="750" height="473" /></p>
<p><strong>A</strong>té então nossa pipeline está apenas validando o início do projeto, portanto ela deve concluir em poucos segundos. Mas você pode ver o andamento da mesma clicando na pipeline em questão. Você será levado para a página da pipeline em questão e verá a lista dos <em>stages</em> da mesma. Neste caso, apenas temos um <em>stage</em> nesta pipeline (por enquanto). Clique no <em>stage</em> para ver a saída do mesmo:</p>
<p><img
        class="lazyload"
        src="/svg/loading.min.svg"
        data-src="/posts/criando-uma-pipeline-para-terraform/gitlab_12.png"
        data-srcset="/posts/criando-uma-pipeline-para-terraform/gitlab_12.png, /posts/criando-uma-pipeline-para-terraform/gitlab_12.png 1.5x, /posts/criando-uma-pipeline-para-terraform/gitlab_12.png 2x"
        data-sizes="auto"
        alt="/posts/criando-uma-pipeline-para-terraform/gitlab_12.png"
        title="Gitlab" width="820" height="640" /></p>
<p><img
        class="lazyload"
        src="/svg/loading.min.svg"
        data-src="/posts/criando-uma-pipeline-para-terraform/gitlab_13.png"
        data-srcset="/posts/criando-uma-pipeline-para-terraform/gitlab_13.png, /posts/criando-uma-pipeline-para-terraform/gitlab_13.png 1.5x, /posts/criando-uma-pipeline-para-terraform/gitlab_13.png 2x"
        data-sizes="auto"
        alt="/posts/criando-uma-pipeline-para-terraform/gitlab_13.png"
        title="Gitlab" width="650" height="845" /></p>
<p><strong>P</strong>odemos ver que nossa pipeline foi bem sucedida. Ignore o erro Fatal na imagem acima. Ele apenas não encontrou o arquivo que listamos que ele deveria utilizar para cache, mas isto era esperado pois esta é a primeira vez que rodamos nossa pipeline, portanto o arquivo ainda não existia em cache.</p>
<p><strong>A</strong>gora que temos uma pipeline funcional, vamos incluir mais um <em>stage</em> em nossa pipeline, pois da forma que ela está agora, apenas validamos a versão do terraform no container que roda a pipeline e nos certificamos de que o init pode ser executado sem erros.</p>
<p><strong>D</strong>e volta ao nosso arquivo <em>gitlab-ci.yml</em>, vamos incluir nosso segundo <em>stage</em>. O código agora ficará assim:</p>
<div class="code-block code-line-numbers open" style="counter-reset: code-block 0">
    <div class="code-header language-yaml">
        <span class="code-title"><i class="arrow fas fa-angle-right fa-fw" aria-hidden="true"></i></span>
        <span class="ellipses"><i class="fas fa-ellipsis-h fa-fw" aria-hidden="true"></i></span>
        <span class="copy" title="Copiar para a área de transferência"><i class="far fa-copy fa-fw" aria-hidden="true"></i></span>
    </div><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-yaml" data-lang="yaml"><span class="line"><span class="cl"><span class="nt">image</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">hashicorp/terraform:light</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">entrypoint</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span>- <span class="s1">&#39;/usr/bin/env&#39;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span>- <span class="s1">&#39;PATH=/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin&#39;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span>- <span class="s1">&#39;AWS_SECRET_ACCESS_KEY=${AWS_SECRET_ACCESS_KEY}&#39;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span>- <span class="s1">&#39;AWS_ACCESS_KEY_ID=${AWS_ACCESS_KEY_ID}&#39;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">cache</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">paths</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span>- <span class="l">.terraform</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">before_script</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span>- <span class="l">terraform --version</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span>- <span class="l">terraform init</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">stages</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span>- <span class="l">validar</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span>- <span class="l">plan</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">validar</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">stage</span><span class="p">:</span><span class="w"> </span><span class="l">validar</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">script</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span>- <span class="l">terraform validate</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">only</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span>- <span class="l">branches</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">plan</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">stage</span><span class="p">:</span><span class="w"> </span><span class="l">plan</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">script</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span>- <span class="l">terraform plan</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">only</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span>- <span class="l">merge_requests</span></span></span></code></pre></div></div>
<p><strong>O</strong> que alteramos:</p>
<ol>
<li>stages: Repare que no bloco de <em>stages</em> nós agora incluímos um novo <em>stage</em> que se chamará <em>plan</em> (em alusão ao comando terraform plan);</li>
<li>plan: incluímos também um bloco para nosso segundo <em>stage</em>, o plan. Neste bloco indicamos que o nome do <em>stage</em> é <em>plan</em>, em seguida que o <em>script</em> a ser executado será simplesmente o comando <em>terraform plan</em>. Como condição ou restrição, informamos que este <em>stage</em> apenas será executado quando houver um <em>merge_request</em>. Merge request ou Pull request, é quando fazemos uma solicitação para que nosso branch seja unido (<em>merge</em>) ao master do projeto.</li>
</ol>
<p><strong>E</strong>m nossa página principal de pipelines no Gitlab, só devemos ter o resultado de uma execução, que foi bem sucedida, conforme imagem abaixo:</p>
<p><img
        class="lazyload"
        src="/svg/loading.min.svg"
        data-src="/posts/criando-uma-pipeline-para-terraform/gitlab_14.png"
        data-srcset="/posts/criando-uma-pipeline-para-terraform/gitlab_14.png, /posts/criando-uma-pipeline-para-terraform/gitlab_14.png 1.5x, /posts/criando-uma-pipeline-para-terraform/gitlab_14.png 2x"
        data-sizes="auto"
        alt="/posts/criando-uma-pipeline-para-terraform/gitlab_14.png"
        title="Gitlab" width="650" height="325" /></p>
<p><strong>C</strong>om nosso código alterado, vamos fazer um novo commit e push para nosso branch:</p>
<div class="code-block code-line-numbers open" style="counter-reset: code-block 0">
    <div class="code-header language-bash">
        <span class="code-title"><i class="arrow fas fa-angle-right fa-fw" aria-hidden="true"></i></span>
        <span class="ellipses"><i class="fas fa-ellipsis-h fa-fw" aria-hidden="true"></i></span>
        <span class="copy" title="Copiar para a área de transferência"><i class="far fa-copy fa-fw" aria-hidden="true"></i></span>
    </div><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">$ git add .
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">$ git commit -m <span class="s2">&#34;Inserindo stage plan na pipeline.&#34;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">$ git push origin codigo-inicial</span></span></code></pre></div></div>
<p><strong>I</strong>mediatamente poderemos ver que uma nova execução de nossa pipeline começou:</p>
<p><img
        class="lazyload"
        src="/svg/loading.min.svg"
        data-src="/posts/criando-uma-pipeline-para-terraform/gitlab_15.png"
        data-srcset="/posts/criando-uma-pipeline-para-terraform/gitlab_15.png, /posts/criando-uma-pipeline-para-terraform/gitlab_15.png 1.5x, /posts/criando-uma-pipeline-para-terraform/gitlab_15.png 2x"
        data-sizes="auto"
        alt="/posts/criando-uma-pipeline-para-terraform/gitlab_15.png"
        title="Gitlab" width="700" height="320" /></p>
<p><strong>S</strong>e de fato clicarmos nesta pipeline que foi iniciada veremos que a mesma não executou o <em>stage</em> plan, afinal a nossa restrição dizia que o <em>plan</em> só deveria ser executado quando houvesse um Merge Request (ou Pull Request, como prefira chamar). É importante lembrar que isto não é uma regra, mas sim uma opção minha. Você poderia muito bem dizer que quer o plan executado a cada branch e não apenas quando houver um Merge Request. A opção aqui foi apenas ilustrativa, para que conheceçamos alguns recursos do Gitlab.</p>
<p><img
        class="lazyload"
        src="/svg/loading.min.svg"
        data-src="/posts/criando-uma-pipeline-para-terraform/gitlab_16.png"
        data-srcset="/posts/criando-uma-pipeline-para-terraform/gitlab_16.png, /posts/criando-uma-pipeline-para-terraform/gitlab_16.png 1.5x, /posts/criando-uma-pipeline-para-terraform/gitlab_16.png 2x"
        data-sizes="auto"
        alt="/posts/criando-uma-pipeline-para-terraform/gitlab_16.png"
        title="Gitlab" width="580" height="467" /></p>
<p><strong>C</strong>omo podemos então testar nosso próximo stage? Simples, criando um Merge Request (ou Pull Request).</p>
<p><strong>S</strong>e voltarmos ao nosso terminal onde acabamos de realizar nosso push, veremos que uma URL nos foi disponibilizada. Esta URL pode ser utilizada para criar um Merge Request (Pull Request):</p>
<p><img
        class="lazyload"
        src="/svg/loading.min.svg"
        data-src="/posts/criando-uma-pipeline-para-terraform/gitlab_17.png"
        data-srcset="/posts/criando-uma-pipeline-para-terraform/gitlab_17.png, /posts/criando-uma-pipeline-para-terraform/gitlab_17.png 1.5x, /posts/criando-uma-pipeline-para-terraform/gitlab_17.png 2x"
        data-sizes="auto"
        alt="/posts/criando-uma-pipeline-para-terraform/gitlab_17.png"
        title="Gitlab" width="700" height="239" /></p>
<p><strong>C</strong>opie e cole esta URL em seu navegador. Insira algum comentário (opcional) e em seguida clique em <em>Submit Merge request</em> (Submeter Merge Request):</p>
<p><img
        class="lazyload"
        src="/svg/loading.min.svg"
        data-src="/posts/criando-uma-pipeline-para-terraform/gitlab_18.png"
        data-srcset="/posts/criando-uma-pipeline-para-terraform/gitlab_18.png, /posts/criando-uma-pipeline-para-terraform/gitlab_18.png 1.5x, /posts/criando-uma-pipeline-para-terraform/gitlab_18.png 2x"
        data-sizes="auto"
        alt="/posts/criando-uma-pipeline-para-terraform/gitlab_18.png"
        title="Gitlab" width="750" height="631" /></p>
<p><strong>R</strong>epare que o Gitlab começou automaticamente a pipeline:</p>
<p><img
        class="lazyload"
        src="/svg/loading.min.svg"
        data-src="/posts/criando-uma-pipeline-para-terraform/gitlab_19.png"
        data-srcset="/posts/criando-uma-pipeline-para-terraform/gitlab_19.png, /posts/criando-uma-pipeline-para-terraform/gitlab_19.png 1.5x, /posts/criando-uma-pipeline-para-terraform/gitlab_19.png 2x"
        data-sizes="auto"
        alt="/posts/criando-uma-pipeline-para-terraform/gitlab_19.png"
        title="Gitlab" width="600" height="480" /></p>
<p><strong>S</strong>e você clicar na pipeline, verá que desta vez o seu stage <em>plan</em> foi executado e, caso seu código esteja todo correto, o seu plan terá sido realizado com sucesso:</p>
<p><img
        class="lazyload"
        src="/svg/loading.min.svg"
        data-src="/posts/criando-uma-pipeline-para-terraform/gitlab_20.png"
        data-srcset="/posts/criando-uma-pipeline-para-terraform/gitlab_20.png, /posts/criando-uma-pipeline-para-terraform/gitlab_20.png 1.5x, /posts/criando-uma-pipeline-para-terraform/gitlab_20.png 2x"
        data-sizes="auto"
        alt="/posts/criando-uma-pipeline-para-terraform/gitlab_20.png"
        title="Gitlab" width="600" height="729" /></p>
<p><strong>E</strong>m seu estado atual, nossa pipeline possui dois <em>stages</em>, sendo eles uma validação e o plan. O próximo <em>stage</em> será o de aplicar nosso código e fazer o deployment de nossa infraestrutura de fato.</p>
<p><strong>V</strong>oltemos ao nosso arquivo <em>gitlab-ci.yml</em>. Insira o seguinte:</p>
<div class="code-block code-line-numbers open" style="counter-reset: code-block 0">
    <div class="code-header language-yaml">
        <span class="code-title"><i class="arrow fas fa-angle-right fa-fw" aria-hidden="true"></i></span>
        <span class="ellipses"><i class="fas fa-ellipsis-h fa-fw" aria-hidden="true"></i></span>
        <span class="copy" title="Copiar para a área de transferência"><i class="far fa-copy fa-fw" aria-hidden="true"></i></span>
    </div><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-yaml" data-lang="yaml"><span class="line"><span class="cl"><span class="nt">image</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">hashicorp/terraform:light</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">entrypoint</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span>- <span class="s1">&#39;/usr/bin/env&#39;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span>- <span class="s1">&#39;PATH=/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin&#39;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span>- <span class="s1">&#39;AWS_SECRET_ACCESS_KEY=${AWS_SECRET_ACCESS_KEY}&#39;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span>- <span class="s1">&#39;AWS_ACCESS_KEY_ID=${AWS_ACCESS_KEY_ID}&#39;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">cache</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">paths</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span>- <span class="l">.terraform</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">before_script</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span>- <span class="l">terraform --version</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span>- <span class="l">terraform init</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">stages</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span>- <span class="l">validar</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span>- <span class="l">plan</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span>- <span class="l">apply</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">validar</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">stage</span><span class="p">:</span><span class="w"> </span><span class="l">validar</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">script</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span>- <span class="l">terraform validate</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">only</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span>- <span class="l">branches</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">plan</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">stage</span><span class="p">:</span><span class="w"> </span><span class="l">plan</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">script</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span>- <span class="l">terraform plan</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">only</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span>- <span class="l">merge_requests</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">build</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">stage</span><span class="p">:</span><span class="w"> </span><span class="l">plan</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">script</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span>- <span class="l">terraform plan</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">only</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span>- <span class="l">master</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">apply</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">stage</span><span class="p">:</span><span class="w"> </span><span class="l">apply</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">script</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span>- <span class="l">terraform apply -auto-approve</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">dependencies</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span>- <span class="l">build</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">only</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span>- <span class="l">master</span></span></span></code></pre></div></div>
<p><strong>O</strong> que alteramos:</p>
<ol>
<li>stages: Repare que no bloco de <em>stages</em> nós agora incluímos um novo <em>stage</em> que se chamará <em>apply</em> (em alusão ao comando terraform apply);</li>
<li>build: incluímos mais um passo ou tarefa em nossa pipeline chamado <em>build</em>. Este executará novamente um plan, porém desta vez será após o merge do código ser aceito, por isso temos a restrição <em>only</em> como sendo <em>master</em>. É importante perceber que desta vez teremos dois stages na pipeline que será executada após o merge do código;</li>
<li>apply: mais um passo que será também executado apenas após o merge do código no <em>master</em>. Este executará o script <em>terraform apply</em>. Aqui temos o parâmetro <em>dependencies</em>, no qual indicamos que este passo apenas será executado se o passo anterior finalizar com sucesso.</li>
</ol>
<p><strong>A</strong>ntes de testarmos nosso código, vou logar em minha conta do AWS para constatar que não possuo nenhuma instância EC2 rodando:</p>
<p><img
        class="lazyload"
        src="/svg/loading.min.svg"
        data-src="/posts/criando-uma-pipeline-para-terraform/gitlab_21.png"
        data-srcset="/posts/criando-uma-pipeline-para-terraform/gitlab_21.png, /posts/criando-uma-pipeline-para-terraform/gitlab_21.png 1.5x, /posts/criando-uma-pipeline-para-terraform/gitlab_21.png 2x"
        data-sizes="auto"
        alt="/posts/criando-uma-pipeline-para-terraform/gitlab_21.png"
        title="Gitlab" width="870" height="370" /></p>
<p><strong>A</strong>gora que tenho a certeza de não possuir nenhuma instância rodando, é hora de testar nossa pipeline completa.</p>
<p><strong>D</strong>e volta ao nosso terminal, faremos um novo commit no branch que criamos anteriormente, desta vez incluindo estas últimas alterações.</p>
<div class="code-block code-line-numbers open" style="counter-reset: code-block 0">
    <div class="code-header language-bash">
        <span class="code-title"><i class="arrow fas fa-angle-right fa-fw" aria-hidden="true"></i></span>
        <span class="ellipses"><i class="fas fa-ellipsis-h fa-fw" aria-hidden="true"></i></span>
        <span class="copy" title="Copiar para a área de transferência"><i class="far fa-copy fa-fw" aria-hidden="true"></i></span>
    </div><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">$ git checkout codigo-inicial
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">$ git add .
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">$ git commit -m <span class="s2">&#34;Finalizando a pipeline&#34;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">$ git push origin codigo-inicial</span></span></code></pre></div></div>
<p><strong>C</strong>omo podemos notar no Gitlab, na janela de pipelines, o stage de plan será executado devido ao nosso novo commit no branch.</p>
<p><img
        class="lazyload"
        src="/svg/loading.min.svg"
        data-src="/posts/criando-uma-pipeline-para-terraform/gitlab_22.png"
        data-srcset="/posts/criando-uma-pipeline-para-terraform/gitlab_22.png, /posts/criando-uma-pipeline-para-terraform/gitlab_22.png 1.5x, /posts/criando-uma-pipeline-para-terraform/gitlab_22.png 2x"
        data-sizes="auto"
        alt="/posts/criando-uma-pipeline-para-terraform/gitlab_22.png"
        title="Gitlab" width="600" height="76" /></p>
<p><strong>S</strong>e não cometemos nenhum erro, nossa pipeline executará com sucesso.</p>
<p><strong>A</strong>gora, de volta ao nosso Merge Request (Ou PR), vamos realizar o nosso merge de fato, para que possamos ver o nosso código ser aplicado em nossa conta do AWS. Na interface do Gitlab, clique no botão de Merge Requests que se encontra na lateral esquerda. Em seguida, clique no seu Merge Request que estará listado, conforme imagem a seguir:</p>
<p><img
        class="lazyload"
        src="/svg/loading.min.svg"
        data-src="/posts/criando-uma-pipeline-para-terraform/gitlab_23.png"
        data-srcset="/posts/criando-uma-pipeline-para-terraform/gitlab_23.png, /posts/criando-uma-pipeline-para-terraform/gitlab_23.png 1.5x, /posts/criando-uma-pipeline-para-terraform/gitlab_23.png 2x"
        data-sizes="auto"
        alt="/posts/criando-uma-pipeline-para-terraform/gitlab_23.png"
        title="Gitlab" width="700" height="350" /></p>
<p><strong>R</strong>epare que ele lista a pipeline que foi bem sucedida para este Merge Request e nos apresenta logo abaixo a opção de realizarmos o Merge. Clique em <em>Merge</em>.</p>
<p><img
        class="lazyload"
        src="/svg/loading.min.svg"
        data-src="/posts/criando-uma-pipeline-para-terraform/gitlab_24.png"
        data-srcset="/posts/criando-uma-pipeline-para-terraform/gitlab_24.png, /posts/criando-uma-pipeline-para-terraform/gitlab_24.png 1.5x, /posts/criando-uma-pipeline-para-terraform/gitlab_24.png 2x"
        data-sizes="auto"
        alt="/posts/criando-uma-pipeline-para-terraform/gitlab_24.png"
        title="Gitlab" width="800" height="444" /></p>
<p><strong>R</strong>epare que imediatamente após clicarmos em <em>Merge</em>, uma pipeline é iniciada automaticamente. Clique nela:</p>
<p><img
        class="lazyload"
        src="/svg/loading.min.svg"
        data-src="/posts/criando-uma-pipeline-para-terraform/gitlab_25.png"
        data-srcset="/posts/criando-uma-pipeline-para-terraform/gitlab_25.png, /posts/criando-uma-pipeline-para-terraform/gitlab_25.png 1.5x, /posts/criando-uma-pipeline-para-terraform/gitlab_25.png 2x"
        data-sizes="auto"
        alt="/posts/criando-uma-pipeline-para-terraform/gitlab_25.png"
        title="Gitlab" width="800" height="533" /></p>
<p><strong>C</strong>omo podemos ver, esta é nossa pipeline final, a qual executa os 3 stages definidos: Validar, Plan e Apply.</p>
<p><img
        class="lazyload"
        src="/svg/loading.min.svg"
        data-src="/posts/criando-uma-pipeline-para-terraform/gitlab_26.png"
        data-srcset="/posts/criando-uma-pipeline-para-terraform/gitlab_26.png, /posts/criando-uma-pipeline-para-terraform/gitlab_26.png 1.5x, /posts/criando-uma-pipeline-para-terraform/gitlab_26.png 2x"
        data-sizes="auto"
        alt="/posts/criando-uma-pipeline-para-terraform/gitlab_26.png"
        title="Gitlab" width="800" height="700" /></p>
<p><strong>S</strong>e clicarmos no stage <em>apply</em> poderemos ver a execução do nosso código sendo aplicado de fato para a criação de nossa infraestrutura no AWS:</p>
<p><img
        class="lazyload"
        src="/svg/loading.min.svg"
        data-src="/posts/criando-uma-pipeline-para-terraform/gitlab_27.png"
        data-srcset="/posts/criando-uma-pipeline-para-terraform/gitlab_27.png, /posts/criando-uma-pipeline-para-terraform/gitlab_27.png 1.5x, /posts/criando-uma-pipeline-para-terraform/gitlab_27.png 2x"
        data-sizes="auto"
        alt="/posts/criando-uma-pipeline-para-terraform/gitlab_27.png"
        title="Gitlab" width="800" height="620" /></p>
<p><img
        class="lazyload"
        src="/svg/loading.min.svg"
        data-src="/posts/criando-uma-pipeline-para-terraform/gitlab_28.png"
        data-srcset="/posts/criando-uma-pipeline-para-terraform/gitlab_28.png, /posts/criando-uma-pipeline-para-terraform/gitlab_28.png 1.5x, /posts/criando-uma-pipeline-para-terraform/gitlab_28.png 2x"
        data-sizes="auto"
        alt="/posts/criando-uma-pipeline-para-terraform/gitlab_28.png"
        title="Gitlab" width="800" height="620" /></p>
<p><strong>A</strong>o checarmos nossa conta do AWS, também podemos ver que nossa instância foi criada conforme especificado em nosso código.</p>
<p><img
        class="lazyload"
        src="/svg/loading.min.svg"
        data-src="/posts/criando-uma-pipeline-para-terraform/gitlab_29.png"
        data-srcset="/posts/criando-uma-pipeline-para-terraform/gitlab_29.png, /posts/criando-uma-pipeline-para-terraform/gitlab_29.png 1.5x, /posts/criando-uma-pipeline-para-terraform/gitlab_29.png 2x"
        data-sizes="auto"
        alt="/posts/criando-uma-pipeline-para-terraform/gitlab_29.png"
        title="Gitlab" width="800" height="145" /></p>
<p><strong>C</strong>onsiderações finais:</p>
<ul>
<li>Apesar de esta infraestrutura ser extremamente simplista, criando apenas uma instância ou VM, o seu código poderia criar coisas muito mais complexas, como VPCs, subnets, múltiplas instâncias, clusters, lambda functions, security groups, etc. O objetivo deste artigo não era a criação de infraestrutura com terraform, mas sim a possibilidade e utilização de uma pipeline para sua infraestrutura;</li>
<li>Não esqueça sempre de deletar os recursos criados por você durante estes testes, para evitar desperdiçar dinheiro. Neste exemplo, lembre-se de destruir no AWS a instância criada.</li>
</ul>
<p><strong>H</strong>ave fun!</p></div><div class="post-footer" id="post-footer">
    <div class="post-info">
        <div class="post-info-line">
            <div class="post-info-mod">
                <span>Atualizado em 2020-02-17</span>
            </div></div>
        <div class="post-info-line">
            <div class="post-info-md"></div>
            <div class="post-info-share">
                <span><a href="javascript:void(0);" title="Compartilhe em X" data-sharer="x" data-url="//blog.marcelocavalcante.net:1313/posts/criando-uma-pipeline-para-terraform/" data-title="Criando Uma Pipeline Para Terraform Com o Gitlab" data-via="Marcelo_Kalib" data-hashtags="Devops,Gitlab,Terraform,Cloud,AWS,CI,CD,Pipeline"><i class="fab fa-x-twitter fa-fw" aria-hidden="true"></i></a><a href="javascript:void(0);" title="Compartilhe em Threads" data-sharer="threads" data-url="//blog.marcelocavalcante.net:1313/posts/criando-uma-pipeline-para-terraform/" data-title="Criando Uma Pipeline Para Terraform Com o Gitlab"><i class="fab fa-threads fa-fw" aria-hidden="true"></i></a><a href="javascript:void(0);" title="Compartilhe em Facebook" data-sharer="facebook" data-url="//blog.marcelocavalcante.net:1313/posts/criando-uma-pipeline-para-terraform/" data-hashtag="Devops"><i class="fab fa-facebook-square fa-fw" aria-hidden="true"></i></a><a href="javascript:void(0);" title="Compartilhe em Linkedin" data-sharer="linkedin" data-url="//blog.marcelocavalcante.net:1313/posts/criando-uma-pipeline-para-terraform/"><i class="fab fa-linkedin fa-fw" aria-hidden="true"></i></a><a href="javascript:void(0);" title="Compartilhe em Hacker News" data-sharer="hackernews" data-url="//blog.marcelocavalcante.net:1313/posts/criando-uma-pipeline-para-terraform/" data-title="Criando Uma Pipeline Para Terraform Com o Gitlab"><i class="fab fa-hacker-news fa-fw" aria-hidden="true"></i></a><a href="javascript:void(0);" title="Compartilhe em Line" data-sharer="line" data-url="//blog.marcelocavalcante.net:1313/posts/criando-uma-pipeline-para-terraform/" data-title="Criando Uma Pipeline Para Terraform Com o Gitlab"><i data-svg-src="https://cdn.jsdelivr.net/npm/simple-icons@15.14.0/icons/line.svg" aria-hidden="true"></i></a><a href="javascript:void(0);" title="Compartilhe em 微博" data-sharer="weibo" data-url="//blog.marcelocavalcante.net:1313/posts/criando-uma-pipeline-para-terraform/" data-title="Criando Uma Pipeline Para Terraform Com o Gitlab"><i class="fab fa-weibo fa-fw" aria-hidden="true"></i></a><a href="javascript:void(0);" title="Compartilhe em Diaspora" data-sharer="diaspora" data-url="//blog.marcelocavalcante.net:1313/posts/criando-uma-pipeline-para-terraform/" data-title="Criando Uma Pipeline Para Terraform Com o Gitlab" data-description="Integração contínua (CI) e entrega contínua (CD) são termos bastante utilizados em equipes ágeis e de alta performance. São termos fundamentais na cultura e no dia a dia de uma equipe DevOps. Demonstrarei como podemos criar uma eficiente pipeline para Terraform com o Gitlab."><i class="fab fa-diaspora fa-fw" aria-hidden="true"></i></a><a href="https://t.me/share/url?url=%2f%2fblog.marcelocavalcante.net%3a1313%2fposts%2fcriando-uma-pipeline-para-terraform%2f&amp;text=Criando%20Uma%20Pipeline%20Para%20Terraform%20Com%20o%20Gitlab" target="_blank" title="Compartilhe em Telegram"><i class="fab fa-telegram fa-fw" aria-hidden="true"></i></a></span>
            </div>
        </div>
    </div>

    <div class="post-info-more">
        <section class="post-tags"><i class="fas fa-tags fa-fw" aria-hidden="true"></i>&nbsp;<a href="/tags/devops/">Devops</a>,&nbsp;<a href="/tags/gitlab/">Gitlab</a>,&nbsp;<a href="/tags/terraform/">Terraform</a>,&nbsp;<a href="/tags/cloud/">Cloud</a>,&nbsp;<a href="/tags/aws/">AWS</a>,&nbsp;<a href="/tags/ci/">CI</a>,&nbsp;<a href="/tags/cd/">CD</a>,&nbsp;<a href="/tags/pipeline/">Pipeline</a></section>
        <section>
            <span><a href="javascript:void(0);" onclick="window.history.back();">Voltar</a></span>&nbsp;|&nbsp;<span><a href="/">Home</a></span>
        </section>
    </div>

    <div class="post-nav"><a href="/posts/terraform-modules-porque-e-como/" class="prev" rel="prev" title="Terraform Modules: Porquê E Como Trabalhar Com Módulos No Terraform - PARTE 2"><i class="fas fa-angle-left fa-fw" aria-hidden="true"></i>Terraform Modules: Porquê E Como Trabalhar Com Módulos No Terraform - PARTE 2</a>
            <a href="/posts/kubernetes-imperativo-vs-declarativo/" class="next" rel="next" title="Kubernetes: Imperativo vs Declarativo">Kubernetes: Imperativo vs Declarativo<i class="fas fa-angle-right fa-fw" aria-hidden="true"></i></a></div>
</div>
<div id="comments"><div id="disqus_thread" class="comment"></div><noscript>
                Please enable JavaScript to view the comments powered by <a href="https://disqus.com/?ref_noscript">Disqus</a>.
            </noscript></div></article></div>
            </main><footer class="footer">
        <div class="footer-container"><div class="footer-line">Possibilitado por <a href="https://gohugo.io/" target="_blank" rel="noopener noreffer" title="Hugo 0.145.0">Hugo</a> | Tema - <a href="https://github.com/dillonzq/LoveIt" target="_blank" rel="noopener noreffer" title="LoveIt 0.3.1-DEV"><i class="far fa-kiss-wink-heart fa-fw" aria-hidden="true"></i> LoveIt</a>
                </div><div class="footer-line" itemscope itemtype="http://schema.org/CreativeWork"><i class="far fa-copyright fa-fw" aria-hidden="true"></i><span itemprop="copyrightYear">2008 - 2025</span><span class="author" itemprop="copyrightHolder">&nbsp;<a href="https://blog.marcelocavalcante.net" target="_blank">Marcelo Cavalcante</a></span></div>
        </div>
    </footer></div>

        <div id="fixed-buttons"><a href="#" id="back-to-top" class="fixed-button" title="Voltar ao topo">
                <i class="fas fa-arrow-up fa-fw" aria-hidden="true"></i>
            </a>
        </div>

        <div id="fixed-buttons-hidden"><a href="#" id="view-comments" class="fixed-button" title="Ver comentários">
                <i class="fas fa-comment fa-fw" aria-hidden="true"></i>
            </a>
        </div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/lightgallery@2.5.0/css/lightgallery-bundle.min.css"><script src="https://marcelocavalcante.disqus.com/embed.js" defer></script><script src="https://cdn.jsdelivr.net/npm/autocomplete.js@0.38.1/dist/autocomplete.min.js"></script><script src="https://cdn.jsdelivr.net/npm/lunr@2.3.9/lunr.min.js"></script><script src="/lib/lunr/lunr.stemmer.support.min.js"></script><script src="/lib/lunr/lunr.pt.min.js"></script><script src="https://cdn.jsdelivr.net/npm/lazysizes@5.3.2/lazysizes.min.js"></script><script src="https://cdn.jsdelivr.net/npm/lightgallery@2.5.0/lightgallery.min.js"></script><script src="https://cdn.jsdelivr.net/npm/lightgallery@2.5.0/plugins/thumbnail/lg-thumbnail.min.js"></script><script src="https://cdn.jsdelivr.net/npm/lightgallery@2.5.0/plugins/zoom/lg-zoom.min.js"></script><script src="https://cdn.jsdelivr.net/npm/clipboard@2.0.11/dist/clipboard.min.js"></script><script src="https://cdn.jsdelivr.net/npm/sharer.js@0.5.2/sharer.min.js"></script><script>window.config={"comment":{},"lightgallery":true,"search":{"highlightTag":"em","lunrIndexURL":"/index.json","lunrLanguageCode":"pt","maxResultLength":10,"noResultsFound":"Nenhum resultado encontrado","snippetLength":30,"type":"lunr"}};</script><script src="/js/theme.min.js"></script></body>
</html>

<script>
    document.addEventListener('DOMContentLoaded', function() {
        var searchIndex;

        fetch('/lunr.json')
            .then(response => response.json())
            .then(data => {
                searchIndex = lunr(function () {
                    this.field('title');
                    this.field('content');
                    this.field('tags');
                    this.ref('uri');

                    data.forEach(doc => {
                        this.add(doc);
                    });
                });
            });

        function performSearch(query) {
            if (searchIndex) {
                var results = searchIndex.search(query);
                displayResults(results);
            }
        }

        function displayResults(results) {
            var resultsContainer = document.getElementById('search-results');
            resultsContainer.innerHTML = '';
            results.forEach(result => {
                var item = document.createElement('div');
                item.innerHTML = `<a href="${result.ref}">${result.ref}</a>`;
                resultsContainer.appendChild(item);
            });
        }

        var searchInputDesktop = document.getElementById('search-input-desktop');
        if (searchInputDesktop) {
            searchInputDesktop.addEventListener('input', function() {
                performSearch(searchInputDesktop.value);
            });
        }

        var searchInputMobile = document.getElementById('search-input-mobile');
        if (searchInputMobile) {
            searchInputMobile.addEventListener('input', function() {
                performSearch(searchInputMobile.value);
            });
        }
    });
</script>
