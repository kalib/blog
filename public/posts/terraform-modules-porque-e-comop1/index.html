<!DOCTYPE html>
<html lang="pt-BR">
    <head><script src="/livereload.js?mindelay=10&amp;v=2&amp;port=1313&amp;path=livereload" data-no-instant defer></script>
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="robots" content="noodp" />
        <title>Terraform Modules: Porquê E Como Trabalhar Com Módulos No Terraform - PARTE 1 - Marcelo Cavalcante Rocha</title><meta name="Description" content="Todos sabem que o Terraform é uma solucão fantástica para criar infraestrutura através de código, porém nem todos utilizam as diversas possibilidades do mesmo, como por exemplos módulos. Com módulos podemos fazer a reutilização de código para nossa infraestrutura."><meta property="og:url" content="//blog.marcelocavalcante.net:1313/posts/terraform-modules-porque-e-comop1/">
  <meta property="og:site_name" content="Marcelo Cavalcante Rocha">
  <meta property="og:title" content="Terraform Modules: Porquê E Como Trabalhar Com Módulos No Terraform - PARTE 1">
  <meta property="og:description" content="Todos sabem que o Terraform é uma solucão fantástica para criar infraestrutura através de código, porém nem todos utilizam as diversas possibilidades do mesmo, como por exemplos módulos. Com módulos podemos fazer a reutilização de código para nossa infraestrutura.">
  <meta property="og:locale" content="pt_BR">
  <meta property="og:type" content="article">
    <meta property="article:section" content="posts">
    <meta property="article:published_time" content="2019-05-17T20:01:40-04:00">
    <meta property="article:modified_time" content="2019-05-17T20:01:40-04:00">
    <meta property="article:tag" content="Devops">
    <meta property="article:tag" content="Terraform">
    <meta property="article:tag" content="Cloud">
    <meta property="article:tag" content="AWS">
    <meta property="og:image" content="//blog.marcelocavalcante.net:1313/posts/terraform-modules-porque-e-comop1/featured-image.jpg">

  <meta name="twitter:card" content="summary_large_image">
  <meta name="twitter:image" content="//blog.marcelocavalcante.net:1313/posts/terraform-modules-porque-e-comop1/featured-image.jpg">
  <meta name="twitter:title" content="Terraform Modules: Porquê E Como Trabalhar Com Módulos No Terraform - PARTE 1">
  <meta name="twitter:description" content="Todos sabem que o Terraform é uma solucão fantástica para criar infraestrutura através de código, porém nem todos utilizam as diversas possibilidades do mesmo, como por exemplos módulos. Com módulos podemos fazer a reutilização de código para nossa infraestrutura.">
<meta name="application-name" content="Marcelo Cavalcante">
<meta name="apple-mobile-web-app-title" content="Marcelo Cavalcante">
<meta name="referrer" content="no-referrer" /><meta name="theme-color" content="#ffffff"><meta name="msapplication-TileColor" content="#da532c"><link rel="shortcut icon" type="image/x-icon" href="/favicon.ico" />
        <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
        <link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png"><link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png"><link rel="mask-icon" href="/safari-pinned-tab.svg" color="#5bbad5"><link rel="manifest" href="/site.webmanifest"><link rel="canonical" href="//blog.marcelocavalcante.net:1313/posts/terraform-modules-porque-e-comop1/" /><link rel="prev" href="//blog.marcelocavalcante.net:1313/posts/go-ou-golang-porque-adotei/" /><link rel="next" href="//blog.marcelocavalcante.net:1313/posts/terraform-modules-porque-e-como/" /><link rel="stylesheet" href="/css/style.min.css"><link rel="preload" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.7.2/css/all.min.css" as="style" onload="this.onload=null;this.rel='stylesheet'">
        <noscript><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.7.2/css/all.min.css"></noscript><link rel="preload" href="https://cdn.jsdelivr.net/npm/animate.css@4.1.1/animate.min.css" as="style" onload="this.onload=null;this.rel='stylesheet'">
        <noscript><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/animate.css@4.1.1/animate.min.css"></noscript><script type="application/ld+json">
    {
        "@context": "http://schema.org",
        "@type": "BlogPosting",
        "headline": "Terraform Modules: Porquê E Como Trabalhar Com Módulos No Terraform - PARTE 1",
        "inLanguage": "pt-BR",
        "mainEntityOfPage": {
            "@type": "WebPage",
            "@id": "\/\/blog.marcelocavalcante.net:1313\/posts\/terraform-modules-porque-e-comop1\/"
        },"image": [{
                            "@type": "ImageObject",
                            "url": "\/\/blog.marcelocavalcante.net:1313\/posts\/terraform-modules-porque-e-comop1\/featured-image.jpg",
                            "width":  700 ,
                            "height":  500 
                        }],"genre": "posts","keywords": "Devops, Terraform, Cloud, AWS","wordcount":  2972 ,
        "url": "\/\/blog.marcelocavalcante.net:1313\/posts\/terraform-modules-porque-e-comop1\/","datePublished": "2019-05-17T20:01:40-04:00","dateModified": "2019-05-17T20:01:40-04:00","publisher": {
            "@type": "Organization",
            "name": ""},"author": {
                "@type": "Person",
                "name": "Marcelo Cavalcante"
            },"description": "Todos sabem que o Terraform é uma solucão fantástica para criar infraestrutura através de código, porém nem todos utilizam as diversas possibilidades do mesmo, como por exemplos módulos. Com módulos podemos fazer a reutilização de código para nossa infraestrutura."
    }
    </script><script src="https://cdnjs.cloudflare.com/ajax/libs/lunr.js/2.3.9/lunr.min.js"></script>
    </head>
    <body data-header-desktop="fixed" data-header-mobile="auto"><script>
          const query = window.matchMedia('(prefers-color-scheme: dark)');
          function applyTheme() {
            let theme = window.localStorage?.getItem('theme') || 'auto';
            let isDark = theme === 'dark' || (theme === 'auto' && query.matches);
            document.body.setAttribute('theme', isDark? 'dark' : 'light');
            document.body.setAttribute('cfg-theme', theme);
          }

          applyTheme();
          query.addEventListener('change', applyTheme);
        </script>

        <div id="mask"></div><div class="wrapper"><header class="desktop" id="header-desktop">
    <div class="header-wrapper">
        <div class="header-title">
            <a href="/" title="Marcelo Cavalcante Rocha"><img
        class="lazyload logo"
        src="/svg/loading.min.svg"
        data-src="https://marcelocavalcante.net/ftp/logonew.png"
        data-srcset="https://marcelocavalcante.net/ftp/logonew.png, https://marcelocavalcante.net/ftp/logonew.png 1.5x, https://marcelocavalcante.net/ftp/logonew.png 2x"
        data-sizes="auto"
        alt="https://marcelocavalcante.net/ftp/logonew.png"
        title="https://marcelocavalcante.net/ftp/logonew.png" /></a>
        </div>
        <div class="menu">
            <div class="menu-inner"><a class="menu-item" href="/" title="Return to home page"><i class='fas fa-home'></i> Home </a><a class="menu-item" href="/posts/"> Posts </a><a class="menu-item" href="/tags/"> Tags </a><a class="menu-item" href="/categories/"> Categorias </a><a class="menu-item" href="/sobre/"> Quem Sou </a><span class="menu-item delimiter"></span><span class="menu-item search" id="search-desktop">
                        <input type="text" placeholder="Pesquisar títulos ou conteúdos ..." id="search-input-desktop">
                        <a href="javascript:void(0);" class="search-button search-toggle" id="search-toggle-desktop" title="Pesquisa">
                            <i class="fas fa-search fa-fw" aria-hidden="true"></i>
                        </a>
                        <a href="javascript:void(0);" class="search-button search-clear" id="search-clear-desktop" title="Limpar">
                            <i class="fas fa-times-circle fa-fw" aria-hidden="true"></i>
                        </a>
                        <span class="search-button search-loading" id="search-loading-desktop">
                            <i class="fas fa-spinner fa-fw fa-spin" aria-hidden="true"></i>
                        </span>
                    </span><a href="javascript:void(0);" class="menu-item theme-switch" title="Trocar tema">
                    <i class="fas fa-adjust fa-fw" aria-hidden="true"></i>
                </a></div>
        </div>
    </div>
</header><header class="mobile" id="header-mobile">
    <div class="header-container">
        <div class="header-wrapper">
            <div class="header-title">
                <a href="/" title="Marcelo Cavalcante Rocha"><img
        class="lazyload logo"
        src="/svg/loading.min.svg"
        data-src="https://marcelocavalcante.net/ftp/logonew.png"
        data-srcset="https://marcelocavalcante.net/ftp/logonew.png, https://marcelocavalcante.net/ftp/logonew.png 1.5x, https://marcelocavalcante.net/ftp/logonew.png 2x"
        data-sizes="auto"
        alt="https://marcelocavalcante.net/ftp/logonew.png"
        title="https://marcelocavalcante.net/ftp/logonew.png" /></a>
            </div>
            <div class="menu-toggle" id="menu-toggle-mobile">
                <span></span><span></span><span></span>
            </div>
        </div>
        <div class="menu" id="menu-mobile"><div class="search-wrapper">
                    <div class="search mobile" id="search-mobile">
                        <input type="text" placeholder="Pesquisar títulos ou conteúdos ..." id="search-input-mobile">
                        <a href="javascript:void(0);" class="search-button search-toggle" id="search-toggle-mobile" title="Pesquisa">
                            <i class="fas fa-search fa-fw" aria-hidden="true"></i>
                        </a>
                        <a href="javascript:void(0);" class="search-button search-clear" id="search-clear-mobile" title="Limpar">
                            <i class="fas fa-times-circle fa-fw" aria-hidden="true"></i>
                        </a>
                        <span class="search-button search-loading" id="search-loading-mobile">
                            <i class="fas fa-spinner fa-fw fa-spin" aria-hidden="true"></i>
                        </span>
                    </div>
                    <a href="javascript:void(0);" class="search-cancel" id="search-cancel-mobile">
                        Cancelar
                    </a>
                </div><a class="menu-item" href="/" title="Return to home page"><i class='fas fa-home'></i>Home</a><a class="menu-item" href="/posts/" title="">Posts</a><a class="menu-item" href="/tags/" title="">Tags</a><a class="menu-item" href="/categories/" title="">Categorias</a><a class="menu-item" href="/sobre/" title="">Quem Sou</a><a href="javascript:void(0);" class="menu-item theme-switch" title="Trocar tema">
                <i class="fas fa-adjust fa-fw" aria-hidden="true"></i>
            </a></div>
    </div>
</header><div class="search-dropdown desktop">
        <div id="search-dropdown-desktop"></div>
    </div>
    <div class="search-dropdown mobile">
        <div id="search-dropdown-mobile"></div>
    </div><main class="main">
                <div class="container"><div class="toc" id="toc-auto">
            <h2 class="toc-title">Conteúdos</h2>
            <div class="toc-content" id="toc-content-auto"></div>
        </div><article class="page single"><h1 class="single-title animate__animated animate__flipInX">Terraform Modules: Porquê E Como Trabalhar Com Módulos No Terraform - PARTE 1</h1><div class="post-meta">
            <div class="post-meta-line"><span class="post-author"><a href="https://blog.marcelocavalcante.net" title="Author" target="_blank" rel="noopener noreffer author" class="author"><i class="fas fa-user-circle fa-fw" aria-hidden="true"></i>Marcelo Cavalcante</a></span>&nbsp;<span class="post-category">incluido em <a href="/categories/tutoriais/"><i class="far fa-folder fa-fw" aria-hidden="true"></i>Tutoriais</a></span></div>
            <div class="post-meta-line"><i class="far fa-calendar-alt fa-fw" aria-hidden="true"></i>&nbsp;<time datetime="2019-05-17">2019-05-17</time>&nbsp;<i class="fas fa-pencil-alt fa-fw" aria-hidden="true"></i>&nbsp;2972 palavras&nbsp;
                <i class="far fa-clock fa-fw" aria-hidden="true"></i>&nbsp;14 minutos&nbsp;</div>
        </div><div class="featured-image"><img
        class="lazyload"
        src="/svg/loading.min.svg"
        data-src="/posts/terraform-modules-porque-e-comop1/featured-image.jpg"
        data-srcset="/posts/terraform-modules-porque-e-comop1/featured-image.jpg, /posts/terraform-modules-porque-e-comop1/featured-image.jpg 1.5x, /posts/terraform-modules-porque-e-comop1/featured-image.jpg 2x"
        data-sizes="auto"
        alt="/posts/terraform-modules-porque-e-comop1/featured-image.jpg"
        title="Todos sabem que o Terraform é uma solucão fantástica para criar infraestrutura através de código, porém nem todos utilizam as diversas possibilidades do mesmo, como por exemplos módulos. Com módulos podemos fazer a reutilização de código para nossa infraestrutura." /></div><div class="details toc" id="toc-static"  data-kept="">
                <div class="details-summary toc-title">
                    <span>Conteúdos</span>
                    <span><i class="details-icon fas fa-angle-right" aria-hidden="true"></i></span>
                </div>
                <div class="details-content toc-content" id="toc-content-static"><nav id="TableOfContents">
  <ul>
    <li><a href="#multi-plataforma---aws">Multi Plataforma - AWS</a></li>
    <li><a href="#criando-uma-conta-e-usuário-no-aws">Criando uma conta e usuário no AWS</a></li>
    <li><a href="#criando-vms-no-aws-com-terraform">Criando VMs no AWS com Terraform</a></li>
  </ul>
</nav></div>
            </div><div class="content" id="content"><p><strong>T</strong>odos sabem o quão fantástico o Terraform é quando o assunto é criar infraestrutura de forma automática e através de código, a chamada IaC ou Infraestrutura como Código <em>(Infrastructure as Code)</em>. No entanto, nem todos se utilizam de todos os recursos ou funcionalidades que o Terraform nos disponibiliza para tornar nossa vida ainda mais fácil e nosso código mais organizado.</p>
<p><strong>A</strong> possibilidade de utilizar módulos em nosso código Terraform faz com que possamos ter a reutilização de código, não apenas nosso mas também de terceiros, evitando a repetição de código bem como nos dando flexibilidade para criarmos dezenas de recursos similares porém com suas respectivas particularidades utilizando-se da mesma base de código.</p>
<p><strong>O</strong> objetivo deste post não é ensinar o básico de Terraform, portanto se você ainda não possui uma certa familiaridade com o Terraform, sugiro que volte um pouco e leia estes posts antes de seguir com esta leitura:</p>
<ul>
<li><a href="/posts/infraestrutura-como-codigo-com-terraform/" rel="">Infraestrutura como Código com Terraform</a></li>
<li><a href="/posts/introducao-ao-terraform/" rel="">Introdução ao Terraform</a></li>
<li><a href="/posts/terraform-variaveis-e-outputs/" rel="">Terraform: Variáveis e Outputs</a></li>
<li><a href="/posts/terraform-criando-uma-infraestrutura-no/" rel="">Terraform: Criando uma infraestrutura no Google Cloud</a></li>
</ul>
<h2 id="multi-plataforma---aws">Multi Plataforma - AWS</h2>
<p><img
        class="lazyload"
        src="/svg/loading.min.svg"
        data-src="terraform-aws.jpeg"
        data-srcset="terraform-aws.jpeg, terraform-aws.jpeg 1.5x, terraform-aws.jpeg 2x"
        data-sizes="auto"
        alt="terraform-aws.jpeg"
        title="Terraform and AWS" /></p>
<p><strong>J</strong>á que o Terraform é multi plataforma, desta vez utilizarei o AWS como cloud para criar minha infraestrutura, ao contrário dos posts anteriores nos quais utilizei Google Cloud.</p>
<p><strong>C</strong>omo costumo deixar claro, gosto muito de ambas as opções, GCP (Google Cloud Plataform) e AWS (Amazon Web Services), e não gosto de julgar uma como melhor que a outra. GCP se sai melhor em alguns aspectos, enquanto que AWS se sai melhor em outros, mas isto não é tema para este post.</p>
<p><strong>C</strong>aso queira acompanhar o passo a passo deste post e praticar os mesmos códigos, você precisará atender a alguns pré-requisitos:</p>
<ol>
<li>Já possuir uma conta no AWS. O AWS lhe permite criar uma conta para que você utilize alguns recursos gratuitamente durante os primeiros 12 meses para fins de estudos e serão estes os recursos nos quais focarei aqui;</li>
<li>Possuir um usuário não root com sua devida chave. Por padrão, ao criar uma conta no AWS, você sempre logará inicialmente com a conta root ou master. Embora muitas pessoas utilizem esta conta para tudo, é extremamente importante, por questões de segurança, que esta conta seja utilizada única e exclusivamente para criar novos usuários. Portanto, sugiro que você crie um novo usuário qualquer bem como uma chave para o mesmo, de forma que você possa interagir com o AWS programaticamente, via APIs, aws cli ou mesmo via Terraform. Você deverá possuir o <em>AWS_ACCESS_KEY_ID</em> deste usuário, bem como sua <em>AWS_SECRET_ACCESS_KEY</em>. Estas informações serão utilizadas para que você consiga se comunicar com o AWS através do Terraform;</li>
</ol>
<h2 id="criando-uma-conta-e-usuário-no-aws">Criando uma conta e usuário no AWS</h2>
<p><strong>C</strong>aso você já possua uma conta e um usuário pronto para utilização, siga para a próxima sessão: <strong>Criando VMs no AWS com Terraform</strong></p>
<p><strong>P</strong>ara criar sua conta no AWS preencha o formulário de cadastro através do seguinte link: <a href="https://portal.aws.amazon.com/billing/signup?nc2=h_ct&amp;src=header_signup&amp;redirect_url=https%3A%2F%2Faws.amazon.com%2Fregistration-confirmation#/start" target="_blank" rel="noopener noreffer ">Cadastro AWS</a>.</p>
<p><strong>A</strong>pós ter sua conta criada, efetue login com seu email para que possamos criar um usuário para nosso exemplo:</p>
<p><strong>N</strong>o canto superior esquerdo clique em <strong>Serviços</strong> <em>(Services)</em>. Busque e clique no serviço <strong>IAM</strong>.</p>
<p><img
        class="lazyload"
        src="/svg/loading.min.svg"
        data-src="/posts/terraform-modules-porque-e-comop1/terraform_aws1.jpg"
        data-srcset="/posts/terraform-modules-porque-e-comop1/terraform_aws1.jpg, /posts/terraform-modules-porque-e-comop1/terraform_aws1.jpg 1.5x, /posts/terraform-modules-porque-e-comop1/terraform_aws1.jpg 2x"
        data-sizes="auto"
        alt="/posts/terraform-modules-porque-e-comop1/terraform_aws1.jpg"
        title="AWS IAM" width="800" height="550" /></p>
<p><strong>N</strong>o menu da lateral esquerda clique em <strong>Usuários</strong> <em>(Users)</em> e em seguida clique no botão azul <strong>Adicionar Usuário</strong> <em>(Add User)</em>.</p>
<p><img
        class="lazyload"
        src="/svg/loading.min.svg"
        data-src="/posts/terraform-modules-porque-e-comop1/terraform_aws2.jpg"
        data-srcset="/posts/terraform-modules-porque-e-comop1/terraform_aws2.jpg, /posts/terraform-modules-porque-e-comop1/terraform_aws2.jpg 1.5x, /posts/terraform-modules-porque-e-comop1/terraform_aws2.jpg 2x"
        data-sizes="auto"
        alt="/posts/terraform-modules-porque-e-comop1/terraform_aws2.jpg"
        title="AWS IAM" width="450" height="230" /></p>
<p><strong>I</strong>nsira um nome para seu usuário e, em <strong>Tipo de Acesso</strong> <em>(Access Type)</em>, selecione a opcão <strong>Acesso programático</strong> <em>(Programmatic Access)</em>.</p>
<p><img
        class="lazyload"
        src="/svg/loading.min.svg"
        data-src="/posts/terraform-modules-porque-e-comop1/terraform_aws3.jpg"
        data-srcset="/posts/terraform-modules-porque-e-comop1/terraform_aws3.jpg, /posts/terraform-modules-porque-e-comop1/terraform_aws3.jpg 1.5x, /posts/terraform-modules-porque-e-comop1/terraform_aws3.jpg 2x"
        data-sizes="auto"
        alt="/posts/terraform-modules-porque-e-comop1/terraform_aws3.jpg"
        title="AWS IAM" width="800" height="456" /></p>
<p><strong>C</strong>lique no botão azul do canto inferior direito <strong>Próximo: Permissões</strong> <em>(Next: Permissions)</em>.</p>
<p><strong>N</strong>a tela seguinte clique em <strong>Anexar políticas existentes de forma direta</strong> <em>(Attach existing policies directly)</em> e em seguida, no campo de busca, digite <strong>AmazonEC2FullAccess</strong>. Selecione a caixa para atribuir esta <em>policy</em> ao seu novo usuário.</p>
<p><img
        class="lazyload"
        src="/svg/loading.min.svg"
        data-src="/posts/terraform-modules-porque-e-comop1/terraform_aws4.jpg"
        data-srcset="/posts/terraform-modules-porque-e-comop1/terraform_aws4.jpg, /posts/terraform-modules-porque-e-comop1/terraform_aws4.jpg 1.5x, /posts/terraform-modules-porque-e-comop1/terraform_aws4.jpg 2x"
        data-sizes="auto"
        alt="/posts/terraform-modules-porque-e-comop1/terraform_aws4.jpg"
        title="AWS IAM" width="850" height="357" /></p>
<p><strong>A</strong>gora que demos permissão para criar instâncias EC2 (VMs) ao nosso usuário, clique no botão azul <strong>Próximo: Tags</strong> <em>(Next: Tags)</em>.</p>
<p><strong>E</strong>mbora <em>Tags</em> não sejam obrigatórias, por questões de organização e para seguirmos melhores práticas, definiremos uma <em>Tag</em> para este usuário: <em>Uso: Terraform</em></p>
<p><img
        class="lazyload"
        src="/svg/loading.min.svg"
        data-src="/posts/terraform-modules-porque-e-comop1/terraform_aws5.jpg"
        data-srcset="/posts/terraform-modules-porque-e-comop1/terraform_aws5.jpg, /posts/terraform-modules-porque-e-comop1/terraform_aws5.jpg 1.5x, /posts/terraform-modules-porque-e-comop1/terraform_aws5.jpg 2x"
        data-sizes="auto"
        alt="/posts/terraform-modules-porque-e-comop1/terraform_aws5.jpg"
        title="AWS IAM" width="900" height="342" /></p>
<p><strong>C</strong>lique no botão azul do canto inferior direito, <strong>Próximo: Revisar</strong> <em>(Next: Review)</em>.</p>
<p><strong>C</strong>ertifique-se de que está tudo certo quanto ao seu novo usuário e em seguida clique no botão azul <strong>Criar Usuário</strong> <em>(Create user)</em>.</p>
<p><img
        class="lazyload"
        src="/svg/loading.min.svg"
        data-src="/posts/terraform-modules-porque-e-comop1/terraform_aws6.jpg"
        data-srcset="/posts/terraform-modules-porque-e-comop1/terraform_aws6.jpg, /posts/terraform-modules-porque-e-comop1/terraform_aws6.jpg 1.5x, /posts/terraform-modules-porque-e-comop1/terraform_aws6.jpg 2x"
        data-sizes="auto"
        alt="/posts/terraform-modules-porque-e-comop1/terraform_aws6.jpg"
        title="AWS IAM" width="850" height="680" /></p>
<p><strong>ATENÇÃO!</strong> Tenha cuidado nesta tela seguinte, pois esta será a única vez em que a senha de sua chave será apresentada. Clique no botão <strong>Fazer download .csv</strong> <em>(Download .csv)</em> para realizar o download de um arquivo .csv com sua chave e senha, ou apenas copie o conteúdo exibido na tela para sua chave e senha após clicar em <strong>Exibir</strong> <em>(Show)</em> no campo de senha da chave e salve estes dados em algum local seguro, pois você precisará destes dois valores para controlar sua conta AWS programaticamente com este usuário.</p>
<p><img
        class="lazyload"
        src="/svg/loading.min.svg"
        data-src="/posts/terraform-modules-porque-e-comop1/terraform_aws7.jpg"
        data-srcset="/posts/terraform-modules-porque-e-comop1/terraform_aws7.jpg, /posts/terraform-modules-porque-e-comop1/terraform_aws7.jpg 1.5x, /posts/terraform-modules-porque-e-comop1/terraform_aws7.jpg 2x"
        data-sizes="auto"
        alt="/posts/terraform-modules-porque-e-comop1/terraform_aws7.jpg"
        title="AWS IAM" width="850" height="383" /></p>
<p><strong>C</strong>om seu usuário criado, clique no botão do canto inferior direito <strong>Fechar</strong> <em>(Close)</em>.</p>
<h2 id="criando-vms-no-aws-com-terraform">Criando VMs no AWS com Terraform</h2>
<p><strong>A</strong>ssumindo que você já possui uma conta no AWS e um usuário com chave para acesso, vamos exportar nossa chave de acesso e nossa senha para esta chave. No Linux ou OS X, execute:</p>
<div class="code-block code-line-numbers open" style="counter-reset: code-block 0">
    <div class="code-header language-bash">
        <span class="code-title"><i class="arrow fas fa-angle-right fa-fw" aria-hidden="true"></i></span>
        <span class="ellipses"><i class="fas fa-ellipsis-h fa-fw" aria-hidden="true"></i></span>
        <span class="copy" title="Copiar para a área de transferência"><i class="far fa-copy fa-fw" aria-hidden="true"></i></span>
    </div><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">$ <span class="nb">export</span> <span class="nv">AWS_ACCESS_KEY_ID</span><span class="o">=</span>&lt;SUA_CHAVE_AUI&gt;
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">$ <span class="nb">export</span> <span class="nv">AWS_SECRET_ACCESS_KEY</span><span class="o">=</span>&lt;SUA_SENHA_PARA_A_CHAVE_AQUI&gt;</span></span></code></pre></div></div>
<p><strong>V</strong>ocê poderá confirmar que seus comandos deram certo digitando:</p>
<div class="code-block code-line-numbers open" style="counter-reset: code-block 0">
    <div class="code-header language-bash">
        <span class="code-title"><i class="arrow fas fa-angle-right fa-fw" aria-hidden="true"></i></span>
        <span class="ellipses"><i class="fas fa-ellipsis-h fa-fw" aria-hidden="true"></i></span>
        <span class="copy" title="Copiar para a área de transferência"><i class="far fa-copy fa-fw" aria-hidden="true"></i></span>
    </div><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">$ <span class="nb">echo</span> <span class="nv">$AWS_ACCESS_KEY_ID</span> <span class="o">&amp;&amp;</span> <span class="nb">echo</span> <span class="nv">$AWS_SECRET_ACCESS_KEY</span></span></span></code></pre></div></div>
<p><strong>C</strong>aso sua chave e senha tenham sido exibidas, podemos partir para o Terraform.</p>
<p><strong>N</strong>ovamente, estou assumindo que você já possui um conhecimento básico de Terraform, visto que o foco deste post não é explicar detalhadamente o funcionamento do mesmo, mas sim explicar como e porque utilizar módulos no Terraform.</p>
<p><strong>C</strong>omecemos criando uma instância ou VM Ubuntu Linux simples.</p>
<p><strong>I</strong>niciemos criando um diretório para nosso projeto e em seguida indo para dentro do mesmo com algum terminal ou console:</p>
<div class="code-block code-line-numbers open" style="counter-reset: code-block 0">
    <div class="code-header language-bash">
        <span class="code-title"><i class="arrow fas fa-angle-right fa-fw" aria-hidden="true"></i></span>
        <span class="ellipses"><i class="fas fa-ellipsis-h fa-fw" aria-hidden="true"></i></span>
        <span class="copy" title="Copiar para a área de transferência"><i class="far fa-copy fa-fw" aria-hidden="true"></i></span>
    </div><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">$ mkdir terraform
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">$ <span class="nb">cd</span> terraform</span></span></code></pre></div></div>
<p><strong>A</strong> forma mais simplificada de iniciar nosso projeto e criar uma simples instância Ubuntu seria criando um arquivo <em>main.tf</em> e inserindo o seguinte conteúdo no mesmo:</p>
<div class="code-block" style="counter-reset: code-block -1">
    <div class="code-header language-py">
        <span class="code-title"><i class="arrow fas fa-angle-right fa-fw" aria-hidden="true"></i></span>
        <span class="ellipses"><i class="fas fa-ellipsis-h fa-fw" aria-hidden="true"></i></span>
        <span class="copy" title="Copiar para a área de transferência"><i class="far fa-copy fa-fw" aria-hidden="true"></i></span>
    </div><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-py" data-lang="py"><span class="line"><span class="cl"><span class="c1"># Criando uma Instância Ubuntu no AWS</span>
</span></span><span class="line"><span class="cl"><span class="n">provider</span> <span class="s2">&#34;aws&#34;</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="n">region</span> <span class="o">=</span> <span class="s2">&#34;us-east-1&#34;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">resource</span> <span class="s2">&#34;aws_instance&#34;</span> <span class="s2">&#34;server1&#34;</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="n">ami</span>           <span class="o">=</span> <span class="s2">&#34;ami-0a313d6098716f372&#34;</span>
</span></span><span class="line"><span class="cl">  <span class="n">instance_type</span> <span class="o">=</span> <span class="s2">&#34;t2.micro&#34;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="n">tags</span> <span class="o">=</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="n">Name</span>     <span class="o">=</span> <span class="s2">&#34;Ubuntu-1&#34;</span>
</span></span><span class="line"><span class="cl">    <span class="n">Ambiente</span> <span class="o">=</span> <span class="s2">&#34;Desenvolvimento&#34;</span>
</span></span><span class="line"><span class="cl">  <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span></span></span></code></pre></div></div>

<p><strong>O</strong>bviamente este código é extremamente simplista. Sequer estamos definindo variáveis, mas chegaremos lá.</p>
<p><strong>O</strong> que fizemos:</p>
<ol>
<li>Indicamos que o nosso <em>provider</em> será o <strong>AWS</strong>;</li>
<li>Criamos um <em>resource</em> do tipo <strong>aws_instance</strong>;</li>
<li>Indicamos qual o ID exato da imagem que queremos utilizar para nossa instância. A lista completa de AMI ou imagens disponibilizadas pelo AWS pode ser encontrada <a href="https://console.aws.amazon.com/ec2/" target="_blank" rel="noopener noreffer ">aqui</a>;</li>
<li>Indiquei o tipo de instância como sendo <em>t2.micro</em>. Cada tipo de instância representa uma configuração diferente em termos de CPU, memória, etc. Uma lista completa com todos os tipos disponíveis pode ser encontrada <a href="https://aws.amazon.com/sap/instance-types/" target="_blank" rel="noopener noreffer ">aqui</a></li>
<li>Inseri algumas tags para seguir melhores práticas e deixar nossa infraestrutura organizada e catalogada;</li>
</ol>
<p><strong>P</strong>rimeiramente, vamos testar nosso código e ver se estamos com acesso ao AWS via Terraform.</p>
<p><strong>V</strong>amos validar que não temos esta instância já criada no AWS clicando em <strong>Serviços</strong> <em>(Services)</em> e em seguida buscando o serviço <strong>EC2</strong>:</p>
<p><img
        class="lazyload"
        src="/svg/loading.min.svg"
        data-src="/posts/terraform-modules-porque-e-comop1/terraform_aws8.jpg"
        data-srcset="/posts/terraform-modules-porque-e-comop1/terraform_aws8.jpg, /posts/terraform-modules-porque-e-comop1/terraform_aws8.jpg 1.5x, /posts/terraform-modules-porque-e-comop1/terraform_aws8.jpg 2x"
        data-sizes="auto"
        alt="/posts/terraform-modules-porque-e-comop1/terraform_aws8.jpg"
        title="AWS IAM" width="680" height="437" /></p>
<p><strong>E</strong>m seguida clique em <strong>Instâncias</strong> <em>(Instances)</em> no menu esquerdo para listar suas instâncias:</p>
<p><img
        class="lazyload"
        src="/svg/loading.min.svg"
        data-src="/posts/terraform-modules-porque-e-comop1/terraform_aws9.jpg"
        data-srcset="/posts/terraform-modules-porque-e-comop1/terraform_aws9.jpg, /posts/terraform-modules-porque-e-comop1/terraform_aws9.jpg 1.5x, /posts/terraform-modules-porque-e-comop1/terraform_aws9.jpg 2x"
        data-sizes="auto"
        alt="/posts/terraform-modules-porque-e-comop1/terraform_aws9.jpg"
        title="AWS IAM" width="950" height="450" /></p>
<p><strong>D</strong>e volta ao nosso terminal, no diretório onde criamos nosso arquivo <em>main.tf</em>, vamos iniciar o terraform com <em>terraform init .</em> :</p>
<div class="code-block code-line-numbers" style="counter-reset: code-block 0">
    <div class="code-header language-bash">
        <span class="code-title"><i class="arrow fas fa-angle-right fa-fw" aria-hidden="true"></i></span>
        <span class="ellipses"><i class="fas fa-ellipsis-h fa-fw" aria-hidden="true"></i></span>
        <span class="copy" title="Copiar para a área de transferência"><i class="far fa-copy fa-fw" aria-hidden="true"></i></span>
    </div><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">$ terraform init .
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">Initializing provider plugins...
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">The following providers <span class="k">do</span> not have any version constraints in configuration,
</span></span><span class="line"><span class="cl">so the latest version was installed.
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">To prevent automatic upgrades to new major versions that may contain breaking
</span></span><span class="line"><span class="cl">changes, it is recommended to add <span class="nv">version</span> <span class="o">=</span> <span class="s2">&#34;...&#34;</span> constraints to the
</span></span><span class="line"><span class="cl">corresponding provider blocks in configuration, with the constraint strings
</span></span><span class="line"><span class="cl">suggested below.
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">* provider.aws: <span class="nv">version</span> <span class="o">=</span> <span class="s2">&#34;~&gt; 2.11&#34;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">Terraform has been successfully initialized!
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">You may now begin working with Terraform. Try running <span class="s2">&#34;terraform plan&#34;</span> to see
</span></span><span class="line"><span class="cl">any changes that are required <span class="k">for</span> your infrastructure. All Terraform commands
</span></span><span class="line"><span class="cl">should now work.
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">If you ever <span class="nb">set</span> or change modules or backend configuration <span class="k">for</span> Terraform,
</span></span><span class="line"><span class="cl">rerun this <span class="nb">command</span> to reinitialize your working directory. If you forget, other
</span></span><span class="line"><span class="cl">commands will detect it and remind you to <span class="k">do</span> so <span class="k">if</span> necessary.</span></span></code></pre></div></div>
<p><strong>C</strong>aso você não tenha recebido um erro com o <em>init</em>, podemos executar o nosso plano ou <em>plan</em>:</p>
<div class="code-block code-line-numbers" style="counter-reset: code-block 0">
    <div class="code-header language-bash">
        <span class="code-title"><i class="arrow fas fa-angle-right fa-fw" aria-hidden="true"></i></span>
        <span class="ellipses"><i class="fas fa-ellipsis-h fa-fw" aria-hidden="true"></i></span>
        <span class="copy" title="Copiar para a área de transferência"><i class="far fa-copy fa-fw" aria-hidden="true"></i></span>
    </div><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">$ terraform plan
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">Refreshing Terraform state in-memory prior to plan...
</span></span><span class="line"><span class="cl">The refreshed state will be used to calculate this plan, but will not be
</span></span><span class="line"><span class="cl">persisted to <span class="nb">local</span> or remote state storage.
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">------------------------------------------------------------------------
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">An execution plan has been generated and is shown below.
</span></span><span class="line"><span class="cl">Resource actions are indicated with the following symbols:
</span></span><span class="line"><span class="cl">  + create
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">Terraform will perform the following actions:
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  + aws_instance.server1
</span></span><span class="line"><span class="cl">      id:                           &lt;computed&gt;
</span></span><span class="line"><span class="cl">      ami:                          <span class="s2">&#34;ami-0a313d6098716f372&#34;</span>
</span></span><span class="line"><span class="cl">      arn:                          &lt;computed&gt;
</span></span><span class="line"><span class="cl">      associate_public_ip_address:  &lt;computed&gt;
</span></span><span class="line"><span class="cl">      availability_zone:            &lt;computed&gt;
</span></span><span class="line"><span class="cl">      cpu_core_count:               &lt;computed&gt;
</span></span><span class="line"><span class="cl">      cpu_threads_per_core:         &lt;computed&gt;
</span></span><span class="line"><span class="cl">      ebs_block_device.#:           &lt;computed&gt;
</span></span><span class="line"><span class="cl">      ephemeral_block_device.#:     &lt;computed&gt;
</span></span><span class="line"><span class="cl">      get_password_data:            <span class="s2">&#34;false&#34;</span>
</span></span><span class="line"><span class="cl">      host_id:                      &lt;computed&gt;
</span></span><span class="line"><span class="cl">      instance_state:               &lt;computed&gt;
</span></span><span class="line"><span class="cl">      instance_type:                <span class="s2">&#34;t2.micro&#34;</span>
</span></span><span class="line"><span class="cl">      ipv6_address_count:           &lt;computed&gt;
</span></span><span class="line"><span class="cl">      ipv6_addresses.#:             &lt;computed&gt;
</span></span><span class="line"><span class="cl">      key_name:                     &lt;computed&gt;
</span></span><span class="line"><span class="cl">      network_interface.#:          &lt;computed&gt;
</span></span><span class="line"><span class="cl">      network_interface_id:         &lt;computed&gt;
</span></span><span class="line"><span class="cl">      password_data:                &lt;computed&gt;
</span></span><span class="line"><span class="cl">      placement_group:              &lt;computed&gt;
</span></span><span class="line"><span class="cl">      primary_network_interface_id: &lt;computed&gt;
</span></span><span class="line"><span class="cl">      private_dns:                  &lt;computed&gt;
</span></span><span class="line"><span class="cl">      private_ip:                   &lt;computed&gt;
</span></span><span class="line"><span class="cl">      public_dns:                   &lt;computed&gt;
</span></span><span class="line"><span class="cl">      public_ip:                    &lt;computed&gt;
</span></span><span class="line"><span class="cl">      root_block_device.#:          &lt;computed&gt;
</span></span><span class="line"><span class="cl">      security_groups.#:            &lt;computed&gt;
</span></span><span class="line"><span class="cl">      source_dest_check:            <span class="s2">&#34;true&#34;</span>
</span></span><span class="line"><span class="cl">      subnet_id:                    &lt;computed&gt;
</span></span><span class="line"><span class="cl">      tags.%:                       <span class="s2">&#34;2&#34;</span>
</span></span><span class="line"><span class="cl">      tags.Ambiente:                <span class="s2">&#34;Desenvolvimento&#34;</span>
</span></span><span class="line"><span class="cl">      tags.Name:                    <span class="s2">&#34;Ubuntu-1&#34;</span>
</span></span><span class="line"><span class="cl">      tenancy:                      &lt;computed&gt;
</span></span><span class="line"><span class="cl">      volume_tags.%:                &lt;computed&gt;
</span></span><span class="line"><span class="cl">      vpc_security_group_ids.#:     &lt;computed&gt;
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">Plan: <span class="m">1</span> to add, <span class="m">0</span> to change, <span class="m">0</span> to destroy.
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">------------------------------------------------------------------------
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">Note: You didn<span class="s1">&#39;t specify an &#34;-out&#34; parameter to save this plan, so Terraform
</span></span></span><span class="line"><span class="cl"><span class="s1">can&#39;</span>t guarantee that exactly these actions will be performed <span class="k">if</span>
</span></span><span class="line"><span class="cl"><span class="s2">&#34;terraform apply&#34;</span> is subsequently run.</span></span></code></pre></div></div>
<p><strong>T</strong>udo parece certo no plano, portanto o próximo passo será aplicarmos este código:</p>
<div class="code-block code-line-numbers" style="counter-reset: code-block 0">
    <div class="code-header language-bash">
        <span class="code-title"><i class="arrow fas fa-angle-right fa-fw" aria-hidden="true"></i></span>
        <span class="ellipses"><i class="fas fa-ellipsis-h fa-fw" aria-hidden="true"></i></span>
        <span class="copy" title="Copiar para a área de transferência"><i class="far fa-copy fa-fw" aria-hidden="true"></i></span>
    </div><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">$ terraform apply
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">An execution plan has been generated and is shown below.
</span></span><span class="line"><span class="cl">Resource actions are indicated with the following symbols:
</span></span><span class="line"><span class="cl">  + create
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">Terraform will perform the following actions:
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  + aws_instance.server1
</span></span><span class="line"><span class="cl">      id:                           &lt;computed&gt;
</span></span><span class="line"><span class="cl">      ami:                          <span class="s2">&#34;ami-0a313d6098716f372&#34;</span>
</span></span><span class="line"><span class="cl">      arn:                          &lt;computed&gt;
</span></span><span class="line"><span class="cl">      associate_public_ip_address:  &lt;computed&gt;
</span></span><span class="line"><span class="cl">      availability_zone:            &lt;computed&gt;
</span></span><span class="line"><span class="cl">      cpu_core_count:               &lt;computed&gt;
</span></span><span class="line"><span class="cl">      cpu_threads_per_core:         &lt;computed&gt;
</span></span><span class="line"><span class="cl">      ebs_block_device.#:           &lt;computed&gt;
</span></span><span class="line"><span class="cl">      ephemeral_block_device.#:     &lt;computed&gt;
</span></span><span class="line"><span class="cl">      get_password_data:            <span class="s2">&#34;false&#34;</span>
</span></span><span class="line"><span class="cl">      host_id:                      &lt;computed&gt;
</span></span><span class="line"><span class="cl">      instance_state:               &lt;computed&gt;
</span></span><span class="line"><span class="cl">      instance_type:                <span class="s2">&#34;t2.micro&#34;</span>
</span></span><span class="line"><span class="cl">      ipv6_address_count:           &lt;computed&gt;
</span></span><span class="line"><span class="cl">      ipv6_addresses.#:             &lt;computed&gt;
</span></span><span class="line"><span class="cl">      key_name:                     &lt;computed&gt;
</span></span><span class="line"><span class="cl">      network_interface.#:          &lt;computed&gt;
</span></span><span class="line"><span class="cl">      network_interface_id:         &lt;computed&gt;
</span></span><span class="line"><span class="cl">      password_data:                &lt;computed&gt;
</span></span><span class="line"><span class="cl">      placement_group:              &lt;computed&gt;
</span></span><span class="line"><span class="cl">      primary_network_interface_id: &lt;computed&gt;
</span></span><span class="line"><span class="cl">      private_dns:                  &lt;computed&gt;
</span></span><span class="line"><span class="cl">      private_ip:                   &lt;computed&gt;
</span></span><span class="line"><span class="cl">      public_dns:                   &lt;computed&gt;
</span></span><span class="line"><span class="cl">      public_ip:                    &lt;computed&gt;
</span></span><span class="line"><span class="cl">      root_block_device.#:          &lt;computed&gt;
</span></span><span class="line"><span class="cl">      security_groups.#:            &lt;computed&gt;
</span></span><span class="line"><span class="cl">      source_dest_check:            <span class="s2">&#34;true&#34;</span>
</span></span><span class="line"><span class="cl">      subnet_id:                    &lt;computed&gt;
</span></span><span class="line"><span class="cl">      tags.%:                       <span class="s2">&#34;2&#34;</span>
</span></span><span class="line"><span class="cl">      tags.Ambiente:                <span class="s2">&#34;Desenvolvimento&#34;</span>
</span></span><span class="line"><span class="cl">      tags.Name:                    <span class="s2">&#34;Ubuntu-1&#34;</span>
</span></span><span class="line"><span class="cl">      tenancy:                      &lt;computed&gt;
</span></span><span class="line"><span class="cl">      volume_tags.%:                &lt;computed&gt;
</span></span><span class="line"><span class="cl">      vpc_security_group_ids.#:     &lt;computed&gt;
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">Plan: <span class="m">1</span> to add, <span class="m">0</span> to change, <span class="m">0</span> to destroy.
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">Do you want to perform these actions?
</span></span><span class="line"><span class="cl">  Terraform will perform the actions described above.
</span></span><span class="line"><span class="cl">  Only <span class="s1">&#39;yes&#39;</span> will be accepted to approve.
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  Enter a value: yes
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">aws_instance.server1: Creating...
</span></span><span class="line"><span class="cl">  ami:                          <span class="s2">&#34;&#34;</span> <span class="o">=</span>&gt; <span class="s2">&#34;ami-0a313d6098716f372&#34;</span>
</span></span><span class="line"><span class="cl">  arn:                          <span class="s2">&#34;&#34;</span> <span class="o">=</span>&gt; <span class="s2">&#34;&lt;computed&gt;&#34;</span>
</span></span><span class="line"><span class="cl">  associate_public_ip_address:  <span class="s2">&#34;&#34;</span> <span class="o">=</span>&gt; <span class="s2">&#34;&lt;computed&gt;&#34;</span>
</span></span><span class="line"><span class="cl">  availability_zone:            <span class="s2">&#34;&#34;</span> <span class="o">=</span>&gt; <span class="s2">&#34;&lt;computed&gt;&#34;</span>
</span></span><span class="line"><span class="cl">  cpu_core_count:               <span class="s2">&#34;&#34;</span> <span class="o">=</span>&gt; <span class="s2">&#34;&lt;computed&gt;&#34;</span>
</span></span><span class="line"><span class="cl">  cpu_threads_per_core:         <span class="s2">&#34;&#34;</span> <span class="o">=</span>&gt; <span class="s2">&#34;&lt;computed&gt;&#34;</span>
</span></span><span class="line"><span class="cl">  ebs_block_device.#:           <span class="s2">&#34;&#34;</span> <span class="o">=</span>&gt; <span class="s2">&#34;&lt;computed&gt;&#34;</span>
</span></span><span class="line"><span class="cl">  ephemeral_block_device.#:     <span class="s2">&#34;&#34;</span> <span class="o">=</span>&gt; <span class="s2">&#34;&lt;computed&gt;&#34;</span>
</span></span><span class="line"><span class="cl">  get_password_data:            <span class="s2">&#34;&#34;</span> <span class="o">=</span>&gt; <span class="s2">&#34;false&#34;</span>
</span></span><span class="line"><span class="cl">  host_id:                      <span class="s2">&#34;&#34;</span> <span class="o">=</span>&gt; <span class="s2">&#34;&lt;computed&gt;&#34;</span>
</span></span><span class="line"><span class="cl">  instance_state:               <span class="s2">&#34;&#34;</span> <span class="o">=</span>&gt; <span class="s2">&#34;&lt;computed&gt;&#34;</span>
</span></span><span class="line"><span class="cl">  instance_type:                <span class="s2">&#34;&#34;</span> <span class="o">=</span>&gt; <span class="s2">&#34;t2.micro&#34;</span>
</span></span><span class="line"><span class="cl">  ipv6_address_count:           <span class="s2">&#34;&#34;</span> <span class="o">=</span>&gt; <span class="s2">&#34;&lt;computed&gt;&#34;</span>
</span></span><span class="line"><span class="cl">  ipv6_addresses.#:             <span class="s2">&#34;&#34;</span> <span class="o">=</span>&gt; <span class="s2">&#34;&lt;computed&gt;&#34;</span>
</span></span><span class="line"><span class="cl">  key_name:                     <span class="s2">&#34;&#34;</span> <span class="o">=</span>&gt; <span class="s2">&#34;&lt;computed&gt;&#34;</span>
</span></span><span class="line"><span class="cl">  network_interface.#:          <span class="s2">&#34;&#34;</span> <span class="o">=</span>&gt; <span class="s2">&#34;&lt;computed&gt;&#34;</span>
</span></span><span class="line"><span class="cl">  network_interface_id:         <span class="s2">&#34;&#34;</span> <span class="o">=</span>&gt; <span class="s2">&#34;&lt;computed&gt;&#34;</span>
</span></span><span class="line"><span class="cl">  password_data:                <span class="s2">&#34;&#34;</span> <span class="o">=</span>&gt; <span class="s2">&#34;&lt;computed&gt;&#34;</span>
</span></span><span class="line"><span class="cl">  placement_group:              <span class="s2">&#34;&#34;</span> <span class="o">=</span>&gt; <span class="s2">&#34;&lt;computed&gt;&#34;</span>
</span></span><span class="line"><span class="cl">  primary_network_interface_id: <span class="s2">&#34;&#34;</span> <span class="o">=</span>&gt; <span class="s2">&#34;&lt;computed&gt;&#34;</span>
</span></span><span class="line"><span class="cl">  private_dns:                  <span class="s2">&#34;&#34;</span> <span class="o">=</span>&gt; <span class="s2">&#34;&lt;computed&gt;&#34;</span>
</span></span><span class="line"><span class="cl">  private_ip:                   <span class="s2">&#34;&#34;</span> <span class="o">=</span>&gt; <span class="s2">&#34;&lt;computed&gt;&#34;</span>
</span></span><span class="line"><span class="cl">  public_dns:                   <span class="s2">&#34;&#34;</span> <span class="o">=</span>&gt; <span class="s2">&#34;&lt;computed&gt;&#34;</span>
</span></span><span class="line"><span class="cl">  public_ip:                    <span class="s2">&#34;&#34;</span> <span class="o">=</span>&gt; <span class="s2">&#34;&lt;computed&gt;&#34;</span>
</span></span><span class="line"><span class="cl">  root_block_device.#:          <span class="s2">&#34;&#34;</span> <span class="o">=</span>&gt; <span class="s2">&#34;&lt;computed&gt;&#34;</span>
</span></span><span class="line"><span class="cl">  security_groups.#:            <span class="s2">&#34;&#34;</span> <span class="o">=</span>&gt; <span class="s2">&#34;&lt;computed&gt;&#34;</span>
</span></span><span class="line"><span class="cl">  source_dest_check:            <span class="s2">&#34;&#34;</span> <span class="o">=</span>&gt; <span class="s2">&#34;true&#34;</span>
</span></span><span class="line"><span class="cl">  subnet_id:                    <span class="s2">&#34;&#34;</span> <span class="o">=</span>&gt; <span class="s2">&#34;&lt;computed&gt;&#34;</span>
</span></span><span class="line"><span class="cl">  tags.%:                       <span class="s2">&#34;&#34;</span> <span class="o">=</span>&gt; <span class="s2">&#34;2&#34;</span>
</span></span><span class="line"><span class="cl">  tags.Ambiente:                <span class="s2">&#34;&#34;</span> <span class="o">=</span>&gt; <span class="s2">&#34;Desenvolvimento&#34;</span>
</span></span><span class="line"><span class="cl">  tags.Name:                    <span class="s2">&#34;&#34;</span> <span class="o">=</span>&gt; <span class="s2">&#34;Ubuntu-1&#34;</span>
</span></span><span class="line"><span class="cl">  tenancy:                      <span class="s2">&#34;&#34;</span> <span class="o">=</span>&gt; <span class="s2">&#34;&lt;computed&gt;&#34;</span>
</span></span><span class="line"><span class="cl">  volume_tags.%:                <span class="s2">&#34;&#34;</span> <span class="o">=</span>&gt; <span class="s2">&#34;&lt;computed&gt;&#34;</span>
</span></span><span class="line"><span class="cl">  vpc_security_group_ids.#:     <span class="s2">&#34;&#34;</span> <span class="o">=</span>&gt; <span class="s2">&#34;&lt;computed&gt;&#34;</span>
</span></span><span class="line"><span class="cl">aws_instance.server1: Still creating... <span class="o">(</span>10s elapsed<span class="o">)</span>
</span></span><span class="line"><span class="cl">aws_instance.server1: Still creating... <span class="o">(</span>20s elapsed<span class="o">)</span>
</span></span><span class="line"><span class="cl">aws_instance.server1: Still creating... <span class="o">(</span>30s elapsed<span class="o">)</span>
</span></span><span class="line"><span class="cl">aws_instance.server1: Creation <span class="nb">complete</span> after 34s <span class="o">(</span>ID: i-0cc1dcdbee6a81644<span class="o">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">Apply complete! Resources: <span class="m">1</span> added, <span class="m">0</span> changed, <span class="m">0</span> destroyed.</span></span></code></pre></div></div>
<p><strong>Ó</strong>timo. Nenhum erro e um <em>resource</em> criado. Se atualizarmos a lista de instâncias em nossa interface do AWS, deveremos ver nossa nova instância Ubuntu criada.</p>
<p><img
        class="lazyload"
        src="/svg/loading.min.svg"
        data-src="/posts/terraform-modules-porque-e-comop1/terraform_aws10.jpg"
        data-srcset="/posts/terraform-modules-porque-e-comop1/terraform_aws10.jpg, /posts/terraform-modules-porque-e-comop1/terraform_aws10.jpg 1.5x, /posts/terraform-modules-porque-e-comop1/terraform_aws10.jpg 2x"
        data-sizes="auto"
        alt="/posts/terraform-modules-porque-e-comop1/terraform_aws10.jpg"
        title="AWS IAM" width="950" height="450" /></p>
<p><strong>T</strong>udo certo. Nossa instância foi criada e está disponível para acesso.</p>
<p><strong>M</strong>as tudo ainda está muito simples e desorganizado. Vamos destruir a nossa infraestrutura para melhorarmos um pouco. Utilizaremos <em>terraform destroy</em> para destruir tudo o que foi criado:</p>
<div class="code-block code-line-numbers" style="counter-reset: code-block 0">
    <div class="code-header language-bash">
        <span class="code-title"><i class="arrow fas fa-angle-right fa-fw" aria-hidden="true"></i></span>
        <span class="ellipses"><i class="fas fa-ellipsis-h fa-fw" aria-hidden="true"></i></span>
        <span class="copy" title="Copiar para a área de transferência"><i class="far fa-copy fa-fw" aria-hidden="true"></i></span>
    </div><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">$ terraform destroy
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">aws_instance.server1: Refreshing state... <span class="o">(</span>ID: i-0cc1dcdbee6a81644<span class="o">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">An execution plan has been generated and is shown below.
</span></span><span class="line"><span class="cl">Resource actions are indicated with the following symbols:
</span></span><span class="line"><span class="cl">  - destroy
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">Terraform will perform the following actions:
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  - aws_instance.server1
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">Plan: <span class="m">0</span> to add, <span class="m">0</span> to change, <span class="m">1</span> to destroy.
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">Do you really want to destroy all resources?
</span></span><span class="line"><span class="cl">  Terraform will destroy all your managed infrastructure, as shown above.
</span></span><span class="line"><span class="cl">  There is no undo. Only <span class="s1">&#39;yes&#39;</span> will be accepted to confirm.
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  Enter a value: yes
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">aws_instance.server1: Destroying... <span class="o">(</span>ID: i-0cc1dcdbee6a81644<span class="o">)</span>
</span></span><span class="line"><span class="cl">aws_instance.server1: Still destroying... <span class="o">(</span>ID: i-0cc1dcdbee6a81644, 10s elapsed<span class="o">)</span>
</span></span><span class="line"><span class="cl">aws_instance.server1: Still destroying... <span class="o">(</span>ID: i-0cc1dcdbee6a81644, 20s elapsed<span class="o">)</span>
</span></span><span class="line"><span class="cl">aws_instance.server1: Destruction <span class="nb">complete</span> after 21s
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">Destroy complete! Resources: <span class="m">1</span> destroyed.</span></span></code></pre></div></div>
<p><strong>A</strong>ntes de mais nada, vamos organizar o código e criar algumas variáveis.</p>
<p><strong>C</strong>omecemos criando um arquivo chamado <em>variables.tf</em> no mesmo diretório onde se encontra o arquivo main.tf e insira as seguintes variáveis nele:</p>
<div class="code-block" style="counter-reset: code-block -1">
    <div class="code-header language-py">
        <span class="code-title"><i class="arrow fas fa-angle-right fa-fw" aria-hidden="true"></i></span>
        <span class="ellipses"><i class="fas fa-ellipsis-h fa-fw" aria-hidden="true"></i></span>
        <span class="copy" title="Copiar para a área de transferência"><i class="far fa-copy fa-fw" aria-hidden="true"></i></span>
    </div><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-py" data-lang="py"><span class="line"><span class="cl"><span class="n">variable</span> <span class="s2">&#34;region&#34;</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="nb">type</span>        <span class="o">=</span> <span class="s2">&#34;string&#34;</span>
</span></span><span class="line"><span class="cl">  <span class="n">description</span> <span class="o">=</span> <span class="s2">&#34;Região no AWS onde nossos recursos estarão.&#34;</span>
</span></span><span class="line"><span class="cl">  <span class="n">default</span>     <span class="o">=</span> <span class="s2">&#34;us-east-1&#34;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">variable</span> <span class="s2">&#34;ami&#34;</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="nb">type</span>        <span class="o">=</span> <span class="s2">&#34;string&#34;</span>
</span></span><span class="line"><span class="cl">  <span class="n">description</span> <span class="o">=</span> <span class="s2">&#34;Id da imagem EC2 que desejamos utilizar para nossa instância.&#34;</span>
</span></span><span class="line"><span class="cl">  <span class="n">default</span>     <span class="o">=</span> <span class="s2">&#34;ami-0a313d6098716f372&#34;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">variable</span> <span class="s2">&#34;instance_type&#34;</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="nb">type</span>        <span class="o">=</span> <span class="s2">&#34;string&#34;</span>
</span></span><span class="line"><span class="cl">  <span class="n">description</span> <span class="o">=</span> <span class="s2">&#34;Tipo de instância a ser utilizado&#34;</span>
</span></span><span class="line"><span class="cl">  <span class="n">default</span>     <span class="o">=</span> <span class="s2">&#34;t2.micro&#34;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">variable</span> <span class="s2">&#34;tags&#34;</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="nb">type</span>        <span class="o">=</span> <span class="s2">&#34;map&#34;</span>
</span></span><span class="line"><span class="cl">  <span class="n">description</span> <span class="o">=</span> <span class="s2">&#34;Tags a serem aplicadas à nossa instância.&#34;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="n">default</span> <span class="o">=</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="s2">&#34;Name&#34;</span>     <span class="o">=</span> <span class="s2">&#34;Ubuntu-1&#34;</span>
</span></span><span class="line"><span class="cl">    <span class="s2">&#34;Ambiente&#34;</span> <span class="o">=</span> <span class="s2">&#34;Desenvolvimento&#34;</span>
</span></span><span class="line"><span class="cl">  <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span></span></span></code></pre></div></div>

<p><strong>A</strong>gora que temos nosso arquivo de variáveis, vamos limpar nosso arquivo <em>main.tf</em> para que ele faça uso destas variáveis, eliminando assim valores codificados diretamente em nosso arquivo principal. O arquivo <em>main.tf</em> deverá ficar assim:</p>
<div class="code-block open" style="counter-reset: code-block -1">
    <div class="code-header language-py">
        <span class="code-title"><i class="arrow fas fa-angle-right fa-fw" aria-hidden="true"></i></span>
        <span class="ellipses"><i class="fas fa-ellipsis-h fa-fw" aria-hidden="true"></i></span>
        <span class="copy" title="Copiar para a área de transferência"><i class="far fa-copy fa-fw" aria-hidden="true"></i></span>
    </div><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-py" data-lang="py"><span class="line"><span class="cl"><span class="n">provider</span> <span class="s2">&#34;aws&#34;</span> <span class="p">{</span>
</span></span><span class="line hl"><span class="cl">  <span class="n">region</span> <span class="o">=</span> <span class="s2">&#34;$</span><span class="si">{var.region}</span><span class="s2">&#34;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">resource</span> <span class="s2">&#34;aws_instance&#34;</span> <span class="s2">&#34;server1&#34;</span> <span class="p">{</span>
</span></span><span class="line hl"><span class="cl">  <span class="n">ami</span>           <span class="o">=</span> <span class="s2">&#34;$</span><span class="si">{var.ami}</span><span class="s2">&#34;</span>
</span></span><span class="line hl"><span class="cl">  <span class="n">instance_type</span> <span class="o">=</span> <span class="s2">&#34;$</span><span class="si">{var.instance_type}</span><span class="s2">&#34;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line hl"><span class="cl">  <span class="n">tags</span> <span class="o">=</span> <span class="s2">&#34;$</span><span class="si">{var.tags}</span><span class="s2">&#34;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span></span></span></code></pre></div></div>

<p><strong>E</strong>mbora tenhamos organizado melhor nosso código, nada de fato mudou no resultado.</p>
<p><strong>S</strong>inta-se livre para rodar <em>terraform plan</em> e <em>terraform apply</em> em seguida para constatar que ele apenas criará a mesma instância novamente, caso você tenha destruído a anterior com <em>terraform destroy</em>, claro.</p>
<p><strong>A</strong>pós testar, lembre-se de limpar sua infraestrutura novamente com <em>terraform destroy</em>, pois estamos apenas testando nosso código por enquanto.</p>
<p><strong>A</strong>té então temos apenas o código que cria uma instância Ubuntu comum e vazia. Agora que temos este código pronto, a gerência da empresa na qual você trabalha lhe pede que crie um projeto chamado <em>Webserver</em>. Tudo o que este projeto precisa ter por enquanto é uma instância Ubuntu. Ela não precisa possuir de fato um servidor web instalado neste momento.</p>
<p><strong>V</strong>ocê é esperto e já tinha o código pronto, apenas não possuia um projeto para utilizá-lo. Neste caso, vamos começar a organizar nossos projetos. O que temos até então é um diretório qualquer, que no meu caso se chama <em>terraform</em>, e dentro dele temos dois arquivos principais:</p>
<ul>
<li>main.tf</li>
<li>variables.tf</li>
</ul>
<p><strong>A</strong>lém deles, o Terraform terá criado alguns arquivos de <em>state</em> onde ele armazena as informações sobre o estado de sua infraestrutura, bem como um diretório oculto <em>.terraform</em>.</p>
<p><strong>V</strong>amos criar um diretório para nosso novo projeto. O novo diretório deverá se chamar <em>webserver</em>. Este deverá ser criado dentro do seu diretório original. Além disso, agora podemos mover nossos arquivos para dentro de nosso diretório de projeto. Sua estrutura de diretórios e arquivos agora deverá ser similar a esta: (Os arquivos realmente importantes são <em>main.tf</em> e <em>variables.tf</em>, visto que como destruimos nossa infraestrutura por completo, podemos facilmente ter novos arquivos de state.)</p>
<div class="code-block code-line-numbers open" style="counter-reset: code-block 0">
    <div class="code-header language-bash">
        <span class="code-title"><i class="arrow fas fa-angle-right fa-fw" aria-hidden="true"></i></span>
        <span class="ellipses"><i class="fas fa-ellipsis-h fa-fw" aria-hidden="true"></i></span>
        <span class="copy" title="Copiar para a área de transferência"><i class="far fa-copy fa-fw" aria-hidden="true"></i></span>
    </div><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">terraform
</span></span><span class="line"><span class="cl">└── webserver
</span></span><span class="line"><span class="cl">    ├── main.tf
</span></span><span class="line"><span class="cl">    ├── terraform.tfstate
</span></span><span class="line"><span class="cl">    ├── terraform.tfstate.backup
</span></span><span class="line"><span class="cl">    └── variables.tf</span></span></code></pre></div></div>
<p><strong>I</strong>magine que além do projeto webserver, agora você precisará se preparar para o projeto que rodará um banco de dados em uma instância também Ubuntu. Por enquanto tudo o que será preciso fazer é criar um diretório para o projeto <em>db</em> e criar o código que criará uma instância Ubuntu.</p>
<p><strong>C</strong>omo já temos o código que faz isso, podemos simplesmente copiar os mesmos dois arquivos <em>main.tf</em> e <em>variables.tf</em> para dentro de um novo diretório chamado <em>db</em> e alterar alguns valores neles, certo?!</p>
<p><strong>S</strong>endo assim, nossa árvore de diretórios agora estará assim:</p>
<div class="code-block code-line-numbers open" style="counter-reset: code-block 0">
    <div class="code-header language-bash">
        <span class="code-title"><i class="arrow fas fa-angle-right fa-fw" aria-hidden="true"></i></span>
        <span class="ellipses"><i class="fas fa-ellipsis-h fa-fw" aria-hidden="true"></i></span>
        <span class="copy" title="Copiar para a área de transferência"><i class="far fa-copy fa-fw" aria-hidden="true"></i></span>
    </div><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">terraform
</span></span><span class="line"><span class="cl">└── db
</span></span><span class="line"><span class="cl">    ├── main.tf
</span></span><span class="line"><span class="cl">    ├── variables.tf
</span></span><span class="line"><span class="cl">└── webserver
</span></span><span class="line"><span class="cl">    ├── main.tf
</span></span><span class="line"><span class="cl">    ├── terraform.tfstate
</span></span><span class="line"><span class="cl">    ├── terraform.tfstate.backup
</span></span><span class="line"><span class="cl">    └── variables.tf</span></span></code></pre></div></div>
<p><strong>C</strong>omo já tínhamos isolado nossas variáveis, não precisaremos tocar nos arquivos <em>main.tf</em>. Podemos alterar apenas valores das variáveis desejadas nos respectivos arquivos <em>variables.tf</em>.</p>
<p><strong>C</strong>omeçando pelo <em>variables.tf</em> do projeto <strong>webserver</strong>, alteraremos apenas a variável de tags, que agora ficará assim:</p>
<div class="code-block open" style="counter-reset: code-block -1">
    <div class="code-header language-py">
        <span class="code-title"><i class="arrow fas fa-angle-right fa-fw" aria-hidden="true"></i></span>
        <span class="ellipses"><i class="fas fa-ellipsis-h fa-fw" aria-hidden="true"></i></span>
        <span class="copy" title="Copiar para a área de transferência"><i class="far fa-copy fa-fw" aria-hidden="true"></i></span>
    </div><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-py" data-lang="py"><span class="line"><span class="cl"><span class="n">variable</span> <span class="s2">&#34;region&#34;</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="nb">type</span>        <span class="o">=</span> <span class="s2">&#34;string&#34;</span>
</span></span><span class="line"><span class="cl">  <span class="n">description</span> <span class="o">=</span> <span class="s2">&#34;Região no AWS onde nossos recursos estarão.&#34;</span>
</span></span><span class="line"><span class="cl">  <span class="n">default</span>     <span class="o">=</span> <span class="s2">&#34;us-east-1&#34;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">variable</span> <span class="s2">&#34;ami&#34;</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="nb">type</span>        <span class="o">=</span> <span class="s2">&#34;string&#34;</span>
</span></span><span class="line"><span class="cl">  <span class="n">description</span> <span class="o">=</span> <span class="s2">&#34;Id da imagem EC2 que desejamos utilizar para nossa instância.&#34;</span>
</span></span><span class="line"><span class="cl">  <span class="n">default</span>     <span class="o">=</span> <span class="s2">&#34;ami-0a313d6098716f372&#34;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">variable</span> <span class="s2">&#34;instance_type&#34;</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="nb">type</span>        <span class="o">=</span> <span class="s2">&#34;string&#34;</span>
</span></span><span class="line"><span class="cl">  <span class="n">description</span> <span class="o">=</span> <span class="s2">&#34;Tipo de instância a ser utilizado&#34;</span>
</span></span><span class="line"><span class="cl">  <span class="n">default</span>     <span class="o">=</span> <span class="s2">&#34;t2.micro&#34;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">variable</span> <span class="s2">&#34;tags&#34;</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="nb">type</span>        <span class="o">=</span> <span class="s2">&#34;map&#34;</span>
</span></span><span class="line"><span class="cl">  <span class="n">description</span> <span class="o">=</span> <span class="s2">&#34;Tags a serem aplicadas à nossa instância.&#34;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="n">default</span> <span class="o">=</span> <span class="p">{</span>
</span></span><span class="line hl"><span class="cl">    <span class="s2">&#34;Name&#34;</span>     <span class="o">=</span> <span class="s2">&#34;Ubuntu-webserver&#34;</span>
</span></span><span class="line hl"><span class="cl">    <span class="s2">&#34;Ambiente&#34;</span> <span class="o">=</span> <span class="s2">&#34;Desenvolvimento&#34;</span>
</span></span><span class="line hl"><span class="cl">    <span class="s2">&#34;Projeto&#34;</span>  <span class="o">=</span> <span class="s2">&#34;Webserver&#34;</span>
</span></span><span class="line"><span class="cl">  <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span></span></span></code></pre></div></div>

<p><strong>A</strong>lteramos apenas o nome da instância para <em>Ubuntu-webserver</em> e adicionamos uma tag para o <em>projeto</em>.</p>
<p><strong>A</strong>gora faremos algo similar no arquivo <em>variables.tf</em> do projeto <strong>db</strong>, ficando assim:</p>
<div class="code-block open" style="counter-reset: code-block -1">
    <div class="code-header language-py">
        <span class="code-title"><i class="arrow fas fa-angle-right fa-fw" aria-hidden="true"></i></span>
        <span class="ellipses"><i class="fas fa-ellipsis-h fa-fw" aria-hidden="true"></i></span>
        <span class="copy" title="Copiar para a área de transferência"><i class="far fa-copy fa-fw" aria-hidden="true"></i></span>
    </div><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-py" data-lang="py"><span class="line"><span class="cl"><span class="n">variable</span> <span class="s2">&#34;region&#34;</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="nb">type</span>        <span class="o">=</span> <span class="s2">&#34;string&#34;</span>
</span></span><span class="line"><span class="cl">  <span class="n">description</span> <span class="o">=</span> <span class="s2">&#34;Região no AWS onde nossos recursos estarão.&#34;</span>
</span></span><span class="line"><span class="cl">  <span class="n">default</span>     <span class="o">=</span> <span class="s2">&#34;us-east-1&#34;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">variable</span> <span class="s2">&#34;ami&#34;</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="nb">type</span>        <span class="o">=</span> <span class="s2">&#34;string&#34;</span>
</span></span><span class="line"><span class="cl">  <span class="n">description</span> <span class="o">=</span> <span class="s2">&#34;Id da imagem EC2 que desejamos utilizar para nossa instância.&#34;</span>
</span></span><span class="line"><span class="cl">  <span class="n">default</span>     <span class="o">=</span> <span class="s2">&#34;ami-0a313d6098716f372&#34;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">variable</span> <span class="s2">&#34;instance_type&#34;</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="nb">type</span>        <span class="o">=</span> <span class="s2">&#34;string&#34;</span>
</span></span><span class="line"><span class="cl">  <span class="n">description</span> <span class="o">=</span> <span class="s2">&#34;Tipo de instância a ser utilizado&#34;</span>
</span></span><span class="line"><span class="cl">  <span class="n">default</span>     <span class="o">=</span> <span class="s2">&#34;t2.micro&#34;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">variable</span> <span class="s2">&#34;tags&#34;</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="nb">type</span>        <span class="o">=</span> <span class="s2">&#34;map&#34;</span>
</span></span><span class="line"><span class="cl">  <span class="n">description</span> <span class="o">=</span> <span class="s2">&#34;Tags a serem aplicadas à nossa instância.&#34;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="n">default</span> <span class="o">=</span> <span class="p">{</span>
</span></span><span class="line hl"><span class="cl">    <span class="s2">&#34;Name&#34;</span>     <span class="o">=</span> <span class="s2">&#34;Ubuntu-db&#34;</span>
</span></span><span class="line hl"><span class="cl">    <span class="s2">&#34;Ambiente&#34;</span> <span class="o">=</span> <span class="s2">&#34;Desenvolvimento&#34;</span>
</span></span><span class="line hl"><span class="cl">    <span class="s2">&#34;Projeto&#34;</span>  <span class="o">=</span> <span class="s2">&#34;Db&#34;</span>
</span></span><span class="line"><span class="cl">  <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span></span></span></code></pre></div></div>

<p><strong>N</strong>este momento não temos nenhuma instância rodando, pois exluímos a que criamos anteriormente com <em>terraform destroy</em>.</p>
<p><strong>V</strong>amos validar nosso código agora. Primeiramente, vamos executar os seguintes comandos de dentro do diretório <em>db</em>:</p>
<div class="code-block code-line-numbers open" style="counter-reset: code-block 0">
    <div class="code-header language-bash">
        <span class="code-title"><i class="arrow fas fa-angle-right fa-fw" aria-hidden="true"></i></span>
        <span class="ellipses"><i class="fas fa-ellipsis-h fa-fw" aria-hidden="true"></i></span>
        <span class="copy" title="Copiar para a área de transferência"><i class="far fa-copy fa-fw" aria-hidden="true"></i></span>
    </div><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">$ terraform init .
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">$ terraform plan
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">$ terraform apply</span></span></code></pre></div></div>
<p><strong>E</strong>m seguida, de dentro do diretório <em>webserver</em> execute também os comandos:</p>
<div class="code-block code-line-numbers open" style="counter-reset: code-block 0">
    <div class="code-header language-bash">
        <span class="code-title"><i class="arrow fas fa-angle-right fa-fw" aria-hidden="true"></i></span>
        <span class="ellipses"><i class="fas fa-ellipsis-h fa-fw" aria-hidden="true"></i></span>
        <span class="copy" title="Copiar para a área de transferência"><i class="far fa-copy fa-fw" aria-hidden="true"></i></span>
    </div><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">$ terraform plan
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">$ terraform apply</span></span></code></pre></div></div>
<p><strong>O</strong> motivo pelo qual não precisamos executar <em>terraform init .</em> para o projeto <em>webserver</em> é por já termos feito isso anteriormente, portanto já devemos ter os arquivos de configuração e state do Terraform dentro de nosso diretório webserver. Caso contrário, execute <em>terraform init .</em> antes do <em>plan</em>.</p>
<p><strong>S</strong>e verificarmos nossas instâncias no AWS agora, devemos ter as duas instâncias: <em>Ubuntu-webserver</em> e <em>Ubuntu-db</em>.</p>
<p><img
        class="lazyload"
        src="/svg/loading.min.svg"
        data-src="/posts/terraform-modules-porque-e-comop1/terraform_aws11.jpg"
        data-srcset="/posts/terraform-modules-porque-e-comop1/terraform_aws11.jpg, /posts/terraform-modules-porque-e-comop1/terraform_aws11.jpg 1.5x, /posts/terraform-modules-porque-e-comop1/terraform_aws11.jpg 2x"
        data-sizes="auto"
        alt="/posts/terraform-modules-porque-e-comop1/terraform_aws11.jpg"
        title="AWS IAM" width="880" height="350" /></p>
<p><strong>J</strong>á vimos que nossas duas instâncias podem ser criadas com nosso código mas até então elas não fazem nada além de simplesmente existir.</p>
<p><strong>V</strong>amos destruir tudo o que foi criado para não gastarmos nossos créditos AWS de forma desnecessária. Execute <em>terraform destroy</em> a partir de ambos os diretórios, <em>db</em> e <em>webserver</em> para garantir que ambas as instâncias serão destruídas.</p>
<p><strong>N</strong>a PARTE 2 deste tutorial criaremos então o código que defato definirá e criará um servidor web e um servidor de banco de dados rapidamente.</p></div><div class="post-footer" id="post-footer">
    <div class="post-info">
        <div class="post-info-line">
            <div class="post-info-mod">
                <span>Atualizado em 2019-05-17</span>
            </div></div>
        <div class="post-info-line">
            <div class="post-info-md"></div>
            <div class="post-info-share">
                <span><a href="javascript:void(0);" title="Compartilhe em X" data-sharer="x" data-url="//blog.marcelocavalcante.net:1313/posts/terraform-modules-porque-e-comop1/" data-title="Terraform Modules: Porquê E Como Trabalhar Com Módulos No Terraform - PARTE 1" data-via="Marcelo_Kalib" data-hashtags="Devops,Terraform,Cloud,AWS"><i class="fab fa-x-twitter fa-fw" aria-hidden="true"></i></a><a href="javascript:void(0);" title="Compartilhe em Threads" data-sharer="threads" data-url="//blog.marcelocavalcante.net:1313/posts/terraform-modules-porque-e-comop1/" data-title="Terraform Modules: Porquê E Como Trabalhar Com Módulos No Terraform - PARTE 1"><i class="fab fa-threads fa-fw" aria-hidden="true"></i></a><a href="javascript:void(0);" title="Compartilhe em Facebook" data-sharer="facebook" data-url="//blog.marcelocavalcante.net:1313/posts/terraform-modules-porque-e-comop1/" data-hashtag="Devops"><i class="fab fa-facebook-square fa-fw" aria-hidden="true"></i></a><a href="javascript:void(0);" title="Compartilhe em Linkedin" data-sharer="linkedin" data-url="//blog.marcelocavalcante.net:1313/posts/terraform-modules-porque-e-comop1/"><i class="fab fa-linkedin fa-fw" aria-hidden="true"></i></a><a href="javascript:void(0);" title="Compartilhe em Hacker News" data-sharer="hackernews" data-url="//blog.marcelocavalcante.net:1313/posts/terraform-modules-porque-e-comop1/" data-title="Terraform Modules: Porquê E Como Trabalhar Com Módulos No Terraform - PARTE 1"><i class="fab fa-hacker-news fa-fw" aria-hidden="true"></i></a><a href="javascript:void(0);" title="Compartilhe em Line" data-sharer="line" data-url="//blog.marcelocavalcante.net:1313/posts/terraform-modules-porque-e-comop1/" data-title="Terraform Modules: Porquê E Como Trabalhar Com Módulos No Terraform - PARTE 1"><i data-svg-src="https://cdn.jsdelivr.net/npm/simple-icons@15.14.0/icons/line.svg" aria-hidden="true"></i></a><a href="javascript:void(0);" title="Compartilhe em 微博" data-sharer="weibo" data-url="//blog.marcelocavalcante.net:1313/posts/terraform-modules-porque-e-comop1/" data-title="Terraform Modules: Porquê E Como Trabalhar Com Módulos No Terraform - PARTE 1"><i class="fab fa-weibo fa-fw" aria-hidden="true"></i></a><a href="javascript:void(0);" title="Compartilhe em Diaspora" data-sharer="diaspora" data-url="//blog.marcelocavalcante.net:1313/posts/terraform-modules-porque-e-comop1/" data-title="Terraform Modules: Porquê E Como Trabalhar Com Módulos No Terraform - PARTE 1" data-description="Todos sabem que o Terraform é uma solucão fantástica para criar infraestrutura através de código, porém nem todos utilizam as diversas possibilidades do mesmo, como por exemplos módulos. Com módulos podemos fazer a reutilização de código para nossa infraestrutura."><i class="fab fa-diaspora fa-fw" aria-hidden="true"></i></a><a href="https://t.me/share/url?url=%2f%2fblog.marcelocavalcante.net%3a1313%2fposts%2fterraform-modules-porque-e-comop1%2f&amp;text=Terraform%20Modules%3a%20Porqu%c3%aa%20E%20Como%20Trabalhar%20Com%20M%c3%b3dulos%20No%20Terraform%20-%20PARTE%201" target="_blank" title="Compartilhe em Telegram"><i class="fab fa-telegram fa-fw" aria-hidden="true"></i></a></span>
            </div>
        </div>
    </div>

    <div class="post-info-more">
        <section class="post-tags"><i class="fas fa-tags fa-fw" aria-hidden="true"></i>&nbsp;<a href="/tags/devops/">Devops</a>,&nbsp;<a href="/tags/terraform/">Terraform</a>,&nbsp;<a href="/tags/cloud/">Cloud</a>,&nbsp;<a href="/tags/aws/">AWS</a></section>
        <section>
            <span><a href="javascript:void(0);" onclick="window.history.back();">Voltar</a></span>&nbsp;|&nbsp;<span><a href="/">Home</a></span>
        </section>
    </div>

    <div class="post-nav"><a href="/posts/go-ou-golang-porque-adotei/" class="prev" rel="prev" title="Go Ou Golang: Porquê Adotei Go Como Minha Linguagem Favorita"><i class="fas fa-angle-left fa-fw" aria-hidden="true"></i>Go Ou Golang: Porquê Adotei Go Como Minha Linguagem Favorita</a>
            <a href="/posts/terraform-modules-porque-e-como/" class="next" rel="next" title="Terraform Modules: Porquê E Como Trabalhar Com Módulos No Terraform - PARTE 2">Terraform Modules: Porquê E Como Trabalhar Com Módulos No Terraform - PARTE 2<i class="fas fa-angle-right fa-fw" aria-hidden="true"></i></a></div>
</div>
<div id="comments"><div id="disqus_thread" class="comment"></div><noscript>
                Please enable JavaScript to view the comments powered by <a href="https://disqus.com/?ref_noscript">Disqus</a>.
            </noscript></div></article></div>
            </main><footer class="footer">
        <div class="footer-container"><div class="footer-line">Possibilitado por <a href="https://gohugo.io/" target="_blank" rel="noopener noreffer" title="Hugo 0.145.0">Hugo</a> | Tema - <a href="https://github.com/dillonzq/LoveIt" target="_blank" rel="noopener noreffer" title="LoveIt 0.3.1-DEV"><i class="far fa-kiss-wink-heart fa-fw" aria-hidden="true"></i> LoveIt</a>
                </div><div class="footer-line" itemscope itemtype="http://schema.org/CreativeWork"><i class="far fa-copyright fa-fw" aria-hidden="true"></i><span itemprop="copyrightYear">2008 - 2025</span><span class="author" itemprop="copyrightHolder">&nbsp;<a href="https://blog.marcelocavalcante.net" target="_blank">Marcelo Cavalcante</a></span></div>
        </div>
    </footer></div>

        <div id="fixed-buttons"><a href="#" id="back-to-top" class="fixed-button" title="Voltar ao topo">
                <i class="fas fa-arrow-up fa-fw" aria-hidden="true"></i>
            </a>
        </div>

        <div id="fixed-buttons-hidden"><a href="#" id="view-comments" class="fixed-button" title="Ver comentários">
                <i class="fas fa-comment fa-fw" aria-hidden="true"></i>
            </a>
        </div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/lightgallery@2.5.0/css/lightgallery-bundle.min.css"><script src="https://marcelocavalcante.disqus.com/embed.js" defer></script><script src="https://cdn.jsdelivr.net/npm/autocomplete.js@0.38.1/dist/autocomplete.min.js"></script><script src="https://cdn.jsdelivr.net/npm/lunr@2.3.9/lunr.min.js"></script><script src="/lib/lunr/lunr.stemmer.support.min.js"></script><script src="/lib/lunr/lunr.pt.min.js"></script><script src="https://cdn.jsdelivr.net/npm/lazysizes@5.3.2/lazysizes.min.js"></script><script src="https://cdn.jsdelivr.net/npm/lightgallery@2.5.0/lightgallery.min.js"></script><script src="https://cdn.jsdelivr.net/npm/lightgallery@2.5.0/plugins/thumbnail/lg-thumbnail.min.js"></script><script src="https://cdn.jsdelivr.net/npm/lightgallery@2.5.0/plugins/zoom/lg-zoom.min.js"></script><script src="https://cdn.jsdelivr.net/npm/clipboard@2.0.11/dist/clipboard.min.js"></script><script src="https://cdn.jsdelivr.net/npm/sharer.js@0.5.2/sharer.min.js"></script><script>window.config={"comment":{},"lightgallery":true,"search":{"highlightTag":"em","lunrIndexURL":"/index.json","lunrLanguageCode":"pt","maxResultLength":10,"noResultsFound":"Nenhum resultado encontrado","snippetLength":30,"type":"lunr"}};</script><script src="/js/theme.min.js"></script></body>
</html>

<script>
    document.addEventListener('DOMContentLoaded', function() {
        var searchIndex;

        fetch('/lunr.json')
            .then(response => response.json())
            .then(data => {
                searchIndex = lunr(function () {
                    this.field('title');
                    this.field('content');
                    this.field('tags');
                    this.ref('uri');

                    data.forEach(doc => {
                        this.add(doc);
                    });
                });
            });

        function performSearch(query) {
            if (searchIndex) {
                var results = searchIndex.search(query);
                displayResults(results);
            }
        }

        function displayResults(results) {
            var resultsContainer = document.getElementById('search-results');
            resultsContainer.innerHTML = '';
            results.forEach(result => {
                var item = document.createElement('div');
                item.innerHTML = `<a href="${result.ref}">${result.ref}</a>`;
                resultsContainer.appendChild(item);
            });
        }

        var searchInputDesktop = document.getElementById('search-input-desktop');
        if (searchInputDesktop) {
            searchInputDesktop.addEventListener('input', function() {
                performSearch(searchInputDesktop.value);
            });
        }

        var searchInputMobile = document.getElementById('search-input-mobile');
        if (searchInputMobile) {
            searchInputMobile.addEventListener('input', function() {
                performSearch(searchInputMobile.value);
            });
        }
    });
</script>
